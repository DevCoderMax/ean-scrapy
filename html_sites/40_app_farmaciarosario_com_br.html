<!DOCTYPE html>
<html lang="pt-br">





<style>
 .new-pbm {
    border: solid 2px #00af66;
    color: #00af66;
    transform: skewX(-10deg);
    border-radius: 0.5rem;
    height: 35px;
}
/* .ativar-desconto {
    display: block;
    width: 200px;
    height: 35px;
    line-height: 40px;
    font-size: 18px;
    font-family: sans-serif;
    text-decoration: none;
    color: #333;
    letter-spacing: 2px;
    text-align: center;
    position: relative;
    transition: all .80s;
}
.ativar-desconto .span {
    position: relative;
    z-index: 2;
  }

  .carrinho-body::-webkit-scrollbar {
    width: 0.5em;
}

.carrinho-body::-webkit-scrollbar-thumb {
    background-color: transparent;
}

.carrinho-body::-webkit-scrollbar-track {
    background-color: transparent;
}

.carrinho-body {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

.carrinho-body {
    -ms-overflow-style: none;
}

.ativar-desconto:after{
    position: absolute;
    content: "";
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: #00af66;
    color: #fff !important;
    transition: all .80s;
  }

.ativar-desconto:hover{
    color: #fff !important;
    z-index: 2;
}

.ativar-desconto:hover:after{
    width: 100%;
} */
.icone-white {
    filter: invert(98%) sepia(156%) saturate(82%) hue-rotate(92deg) brightness(203%) contrast(100%);
}
.icone-pbm {
    background-color: #00af66;
    height: 33px;
    border-radius: 3px;
    align-items: center;
    display: flex;
}
/* .btn-submit {
    -webkit-box-align: center;
    -ms-flex-align: center;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    align-items: center;
    background-color: #636363;
    border-radius: 4px;
    color: #fff;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: 29px;
    justify-content: center;
    position: absolute;
    right: 3px;
    top: 3px;
    width: 29px;
} */
.selector-qtd {
    transform: skewX(-10deg);
    border-radius: 0.5rem;
}

.sub-categoria-scroll{
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    -ms-overflow-style: none;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

.sub-categoria-scroll::-webkit-scrollbar {
    width: 12px;
}

.sub-categoria-scroll::-webkit-scrollbar-thumb {
    background-color: transparent;
}

.sub-categoria-scroll::-webkit-scrollbar-track {
    background-color: transparent;
}

.subsubcategoria-scroll{
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    -ms-overflow-style: none;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

.subsubcategoria-scroll::-webkit-scrollbar {
    width: 12px;
}

.subsubcategoria-scroll::-webkit-scrollbar-thumb {
    background-color: transparent;
}

.subsubcategoria-scroll::-webkit-scrollbar-track {
    background-color: transparent;
}

.popupInformacaoLojas{
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    -ms-overflow-style: none;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

.popupInformacaoLojas::-webkit-scrollbar {
    width: 12px;
}

.popupInformacaoLojas::-webkit-scrollbar-thumb {
    background-color: transparent;
}

.popupInformacaoLojas::-webkit-scrollbar-track {
    background-color: transparent;
}

#carrinho-body{
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    -ms-overflow-style: none;
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
}

#carrinho-body::-webkit-scrollbar {
    width: 12px;
}

#carrinho-body::-webkit-scrollbar-thumb {
    background-color: transparent;
}

#carrinho-body::-webkit-scrollbar-track {
    background-color: transparent;
}

</style>

<head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 ">
    <meta name="description" content="
None
">
    <meta property="og:image" content="/media/logos_e_banners/logo_rosario.png" />
    <meta content='pt_BR' property='og:locale'>
<meta content='' property='fb:app_id'>
<meta property="og:type" content="website">
<meta content='https://www.farmaciarosario.com.br' property='og:url'>
<meta content='Farmácia Rosário'  property='og:title'>
<meta content='1280'  property='og:image:width'>
<meta content='720' property='og:image:height'>
<meta content='Farmácia Rosário' property='og:description'>
<meta content='Farmácia Rosário' property='og:site_name'>
    <meta name="keywords" content="farmácia online,medicamentos,saúde e bem-estar,produtos farmacêuticos,cuidados com a saúde,cosméticos,promoções de saúde,remédios online,entrega rápida,produtos de qualidade,beleza,descontos em saúde,variedade de produtos,compras online,farmácia confiável,atendimento ao cliente,ofertas especiais,compras seguras,conveniência em saúde">

    <title>
    Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML | Farmácia Rosário - Farmácia Online com Delivery | Desde 1931
</title>
    <link rel="icon" href="/media/estrutura/icones/favicon.png" />

    <meta name="google-site-verification" content="SENHA" />
    <!-- Confirmação Pinterest -->
    <meta name="p:domain_verify" content="ef2516d7c9c7335dcbf46e9af44aa45f"/>
    <!-- end Confirmação Pinterest -->













    <script src="https://assets.pagar.me/pagarme-js/4.5/pagarme.min.js"/>

    <noscript>
        <img src="https://device.clearsale.com.br/p/fp.png?sid=None&app=None&ns=1" />
    </noscript>
    <script>
        function checkUrl(url){
            let request = new XMLHttpRequest();
            request.open( "GET", url, true );
            request.send(null);
            request.onerror = (event) => {
                request.open("GET", "https://web.fpcs-monitor.com.br/p/fp.png?sid=None&app=None&bl=1", false);
                request.send(null);
            }
        }
        checkUrl("https://device.clearsale.com.br/p/fp.png");
    </script>

    <script>
        (function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:3567234,hjsv:6};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>

    <script> (function(w,d,t,r,u) { var f,n,i; w[u]=w[u]||[],f=function() { var o={ti:"343061149", enableAutoSpaTracking: true}; o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad") }, n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function() { var s=this.readyState; s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null) }, i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i) }) (window,document,"script","//bat.bing.com/bat.js","uetq"); </script>

    <link rel="preload" as="style" onload="this.rel = 'stylesheet'"
          href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap">

    <!-- Global site tag (gtag.js) - Google Analytics -->
   <script defer src="https://www.googletagmanager.com/gtag/js?id=G-09RPC7SELW"></script>


<link rel="canonical" href="app.farmaciarosario.com.br/desodorante-aerosol-nivea-invisible-black-white-clear-200ml" />


<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T52Q99V');</script>
<!-- End Google Tag Manager -->

<!-- Global site tag (gtag.js) - Google Analytics MerchanCenter -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-09RPC7SELW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-09RPC7SELW');
</script>
    <meta name="facebook-domain-verification" content="e44cf0lriljd3x93sebz6jq8m8llhp" />

    <!-- Css do componente Select2 -->
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/select2/css/select2.min.4da043bff9ea.css">

    <!-- Css Font awesome -->
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'"
          href="/staticfiles/css/font-awesome/css/font-awesome.min.a61dc01fabae.css">
    <!-- Ícones -->
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/css/fontface/icone_pin/icone_menu/icons_menu.min.70eb19e2e113.css">
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'"
          href="/staticfiles/css/fontface/icone_pin/icons_pin.3e018ec3b221.css">

    <link rel="preload" as="style" onload="this.rel = 'stylesheet'"
          href="/staticfiles/bootstrap-4.4.1/dist/css/bootstrap.min.1a5e2c5cdd19.css">
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/css/cores.min.a66cdf801af6.css">
    <style>
        /* Feel free to change duration */
        .animated {
            -webkit-animation-duration: 300ms;
            animation-duration: 300ms;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }

        .owl-animated-out {
            z-index: 0;
        }

        .fadeOut {
            z-index: 0;
        }

        .owl-item.active {
            z-index: 1 !important;
        }

        .owl-item.active {
            -webkit-animation-name: slideron;
            animation-name: slideron;
        }

        @-webkit-keyframes slideron {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes slideron {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        :root {
            /*
                Cores padrões
                */

            --syndiMosaicContentZIndex: 1;

            --white: #fff;
            --no-white: #FFF;
            --white-secondary: #f7f7f7;
            --white-secondary-hover: #e4e7ea;
            --global-bg-color: #FFF;
            --texto: #444;
            --ice-blue: #edeff0;
            --windows-blue: #3d85c6;
            --sunflower-yellow: #ffd200;
            --blue-gray: #8a9297;
            /* cores do padrão 1 */
            --mundo-padrao1-1: #f6fffb;
            --mundo-padrao1-2: #00af66;
            /* cores padrao 2 */
            --mundo-padrao2-1: #fffdfd;
            --mundo-padrao2-2: #e682a9;
            /* cores padrao 3 */
            --mundo-padrao3-1: #ad7c59;
            --mundo-padrao3-2: #fffdfc;
            /* cores padrao 4 */
            --mundo-padrao4-1: #8986ca;
            --mundo-padrao4-2: #fbfaff;
            /* cores padrao 5 segue as mesmas cores do padrao 1
                cores padrao 6 segue mesmo padrão do navy-blue */
            /* cores padrao 7 */
            --mundo-padrao7-1: #fe0b00;
            --mundo-padrao7-2: #fffbfa;
            /* cores padrao marcas */
            --mundo-marcas-1: var(--light-navy-blue);
            --mundo-marcas-2: #f6fbff;


            --pale-sky-blue: #d7e1e7;

            /*
                cool blue
                */
            --primary: #3d85c6;
            --primary-hover: #397dba;

            /*
                light-navy
                */
            --light-navy: #18537d;
            --light-navy-hover: #144466;

            /*
                light-navy-blue
                */
            --light-navy-blue: #315c8e;
            --light-navy-blue-hover: #2b527e;

            --marine: #083050;

            --outline-primary: #FFF;
            --outline-primary-hover: #E8F8FF;

            --secondary: #d7e1e7;
            --secondary-hover: #bdc6cb;

            --success: #9FC44E;
            --success-hover: #3ea662;

            --info: #294d80;
            --info-hover: #22406a;

            --warning: #fcb514;
            --warning-hover: #e3a312;


            --danger: #ee3a41;
            --danger-hover: #d7343b;

            --light: #f0f3f5;
            --light-hover: #d9e1e6;
            --muted: #8a9297;

            --dark-80: rgba(0, 0, 0, 0.8);
            --dark-50: rgba(0, 0, 0, 0.5);
            --dark-35: rgba(0, 0, 0, 0.35);
            --dark-20: rgba(0, 0, 0, 0.2);
            --dark-10: rgba(0, 0, 0, 0.1);
            --dark-5: rgba(0, 0, 0, 0.05);

            --tabela: #EFF3F5;
            --tabela-hover: #dce0e2;

            --cinza-escuro-medio: #444444;
            --cinza-escuro: #838383;

            /*
                Fim Cores Padrões
                 */

            /*
                Tamanhos de telas utilizados para @media responsive
                 */
            --breakpoint-xs: 0;
            --breakpoint-sm: 576px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 992px;
            --breakpoint-xl: 1200px;
            /*
                Fim
                 */

            /*
                Cores personalizadas e icones do cliente
                 */

            --amarelo-cliente: #ffd200;

            /*
                   N Amarelo
                */
            --cliente-icone-warning-btn: url("/staticfiles/img/logos_e_banners/n-amarelo.png");

            /*
                    Azul
                 */
            --cliente-color-primary: #18537d;
            --cliente-color-primary-hover: #144467;
            --cliente-icone-primary-btn: url("/staticfiles/img/logos_e_banners/n-azul.png");
        }


        .d-none-valor-banco {
            display: none
        }

        #form_upload_receita_carrinho .labl>input+label:hover, #form_upload_receita_carrinho .labl>input:checked+label{
            background-color: #3f84c7 !important;
        }

        #form_upload_receita_carrinho .labl.labl-receita>input+label:hover *, #form_upload_receita_carrinho .labl.labl-receita>input:checked+label *{
            color: white !important;
        }

        #form_upload_receita_carrinho .labl>input.is-invalid+label{
            border-color: var(--danger) !important;
        }

        #form_upload_receita_carrinho .labl>input.is-valid+label{
            border-color: var(--success) !important;
        }

        #form_upload_receita_carrinho .is-invalid .filepond--drop-label{
            border: 1px solid var(--danger) !important;
            border-radius: .25rem;
        }

        #form_upload_receita_carrinho .is-valid .filepond--drop-label{
            border: 1px solid var(--danger) !important;
            border-radius: .25rem;
        }

    </style>
    

    <!-- Filepond -->
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/filepond/filepond.f276ce2940dc.css">

    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/css/style.min.f9b41f2da366.css">

    <!-- Css OWL Carousel -->
    <link rel="stylesheet" href="/staticfiles/OwlCarousel2-2.3.4/dist/assets/owl.carousel.min.4ef5d2056b19.css">
    <link rel="prefetch" as="style" onload="this.rel = 'stylesheet'"
          href="/staticfiles/OwlCarousel2-2.3.4/dist/assets/owl.theme.default.min.c3fc96aad995.css">

    <!-- Toastr, Alerta de sucesso ou error css -->
    <link rel="preload" as="style" onload="this.rel = 'stylesheet'" href="/staticfiles/toastr/css/toastr.min.16d7ebcdac95.css">

    <!-- datepicker -->
    <link rel="prefetch" as="style" onload="this.rel = 'stylesheet'"
          href="/staticfiles/datepicker/css/datepicker.min.726d9ae81d84.css">
    <link rel="stylesheet" href="/staticfiles/ecommerce_menu/css/style.min.b340c92e21f7.css">

    <link rel="stylesheet" href="/staticfiles/css/carrinho.min.0ecba3dc9cb9.css">

    <style>
        .load {
            z-index: 1000;
            width: 100%;
            height: 100%;
            left: 0
        }

        .load::before {
            content: " ";
            width: 100%;
            height: 100%;
            opacity: .5;
            background: var(--light);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10291
        }

        @keyframes loaderpng {
            0% {
                content: url(/staticfiles/img/loader/loader-torii-0.png);
            }

            5% {
                content: url(/staticfiles/img/loader/loader-torii-1.png);
            }

            10% {
                content: url(/staticfiles/img/loader/loader-torii-2.png);
            }

            15% {
                content: url(/staticfiles/img/loader/loader-torii-3.png);
            }

            20% {
                content: url(/staticfiles/img/loader/loader-torii-4.png);
            }

            25% {
                content: url(/staticfiles/img/loader/loader-torii-5.png);
            }

            30% {
                content: url(/staticfiles/img/loader/loader-torii-6.png);
            }

            35% {
                content: url(/staticfiles/img/loader/loader-torii-7.png);
            }

            40% {
                content: url(/staticfiles/img/loader/loader-torii-8.png);
            }

            45% {
                content: url(/staticfiles/img/loader/loader-torii-9.png);
            }

            50% {
                content: url(/staticfiles/img/loader/loader-torii-10.png);
            }

            55% {
                content: url(/staticfiles/img/loader/loader-torii-11.png);
            }

            60% {
                content: url(/staticfiles/img/loader/loader-torii-12.png);
            }

            65% {
                content: url(/staticfiles/img/loader/loader-torii-13.png);
            }

            70% {
                content: url(/staticfiles/img/loader/loader-torii-14.png);
            }

            75% {
                content: url(/staticfiles/img/loader/loader-torii-15.png);
            }

            80% {
                content: url(/staticfiles/img/loader/loader-torii-16.png);
            }

            85% {
                /* content: url(staticfiles/img/loader/loader-torii-17.png); */
            }

            90% {
                content: url(/staticfiles/img/loader/loader-torii-18.png);
            }

            95% {
                content: url(/staticfiles/img/loader/loader-torii-19.png);
            }

            100% {
                content: url(/staticfiles/img/loader/loader-torii-20.png);
            }
        }

        .load .toriload {
            content: " ";
            width: 16% !important;
            z-index: 10292;
            position: relative;
            top: 30%;
            left: 41%;
        }

        fieldset:not(.form-group-float) .select2-selection__rendered {
            padding: 3px 0 0 0 !important;
            font-size: 0.85rem !important;
            color: #545454;
        }

        .select2-container--bootstrap .select2-selection--single .select2-selection__arrow {
            position: absolute;
            bottom: 0;
            right: 0.75rem;


            width: 30px;
            height: 30px;

            margin-bottom: auto;
            margin-top: auto;

            background-color: #137ec2;
            border-color: transparent;

            font-weight: 400;
            color: #fff !important;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            border-radius: 0.25rem;
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;

            -ms-flex-align: center !important;
            align-items: center !important;
            -ms-flex-pack: center !important;
            justify-content: center !important;
            display: -ms-flexbox !important;
            display: flex !important;

            font-family: pin-icons !important;
            font-style: normal;
            font-weight: normal;
            font-variant: normal;
            text-transform: none;
            line-height: 1;
            font-size: 1.3rem;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .select2-container--bootstrap .select2-selection--single .select2-selection__arrow>b {
            display: none;
        }

        .select2-container--bootstrap .select2-selection--single .select2-selection__arrow:before {
            content: "\e905"
        }

    </style>


    
    
</head><!-- head -->


<body class="app header-fixed sidebar-minimized aside-menu-minimized sidebar-lg-show">
<!-- Google Tag Manager (noscript) -->
<noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T52Q99V" height="0"
            width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->

<script>
    function load(status, elem, prop) {
        let loader;
        if (elem.length > 0) {
            if (elem[0].tagName === "MAIN" || elem[0].tagName === "BODY" || elem[0].tagName === "HTML") {
                loader = `<div class="load load-body" style="position:fixed !important;">
                            <div class="toriload"></div>
                          </div>`;
            } else {
                loader = `<div class="load" style="position:absolute !important;${prop ? prop : ""}">
                            <div class="toriload"></div>
                          </div>`;
            }
            switch (status) {
                case "off":
                    elem.find('.load').remove();
                    break;
                case "on":
                    elem.prepend(loader);
                    break;
                default:
                    elem.prepend(loader);
            }
        }
    }
</script>

<!-- Jquery v3.5.1 versao -->
<script src="/staticfiles/js/jquery/js/jquery_3.5.1v.min.dc5e7f18c8d3.js" type="text/javascript"></script>

<!-- Lazy load for imgs tags -->
<script type="text/javascript" src="/staticfiles/js/lazyload-img.min.a372a2f4bd2a.js"></script>

<!-- Máscaras do jquery com regexp -->
<script src="/staticfiles/js/utilitarios/mascara/mask.min.f6c2976fa885.js" type="text/javascript"></script>

<!-- Lodash -->
<script src="/staticfiles/js/utilitarios/lodash/lodash.min.e4be59809de6.js" type="text/javascript"></script>

<div class="body-disabled"></div>
<script>
    Number.prototype.toLocaleFixed = function (o) {
        return "number" == typeof parseFloat(this) ? parseFloat(this).toLocaleString("pt-BR", { minimumFractionDigits: o, maximumFractionDigits: o }) : this
    }
    function blackPanel(_this) {
        if ($(_this).hasClass('asidebar-desfoco-confirmacao')) {
            onToggleCarrinhoPopUp(null, $(_this).attr('data-seletor').toString());
        } else if ($(_this).hasClass('asidebar-desfoco')) {
            onToggleCarrinho();
        }
    }

    function blackPanelMobile(_this){
        if($(_this).hasClass('asidebar-desfoco-confirmacao')){
            abrirModalQuantidade(__esse, null, $(_this).attr('data-seletor').toString());
        } else if ($(_this).hasClass('asidebar-desfoco')){

        }
    }

</script>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "",
        "logo": "",
        "email": "",
        "contactPoint":{
            "@type": "ContactPoint",
            "contactType": "Televendas",
            "telephone": "+55 (41) 4004-4041",
            "availableLanguage": "pt-BR",
            "areaServed": "BR"
        },
        "address":{
            "@type": "PostalAddress",
            "streetAddress": "Av. Marechal Floriano Peixoto, 5666",
            "addressLocality": "Curitiba",
            "addressRegion": "Parana",
            "addressCountry": "BR",
            "postalCode": "81630-000"
        },
        "sameAs": [
            "",
            "",
            "",
            "",
            "",
            "",
            ""
        ]
    }
</script>
<div id="carrinho_desfoco" onclick="blackPanel(this)"></div>

<style>
    .clube-permissao {
        display: none;
    }
</style>

<style>
    
</style>

    
        
<div style="margin-top: -115px!important"></div>


    






    
        
    <div class="app-body pt-3 mt-md-4 pt-md-0">
        
        

        
        

        <main class="main">
            
            
            <div class="container w-100 " id="main-container">
                <!-- 
                    
                 -->
                

    
        

        
            



<style>
    @media (max-width: 768px) {
        .card-pbm {
            padding: 15px;
        }
    }

    .swiper-container.swiper-container-initialized.swiper-container-horizontal {
        height: 500px !important;
    }
    
    @media (max-width: 768px) {
        .swiper-container.swiper-container-initialized.swiper-container-horizontal {
	    	height: fit-content !important;
    		max-height: 500px !important;
	    }
    }

    .swiper-pagination.swiper-customized.swiper-pagination-clickable.swiper-pagination-bullets {
        max-height: 400px !important;
        margin-top: 50px;
    }

    .btn-lupa-pbm {
        -ms-transform: skewX(0deg);
        -webkit-transform: skewX(0deg);
        -moz-transform: skewX(0deg);
        -o-transform: skewX(0deg);
        transform: skewX(0deg);
        border-radius: 0rem .5rem .5rem 0rem;
        margin-left: -.5rem;
    }

    .btn-pbm {
        background: #00af66;
    }

    .btn-qtd-pbm-esq {
        border-radius: .5rem 0rem 0rem .5rem;
    }

    .btn-qtd-pbm-dir {
        border-radius: 0rem .5rem .5rem 0rem;
    }

    #modal_receita_medica .labl>input+label:hover, #modal_receita_medica .labl>input:checked+label{
        background-color: #3f84c7 !important;
    }

    #modal_receita_medica .labl.labl-receita>input+label:hover *, #modal_receita_medica .labl.labl-receita>input:checked+label *{
        color: white !important;
    }

    #modal_receita_medica .labl>input.is-invalid+label{
        border-color: var(--danger) !important;
    }

    #modal_receita_medica .labl>input.is-valid+label{
        border-color: var(--success) !important;
    }

    #modal_receita_medica .is-invalid .filepond--drop-label{
        border: 1px solid var(--danger) !important;
        border-radius: .25rem;
    }

    #modal_receita_medica .is-valid .filepond--drop-label{
        border: 1px solid var(--danger) !important;
        border-radius: .25rem;
    }

    .bg-produto-relampago{
        background: url('/staticfiles/img/bg-produto-promocao-relampago.png');
        background-size: cover;
        border-radius: .5rem;
    }

    .label-promocao-relampago{
        font-size: 1rem;
    }

    @media(max-width: 768px){
        .bg-produto-relampago{
            background: url('/staticfiles/img/bg-produto-promocao-relampago-mobile.png');
            background-size: cover;
            border-radius: .5rem;
        }

        .label-promocao-relampago{
            font-size: 1rem;
        }

    }

    .base-timer, .base-timer__label {
        width: 40px !important;
        height: 40px !important;
    }

    .text-dark-grey{
        color: #838383;
    }

    .text-extradark-grey{
        color: #444444;
    }

    .breadcrumb-produtos{
        font-size: 12px;
    }

    .text-descricao-produto{
        font-size: 14px;
    }

    .text-titulo-produto{
        font-size: 20px;
    }

    .text-descricao-produto:not(a){
        color: #8a9297;
    }

    .bloco-preco-produto{
        border: 2px solid #D9D9D9;
        border-radius: 9px;
    }

    .text-desconto-pbm{
        font-size: 13px;
    }

    @media(max-width: 768px){
        .text-titulo-produto{
            font-size: 16px;
        }

        .text-descricao-produto{
            font-size: 11px;
        }

        .text-desconto-pbm{
            font-size: 12px;
        }
    }

    .text-pbm{
        color: #00af66 !important;
    }

    .text-distribuidor{
        color: #8a9297;
    }

    .text-consulta-estoque{
        color: #137ec2 !important;
    }

    .text-align-center{
        text-align: center;
    }

    .bg-muted-pbm{
        background-color: #f4f4f4;
    }

    .hr-produtos{
        position: absolute;
        height: 1px;
        background-color: #137ec2;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
        left: 0;
    }

    .card-consultar-estoque{
        background-color: #f2f2f2;
        box-shadow: none;
    }

    @media(min-width: 768px){
        .bloco-carrossel-dois-produtos{
            padding-left: 5.5rem;
        }
    }

    .text-estoque-success{
        color: #00af66;
    }

    .text-estoque-warning{
        color: #ff8a00;
    }

    .desconto-ativo-pbm {
        color: #ffffff !important;
        background-color: #00af66;
        height: 37px;
        border-radius: 5px 0px 0px 5px;
    }
    .tabela-valores-pbm {
        color: #00af66 !important;
        background-color: #ffffff;
        border: solid 2px #00af66;
    }
    .icone-white {
        filter: invert(98%) sepia(156%) saturate(82%) hue-rotate(92deg) brightness(203%) contrast(100%);
    }

    .text-estoque-danger{
        color: #e62d36;
    }
    .tabela-pbm {
        font-size: 29px;
        color: #00af66;
    }
    @media (max-width: 768px) {
    .tabela-pbm {
        font-size: 18px;
    }
}
    .qtd-tabela {
        font-size: 14px;
        color: #8a9297;
        font-weight: 500;
    }
    .valor-tabela {
        font-size: 14px;
        color: #8a9297;
        font-weight: 800;
    }
    .btn-tabela-pbm {
        max-width: 7rem;
        max-height: 2rem;
        font-weight: 600;
    }

    .btn-desconto-progressivo {
        position: relative;
        display: inline-block;
    }

    .tooltip-progressivo {
        width: 260px;
        border: 1px solid #00af66;
        color: #fff;
        background-color: #fff;
        text-align: center;
        border-radius: 6px;
        bottom: auto !important;
        top: -10px !important;
    }

    .tooltip-progressivo div{
        padding: 0px 10px;
    }

    .tooltip-progressivo .ativo{
        background-color: #00af66;
    }

    .tooltip-progressivo .ativo p {
        font-weight: bold;
        text-align: center;
        color: #fff;
        margin: 0;
    }

    .dropup .dropdown-menu {
        top: auto;
        bottom: 100%;
        margin-bottom: 1px;
    }

    .btn-desconto-progressivo{
        background: #fff;
        color: #00af66;
        border-radius: 4px;
        border: 1px solid #00af66;
        padding: 3px 10px;
    }

    .btn-desconto-progressivo:hover, .show .btn-desconto-progressivo{
        background: #00af66;
        color: #fff !important;
    }


    .btn-desconto-progressivo svg{
        fill: #00af66 !important;
    }

    .btn-desconto-progressivo:hover svg, .show svg{
        fill: #fff !important;
    }

    .breadcrumb-produtos a{
        color: #444444!important;
    }

</style>

<style>
    /* Botão progressivo */

    .btn-desconto-progressivo {
        position: relative;
        display: inline-block;
    }

    .tooltip-progressivo {
        width: 260px;
        border: 1px solid #00af66;
        color: #fff;
        background-color: #fff;
        text-align: center;
        border-radius: 6px;
        bottom: auto !important;
        top: -10px !important;
    }

    .tooltip-progressivo div{
        padding: 0px 10px;
    }

    .tooltip-progressivo .ativo{
        background-color: #00af66;
    }

    .tooltip-progressivo .ativo p {
        font-weight: bold;
        text-align: center;
        color: #fff;
        margin: 0;
    }

    .dropup .dropdown-menu {
        top: auto;
        bottom: 100%;
        margin-bottom: 1px;
    }

    .btn-desconto-progressivo{
        background: #fff;
        color: #00af66;
        border-radius: 4px;
        border: 1px solid #00af66;
        padding: 3px 10px;
    }

    .btn-desconto-progressivo:hover, .show .btn-desconto-progressivo{
        background: #00af66;
        color: #fff !important;
    }


    .btn-desconto-progressivo svg{
        fill: #00af66 !important;
    }

    .btn-desconto-progressivo:hover svg, .show svg{
        fill: #fff !important;
    }
</style>

<style>
    .descricao{
        font-family: font-family: 'Outfit', sans-serif;
        font-weight: 500;
    }

    .descricao h2{
        color: #137ec2;
        font-size: 1.1rem;
        margin-top: 30px;
        font-weight: 600;
    }

    .descricao h3 {
        color: #137ec2;
        font-size: 1rem;
        margin-top: 30px;
    }

    .descricao h4{
        color: #137ec2;
        font-size: 0.9rem;
        margin-top: 20px;
    }

    .swiper-pagination-bullet-active{

    }
</style>

<style>
    
    /* Modal Video */

    @media (max-width: 550px) {
        #modal_video_produto .modal-dialog {
            margin-left: 0 !important;
            margin-right: 0 !important;
            top: 120px;
        }

        #modal_video_produto .modal-content, #modal_video_produto .modal-body {
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        #modal_video_produto .modal-title {
            padding-left: 0.5rem;
        }
    }

    @media (min-height: 351px) and (max-height: 480px) { 
        #modal_video_produto {
            z-index:2001;
            top: 10px;
        }

        #modal_video_produto .modal-dialog {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        #modal_video_produto .modal-content, #modal_video_produto .modal-body {
            padding-top: 5px !important;
            padding-bottom: 5px !important;
        }
    }

    @media (max-height: 350px) { 
        #modal_video_produto {
            z-index:2001;
        }

        #modal_video_produto .modal-dialog {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        #modal_video_produto .modal-content, #modal_video_produto .modal-body {
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }
    }
</style>

<link rel="stylesheet" href="/staticfiles/swiper-preview-product-costumized/swiper.be066312bba0.css">

<!-- Imagem Zoom -->
<script src="/staticfiles/js/zoomsl-3.0.min.5491bf4b4a0f.js"></script>


<div class="d-flex align-items-center ml-0 mt-4 ml-md-3 mt-md-0 my-md-3" id="block-breadcrumb">
    <span class="small fontOutfitRegular breadcrumb-produtos">
        <a href="/" style="color:#838383!important">Página Inicial</a> 
        <span class="font-weight-extrabold mx-1" style="color:#838383!important">/</span> 
        
        <a href="/categorias/cuidados-pessoais" style="color:#838383!important">
            Cuidados Pessoais
        </a> 
        <span class="font-weight-extrabold mx-1" style="color:#838383!important">/</span> 
        
        <a href="/categorias/cuidados-pessoais/higiene-diaria" style="color:#838383!important">
            Higiene Diária
        </a> 
        <span class="font-weight-extrabold mx-1" style="color:#838383!important">/</span> 
        
        <a href="/categorias/cuidados-pessoais/higiene-diaria/desodorantes-aerosol" style="color:#838383!important">
            Desodorantes Aerosol
        </a> 
        <span class="font-weight-extrabold mx-1" style="color:#838383!important">/</span> 
        
        <a href="/desodorante-aerosol-nivea-invisible-black-white-clear-200ml" style="color:#838383!important">Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML</a>
    </span>
</div>

<input type="hidden" id="categoria_principal" value="792">
<input type="hidden" id="categoria_principal_url" value="cuidados-pessoais/higiene-diaria/desodorantes-aerosol">
<input type="hidden" id="cd_produto" value="469678">

<div class="row" data-produto_id="469678" data-target="produto_view">
    <div class="col-12 col-lg-6">

        

        <div class="d-flex mx-0 mt-3">
             <!-- Fim dots paginação -->
            <div class="swiper-container"> <!-- container imagens -->
                <div class="swiper-wrapper">
                    
                        <div class="swiper-slide p-2 d-flex justify-content-center">
                            <div data-target="desconto-produto" class="w-100"></div>
                            <img loading="lazy" class="img-zoom-produto"  
                                  width="400" height="400"     
                                src="/media/produtos/469678/469678_0.jpg" onerror="this.onerror=null;this.src=window.location.origin+'/media/produtos/placeholder-sem-categoria.jpg';" alt="Imagem do produto">
                        </div>
                        
                        
                        
                    
                </div>
                
            </div>
        </div>

    </div>
    
    <div class="col-12 col-lg-6">
        

            <div class="row align-items-center bg-produto-relampago mx-0 mt-3" data-target="bloco-promocao-relampago" style="display: none;">
                <div class="col-12 col-md-4 d-flex justify-content-center align-items-center">
                    <span class="font-1xl text-white fontOutfitBold">Oferta surpresa</span>
                </div>
                <div class="col-12 col-md-4 d-flex justify-content-center align-items-center mt-3 mt-md-0">
                    <div id="hora-limite-promocao-relampago" class="timer-promocao-relampago"></div>
                    <div class="text-white fontOutfitBold font-lg desc-hora-minuto mx-2">h</div>
                    <div id="minuto-limite-promocao-relampago" class="timer-promocao-relampago"></div>
                    <div class="text-white fontOutfitBold desc-hora-minuto font-lg ml-2">m</div>
                </div>
            </div>

            <div class="row justify-content-between align-items-center mx-0 mt-3">
                <div class="d-flex">
                    
                        <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="20" height="20" alt="0 estrela">
                    
                    
                        <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="20" height="20" alt="1 estrela e meia">
                    
                    
                        <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="20" height="20" alt="2 estrela e meia">
                    
                    
                        <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="20" height="20" alt="3 estrela e meia">
                    
                    
                        <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="20" height="20" alt="4 estrela e meia">
                    
                    <span class="ml-2 numero-avaliacoes fontOutfitRegular">(0 avaliações)</span>
                </div>
                
            </div>

            <div class="row mx-0 mt-3">
                <h1 data-target="nome_produto" class="fontOutfitBold text-extradark-grey text-titulo-produto" aria-label="Nome do Produto">Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML</h1>
            </div>

            <div class="d-flex align-items-center mx-0 mt-3">
                <p>
                    <a href="/marcas/Nivea" class="text-primary fontOutfitSemiBold text-uppercase text-descricao-produto fontOutfitSemiBold" style="text-decoration: underline;" aria-label="Marca do produto">Nivea</a>
                    <span class="text-muted text-descricao-produto fontOutfitRegular"> <span class="fontOutfitBold mx-2" aria-label="EAN e código do produto">|</span> EAN: 4005900105073 <span class="fontOutfitBold mx-2">|</span> Código: 469678</span>
                </p>
            </div>
        

        

        

        

        
            

            

        

        <div class="m-0 mt-3 p-0 avisos-produto-funcionario469678 d-none">
            <p class="font-xl text-limit-1 text-uppercase fontOutfitSemiBold">
                <span class="text-danger">Aviso: </span>Produto exclusivo para colaborador Rosário
            </p>
        </div>

        <!-- Preço -->
            
        <div class="row bloco-preco-produto mt-3 mx-0 py-3 px-4">
        	
            <div class="desconto-progressivo">

            </div>
            <div class="col-8 p-0 m-0">
                <div data-target="preco-produto" class="font-2xl-inner-maior"></div>
            </div>
            
                
                <div class="col-4">
                    <div class="p-0 m-0 d-flex justify-content-end align-items-end">
                            <fieldset class=" col-6  m-0 p-0 pr-1 pr-lg-3">
                                <select class="form-control btn select2-qtd-produtos" style="border-radius: 3px" onchange="qtdSelecionadaProduto(this)" data-valor="1" data-limite-min="" data-limite-max="" data-target="combo-qtd-produto">
                                    <option value="1">1</option>
                                </select>
                            </fieldset>
                        </div>
                    </div>
                
            
            <div class="col-12 p-0 m-0">
                <div class="row m-0 p-0">
                    <!-- Comprar -->
                    <div class="d-flex produto-footer produto-footer-page produto-footer-produto-template mt-2 w-100" data-qtd-btn="2" data-cd-produto="469678"></div>
                </div>
            </div>

            
            <!-- Aviso Produtos Internos -->
            <div class="col-12 avisos-produto-funcionario469678 d-none">
                <div class="mt-4 d-flex">
                    <p class="text-dark-grey text-limit-1 fontOutfitSemiBold">
                        <a class="blueText btn-verificar-deconto">Clique aqui </a> e verifique seu desconto
                    </p>
                </div>
            </div>
            

        </div>

        

        

        

        
		
        <div class="row m-0 mt-3 p-0">
            <p class="blueText fontOutfitSemiBold">Consulte estoque disponível em lojas próximas:</p>
        </div>
		<style>
			.cursor_pointer:hover {cursor:pointer;}
		</style>
		<a class="cursor_pointer" onclick="consultar_estoque()" >
            <div class="row m-0 p-0">
                <div class="col-12 m-0 p-0">
                    <div class="row m-0 mt-1 p-0">
                        <div class="bg-muted-pbm d-flex align-items-center m-0 p-0 w-100">
                            <div class="col-1 m-0 px-0 py-2 d-flex align-items-center justify-content-center">
                                <img loading="lazy" src="/staticfiles/img/icons/icon_lozalizacao_estoque.9734454f7e01.svg" width="25" height="25">
                            </div>
                            <div class="col-8 col-md-9 m-0 px-0 py-2">
                                <p class="text-dark-grey fontOutfitSemiBold text-limit-1" data-target="endereco-cliente"></p>
                            </div>
                            <div class="col-3 col-md-2 m-0 p-0 h-100">
                                <div class="btn botaoPadraoAzul text-white font-xs fontOutfitBold cursor-pointer w-100 h-100 d-flex align-items-center justify-content-center"  style="transform: none; border-radius: 0rem .5rem .5rem 0rem;">
                                    Consultar
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </a>
		
    </div>
</div>

<div class="row p-0">
    <hr class="hr-produtos p-0">
</div>

<div class="row p-0 m-0 descricao mt-5">
    <div class="col-12 mt-3">
        <p class="font-1xl fontOutfitBold blueText">Sobre o produto</p>
    </div>
    <div class="col-12 mt-3 text-limit-2" data-target="produto-descricao">
        None
    </div>
    

    
</div>

<div class="row p-0 m-0 d-none">
    <div class="col-12 mt-3">
        <p class="font-1xl fontOutfitBold blueText">Frequentemente comprados juntos</p>
    </div>
    <div class="col-12 mt-3"></div>
</div>

<div class="row p-0 m-0 mt-3">
    <div class="col-12 col-md-12 order-1 order-md-0 mt-3 mt-md-0">
        <p class="font-1xl fontOutfitBold blueText">Avaliações</p>
        <div class="row w-100 m-0 p-0">
            <div class="col-12 col-md-6 d-flex d-md-block align-items-center m-0 p-0 pl-xl-5">
                <div class="col-6 col-md-12 m-0 p-0">
                    <p class="text-consulta-estoque fontOutfitBold" style="font-size: 55px;">0,0</p>
                </div>
                <div class="col-6 col-md-12 m-0 p-0">
                    <div class="d-flex d-md-block justify-content-center">
                        
                            <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">
                        

                        
                            <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">
                        

                        
                            <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">
                        

                        
                            <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">
                        

                        
                            <img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">
                        
                    </div>
                    <div class="d-flex d-md-block justify-content-center">
                        <span class="numero-avaliacoes fontOutfitRegular">(0 avaliações)</span>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 m-0 p-0" style="align-self: center;">
                <div class="col-12 m-0 p-0">
                    <a class="btn botaoPadraoAzul text-white fontOutfitSemiBold cursor-pointer w-100 py-2" style="transform: none; font-size: 15px;" data-toggle="collapse" data-target="#collapseAvaliar">
                        Avaliar produto
                    </a>
                </div>
                
            </div>
            <div class="col-12 col-md-6 m-0 p-0 mt-3" id="bloco_avaliacao">
                <div class="collapse" id="collapseAvaliar">
                    <form id="form-avaliacao" method="POST" novalidate="">
                        <div class="form-row align-items-center">
                            <span class="text-uppercase fontOutfitBold mr-2">Avalie esse produto: </span>
                        </div>
                        <div class="form-row align-items-center mt-3">
                            <fieldset class="rate">
                                <input type="radio" id="rating10" name="rating" value="10" data-star="5">
                                <label for="rating10" title="5"></label>
                                <input type="radio" id="rating9" name="rating" value="9" data-star="4.5">
                                <label class="half" for="rating9" title="4.5"></label>
                                <input type="radio" id="rating8" name="rating" value="8" data-star="4">
                                <label for="rating8" title="4"></label>
                                <input type="radio" id="rating7" name="rating" value="7" data-star="3.5">
                                <label class="half" for="rating7" title="3.5"></label>
                                <input type="radio" id="rating6" name="rating" value="6" data-star="3">
                                <label for="rating6" title="3"></label>
                                <input type="radio" id="rating5" name="rating" value="5" data-star="2.5">
                                <label class="half" for="rating5" title="2.5"></label>
                                <input type="radio" id="rating4" name="rating" value="4" data-star="2">
                                <label for="rating4" title="2"></label>
                                <input type="radio" id="rating3" name="rating" value="3" data-star="1.5">
                                <label class="half" for="rating3" title="1.5"></label>
                                <input type="radio" id="rating2" name="rating" value="2" data-star="1">
                                <label for="rating2" title="1"></label>
                                <input type="radio" id="rating1" name="rating" value="1" data-star="0.5">
                                <label class="half" for="rating1" title="0.5"></label>
                            </fieldset>
                            <span class="text-muted font-sm ml-2" id="rating_produto">(0/5)</span>
                        </div>
                        <div class="form-row form-group-float">
                            <label for="avaliacao_descricao">Escreva sua opinião*</label>
                            <input type="text" class="form-control input-padrao" id="avaliacao_descricao" autocomplete="off" maxlength="200" name="avaliacao_descricao" required="">
                            <div class="invalid-feedback">Informe sua opnião!!</div>
                        </div>
                        <div class="form-row">
                            <label for="sexo" class="font-xs pl-2">Você recomendaria esse produto?</label>
                            <div class="w-100 d-block d-md-flex my-2">
                                <div class="radio-ecomm col-md-2 my-2 my-md-0 mr-5">
                                    <input type="radio" id="recomendaria-sim" value="true" class="form-control" name="avaliacao_recomendaria" required="">
                                    <label tabindex="0" class="outline-none-focus" for="recomendaria-sim">Sim</label>
                                    <div class="invalid-feedback desktop-radio">Selecione uma opção</div>
                                </div>
                                <div class="radio-ecomm col-md-2 my-2 my-md-0 mr-5">
                                    <input type="radio" id="recomendaria-nao" value="false" class="form-control" name="avaliacao_recomendaria" required="">
                                    <label tabindex="0" class="outline-none-focus" for="recomendaria-nao">Não</label>
                                    <div class="invalid-feedback mobile-radio">Selecione uma opção</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="check-ecomm my-1">
                                <input type="checkbox" class="form-control" id="avaliacao_anonimo" name="avaliacao_anonimo">
                                <label for="avaliacao_anonimo" class="font-sm">Anonimato?</label>
                            </div>
                        </div>
                        <div class="d-block">
                            <a onclick="$('#form-avaliacao').submit();" class="mt-2 btn botaoPrincipal text-white fontOutfitSemiBold w-100" style="transform: none;">Enviar</a>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-12 m-0 p-0 mt-3" id="bloco_avaliado" style="display: none">
                <div class="row justify-content-center m-0 p-0">
                    <span class="icon_check02" style="color: #3D85C6; font-size: 4rem;"></span>
                </div>
                <div class="row justify-content-center m-0 p-0">
                    <p class="font-2xl fontOutfitSemiBold my-3">Agradecemos a sua avaliação.</p>
                </div>
                <div class="row justify-content-center m-0 p-0">
                    <p class="font-xl text-muted">Produto avaliado com sucesso. Sua avaliação estará disponível após aprovação.</p>
                </div>
            </div>
        </div>
        <div class="row m-0 p-0" data-target="bloco-comentarios">
            



        </div>
    </div>
	
	<div id="ccs-feature-icons"></div>
	<div id="ccs-logos"></div>
	<div id="ccs-inline-content"></div>
	<div id="ccs-explore-product"></div>

	
    <div class="col-12 col-md-6 order-0 order-md-1 bloco-carrossel-dois-produtos" style="display: none;">
        <div class="col-12 m-0 p-0">
            <p class="font-1xl fontOutfitBold blueText">Outros clientes também viram</p>
        </div>
        <div class="col-12 m-0 p-0">
            <div class="carrossel-produtos"></div>
        </div>
        <div class="col-12 m-0 p-0">
            <div class="carrossel-produtos"></div>
        </div>
    </div>
</div>
<div class="row m-0 p-0 mt-4">
    <hr class="hr-produtos">
</div>



<div class="modal fade" id="modal_receita_medica" tabindex="-1" role="dialog" aria-labelledby="modal_receita_medica" style="z-index: 12000" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content" style="border: none !important; border-radius: 1rem;">

            <div class="modal-header pt-3 pr-3 pb-1 pl-4 d-flex align-items-center" style="border: none !important;">
                <h5 class="modal-title modal-xl text-marine text-uppercase fontOutfitBold">Envie sua receita</h5>
                <button class="btn icon_close text-marine font-lrem m-2" data-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="passo" data-passo="1">
                <div class="modal-body" style="padding: 0rem 1.5rem !important;">
                    <form id="form_tipo_entrega" novalidate>
                        <p class="mt-2 mb-3 fontOutfitSemiBold text-muted">Para prosseguir com sua compra e envio da receita, primeiro selecione um método de entrega do produto.</p>
                        <div class="form-row mb-3">
                            <div class="col-12 col-md-6">
                                <div class="labl labl-receita">
                                    <input type="radio" required name="receita-entrega" id="receita_retirada" autocomplete="off" value="retirada">
                                    <label for="receita_retirada" class="card text-body text-center my-1" style="background-color: #f0f3f5;">
                                        <a class="card-body pt-2 pb-2 text-center">
                                            <img loading="lazy" src="/staticfiles/img/icons/icon_retirada3.85dce0987505.png" alt="Retirada" width="80" height="65" style="filter: invert(70%) sepia(84%) saturate(1678%) hue-rotate(5deg) brightness(112%) contrast(103%)">
                                            <p class="text-navy fontOutfitBolder text-nowrap mt-2">Para retirar</p>
                                            <p class="text-muted small mt-2 mb-3">No método de retirada, você precisará apresentar a receita para receber o medicamento.</p>
                                        </a>
                                    </label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 mt-2 mt-md-0">
                                <div class="labl labl-receita">
                                    <input type="radio" required name="receita-entrega" id="receita_entrega" autocomplete="off" value="entrega">
                                    <label for="receita_entrega" class="card text-body text-center my-1" style="background-color: #f0f3f5;">
                                        <a class="card-body pt-2 pb-2 text-center">
                                            <img loading="lazy" src="/staticfiles/img/icons/icon_entrega3.e5af3fcf495e.png" alt="Retirada" width="80" height="65" style="filter: invert(70%) sepia(84%) saturate(1678%) hue-rotate(5deg) brightness(112%) contrast(103%)">
                                            <p class="text-navy fontOutfitBolder text-nowrap mt-2">Receber em casa</p>
                                            <p class="text-muted small mt-2 mb-3">Receba o medicamento em seu endereço. A receita precisará ser anexa ao pedido.</p>
                                        </a>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-row my-3">
                            <div class="col-12">
                                <a onclick="$('#form_tipo_entrega').submit()" class="btn btn-qtd btn-warning text-white d-block text-center fontOutfitBold w-100 font-xl cursor-pointer isDisabled submit-entrega">Continuar</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="passo" data-passo="2" style="display: none;">
                <div class="modal-body" style="padding: 0rem 1.5rem !important;">

                    <form id="form_envio_receita" novalidate>
                        <div name="bloco_paciente">
                            <div class="form-row mb-2">
                                <div class="col-12 col-md-8 d-flex align-items-center">
                                    <p class="text-marine font-xl fontOutfitBold">Sobre o Paciente</p>
                                </div>
                                <div class="col-12 col-md d-md-flex justify-content-end mt-2 mt-md-0">
                                    <a class="btn btn-outline-light text-dark font-lg" onclick="$('#form_envio_receita').find(`[name='bloco_paciente'] :input`).not(`input[type = radio]`).val(''); $('#form_envio_receita').find(`[name='bloco_paciente'] :checked`).prop('checked', false)">
                                        Não sou paciente
                                    </a>
                                </div>
                            </div>
                            <div class="form-row mb-2">
                                <div class="col-12 col-md-6">
                                    <label for="nm_completo" class="text-primary">Nome do Paciente</label>
                                    <input type="text" autocomplete="off" id="nm_completo" class="form-control input-padrao-receita" name="nm_completo" required >
                                    <div class="invalid-feedback">Informe o nome</div>
                                </div>
                                <div class="col-12 col-md-6 mt-2 mt-md-0">
                                    <label for="documento" class="text-primary">RG do Paciente</label>
                                    <div class="input-group ">
                                        <div class="input-group-prepend">
                                            <fieldset class="w-100">
                                                <select class="form-control combo-estados" id="estado-documento" name="estado-documento" required>
                                                </select>
                                            </fieldset>
                                        </div>
                                        <input type="text" autocomplete="off" id="documento" class="form-control input-padrao-receita rg-receita" name="documento" required >
                                        <div class="invalid-feedback">Informe o número de RG</div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row mb-2">
                                <div class="col-12 col-md-6">
                                    <label for="dat_nasc" class="text-primary">Data de nascimento</label>
                                    <input type="text" autocomplete="off" minlength="10" maxlength="10" id="dat_nasc" class="form-control input-padrao-receita dt-nascimento" name="dat_nasc" required>
                                    <div class="invalid-feedback">Informe a data de nascimento</div>
                                </div>
                                <div class="col-12 col-md-6 mt-2 mt-md-0">
                                    <label class="text-primary">Sexo</label>
                                    <div class="w-100 d-block d-md-flex my-2">
                                        
                                            <div class="radio-ecomm col-sm col-md-2 my-2 my-md-0 mr-5 no-padding">
                                                <input type="radio" id="sexo_feminino" value="feminino" class="form-control" name="sexo" required >
                                                <label tabindex="0" for="sexo_feminino">Feminino</label>

                                                
                                                    
                                                        <div class="invalid-feedback text-nowrap">Informe o sexo</div>
                                                    
                                                

                                            </div>
                                        
                                            <div class="radio-ecomm col-sm col-md-2 my-2 my-md-0 mr-5 no-padding">
                                                <input type="radio" id="sexo_masculino" value="masculino" class="form-control" name="sexo" required >
                                                <label tabindex="0" for="sexo_masculino">Masculino</label>

                                                
                                                    
                                                

                                            </div>
                                        
                                            <div class="radio-ecomm col-sm col-md-2 my-2 my-md-0 mr-5 no-padding">
                                                <input type="radio" id="sexo_outro" value="outro" class="form-control" name="sexo" required >
                                                <label tabindex="0" for="sexo_outro">Outro</label>

                                                
                                                    
                                                

                                            </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div name="bloco_receita">
                            <div class="form-row mt-2 mt-md-4 mb-2">
                                <div class="col-12">
                                    <p class="text-marine font-xl fontOutfitBold">Dados da Receita</p>
                                </div>
                            </div>
                            <div class="form-row mb-2">
                                <div class="col-12 col-md-6">
                                    <label for="dat_receita" class="text-primary">Data da receita</label>
                                    <input type="text" autocomplete="off" minlength="10" maxlength="10" id="dat_receita" class="form-control input-padrao-receita dt-nascimento" name="dat_receita" required>
                                    <div class="invalid-feedback">Informe a data da receita</div>
                                </div>
                                <div class="col-12 col-md-6 mt-2 mt-md-0">
                                    <label for="qtd_medicamentos" class="text-primary">Quantidade de caixas do medicamento</label>
                                    <input type="text" autocomplete="off" id="qtd_medicamentos" class="form-control input-padrao-receita qtd-receita" name="qtd_medicamentos" required>
                                    <div class="invalid-feedback">Informe a quantidade</div>
                                </div>
                            </div>
                            <div class="form-row mt-2 mt-md-4 mb-2">
                                <div class="col-12">
                                    <p class="text-marine font-xl fontOutfitBold">Dados do médico</p>
                                </div>
                            </div>
                            <div class="form-row mt-3">
                                <div class="col-12 col-md-4">
                                    <label for="cr" class="text-primary">CR</label>
                                    <fieldset class="w-100">
                                        <select name="cr" id="cr" required class="form-control input-padrao text-muted combo-cr" style="padding-top: 8px !important">
                                        </select>
                                    </fieldset>
                                </div>
                                <div class="col-12 col-md-4 mt-2 mt-md-0">
                                    <label for="uf_cr" class="text-primary">UF</label>
                                    <fieldset class="w-100">
                                        <select name="uf_cr" id="uf_cr" required class="form-control input-padrao text-muted combo-estados" style="padding-top: 8px !important">
                                        </select>
                                    </fieldset>
                                </div>
                                <div class="col-12 col-md-4 mt-2 mt-md-0">
                                    <label for="codigo_cr" class="text-primary">Código do conselho</label>
                                    <input type="text" name="codigo_cr" required inputmode="numeric" id="codigo_cr" class="form-control input-padrao">
                                    <div class="invalid-feedback">Informe o código do conselho</div>
                                </div>
                                <div class="col-12 mt-2">
                                    <label for="nm_medico" class="text-primary">Nome do Médico</label>
                                    <input type="text" autocomplete="off" required id="nm_medico" class="form-control input-padrao-receita" name="nm_medico">
                                    <div class="invalid-feedback">Informe o nome do médico</div>
                                </div>
                            </div>
                            <div class="form-row mt2 mt-md-4 mb-2 mb-md-4">
                                <div class="col-12 col-md-6 mt-2 mt-md-0">
                                    <div class="labl labl-receita">
                                        <input type="radio" required name="receita-tipo" id="receita_tipo_digital" autocomplete="off" value="token">
                                        <label for="receita_tipo_digital" class="card text-body text-center my-1" style="height:50px; background-color: #f0f3f5;">
                                            <a class="card-body pt-2 pb-2 text-center">
                                                <p class="text-muted fontOutfitBolder text-nowrap small">Enviar receita digital</p>
                                                <p class="text-muted small">Insira o código token que recebeu de seu médico</p>
                                            </a>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 mt-2 mt-md-0">
                                    <div class="labl labl-receita">
                                        <input type="radio" required name="receita-tipo" id="receita_tipo_anexo" autocomplete="off" value="path_receita">
                                        <label for="receita_tipo_anexo" class="card text-body text-center my-1" style="height:50px; background-color: #f0f3f5;">
                                            <a class="card-body pt-2 pb-2 text-center">
                                                <p class="text-muted fontOutfitBolder text-nowrap font-sm">Enviar receita em anexo</p>
                                                <p class="text-muted small">Envie o arquivo (PDF) ou foto da sua receita (JPG).</p>
                                            </a>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 mt-2 mt-md-0" style="display:none;">
                                    <div class="labl labl-receita labl-receita-carrinho">
                                        <input type="radio" required name="receita-tipo" id="receita_tipo_carrinho" autocomplete="off" value="carrinho">
                                        <label for="receita_tipo_carrinho" class="card text-body text-center my-1" style="height:50px; background-color: #f0f3f5;">
                                            <a class="card-body pt-2 pb-2 text-center">
                                                <p class="text-muted fontOutfitBolder text-nowrap font-sm">Utilizar receita da cesta</p>
                                                <p class="text-muted small">Utilize a receita anexada a sua cesta para este produto.</p>
                                            </a>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row mb-2" name="bloco_receita_digital" style="display: none;">

                                <div class="col-12">
                                    <p class="text-marine font-xl fontOutfitBold">Receita digital</p>
                                    <div class="w-100">
                                        <label for="fornecedor_prescricao" class="text-primary">Fornecedor de prescrição médica</label>
                                        <fieldset class="w-100">
                                            <select name="fornecedor_prescricao" id="fornecedor_prescricao" required class="form-control input-padrao text-muted 
                                            combo-fornecedor-prescricao" style="padding-top: 8px !important">
                                            </select>
                                        </fieldset>
                                    </div>
                                    


                                    <label for="receita_numero_token" class="text-primary">Número do token</label>
                                    <input type="text" autocomplete="off" id="receita_numero_token" class="form-control input-padrao-receita" name="receita_numero_token">
                                    <div class="invalid-feedback">Informe o número do token</div>
                                    <span class="font-sm text-danger">Se atente as letras minúsculas, maiúsculas, números e símbolos que estão presentes no seu token.</span>
                                </div>
                            </div>
                            <div class="form-row mb-2" name="bloco_receita_anexo" style="display: none;">
                                <div class="col-12">
                                    <p class="text-marine font-xl fontOutfitBold">Receita física</p>
                                    <p class="text-primary">Enviar receita (Somente JPG ou PDF)</p>
                                    <input type="file" id="receita_anexo_arquivo" name="receita_anexo_arquivo">
                                </div>
                            </div>
                            <div class="form row justify-content-center is-invalid-text mb-2" name="bloco_tipo_receita_required" style="display: none;">
                                <div class="col-12">
                                    <p class="fontOutfitSemiBold text-danger" style="font-size: 1.15rem;">
                                        Escolha como enviar sua receita para prosseguir.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="form-row my-3">
                            <div class="col-12">
                                <a onclick="$('#form_envio_receita').submit()" class="btn btn-qtd botaoPrincipal text-white d-block text-center fontOutfitBold w-100 font-xl cursor-pointer submit-receita">Enviar receita</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>



<div class="modal fade" id="modal_consultar_estoque" tabindex="-1" role="dialog" aria-labelledby="modal_consultar_estoque" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content m-0 p-0 p-3">
            <div class="modal-header m-0 p-0" style="border-bottom: none !important;">
                <h5 class="modal-title">Consultar estoque</h5>
                <a class="icon_close p-1" data-dismiss="modal" aria-label="Close"></a>
            </div>
            <div class="modal-body m-0 p-0 p-3">
                <div class="row">
                    <div class="col-12 col-md-6 p-0 m-0" style="position: relative;">
                        <span class="icon-lupa-estoque"></span>
                        <input type="text" id="buscar_filial" autocomplete="off" name="buscar_filial" class="form-control input-padrao" style="height: 35px; padding: 5px 0px 5px 45px; border-radius: 3px;" placeholder="Buscar endereço ou número">
                    </div>
                    <div class="col-12 col-md-6 m-0 p-0 mt-3 mt-md-0 d-flex align-items-center">
                        <div class="d-flex cursor-pointer" onclick="filtrar_estoque_localizacao()">
                            <img loading="lazy" src="/staticfiles/img/icons/icon_location_3.85e30437ef9d.svg" width="21" class="ml-0 ml-md-3">
                            <span class="fontOutfitSemiBold ml-2">Utilizar minha localização</span>
                        </div>
                    </div>
                    <div class="col-12 m-0 p-0 mt-3 d-flex align-items-center">
                        <img loading="lazy" src="/staticfiles/img/icons/icon_location_4.73dcb54838ed.svg" width="24">
                        <span class="text-consulta-estoque fontOutfitSemiBold" data-target="endereco-cliente"></span>
                    </div>
                    <div class="col-12 m-0 p-0 mt-4">
                        <p class="font-lg fontOutfitSemiBold">Lojas com produto disponível na sua região:</p>
                    </div>
                </div>
                <div class="row mt-2" data-target="bloco-estoque-filiais" style="max-height: 22rem; overflow-y: auto;"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_video_produto" tabindex="-1" role="dialog" aria-labelledby="modal_video_produto" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content m-0 p-0 p-3">
            <div class="modal-header m-0 p-0" style="border-bottom: none !important;">
                <h5 class="modal-title">Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML</h5>
                <a class="icon_close p-1" data-dismiss="modal" aria-label="Close"></a>
            </div>
            <div class="modal-body m-0 p-0 p-3">
                <div class="row">
                    <div class="col-12 p-0 m-0" style="position: relative;">
                        <div height="100%" id="video_produto" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Localizações -->
<div class="modal fade modal-carrinho" id="modal_localizacao_estoque" data-backdrop="true" style="z-index: 12000"
    tabindex="-1" role="dialog" aria-labelledby="modal_localizacao_estoque" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <p class="fontOutfitBold">Localização mapa</p>
                <a class="icon_close02 cursor-pointer" data-dismiss="modal"></a>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col col-xl col-lg col-md-12 col-sm-12 bg-light">
                        <div id="mapa-estoque" style="height:100%; min-height:640px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- Fecha modal -->

<!-- Modal informativa PBM -->
<div class="modal fade modal-carrinho" id="modal_info_pbm" data-backdrop="true" style="z-index: 12000" tabindex="-1" role="dialog" aria-labelledby="modal_info_pbm" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between p-0 px-3 pt-3" style="border-bottom: none;">
                <div class="d-flex align-items-center">
                    <img loading="lazy" src="/staticfiles/img/icons/icon_desconto_pbm.bd6a6c45e3b1.svg" width="40" class="mr-3 mt-4">
                    <span style="color: #00af66; font-size: 18px;" class="fontOutfitBold mt-3">Saiba como funciona o desconto do programa</span>
                </div>
                <div>
                    <a class="icon_close02 cursor-pointer" data-dismiss="modal"></a>
                </div>
            </div>
            <div class="modal-body p-3 mb-3">
                <div class="row m-0 p-0">
                    <div class="col-12 m-0 p-0">
                        <p style="color: #8a9297; font-size: 14px;">
                            Produtos cadastrados no desconto do programa possuem <span class="fontOutfitBold">descontos especiais</span>
                            para clientes cadastrados no programa. Caso já possua cadastro, é só colocar seu <span class="fontOutfitBold">CPF</span>
                            no campo indicado, do contrário, <span class="fontOutfitBold">cadastre-se</span> para aproveitar o benefício!
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer p-3" style="border-top: 3px solid #3f84c7;">
                <p style="color: #3f84c7; font-size: 11px;" class="fontOutfitSemiBold">
                    *Este desconto pode alterar de acordo com os itens da cesta, a quantidade do produto e o CPF, cartão ou cupom informado.
                </p>
            </div>
        </div>
    </div>
</div><!-- Fecha modal -->

<script>
    $('#icon-go-back').remove()
    $('#block-breadcrumb').prepend(`
        <a class="cursor-pointer d-flex align-items-center" id="icon-go-back" onclick="history.back()">
            <img loading="lazy" src="/staticfiles/img/icons/icon_arrow-back-3.a8cc1f194df4.svg" width='15' height='15'>
        </a>
    `)
</script>

<script src="/staticfiles/js/mark-js/jquery.mark.cdeb87b0586a.js"></script>
<script src="/staticfiles/js/mark-js/mark.d905b4c20dfd.js"></script>

<script type="text/javascript">
    (function (s, y, n, di, go) {
      di = s.createElement(y);
      di.type = 'text/java'+y;
      di.async = true;
      di.src = n + Math.floor(Date.now() / 86400000);
      go = s.getElementsByTagName(y)[0];
      go.parentNode.insertBefore(di,go);
    }(document,'script', "https://content.syndigo.com/site/c6774960-74ed-4e54-8059-86a8e147385e/tag.js?cv="));
</script>

<syndigo-powerpage pageid="4005900105073"> </syndigo-powerpage>

<script type="text/javascript">
    window.SYNDI = window.SYNDI || [];
    SYNDI.push('4005900105073'); //replace with your own product ID
</script>

<script type="text/javascript" src="/staticfiles/select2/js/select2.min.cd5f56bf4f27.js"></script>

<script async defer src="https://scontent.webcollage.net/api/v2/product-content"></script>

<script>
    
</script>

<script src="/staticfiles/swiper-preview-product-costumized/swiper.b3b9841e8420.js"></script>

<script>
    if (window.location.href.indexOf("rosarioapp") > -1) {
        $('#pagina-produto-footer').removeClass("pb-5");
    }
</script>

<script>

    $(".input-padrao-receita").each(function (t, e) {
        null == e.value || null == e.value || "" == e.value || e.parentNode.classList.add("active");
    }),
    $(".input-padrao-receita").on("focus", function (t) {
        t.target.parentNode.classList.add("active");
    }),
    $(".input-padrao-receita").on("blur", function (t) {
        0 == this.value.length && t.target.parentNode.classList.remove("active");
    })
    $(".cpf").mask('000.000.000-00');
    $(".cep").mask('00.000-000');
    $(".input-data").mask('00/00/0000');
    $(".telefone").mask('(99) 9999-99999');
    $(".telefone").on('blur', function () {
        if ($(this).val().length > 14) {
            $(this).unmask();
            $(this).mask('(99) 99999-9999');
        } else {
            $(this).unmask();
            $(this).mask('(99) 9999-9999');
        }
    });
    $(".form-numero").mask('#')

    let swiper = new Swiper('.swiper-container', {
        direction: 'horizontal',
        
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                
                renderBullet: function (index, className) {
                    let html;
                    if (index === 0)
                        html += `<div class="row">`;
                    html = $($('.dots-preview').children()[index]).find("img")[0];
                    html = `<div class="col-12 ${className}">${html.outerHTML}</div>`;

                    if (index === $('.dots-preview').children().length - 1)
                        html += `<div/>`;
                    return html;
                },
            },
        
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        on: {
            init: function () {
                resize_swiper_produto();
            },
        },
    });

    $(window).on('load', function () {
        resize_swiper_produto();
        buscar_favoritos();

        $("#buscar_filial").on("input", function () {
            $(".card-filial").show().unmark();
            if ($("#buscar_filial").val()) {
                $(".card-filial").mark($("#buscar_filial").val(), {
                    done: function () {
                        $(".card-filial").not(":has(mark)").hide();
                        $('[data-target="empty-state-estoque"]').hide()
                    }, noMatch: function() {
                        setTimeout(() => {
                            $('[data-target="empty-state-estoque"]').show()
                        }, 500);
                    }
                });
            }
        });
    });

    $(window).resize(function () {
        resize_swiper_produto();
    });

    function resize_swiper_produto() {
        let img_height = $('.swiper-container .swiper-slide-active img.w-100').height();
        $('.swiper-container').height(img_height);
        $('.swiper-pagination').css('maxHeight', img_height);
    }

    function qtdSelecionadaProduto(el){

        let valor_antigo = parseInt($(el).attr('data-valor'))
        let valor_atual = parseInt($(el).val())

        let valor_minimo = parseInt($(el).attr('data-limite-min'))
        let valor_maximo = parseInt($(el).attr('data-limite-max'))

        $(el).attr('data-valor', $(el).val())

        $('[data-qtd_produto]').attr('data-qtd_produto', valor_atual);
    }

</script>
<script>

    $("#form_pbm").on('submit', function (event) {
        load('off', $('body'))
        event.preventDefault();
        event.stopPropagation();
        if ($("#beneficiario_dt_inicio").val()) {
            var dt_inicio = $("#beneficiario_dt_inicio").val().split('/');
            var date = new Date();
            dt_inicio = new Date(dt_inicio[2], dt_inicio[1], dt_inicio[0]);
            if (dt_inicio != 'Invalid Date') {
                if (dt_inicio < date) {
                    $("#beneficiario_dt_inicio")[0].setCustomValidity('Erro');
                    $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('A data de início deve ser maior que a atual');
                } else {
                    $("#beneficiario_dt_inicio")[0].setCustomValidity('');
                    $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('O campo é obrigatório');
                }
            } else {
                $("#beneficiario_dt_inicio")[0].setCustomValidity('Erro');
                $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('Data inválida');
            }
        }
        if (this.checkValidity() == false) {
            $(this).addClass('was-validated');
            $("input:invalid").focus();
            if ($("[type='radio']:invalid").length > 0) {
                $('#modal_data').animate({'scrollTop': 500}, 500);
            }
            return
        }
        var inputs = $(this).find('input, select').get();
        var arrayEnvio = {
            'data': {
                'fields': [],
                'quiz': [{
                    "id": dataID,
                    "configurationId": configurationId,
                    "skuId": idsku,
                    'questions': []
                }],

            },
            'autorizador': autorizador,
        };
        inputs.forEach(function (input) {
            var valor_default = $(input).attr('valor_default')
            var elementmask = $(input).attr('masktype');
            var valor = '';
            if (elementmask === 'cpf' || elementmask === 'cep' || elementmask === 'telefone' || elementmask === 'data') {
                valor = valor_default ? valor_default : $(input).val().slugify().replace(/[( . \/\ )]/g, '');
            } else {
                valor = valor_default ? valor_default : $(input).val();
            }
            if ($(input).attr('coluna_id')) {
                if ($(input).attr('type') == 'radio') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": valor,
                        });
                    }
                } else if ($(input).attr('type') == 'checkbox') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": 'true',
                        });
                    } else {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": 'false',
                        });
                    }
                } else {
                    if ($(input).attr('tabela_id') == 1 && ($(input).attr('coluna_id') == 6 || $(input).attr('coluna_id') == 7 || $(input).attr('coluna_id') == 28)) {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": $("#cpf_desconto").val().slugify().replace(/[( . \/\ )]/g, ''),
                        });
                    } else {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": valor,
                        });

                    }
                }
            } else {
                if ($(input).attr('type') == 'radio') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['quiz'][0]['questions'].push({
                            'id': $(input).attr('questionid'),
                            'value': valor,
                        });
                    }
                } else {
                    arrayEnvio['data']['quiz'][0]['questions'].push({
                        'id': $(input).attr('questionid'),
                        'value': valor,
                    });
                }
            }
        });

        load('on', $(".modal.show .modal-content"));

        $.ajax({
            url: "/core/produto/pbm/cadastro_beneficiario",
            type: 'POST',
            data: {
                'json_resposta': JSON.stringify(arrayEnvio['data']),
                'valor_id': termo_id,
                'ean': '' ? '' : '4005900105073',
                'cpf': $("#cpf_desconto").val(),
                'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
            },
            success: function (data) {
                if (data.sucesso) {
                    $('#modal_data').modal('hide')
                    toastr.success('Cadastro feito com sucesso.', 'Cadastrado')
                } else {
                	if(data.mensagens && data.mensagens.length){
                		toastr.error(data.mensagens[0], 'Erro');
                	} else {
                		toastr.error('Erro ao cadastrar usuário', 'Erro');
                	}
                }
                load('off', $(".modal.show .modal-content"));
            }
        })

    });
    

    

    function montarFormulario(data) {
        autorizador = data.autorizador;
        if (data.sucesso) {
            data.dados.campos.sort(function (a, b) {
                return a.order - b.order;
            });
            $("#form_pbm").html(' ')
            $("#form_pbm").append(`<p class="fontOutfitBold my-2 w-100">Dados Pessoais:</p>`);
            data.dados.campos.forEach(function (e, i) {
                var d_none = '';

                var type = e.tipo ? e.tipo.toLowerCase() : '';
                var mask = '';
                var typemask = '';
                if (e.is_obrigatorio) {
                    var required = 'required';
                    var labelopcional = '';
                } else {
                    var required = '';
                    var labelopcional = '(opcional)'
                }
                if (e['tabela_id'] == 1 && (e['coluna_id'] == 6 || e['coluna_id'] == 7 || e['coluna_id'] == 28 || e['coluna_id'] == 33 || e['coluna_id'] == 4)) {
                    d_none = 'd-none';
                    required = '';
                }
                if (e['label'].toLowerCase().indexOf('cpf') > -1) {
                    mask = 'cpf';
                    typemask = 'cpf'
                } else if (e['label'].toLowerCase().indexOf('data') > -1) {
                    mask = 'input-data';
                } else if (e['label'].toLowerCase().indexOf('cep') > -1) {
                    mask = 'cep';
                    typemask = 'cep'
                } else if (e['label'].toLowerCase().indexOf('telefone') > -1 || e['label'].toLowerCase().indexOf('celular') > -1) {
                    mask = 'telefone';
                    typemask = 'telefone'
                }

                var input = '';
                if (e.tipo == 'radio') {
                    input = "<div class='d-block '>";
                    e['valores_permitidos'].forEach(function (value) {
                        input += `<div class="radio-ecomm  my-2 ml-md-2">
                                <input type="${e.tipo}" ${required}     class="form-control" id="${e['api_alias']}${value['valor']}${value['id']}" value="${value['valor']}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">
                                <label class="w-100" tabindex="0" for="${e['api_alias']}${value['valor']}${value['id']}">${value['label']}</label>
                                 </div>`;
                    });
                    input += "</div>";
                } else if (e.tipo == 'checkbox') {
                    input = `<div class="check-ecomm my-2 ml-md-2">
                                <input type="${e.tipo}" class="form-control" ${required} tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" id="question${e['api_alias']}" questionid="${e['api_alias']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}" value="true">
                                <label class="w-100" for="question${e['api_alias']}">${e['label']}</label>
                                 </div>`;
                } else if (e.tipo == 'select') {
                    input = document.createElement('select');
                    input.setAttribute('type', type);
                    input.setAttribute('name', e['api_alias']);
                    input.setAttribute('tabela_id', e['tabela_id']);
                    input.setAttribute('coluna_id', e['coluna_id']);
                    input.setAttribute('valor_default', e['valor_default'] ? e['valor_default'] : '');
                    if (required) {
                        input.setAttribute('required', 'true');
                    }
                    input.classList.add('form-control');
                    var option = document.createElement('option');
                    option.setAttribute('value', '');
                    input.append(option);
                    e['valores_permitidos'].forEach(function (value) {
                        var option = document.createElement('option');
                        option.setAttribute('value', value['valor']);
                        option.innerHTML = value['label'];
                        input.append(option);
                    });
                    input = input.outerHTML;
                } else {
                    if (autorizador === 'epharma' && (e['coluna_id'] === 33 || e['coluna_id'] === 4)) {
                        var date = new Date();
                        date = date.toLocaleDateString('en-GB', ['short'])
                        input = `<input ${required} value="${date}" type="${e.tipo}" id="${e['api_alias']}" masktype='${typemask}' class="form-control ${mask}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">`
                    } else {
                        input = `<input ${required} type="${e.tipo}" id="${e['api_alias']}" masktype='${typemask}' class="form-control ${mask}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">`
                    }
                }
                $("#form_pbm").append(`<div class="form-row m-0 my-2 w-100 ${d_none}">
                    <div class="col">
                    ${e.tipo != 'checkbox' ? `<label class="w-100" for="${e['api_alias']}">${e['label']} <span class="font-xxs float-right">${labelopcional}</span></label>` : ''}
                    ${input}
                    <div class='invalid-feedback'>O campo é obrigatório</div>
                    </div>
                    </div>
                `);
            });

            if (data['dados']['quiz'] && data['dados']['quiz'].length > 0) {
                dataID = data['dados']['quiz'][0].id;
                configurationId = data['dados']['quiz'][0].configuracao_id;
                if (data['dados']['quiz'][0]['medicamentos']) {
                    data['dados']['quiz'][0]['medicamentos'].forEach(function (e) {
                        idsku.push(e['skuId']);
                    });
                }
                $("#form_pbm").append(`<p class="fontOutfitBold my-2 w-100">Dados do médico:</p>`);
                if (data.dados.quiz[0].perguntas) {
                    data.dados.quiz[0].perguntas.forEach(function (e) {
                        var type = e.tipo;
                        if (e.is_obrigatorio == true) {
                            var required = 'required';
                            var labelopcional = '';
                        } else {
                            var required = '';
                            var labelopcional = '(Opcional)';
                        }
                        var mask = '';
                        var typemask = '';
                        if (e['titulo'].toLowerCase().indexOf('cpf') > -1) {
                            mask = 'cpf';
                            typemask = 'cpf';
                        } else if (e['titulo'].toLowerCase().indexOf('data') > -1) {
                            mask = 'input-data';
                        } else if (e['titulo'].toLowerCase().indexOf('cep') > -1) {
                            mask = 'cep';
                            typemask = 'cep';
                        } else if (e['titulo'].toLowerCase().indexOf('telefone') > -1 || e['titulo'].toLowerCase().indexOf('celular') > -1) {
                            mask = 'telefone';
                            typemask = 'telefone';
                        }

                        var input = '';
                        if (e.tipo == 'radio') {
                            input = `<div class='d-block'>
                                <label  for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>`;
                            e['valores_permitidos'].forEach(function (value) {
                                input += `<div class="radio-ecomm  my-2 ml-md-2 ">
                                <input type="${e.tipo}" class="form-control" name='radio${e['id']}' ${required} id="question${value['id']}" questionid="${e['id']}" value="${value['valor']}">
                                <label class="w-100" for="question${value['id']}">${value['label']}</label>
                                 </div>`;
                            });
                            input += "</div>";
                        } else if (e.tipo == 'checkbox') {
                            input = `<div class="check-ecomm my-2 ml-md-2">
                                <input type="${e.tipo}" class="form-control" ${required} id="question${e['id']}" questionid="${e['id']}" value="true">
                                <label class="w-100" for="question${e['id']}">${e['titulo']}</label>
                                 </div>`;
                        } else if (e.tipo == 'select') {
                            input = document.createElement('select');
                            input.setAttribute('type', type);
                            input.setAttribute('questionid', e['id']);
                            if (required) {
                                input.setAttribute('required', 'true');
                            }
                            input.classList = 'form-control question-pbm';
                            var option = document.createElement('option');
                            option.setAttribute('value', '');
                            input.append(option);
                            e['valores_permitidos'].forEach(function (value) {
                                var option = document.createElement('option');
                                option.setAttribute('value', value['valor']);
                                option.innerHTML = value['label'];
                                input.append(option);
                            });
                            input = `<label class="w-100"  for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>  ${input.outerHTML} `;
                        } else {
                            input = `<label class="w-100" for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>
                            <input type="${e.tipo}" masktype='${typemask}' ${required} questionid="${e['id']}" id="question${e['id']}" class="form-control question-pbm ${mask}">`
                                                    }
                                                    $("#form_pbm").append(`<div class="form-row m-0 my-2 w-100">
                                        <div class="col">
                                        ${input}
                            </div>
                            <div class='invalid-feedback'>O campo é obrigatório</div>
                            </div> `);
                    });
                }
            }
        }
        $(".cpf").mask('000.000.000-00');
        $(".cep").mask('00.000-000');
        $(".input-data").mask('00/00/0000');
        $(".telefone").mask('(99) 9999-99999');
        $(".telefone").on('blur', function () {
            if ($(this).val().length > 14) {
                $(this).unmask();
                $(this).mask('(99) 99999-9999');
            } else {
                $(this).unmask();
                $(this).mask('(99) 9999-9999');
            }
        });
    }
</script>

<script>
    $(document).ready(function(){
        if (window.matchMedia("(min-width: 990px)").matches) {
            $(".img-zoom-produto").imagezoomsl({
                zoomrange: [2, 2]
            });
        }

        
    });
</script>

<script>
    $('#form-avaliacao').on('submit', function (event) {

        event.preventDefault();
        event.stopPropagation();

        let estrelas = $("input[name='rating']:checked").attr('data-star')
        let avaliacao_descricao = $('input[name="avaliacao_descricao"]').val();
        try {
            let recomendacao_produto = $('input[name="avaliacao_recomendaria"]:checked').val();
        } catch (e) {
            toastr.warning('Preencha se você recomendaria ou não o produto!')
            return false
        }

        if (this.checkValidity()) {
            load('on', $('body'))

            $.ajax({
                type: "POST",
                url: "/pesquisa/produto/avaliacao/avaliar",
                data: {
                    'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                    'descricao': $('#avaliacao_descricao').val(),
                    'nota': $("input[name='rating']:checked").val(),
                    'is_recomendado': $("input[name='avaliacao_recomendaria']:checked").val(),
                    'is_anonimo': $("input[name='avaliacao_anonimo']:checked").val(),
                    'produto_id': '469678'

                },
                success: function (data) {
                    if (data.status) {
                        $('#bloco_avaliacao').hide(300)
                        $('#bloco_avaliado').show(300)
                    } else {
                        toastr.error(data.descricao ? data.descricao : 'Ocorreu um erro interno ao avaliar o produto', 'Erro');;
                    }
                    load('off', $('body'))
                },
                error: function (data) {
                    load('off', $('body'))
                    toastr.error('Ocorreu um erro interno ao avaliar o produto', 'Erro');
                }
            });
        } else {
            toastr.warning('Preencha todos os campos necessários para prosseguir')
            $(this).addClass('was-validated')
            return false
        }

    });

    $("input[name='rating']").on("change", function (el) {
        $('#rating_produto').html("(" + $("input[name='rating']:checked").attr('data-star') + "/5)")
    })

    function atualizar_utilidade_avaliacao_produto(tipo, avaliacao_id, index) {

        load('on', $('body'))

        $.ajax({
            type: "POST",
            url: "/pesquisa/produto/avaliacao/reagir",
            data: {
                'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                'tipo': tipo,
                'avaliacao_id': avaliacao_id
            },
            success: function (data) {

                if (data.status) {

                    toastr.success('Reação a avaliação efetuada com sucesso', 'Sucesso')

                    if (tipo === 'util') {
                        $('#icone_like_' + index).attr('src', '/staticfiles/img/icons/icon_thumb_up_liked.39465eb97ae0.svg')
                        $('#icone_dislike_' + index).attr('src', '/staticfiles/img/icons/icon_thumb_down.b8519f9d7bbd.svg')
                    } else {
                        $('#icone_dislike_' + index).attr('src', '/staticfiles/img/icons/icon_thumb_down_disliked.0abaf6f0e043.svg')
                        $('#icone_like_' + index).attr('src', '/staticfiles/img/icons/icon_thumb_up.73893a04780f.svg')
                    }

                    $(`#maislike${avaliacao_id}`).html(`(${data.qtd_util})`)
                    $(`#maisdeslike${avaliacao_id}`).html(`(${data.qtd_nao_util})`)

                } else {
                    toastr.error(data.descricao ? data.descricao : 'Erro ao reagir a avaliação.', 'Erro');
                }

                load('off', $('body'))
            },
            error: function (data) {
                toastr.error('Erro ao reagir a avaliação.', 'Erro');
                load('off', $('body'))
            }
        })
    }

    function show_hide_comentarios(el) {
        if ($(el).attr('aria-expanded') === 'true') {
            $('.show-hide-reacoes').parent().remove()
            $('.avaliacoes-produto').append(`
                <div class="row justify-content-end bg-white">
                    <a class="show-hide-reacoes" onclick="show_hide_comentarios(this)" href="javascript:void(0)" aria-expanded="false" data-target="#show_hide_comentarios" data-toggle="collapse">Ver todos os comentários</a>
                </div>
            `)
        } else {
            $('.show-hide-reacoes').parent().remove()
            $('.avaliacoes-produto').append(`
                <div class="row justify-content-end bg-white">
                    <a class="show-hide-reacoes" onclick="show_hide_comentarios(this)" href="javascript:void(0)" aria-expanded="true" data-target="#show_hide_comentarios" data-toggle="collapse">Ver menos</a>
                </div>
            `)
        }
    }

    function customRadioProduto(el) {
        $('.radio-tipo-produto').find('label').css('border-color', 'lightgrey')
        $(el).css('border-color', '#ffd200')
    }

    function redirect_produto(url) {
        window.location.href = '/' + url
    }

    async function visualizar_receita(el){

        let is_possui_receita_carrinho = 'False' == "True" ? true : false

        if(is_possui_receita_carrinho){
            adicionarProdutoCarrinho($(el).attr('data-hash-produto'), 1, el);
            return;
        }

        let form_envio_receita = $('#form_envio_receita')
        let form_tipo_entrega = $('#form_tipo_entrega')

        let dat_nasc = '' + '-' + '' + '-' + ''
        if(dat_nasc){
            dat_nasc = moment(dat_nasc, 'YYYY-MM-DD').format('DD/MM/YYYY')
            $(form_envio_receita).find('[name="dat_nasc"]').val(dat_nasc)
        }

        filepond_receita(false)

        load('on', $('body'));
        await Promise.all([
            getEstados($('#form_envio_receita')),
            getTiposCr($('#form_envio_receita')),
            getFornecedorPrescricao($('#form_envio_receita'))
        ])
        load('off', $('body'));

        $(form_tipo_entrega).find("[name='receita-entrega']").on('change', function(e){
            if($(form_tipo_entrega).hasClass('was-validated')){
                $(form_tipo_entrega).find('.labl').children('input').addClass('is-valid')
            }
            if($(form_tipo_entrega).find("[name='receita-entrega']:checked").val()){
                $(form_tipo_entrega).find('.submit-entrega').removeClass('isDisabled')
            } else {
                $(form_tipo_entrega).find('.submit-entrega').addClass('isDisabled')
            }
        })

        $(form_envio_receita).find("[name='receita-tipo']").on('change', function(e){

            if($(form_envio_receita).hasClass('was-validated')){
                $(form_envio_receita).find('.labl').children('input').addClass('is-valid')
            }

            $(form_envio_receita).find("[name='receita_numero_token']").val('')
            $('#receita_anexo_arquivo').filepond("removeFiles")

            let forma_envio = $(this).val()
            if(forma_envio === 'token'){
                $(form_envio_receita).find("[name='bloco_receita_digital']").show(300)
                $(form_envio_receita).find("[name='bloco_receita_anexo']").hide(300)
                $(form_envio_receita).find("[name='receita_numero_token'], [name='fornecedor_prescricao']").attr('required', true)
                filepond_receita(false)
            } else if(forma_envio === 'path_receita'){
                $(form_envio_receita).find("[name='bloco_receita_anexo']").show(300)
                $(form_envio_receita).find("[name='bloco_receita_digital']").hide(300)
                $(form_envio_receita).find("[name='receita_numero_token'], [name='fornecedor_prescricao']").attr('required', false)
                filepond_receita(true)
            } else {
                $(form_envio_receita).find("[name='bloco_receita_anexo']").hide(300)
                $(form_envio_receita).find("[name='bloco_receita_digital']").hide(300)
                $(form_envio_receita).find("[name='receita_numero_token'], [name='fornecedor_prescricao']").attr('required', false)
                filepond_receita(false)
            }
        })

        alterarPassoReceita(2)

        $('#modal_receita_medica').modal('show')

        $(form_envio_receita).off('submit').on('submit', function (event) {

            event.preventDefault();
            event.stopPropagation();

            let dat_nasc = $(form_envio_receita).find("[name='dat_nasc']").val()
            dat_nasc = moment(dat_nasc, 'DD/MM/YYYY').format('YYYYMMDD')

            let dat_receita = $(form_envio_receita).find("[name='dat_receita']").val()
            dat_receita = moment(dat_receita, 'DD/MM/YYYY').format('YYYYMMDD')

            if(!$(form_envio_receita).find('[name=receita-tipo]:checked').val()){
                $(form_envio_receita).find('.labl').children('input').addClass('is-invalid')
                $(form_envio_receita).find('.is-invalid-text').show(300)
            } else {
                $(form_envio_receita).find('.labl').children('input').addClass('is-valid')
                $(form_envio_receita).find('.is-invalid-text').hide(300)
            }

            if($(form_envio_receita).find('[name=receita-tipo]:checked').val() === 'path_receita' && receita_anexo){
                $(form_envio_receita).find('#receita_anexo_arquivo').addClass('is-valid')
            } else if($(form_envio_receita).find('[name=receita-tipo]:checked').val() === 'path_receita' && !receita_anexo){
                toastr.warning('Envie sua receita para prosseguir.')
                $(form_envio_receita).find('#receita_anexo_arquivo').addClass('is-invalid')
                return
            }

            if (this.checkValidity()) {

                if($(form_envio_receita).find('[name=receita-tipo]:checked').val() === 'carrinho'){

                    $('#modal_receita_medica').modal('hide');

                    let qtd_solicitada = $(form_envio_receita).find("[name='qtd_medicamentos']").val();
                    adicionarProdutoCarrinho($(el).attr('data-hash-produto'), qtd_solicitada ? qtd_solicitada : 1, el);

                    return
                }

                load('on', $("body"));

                load('on', $(".modal.show .modal-content"));

                $.ajax({
                    type: 'POST',
                    url: "/receita/salvar",
                    data: {
                        'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                        'cd_produto': '469678',
                        'nm_completo': $(form_envio_receita).find("[name='nm_completo']").val(),
                        'uf_rg': $(form_envio_receita).find("[name='estado-documento']").val(),
                        'documento': $(form_envio_receita).find("[name='documento']").val(),
                        'dat_nasc': dat_nasc ? dat_nasc : '',
                        'sexo': $(form_envio_receita).find("[name='sexo']:checked").val(),
                        'dat_receita': dat_receita ? dat_receita : '',
                        'qtd': $(form_envio_receita).find("[name='qtd_medicamentos']").val(),
                        'cr': $(form_envio_receita).find("[name='cr']").val(),
                        'uf': $(form_envio_receita).find("[name='uf_cr']").val(),
                        'conselho': $(form_envio_receita).find("[name='codigo_cr']").val(),
                        'nm_medico': $(form_envio_receita).find("[name='nm_medico']").val(),
                        'fornecedor_prescricao': $(form_envio_receita).find("[name='fornecedor_prescricao']").val(),
                        'token': $(form_envio_receita).find("#receita_tipo_digital").is(':checked') ? $(form_envio_receita).find("[name='receita_numero_token']").val() : '',
                        'path_receita': $(form_envio_receita).find("#receita_tipo_anexo").is(':checked') ? receita_anexo : '',
                    },
                    success: function (response) {

                        if(response.status){

                            $(el).attr('data-receita-id', response ? response.receita_id : '')

                            toastr.success('Receita enviada com sucesso. Compra do produto liberada.')
                            $('#modal_receita_medica').modal('hide')

                            let qtd_solicitada = $(form_envio_receita).find("[name='qtd_medicamentos']").val()
                            adicionarProdutoCarrinho($(el).attr('data-hash-produto'), qtd_solicitada ? qtd_solicitada : 1, el);

                        } else {
                            toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao enviar a receita', 'Erro');
                        }

                        load('off', $('body'));
                        load('off', $(".modal.show .modal-content"))
                    },
                    error: function () {
                        load('off', $('body'));
                        load('off', $(".modal.show .modal-content"))
                        toastr.error('Ocorreu um erro interno ao enviar a receita', 'Erro');
                    }
                });

            } else {
                toastr.warning('Preencha todos os campos necessários para prosseguir')
                $(this).addClass('was-validated')
                return false
            }
        })
    }

    $('#modal_receita_medica').on('hidden.bs.modal', function(){

        $('form').removeClass('was-validated')

        $(form_tipo_entrega).get(0).reset()
        $(form_envio_receita).get(0).reset()

        $(form_tipo_entrega).find(".is-valid").removeClass('is-valid')
        $(form_tipo_entrega).find(".is-invalid").removeClass('is-invalid')
        $(form_tipo_entrega).find('.submit-entrega').addClass('isDisabled')

        $(form_envio_receita).find(".is-valid").removeClass('is-valid')
        $(form_envio_receita).find(".is-invalid").removeClass('is-invalid')

        $(form_envio_receita).find("[name='bloco_receita_anexo']").hide(300)
        $(form_envio_receita).find("[name='bloco_receita_digital']").hide(300)
        $(form_envio_receita).find("[name='bloco_tipo_receita_required']").hide(300)

        filepond_receita(false)
        receita_anexo = ''
        $('#receita_anexo_arquivo').filepond("removeFiles")

    });

    let receita_anexo
    function filepond_receita(is_required){
        $('#receita_anexo_arquivo').filepond({
            allowFileTypeValidation: true,
            acceptedFileTypes: ["image/jpeg", "application/pdf"],
            allowMultiple: false,
            instantUpload: true,
            allowImagePreview: false,
            maxParallelUploads: 1,
            maxFiles: 1,
            required: is_required ? is_required : false,
            onprocessfilestart: function (file) {
                $('#form_envio_receita').find('.submit-receita').addClass('isDisabled')
            },
            onprocessfiles: function () {
                $('#form_envio_receita').find('.submit-receita').removeClass('isDisabled')
            },
            onremovefile: function (error, file) {
                $('#form_envio_receita').find('.submit-receita').removeClass('isDisabled')
            },
            server: {
                process: (fieldName, file, metadata, load, error, progress, abort, transfer, options) => {

                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onloadend = function () {
                        var base64data = reader.result;
                        var data = new FormData();
                        data.append("csrfmiddlewaretoken", 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ');
                        data.append("nome", file.name);
                        data.append("arquivo", base64data);
                        data.append("diretorio", 'receitas/');
                        const request = new XMLHttpRequest();
                        request.open('POST', "/core/arquivo/salvar")
                        request.upload.onprogress = (e) => {
                            progress(e.lengthComputable, e.loaded, e.total);
                        };
                        request.onload = function () {
                            if (request.status >= 200 && request.status < 300) {
                                load(request.responseText);
                                let retorno = JSON.parse(request.response)
                                receita_anexo = retorno.path
                            } else {
                                error('oh no');
                                toastr.error('Ocorreu um erro ao fazer o upload do arquivo.', 'Erro');
                            }
                        };
                        request.send(data);
                        return {
                            abort: () => {
                                toastr.error('Ocorreu um erro ao fazer o upload do arquivo.', 'Erro');
                                request.abort();
                                abort();
                                receita_anexo = ''
                            }
                        };
                    }
                },
                revert: (uniqueFileId, load, error) => {
                    $.ajax({
                        type: "POST",
                        url: "/core/arquivo/deletar",
                        data: {
                            'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                            'path': JSON.parse(uniqueFileId).path,
                        },
                        success: function (data) {},
                        error: function (data) {}
                    });
                    load()
                    receita_anexo = ''
                },
            },
            labelFileLoading: 'Carregando',
            labelFileProcessing: 'Carregando',
            labelTapToCsancel: 'Clique para cancelar',
            labelFileProcessingComplete: 'Upload completo',
            labelTapToUndo: 'Clique para remover',
            labelButtonRemoveItem: 'Remover',
            labelFileTypeNotAllowed: 'Extensão do arquivo inválida',
            fileValidateTypeLabelExpectedTypes: 'As seguintes esxtensões são esperadas: {allTypes}',
            fileValidateTypeLabelExpectedTypesMap: {'image/jpeg': 'JPG', 'application/pdf': 'PDF'},
            labelIdle: `<img loading="lazy" src="/staticfiles/img/icons/icon_upload02.419c83c25873.svg" width="50" alt="" class="mr-2">Arraste o(s) arquivo(s) aqui ou <a  class="btn btn-outline-secondary btn-sm">Selecione do computador</a>`,
        })
    }

    try {

        let FULL_DASH_ARRAY = 283;
        let TIME_LIMIT = 0;
        let time_inicio;
        let time_fim;
        let timePassed = 0;
        let timeLeft = TIME_LIMIT;

        $('#hora-limite-promocao-relampago').html(`
            <div class="base-timer">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g class="base-timer__circle" fill="none" stroke="none">
                        <circle stroke-width="10px" stroke="#ffdf98" cx="50" cy="50" r="45"></circle>
                        <path stroke-dasharray="283" class="base-timer-path-remaining base-timer__path-remaining"
                            d="M 50, 50 m -45, 0 a 45,45 0 1,0 90,0 a 45,45 0 1,0 -90,0">
                        </path>
                    </g>
                </svg>
                <span class="base-timer-label base-timer__label text-white label-promocao-relampago d-flex justify-content-center align-items-center fontOutfitSemiBold"></span>
            </div>
        `)

        $('#minuto-limite-promocao-relampago').html(`
            <div class="base-timer">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g class="base-timer__circle" fill="none" stroke="none">
                        <circle stroke-width="10px" stroke="#ffdf98" cx="50" cy="50" r="45"></circle>
                        <path stroke-dasharray="283" class="base-timer-path-remaining base-timer__path-remaining"
                            d="M 50, 50 m -45, 0 a 45,45 0 1,0 90,0 a 45,45 0 1,0 -90,0">
                        </path>
                    </g>
                </svg>
                <span class="base-timer-label base-timer__label text-white label-promocao-relampago d-flex justify-content-center align-items-center fontOutfitSemiBold"></span>
            </div>
        `)


        if($('.promocao-relampago').length){
            for(let el of $('.promocao-relampago')){
                startTimer($(el));
            }
        }

        function startTimer(el) {

            let dat_atual = moment(new Date())
            let dat_limite = moment($(el).attr('data-timer'))
            restante = dat_limite.diff(dat_atual, 'seconds')

            time_inicio = moment(dat_limite).subtract(1, 'd').format('YYYY-MM-DD HH:mm:ss')
            time_fim = moment($(el).attr('data-timer')).format('YYYY-MM-DD HH:mm:ss')

            let timerInterval = setInterval(() => {

                timePassed = timePassed += 1;
                timeLeft = restante - timePassed;

                let hrs_restantes = moment.utc(timeLeft * 1000).format("HH")
                let min_restantes = moment.utc(timeLeft * 1000).format("mm")

                $('#hora-limite-promocao-relampago').find('.base-timer-label').html(hrs_restantes)
                $('#minuto-limite-promocao-relampago').find('.base-timer-label').html(min_restantes)

                setCircleDasharray();

                if (!timeLeft) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function calculateTimeFraction() {
            const rawTimeFraction = timeLeft / TIME_LIMIT;
            return rawTimeFraction - (1 / TIME_LIMIT) * (1 - rawTimeFraction);
        }

        function setCircleDasharray() {
            const circleDasharray = `${(calculateTimeFraction() * FULL_DASH_ARRAY).toFixed(0)} 283`;
            $('.base-timer-path-remaining').attr("stroke-dasharray", circleDasharray)
        }

        } catch (error) {

        }

        function consultar_estoque(lat, lon){
            
            let latLon = ''

            if(lat && lon)
                latLon = `${lat}, ${lon}`

            load('on', $("body"));
            load('on', $("#modal_consultar_estoque"));

            $.ajax({
                type: 'POST',
                url: "/buscar/estoque",
                data: {
                    'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                    'produto_id': '469678',
                    'cliente_id': '',
                    'parceiro_id': 'none',
                    'coordenadas': latLon,
                    'endereco_id': carrinho.instance.endereco.value ? carrinho.instance.endereco.value.id : '',
                    'cep': carrinho.instance.endereco.value ? carrinho.instance.endereco.value.cep : '',

                },
                success: function (response) {

                    load('off', $('body'));
                    load('off', $("#modal_consultar_estoque"));

                    if(response.status){

                        let html = ``

                        if(response.lista_estoque && response.lista_estoque.length){
                            for(let value of response.lista_estoque){
                                let produto = value.produtos && value.produtos.length ? value.produtos[0] : ''
                                html += `
                                    <div class="col-12 p-0 m-0 mb-3 card-filial">
                                        <div class="card-consultar-estoque d-flex p-1">
                                            <div class="col-2 p-0 m-0 pl-1 pl-md-0 d-flex align-items-center justify-content-center">
                                                <img loading="lazy" src="/staticfiles/img/icons/icon_estoque_loja.d4b3ec807518.svg" width="48">
                                            </div>
                                            <div class="col-10 p-0 m-0 pl-3 pl-md-0">
                                                <p class="fontOutfitSemiBold">Loja ${value.cd_filial} - <span class="text-estoque-${produto.nivel_classe}">Estoque ${produto.nivel_descricao}</span></p>
                                                <p>${value.endereco}, ${value.numero}</p>
                                                <p>${value.bairro} - ${value.cidade} - ${value.uf}</p>
                                                <a class="cursor-pointer text-consulta-estoque fontOutfitBold" onclick="visualizar_filial_estoque('${value.latitude}','${value.longitude}')">Ver no mapa</a>
                                            </div>
                                        </div>
                                    </div>
                                `
                            }
                            html += `
                                <div class="col-12 text-center my-3" data-target="empty-state-estoque" style="display: none;">
                                    <span class="font-2xl text-muted">Nenhuma loja encontrada</span><img loading="lazy" src="/staticfiles/img/carrinho/sad.17aa5d6009a1.png" width="15" class="ml-2">
                                </div>
                            `
                            $('[data-target="bloco-estoque-filiais"]').html(html)
                        }
                        $('#modal_consultar_estoque').modal('show')
                    } else {
                        toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao consultar o estoque do produto', 'Erro');
                    }
                },
                error: function () {
                    load('off', $('body'));
                    load('off', $("#modal_consultar_estoque"));
                    toastr.error('Ocorreu um erro interno ao consultar o estoque do produto', 'Erro');
                }
            });
        }
        
       

        let linkVideo = 'None';
        function abrirVideoProduto() {
            load('on', $("body"));
            load('on', $("#modal_video_produto"));

            // $('#modal_video_produto').modal('show')
            


            load('off', $("body"));
            load('off', $("#modal_video_produto"));
        }
        

        

        

         let map;

        function visualizar_filial_estoque(lat, lon) {
        
            if(map && typeof(map) === 'object'){
                map.remove();
            }
    
            map = L.map('mapa-estoque').setView([+lat, +lon], 15);
    
            const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
    
            const marker = L.marker([+lat, +lon], {alt: ''})
            let customIcon = {
                iconUrl: "/staticfiles/img/maps/pinRosario.7f6c20f2b0e0.svg",
                iconSize:[40,40]
            }
            let myIcon = L.icon(customIcon);
            marker.setIcon(myIcon);
            marker.addTo(map);
    
            $('#modal_localizacao_estoque').modal('show')

            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
              }, "200");
        }

        

        function favoritar_produto(favorito_id){

            load('on', $('body'))

            if(!favorito_id){
                $.ajax({
                    type: 'POST',
                    url: "/favoritar/produto",
                    data: {
                        'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                        'produto_id': '469678',
                    },
                    success: function (response) {
                        if(response.status){
                            $('.bloco_favoritar_produto').hide(300)
                            $('.bloco_favoritar_produto').html(`
                                <img loading="lazy" src="/staticfiles/img/icons/icon_favoritado.87ed23d99132.svg" onclick="favoritar_produto('${response.favorito_id}')"width="24" height="24" class="mr-1 cursor-pointer">
                            `)
                            $('.bloco_favoritar_produto').show(300)
                        } else {
                            toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao favoritar o produto', 'Erro');
                        }

                        load('off', $('body'));
                    },
                    error: function () {
                        load('off', $('body'));
                        toastr.error('Ocorreu um erro interno ao favoritar o produto', 'Erro');
                    }
                });
            } else {
                $.ajax({
                    type: 'POST',
                    url: "/remover/favorito",
                    data: {
                        'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                        'produto_id': '469678',
                        'favorito_id': favorito_id,
                    },
                    success: function (response) {
                        if(response.status){
                            $('.bloco_favoritar_produto').hide(300)
                            $('.bloco_favoritar_produto').html(`
                                <img loading="lazy" src="/staticfiles/img/icons/icon_favorite.aa63b5c1bc4a.svg" onclick="favoritar_produto('')" width="24" height="24" class="mr-1 cursor-pointer">
                            `)
                            $('.bloco_favoritar_produto').show(300)
                        } else {
                            toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao favoritar o produto', 'Erro');
                        }

                        load('off', $('body'));
                    },
                    error: function () {
                        load('off', $('body'));
                        toastr.error('Ocorreu um erro interno ao favoritar o produto', 'Erro');
                    }
                });
            }
        }

        function buscar_favoritos(){
            let is_favorito = false
            let favorito_id = ''
            
            if(is_favorito){
                $('.bloco_favoritar_produto').html(`
                    <img loading="lazy" src="/staticfiles/img/icons/icon_favoritado.87ed23d99132.svg" onclick="favoritar_produto('${favorito_id}')" width="24" height="24" class="mr-1 cursor-pointer">
                `)
            } else {
                $('.bloco_favoritar_produto').html(`
                    <img loading="lazy" src="/staticfiles/img/icons/icon_favorite.aa63b5c1bc4a.svg" onclick="favoritar_produto('${favorito_id}')" width="24" height="24" class="mr-1 cursor-pointer">
                `)
            }
            $('.bloco_favoritar_produto').show(300)
        }

        function ordenar_comentarios(){
            load('on', $('body'))
            $.ajax({
                type: 'POST',
                url: "/pesquisa/produto/avaliacao/ordenar",
                data: {
                    'csrfmiddlewaretoken': 'LF38eeP0Ix8Xo7Scz2nYUtFunvbKuFX04ai37mQd5MmkV9j9Lp4ISZFKwtgebVzQ',
                    'produto_id': '469678',
                    'ordenacao': $('#filtro-avaliacao').val(),
                },
                success: function (response) {
                    if(response.status){
                        let comentarios = response.avaliacoes && response.avaliacoes.avaliacoes && response.avaliacoes.avaliacoes.length ? response.avaliacoes.avaliacoes : []
                        let html = ``
                        if(comentarios.length){
                            for(let [index, value] of comentarios.entries()){
                                let nota_real = parseFloat(value.nota_real)
                                html += `
                                    <div class="col-12 m-0 p-0 mt-3">
                                        <div class="d-flex">
                                `
                                if(nota_real == 0){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else if(nota_real < 1){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else {
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_amarela.f7ded8e6da44.svg" width="17" height="17">`
                                }
                                if(nota_real == 1){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else if(nota_real < 2){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else {
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_amarela.f7ded8e6da44.svg" width="17" height="17">`
                                }
                                if(nota_real == 2){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else if(nota_real < 3){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else {
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_amarela.f7ded8e6da44.svg" width="17" height="17">`
                                }
                                if(nota_real == 3){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else if(nota_real < 4){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else {
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_amarela.f7ded8e6da44.svg" width="17" height="17">`
                                }
                                if(nota_real == 4){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else if(nota_real < 5){
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_cinza.add47130e4e9.svg" width="17" height="17">`
                                } else {
                                    html += `<img loading="lazy" src="/staticfiles/ecommerce/img/estrelas/Estrela_unica_amarela.f7ded8e6da44.svg" width="17" height="17">`
                                }
                                html += `
                                        </div>
                                    </div>
                                    <div class="col-12 m-0 mt-2 p-0">
                                        <p class="fontOutfitBold text-desconto-pbm">
                                            ${ value.is_anonimo ? 'Anônimo' : value.cliente__nm_primeiro } em ${ moment(value.datetime_avaliacao).format('DD/MM/YYYY') }
                                        </p>
                                    </div>
                                    <div class="col-12 m-0 mt-2 p-0">
                                        <p class="text-desconto-pbm font-weight-medium">
                                            ${ value.descricao }
                                        </p>
                                    </div>
                                    <div class="col-12 m-0 p-0 mt-2 mb-3">
                                        <div class="d-flex">
                                            <a onclick="atualizar_utilidade_avaliacao_produto('util', '${ value.id }', '${ index }')" style="cursor: pointer">
                                                <span class="ml-2 text-distribuidor" id="maislike${ value.id }">
                                                    (${ value.qtd_util })
                                                </span>
                                            </a>
                                            <span class="mx-3"></span>
                                            <a onclick="atualizar_utilidade_avaliacao_produto('nao_util', '${ value.id }', '${ index }')" style="cursor: pointer">
                                                <span class="ml-2 text-distribuidor" id="maisdeslike${ value.id }">
                                                    (${ value.qtd_nao_util })
                                                </span>
                                            </a>
                                        </div>
                                    </div>
                                `
                                if(comentarios.length > 5){
                                    html += `
                                        <div class="d-flex d-md-block justify-content-center w-100 m-0 p-0 bg-white">
                                            <a class="show-hide-reacoes text-consulta-estoque fontOutfitSemiBold d-flex align-items-center" onclick="show_hide_comentarios(this)" href="javascript:void(0)" aria-expanded="false" data-target="#show_hide_comentarios" data-toggle="collapse">
                                                Ver mais avaliações
                                                <img loading="lazy" src="/staticfiles/img/icons/icon_arrow_down.b449f5341121.svg" width="25">
                                            </a>
                                        </div>
                                    `
                                }
                            }
                            $('[data-target="bloco-comentarios"]').html(html)
                        }
                    } else {
                        toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao ordenar os comentários do produto', 'Erro');
                    }
                    load('off', $('body'));
                },
                error: function () {
                    load('off', $('body'));
                    toastr.error('Ocorreu um erro interno ao ordenar os comentários do produto', 'Erro');
                }
            });
        }

        function filtrar_estoque_localizacao(){
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        if(position && position.coords){
                            consultar_estoque(position.coords.latitude, position.coords.longitude)
                        }
                    },
                    (error) => {
                        $('#modal_localizacao_nao_permitida').modal('show');
                    }
                );
            } else {
                $('#modal_localizacao_bloqueada').modal('show');
            }
        }

        function visualizarDescricaoCompletaProduto(){
            $('[data-target="produto-descricao"]').removeClass('text-limit-2')
            $('[data-target="bloco-ver-mais-informacoes"]').hide(300)
        }

</script>

<script>
    
        let price_datalayer ="18.99"
    



    gtag('event', 'product_detail', {
        items: [{
            id: "469678",
            index: 1,
            item_name: "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
            item_id: "469678",
            name: "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
            currency: "BRL",
            price: price_datalayer ? price_datalayer : '',
            quantity: 1,
            discount: ""
        }]
    });
    
    // filtroParaDadosAnaliticos('ProductDetail', {
    //     items: [{
    //         id: "469678",
    //         index: 1,
    //         item_name: "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
    //         item_id: "469678",
    //         name: "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
    //         currency: "BRL",
    //         price: price_datalayer ? price_datalayer : '',
    //         quantity: 1,
    //         discount: ""
    //     }]
    // })
</script>



<!-- SEO -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
        "gtin": "4005900105073",
        "brand":{
            "@type": "Brand",
            "name": "Nivea",
            "url": "/marcas/Nivea"
        },
        "description": "",
        "sku": "469678",
        "url": "/desodorante-aerosol-nivea-invisible-black-white-clear-200ml",
        "image": "/media/produtos/469678/469678_0.jpg",
        "category": "/cuidados-pessoais/higiene-diaria/desodorantes-aerosol",
        "offers": {
            "@type": "Offer",
            "sku": "469678",

            
                "price": "18.99",
            

            "priceCurrency": "BRL",
            "seller": {
                "@type": "Organization",
                "name": "Farmácias Rosário"
            }
        }
        
    }
</script>
<!-- SEO -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Página Inicial",
                "item": "www.urlRosario.com.br/"
            },
            
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Cuidados Pessoais",
                    "item": "www.urlRosario.com.br/categorias/cuidados-pessoais"
                },
                
            
                {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Higiene Diária",
                    "item": "www.urlRosario.com.br/categorias/cuidados-pessoais/higiene-diaria"
                },
                
            
                {
                    "@type": "ListItem",
                    "position": 4,
                    "name": "Desodorantes Aerosol",
                    "item": "www.urlRosario.com.br/categorias/cuidados-pessoais/higiene-diaria/desodorantes-aerosol"
                },
                
                {
                    "@type": "ListItem",
                    "position": 5,
                    "name": "Desodorante Aerosol Nivea Invisible Black &amp; White CleaR 200ML",
                    "item": "www.urlRosario.com.br/categorias/cuidados-pessoais/higiene-diaria/desodorantes-aerosol/desodorante-aerosol-nivea-invisible-black-white-clear-200ml"
                }
                
            
        ]
    }
</script>

<script type='text/javascript'>
var ccs_cc_args = ccs_cc_args || [];
// Product Page
ccs_cc_args.push(['cpn', 'CPN']);
ccs_cc_args.push(['mf', "Nivea"]);
ccs_cc_args.push(['pn', '4005900105073']);
ccs_cc_args.push(['upcean', '4005900105073']);
ccs_cc_args.push(['ccid', 'CATALOG_CODE']);
ccs_cc_args.push(['lang', 'pt']);
ccs_cc_args.push(['market', 'br']);
(function () {
	var o = ccs_cc_args; o.push(['_SKey', '9a9c2a74']); o.push(['_ZoneId', 'eff5fb3ceb']);
	var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true;
	sc.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
	'cdn.cs.1worldsync.com/jsc/h1ws.js';
	var n = document.getElementsByTagName('script')[0]; n.parentNode.insertBefore(sc, n);
})();
</script>
        

        
    

            </div>
        </main>
    </div>
    

<style>
            .labl>input+label {
                border: 2px solid var(--light-hover) !important;
                box-shadow: unset !important;
            }

            .labl>input+label:hover,
            .labl>input:checked+label {
                border: 2px solid #137ec2 !important;
            }

            .labl.labl-background>input+label {
                border: 0 !important;
            }

            .labl.labl-background>input:checked+label,
            .labl.labl-background>input:hover+label {
                background-color: #137ec2 !important;
            }

            .labl.labl-background>input:checked+label *,
            .labl.labl-background>input:hover+label * {
                color: #fff !important;
            }

            .labl.labl-background>input+label:hover img,
            .labl.labl-background>input:checked+label img {
                filter: unset !important;
            }

            .labl.labl-warning>input+label {
                border: 0 !important;
            }

            .labl.labl-warning * {
                color: var(--muted);
            }

            .labl.labl-warning>input:checked+label,
            .labl.labl-warning>input:hover+label {
                background-color: var(--warning) !important;
            }

            .labl.labl-warning>input:checked+label *,
            .labl.labl-warning>input:hover+label * {
                color: #fff !important;
            }

            .labl.labl-warning>input+label img {
                filter: invert(21%) sepia(48%) saturate(3055%) hue-rotate(349deg) brightness(103%) contrast(98%) !important;
            }

            .labl.labl-warning>input+label:hover img,
            .labl.labl-warning>input:checked+label img {
                filter: unset !important;
            }



            .labl.labl-success>input+label {
                border: 0 !important;
                cursor: unset !important;
            }

            .labl.labl-success * {
                color: var(--muted);
            }

            .labl.labl-success>input:checked+label,
            .labl.labl-success>input:hover+label {
                background-color: #fff !important;
            }

            /* .labl.labl-success>input:checked+label *, .labl.labl-success>input:hover+label * {
            color: unset !important;
        } */
            .labl.labl-success>input+label img {
                filter: invert(52%) sepia(80%) saturate(3330%) hue-rotate(115deg) brightness(99%) contrast(78%) !important;
            }

            .labl.labl-success>input+label:hover img,
            .labl.labl-success>input:checked+label img {
                filter: invert(52%) sepia(80%) saturate(3330%) hue-rotate(115deg) brightness(99%) contrast(78%) !important;
            }

            .btn-mundo-verde {
                background-color: #1cb05c !important;
                color:var(--white) !important;
            }

            .containerScroll {
                display: flex;
                flex-direction: row;
                height: 25rem;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .scrollport:before,
            .scrollport:after {
                content: '';
            }

            .scrollport {
                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                height: 25rem;
                overflow: scroll;
                scroll-snap-type: y mandatory;
            }

            .scrollport:after, .scrollport:before {
                scroll-snap-align: center;
                flex-grow: 1;
                flex-shrink: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 170px !important;
            }
            .scrollport .cell {
                scroll-snap-align: center;
                flex-grow: 1;
                flex-shrink: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                color: #898989;
                font-size: 2rem;
                height: 85px !important;
            }

            .scrollport .selected {
                font-size: 4rem;
                font-weight: bold;
                color: #444444;
            }

            .modalQuantidade{
                display: flex;
                height: 4rem;
                background-color: #3f84c7;
                font-size: 1.2rem;
                text-align: center;
                align-content: baseline;
            }

            .modalClass{
                border-radius: 20px !important;
            }

        </style>
<!-- versao 01/02 -->
<!-- CARRINHO -->
<div id="asidebar">
    <div class="asidebar asidebar-closed" style="background-color: #f0f3f5;">
        <!-- Header Carrinho -->
        <div class="row" style="margin: 0 !important;">
            <div class="col-12 px-0" style="background-color:#fff;">
                <div style="border-bottom: 3px solid #137ec2;" class="px-3 d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center py-2">
                            <span class="font-weight-bold blueText icon_arrow-back02 mr-3 cursor-pointer" id="carrinho-voltar-entrega"></span>
                        <img src="/media/icons/icon-cesta.svg" class="mr-2" width="30" height="30" alt="cesta">
                        <span class="blueText fontOutfitBold mr-1" style="font-size: 1.1rem;">Cesta </span>
                        <span id="carrinho-itens" class="blueText fontOutfitBold" style="font-size: 1.1rem;"> (0 itens)</span>
                    </div>
                    <div class="icon_close02 cursor-pointer blueText" onclick="onToggleCarrinho()" style="color:#137ec2"></div>
                </div>
            </div>
            <div class="col-12 px-0" style="background-color:#fff;">
                <div class="text-center" style="padding: 15px 20px 8px 20px;">
                    <span class="text-primary font-weight-semibold mb-1" id="carrinho-texto-frete-gratis"></span>
                    <div class="carrinho-progress">
                        <div class="carrinho-progress-bar" id="carrinho-restante_frete_bar" aria-label="Progresso de frete grátis" role="progressbar" aria-valuenow="0" aria-valuemin="0" style="width: 100%;" aria-valuemax="100"></div>
                    </div>
                    <span class="badge text-wrap pointer-event-none">Pedidos realizados das 19h01M até 06h, serão entregues a partir das 8h do dia seguinte. </span>
                </div>
            </div>
        </div>

        <!-- Body Carrinho -->
        <div class="pt-2" id="carrinho-body" style="
            max-height: calc( 100vh - 15.25rem) !important;
            height: 100% !important;
            display: inline-block;
            width: 100%;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 8.5rem;
            padding-left: 0.8rem">
        </div>

        <!-- Footer Carrinho  -->
        <div id="carrinho-footer" class="pb-3"
             style="position:fixed; bottom:0; width:inherit; background-color:#fff;">
            <div class="row mx-2">
                <div class="col-12">
                    <div class="carrinho-progress">
                        <div class="carrinho-progress-bar" data-target="carrinho-progresso" role="progressbar"
                             aria-valuenow="0" aria-valuemin="0" aria-label="Progresso carrinho"
                             style="width:50%;background-color: var(--sunflower-yellow);" aria-valuemax="100"></div>
                    </div>
                </div>
                
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold pt-3">
                    <span class="fontOutfitBold">Subtotal:</span>
                    <span data-target="carrinho-subtotal" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold" style="color:#1cb05c">
                    <span class="fontOutfitBold">Desconto de Programa:</span>
                    <span data-target="carrinho-vlr_desconto_pbm" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold">
                    <span class="fontOutfitBold">Descontos:</span>
                    <span data-target="carrinho-desconto_valor" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold">
                    <span class="fontOutfitBold">Frete:</span>
                    <span data-target="carrinho-vlr_frete" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-xl font-weight-bold blueText pb-1">
                    <span class="fontOutfitBold">Valor Total:</span>
                    <span data-target="carrinho-vlr_total" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 mt-2">
                    <!-- Botão de confirmação -->
                    <div class="btn botaoPrincipal w-100" id="carrinho-botao-finalizar">
                        <span class="font-weight-bold text-nowrap font-xl fontOutfitBold" style="color: #fff">Escolher Entrega</span>
                    </div>
                </div>
                <!-- Fim footer do carrinho -->
            </div>
        </div>
    </div>

    <!-- Localizações -->
    <div class="modal fade modal-carrinho" id="modal_localizacao_mapa" data-backdrop="true" style="z-index: 12000"
         tabindex="-1" role="dialog" aria-labelledby="modal_localizacao_mapa" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="font-weight-bold">Localização mapa</p>

                    <div class="icon_close02 cursor-pointer" data-dismiss="modal" style="color:#137ec2"></div>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 col-xl-4 col-lg-4 col-md-12 col-sm-12 bg-light p-3">
                            <p class="font-weight-bold font-xl">
                                <span data-target="map-nmloja"></span>
                            </p>

                            <p class="font-weight-bold mt-2"> Endereço: </p>
                            <div class="d-flex align-items-center">
                                <img src="" alt="">
                                <div>
                                    <span data-target="map-endereço"></span> <span data-target="map-numero"></span>,
                                    <span data-target="map-bairro"></span> -
                                    <span data-target="map-cidade"></span>/<span data-target="map-estado"></span>
                                    <p class="text-nowrap"><span>CEP:</span><span data-target="map-cep"></span></p>
                                </div>
                            </div>

                            <p class="font-weight-bold mt-2" data-target="map-lista_horarios_p"> Horário de
                                funcionamento: </p>
                            <div class="d-flex align-items-center" data-target="map-lista_horarios_div">
                                <img src="" alt="">
                                <div>
                                    <p>Seg a Sex: <span data-target="map-hr-segasex"></span></p>
                                    <p>Sáb: <span data-target="map-hr-sab"></span></p>
                                    <p>Dom: <span data-target="map-hr-dom"></span></p>
                                </div>
                            </div>

                            <p class="font-weight-bold mt-2"> Telefone: </p>
                            <div class="d-flex align-items-center">
                                <img src="" alt="">
                                <div>
                                    <span data-target="map-telefone"></span>
                                </div>
                            </div>

                            <p class="font-weight-bold mt-2" data-target="map-lista_servicos_div"> Serviços: </p>
                            <div data-target="map-lista_servicos">
                            </div>

                        </div>
                        <div class="col col-xl col-lg col-md-12 col-sm-12 bg-light">
                            <div id="map" style="height:100%; min-height:640px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- Fecha modal -->


    <!-- Popup Agendada -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupAgendada" data-zindex="12001"
         style="z-index: 12001; max-height: 80%; height: 100%; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <p class="blueText font-weight-black mt-1 mb-3 text-center font-xl pb-1">Selecione o horário que deseja
            receber</p>
        <div id="carrinho-horarios-agendada" style="height:85%; overflow:auto;">
        </div>
    </div>

    <!-- Informacao pacotes -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupInformacaoPacote"
         data-zindex="12001"
         style="z-index: 12001; max-height: 80%; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <div class="d-flex align-items-center justify-content-center mt-1 mb-3">
            <p class="text-center pb-1 blueText fontOutfitBold" style="font-size: 1.1rem">Divisão em pacotes</p>
            <div class="icon_close02 cursor-pointer" onclick="onToggleCarrinhoPopUp('', '#popupInformacaoPacote')" style="color:#137ec2; position: absolute; right: 20px"></div>
        </div>
        <div style="height:100%;overflow:auto;">
            <div class="d-flex justify-content-center mt-3 mb-4">
                <img src="/media/icons/icon_package.svg" height="150" width="178" alt="foto do pacote">
            </div>
            <p class="fontOutfitMedium font-weight-semibold myIcon-5 mb-5">
                <span data-target="mensagem-agrupamento-pacote"></span>
                <br>
                <br>
                Você pode selecionar a forma de entrega de cada pacote e dar andamento ao seu pedido clicando na
                seta.<br>
                - Entrega Express: Entregue em <span style="color: red;"> até 3h após </span> a confirmação do seu pagamento.<br>
                - Entrega via Correio: Variável de acordo com a localidade de entrega. A postagem ocorre em até 1
                dia útil.<br>
                <b>Duvidas chama no whatsapp 16 3362-7304</b><br>
            </p>
        </div>
    </div>

    <!-- Informacao loja -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3 popupInformacaoLojas" id="popupInformacaoLojas"data-zindex="12001" style="z-index: 12001; max-height: 80%; border-top-left-radius: 30px;border-top-right-radius: 30px;overflow:auto;">
        <div class="d-flex align-items-center justify-content-center mt-1 mb-3">
            <p class="blueText fontOutfitBold text-center" style="font-size: 1.1rem">Retirada em Loja</p>
            <div class="icon_close02 cursor-pointer" onclick="onToggleCarrinhoPopUp('', '#popupInformacaoLojas')" style="color:#137ec2; position: absolute; right: 20px"></div>
        </div>
        <div style="height:100%;">
            <div class="d-flex justify-content-center mt-3 mb-4">
                <img src="/media/icons/icon_store.svg" height="150" width="150" alt="foto de retirada">
            </div>
            <p class="fontOutfitMedium font-weight-semibold mb-5">
                O serviço Retirada está disponível para 100% da Rede Farmácias Rosário. Consulte através do CEP a
                disponibilidade de estoque do produto selecionado;<br>
                <br>
                - Selecione a modalidade de entrega RETIRADA, escolha a loja mais conveniente, e retire a patir de 1
                hora após aprovação do pedido.<br>
                <br>
                <br>
                Qual o horário para retirada?<br>
                <br>
                O horário de retirada varia de acordo com o horário de funcionamento da loja. Os horários são
                informados na Cesta de compras ao finalizar o pedido;<br>
                <br>
                Posso pedir para alguém retirar no meu lugar?<br>
                <br>
                Sim, ao selecionar a opção RETIRADA você terá opção de retirar por terceiros, onde deverá informar o
                CPF e Nome da pessoa autorizada a retirar o pedido;<br>
                <br>
                Onde retiro o pedido ao chegar na loja ?<br>
                <br>
                Chegando na loja, dirija-se ao balcão conforme sinalização da loja. Nossa equipe estará preparada
                para melhor atendê-lo.<br>
            </p>
        </div>
    </div>

    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupInformacaoLojaParceira"
         data-zindex="12001"
         style="z-index: 12001; max-height: 80%; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <p class="blueText font-weight-black mt-1 mb-3 text-center font-xl pb-1">Retirada em Loja</p>
        <div style="height:100%;overflow:auto;">
            <div class="d-flex justify-content-center mt-5">
                <img src="/media/carrinho/informacao/retirada.png" height="111" width="111" alt="FOTO">
            </div>
            <p class="text-muted font-weight-semibold mt-5">
                Para produtos Vendidos e Entregues por Lojas Parceiras,<br>
                o cliente deve selecionar a Loja do Parceiro mais próxima e comparecer no endereço escolhido,<br>
                com o código do pedido e um documento oficial com foto em mãos,<br>
                <br>
                após identificar a alteração do status do seu pedido para Pronto para Retirada.
            </p>
        </div>
    </div>



    <!-- Popup Lojas -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupLojas" data-zindex="12001"
         style="z-index: 12001; max-height: 80%; height: 100%; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <p class="blueText font-weight-black mt-1 mb-3 text-center font-xl">Selecione a loja para retirar</p>

        <div id="carrinho-lojas-pesquisa">

        </div>

        <div id="carrinho-lojas" style="height:85%; overflow:auto;">

        </div>
    </div>


    <!-- Modal Quantidade Mobile-->
    <div class="modal fade p-3" data-backdrop='true' id="modalQuantidade" tabindex="-1" role='dialog' aria-hidden="true" style='z-index: 15000;'>
        <div class='modal-dialog modal-dialog-centered modal-sm' style='margin-top: 8rem'>
            <div class='modal-content' style="border-radius: 1rem;">
                <div class='modal-header text-white modalQuantidade d-flex justify-content-center align-items-center font-weight-bold' style="border-top-left-radius: 1rem; border-top-right-radius: 1rem;">
                    QUANTIDADE DE PRODUTOS
                </div>
                <div class='modal-body'>
                    <div class="containerScroll">
                        <div class="scrollport"  id='corpoModalQuantidade' style="width: 100%;">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal_login_obrigatorio" tabindex="-1" role="dialog" aria-labelledby="modal_login_obrigatorio" aria-hidden="false">
        <div class="modal-dialog modal-dialog-centered modal-md"role="document">
            <div class="modal-content ">
                <div class="modal-header">
                    <h5 class="modal-title">Login Necessário</h5>
                    <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
                </div>

                <div class="modal-body">
                    <p class="font-sm">Este produto é comercializado de forma controlada e a conclusão da compra será realizada mediante o envio da receita médica.</p>
                    <p class="font-sm mt-2">Faça seu <a class="font-weight-bold" href="/cliente/login">Login</a> ou <a class="font-weight-bold"
                                                                                                                                                 href="/cliente/login">Cadastre-se</a> para prosseguir.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Aviso Controlado -->
    <div class="modal fade" id="modal_aviso_controlado" tabindex="-1" role="dialog" aria-labelledby="modal_aviso_controlado" aria-hidden="false">
        <div class="modal-dialog modal-dialog-centered modal-md" id="aviso_controlado" role="document">
            <div class="modal-content ">
                <div class="modal-header">
                    <h5 class="modal-title">Retenção de Receita</h5>
                    <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
                </div>

                <div class="modal-body font-08rem p-3">
                    <p>
                        A compra desse item está sujeita à apresentação, avaliação e retenção da <strong class="text-uppercase"> receita original </strong> e só poderá ser <strong class="text-uppercase"> retirado em loja </strong>.
                    </p>
                </div>
                <div class="modal-footer text-right">
                    <button id="confirmarCompraControlado" class="btn btn-primary">
                        Sim, estou ciente!
                    </button>
                    <a data-dismiss="modal" class="btn btn-outline-light">
                        Fechar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup Enviar receita -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupUploadReceita" data-zindex="12001"
         style="z-index: 12001; max-height: 85%; height: 100%; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <div class="d-flex justify-content-between align-items-center">
            <span class="font-weight-bold blueText icon_arrow-back02 mr-3 cursor-pointer"
                    id="carrinho-voltar-endereco" onclick="carrinho.instance.endereco._carregarTemplate();"></span>
            <p class="blueText font-weight-black mt-1 mb-3 text-center font-xl">Enviar receita(s)</p>
            <div class="icon_close02 cursor-pointer" onclick="onToggleCarrinhoPopUp('', '#popupUploadReceita'); carrinho.instance._resetFormularioReceitaCarrinho();" style="color:#137ec2"></div>
        </div>
        <div style="max-height:80%; height:100%; overflow:auto;">
            <form id="form_upload_receita_carrinho" class="p-2" novalidate>
                <div name="bloco_paciente">
                    <div class="form-row mb-2">
                        <div class="col-12 col-md-8 d-flex align-items-center">
                            <p class="text-marine font-xl font-weight-bold">Sobre o Paciente</p>
                        </div>
                        <div class="col-12 col-md d-md-flex justify-content-end mt-2 mt-md-0">
                            <div class="btn btn-outline-light text-dark font-lg" onclick="$('#form_upload_receita_carrinho').find(`[name='bloco_paciente'] :input`).not(`input[type = radio]`).val(''); $('#form_upload_receita_carrinho').find(`[name='bloco_paciente'] :checked`).prop('checked', false)">
                                Não sou paciente
                            </div>
                        </div>
                    </div>
                    <div class="form-row mb-2">
                        <div class="col-12 col-md-6">
                            <label for="nm_completo" class="text-primary">Nome do Paciente</label>
                            <input type="text" autocomplete="off" id="nm_completo" class="form-control input-padrao-receita" name="nm_completo" required >
                            <div class="invalid-feedback">Informe o nome</div>
                        </div>
                        <div class="col-12 col-md-6 mt-2 mt-md-0">
                            <label for="documento" class="text-primary">RG do Paciente</label>
                            <div class="input-group ">
                                <div class="input-group-prepend">
                                    <fieldset class="w-100">
                                        <select class="form-control combo-estados" id="estado-documento" name="estado-documento" required>
                                        </select>
                                    </fieldset>
                                </div>
                                <input type="text" autocomplete="off" id="documento" class="form-control input-padrao-receita rg-receita" name="documento" required >
                                <div class="invalid-feedback">Informe o número de RG</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-row mb-2">
                        <div class="col-12 col-md-4">
                            <label for="dat_nasc" class="text-primary">Data de nascimento</label>
                            <input type="text" autocomplete="off" minlength="10" maxlength="10" id="dat_nasc" class="form-control input-padrao-receita dt-nascimento" name="dat_nasc" required>
                            <div class="invalid-feedback">Informe a data de nascimento</div>
                        </div>
                        <div class="col-12 col-md-8 mt-2 mt-md-0">
                            <label class="text-primary">Sexo</label>
                            <div class="w-100 d-block d-md-flex my-2">
                                
                            </div>
                        </div>
                        
                    </div>
                </div>
                <div name="bloco_receita">
                    <div class="form-row mt-2 mt-md-4 mb-2">
                        <div class="col-12">
                            <p class="text-marine font-xl font-weight-bold">Dados da Receita</p>
                        </div>
                    </div>
                    <div class="form-row mb-2">
                        <div class="col-12">
                            <label for="dat_receita" class="text-primary">Data da receita</label>
                            <input type="text" autocomplete="off" minlength="10" maxlength="10" id="dat_receita" class="form-control input-padrao-receita dt-nascimento" name="dat_receita" required>
                            <div class="invalid-feedback">Informe a data da receita</div>
                        </div>
                    </div>
                    <div class="form-row mt-2 mt-md-4 mb-2">
                        <div class="col-12">
                            <p class="text-marine font-xl font-weight-bold">Dados do médico</p>
                        </div>
                    </div>
                    <div class="form-row mb-2">
                        <div class="col-12 col-md-4">
                            <label for="cr" class="text-primary">CR</label>
                            <fieldset class="w-100">
                                <select name="cr" id="cr" class="form-control input-padrao text-muted combo-cr" required>
                                </select>
                            </fieldset>
                        </div>
                        <div class="col-12 col-md-4 mt-2 mt-md-0">
                            <label for="uf_cr" class="text-primary">UF</label>
                            <fieldset class="w-100">
                                <select name="uf_cr" id="uf_cr" class="form-control input-padrao text-muted combo-estados" required>
                                </select>
                            </fieldset>
                        </div>
                        <div class="col-12 col-md-4 mt-2 mt-md-0">
                            <label for="codigo_cr" class="text-primary">Código do conselho</label>
                            <input type="text" name="codigo_cr" inputmode="numeric" id="codigo_cr" class="form-control input-padrao" required>
                            <div class="invalid-feedback">Informe o código do conselho</div>
                        </div>
                        <div class="col-12 mt-2">
                            <label for="nm_medico" class="text-primary">Nome do Médico</label>
                            <input type="text" autocomplete="off" id="nm_medico" class="form-control input-padrao-receita" name="nm_medico" required>
                            <div class="invalid-feedback">Informe o nome do médico</div>
                        </div>
                    </div>
                    <div class="form-row mb-2 mb-md-4">
                        <div class="col-12 col-md-6 mt-2 mt-md-0">
                            <div class="labl labl-receita">
                                <input type="radio" required name="receita-tipo" id="tipo_digital_carrinho" autocomplete="off" value="token">
                                <label for="tipo_digital_carrinho" class="card text-body text-center my-1" style="height:70px; background-color: #f0f3f5;">
                                    <div class="card-body pt-2 pb-2 text-center">
                                        <p class="text-muted font-weight-bolder text-nowrap small">Enviar receita digital</p>
                                        <p class="text-muted small">Insira o código token que recebeu de seu médico</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 mt-2 mt-md-0">
                            <div class="labl labl-receita">
                                <input type="radio" required name="receita-tipo" id="tipo_anexo_carrinho" autocomplete="off" value="path_receita">
                                <label for="tipo_anexo_carrinho" class="card text-body text-center my-1" style="height:70px; background-color: #f0f3f5;">
                                    <div class="card-body pt-2 pb-2 text-center">
                                        <p class="text-muted font-weight-bolder text-nowrap font-sm">Enviar receita em anexo</p>
                                        <p class="text-muted small">Envie o arquivo (PDF) ou foto da sua receita (JPG).</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row mb-2" name="bloco_receita_digital" style="display: none;">
                        <div class="col-12">
                            <p class="text-marine font-xl font-weight-bold">Receita Digital</p>
                            <label for="receita_numero_token" class="text-primary">Número do token</label>
                            <input type="text" autocomplete="off" id="receita_numero_token" class="form-control input-padrao-receita" name="receita_numero_token">
                            <div class="invalid-feedback">Informe o número do token</div>
                            <span class="font-sm text-danger">Se atente as letras minúsculas, maiúsculas, números e símbolos que estão presentes no seu token.</span>
                        </div>
                    </div>
                    <div class="form-row mb-2" name="bloco_receita_anexo" style="display: none;">
                        <div class="col-12">
                            <p class="text-marine font-xl font-weight-bold">Receita física</p>
                            <p class="text-primary">Enviar receita (Somente JPG ou PDF)</p>
                            <input type="file" id="receita_anexo_carrinho" name="receita_anexo_carrinho">
                        </div>
                    </div>
                    <div class="form row justify-content-center is-invalid-text mb-2" name="bloco_tipo_receita_required" style="display: none;">
                        <div class="col-12">
                            <p class="font-weight-semibold text-danger" style="font-size: 1.15rem;">
                                Escolha como enviar sua receita para prosseguir.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="form-row my-3">
                    <div class="col-12">
                        <div onclick="carrinho.instance._submitReceita()" class="btn btn-qtd botaoPrincipal text-white d-block text-center font-weight-bold w-100 font-xl cursor-pointer submit-receita">Enviar receita</div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    

    <!-- Popup Confirmacao -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho p-3" id="popupConfirmacao" data-zindex="12001"
         style="z-index: 12001; height: auto; border-top-left-radius: 30px;border-top-right-radius: 30px;">
        <p class="grayText font-weight-black mt-1 mb-3 text-center font-xl">Confirme os dados da sua compra</p>
        <p
                style="border-bottom: 3px solid #f4eb39!important;margin-right: -1rem;margin-left: -1rem;">
        </p>
        <div id="carrinho-confirmacao">

        </div>
    </div>

    <style>
        .asidebar-closed>.footer-carrinho {
            display: none;
        }
    </style>
    <!-- Popup Entrega -->
    <div class="asidebar-confirmacao asidebar-closed modal-carrinho py-3" id="popupEntrega" data-zindex="12001"
         style="z-index: 11999; max-height: 80%; height:100%; border-top-left-radius: 30px;border-top-right-radius: 30px;">

        <div class="blueText font-weight-black font-xl pb-1 d-flex justify-content-center" id="carrinho-entrega-pacote"></div>

        <div id="carrinho-tipo-entregas" data-pacote-ativo="" style="height:100%; overflow:auto; padding-bottom:35vh;" class="px-3"></div>

        <!-- Footer Carrinho  -->
        <div class="pb-3 px-2 footer-carrinho"
             style="position:fixed; bottom:0; width:inherit; background-color:#fff;">
            <div class="row mx-2">
                <div class="col-12">
                    <div class="carrinho-progress">
                        <div class="carrinho-progress-bar" data-target="carrinho-progresso" role="progressbar"
                             aria-valuenow="0" aria-valuemin="0"
                             style="width:50%;background-color: var(--sunflower-yellow);" aria-valuemax="100"></div>
                    </div>
                </div>
                <div onclick="blackPanel(document.getElementById('carrinho_desfoco'));onToggleCarrinhoPopUp('open', '#popupEndereco')"
                     style="border-bottom: 2px solid var(--light);"
                     class="cursor-pointer col-12 d-flex align-items-center justify-content-between text-primary font-xl font-weight-bold py-2">
                    <div class="d-flex justify-content-start align-items-center">
                        <span class="text-primary small mr-2 font-weight-semibold">Endereço:</span>
                        <span data-target="carrinho-endereco-resumo" class="font-weight-semibold small text-limit-1 text-body"> </span>
                    </div>
                    <div class="text-primary icon_arrow-next01 d-flex align-items-center font-2xl font-weight-bold"
                       style="padding: 0 5px 0 5px; "></div>
                </div>
                
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold pt-3">
                    <span class="fontOutfitBold">Subtotal:</span>
                    <span data-target="carrinho-subtotal" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-weight-extrabold pt-2"
                    style="color:#1cb05c">
                    <span>Desconto de Programa:</span>
                    <span data-target="carrinho-vlr_desconto_pbm">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold">
                    <span class="fontOutfitBold">Descontos:</span>
                    <span data-target="carrinho-desconto_valor" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-sm font-weight-bold">
                    <span class="fontOutfitBold">Frete:</span>
                    <span data-target="carrinho-vlr_frete" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 d-flex align-items-center justify-content-between font-xl font-weight-bold blueText pb-1">
                    <span class="fontOutfitBold">Valor Total:</span>
                    <span data-target="carrinho-vlr_total" class="fontOutfitBold">R$ 0,00</span>
                </div>
                <div class="col-12 mt-2">
                    <!-- Botão de confirmação -->
                    <div class="btn botaoPrincipal text-white py-2 w-100" id="carrinho-continuar-entrega">
                        <span class="font-weight-bold text-nowrap font-xl">Continuar</span>
                    </div>
                </div>
                <!-- Fim footer do carrinho -->
            </div>
        </div>
    </div>
</div>

<form class="d-none" id="pay_fast">

</form>
<!-- Fim carrinho -->

<div class="modal fade" id="modal_localizacao_bloqueada" style="z-index: 12000" tabindex="-1" role="dialog"
     aria-labelledby="modal_localizacao_bloqueada" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <p class="font-weight-bold">Localização bloqueada</p>

                <div class="icon_close02 cursor-pointer" data-dismiss="modal" style="color:#137ec2"></div>
            </div>
            <div class="modal-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    O acesso à localização não é permitida nesse navegador. Para conseguir filtrar apenas endereços
                    próximos, você precisa utilizar outro navegador.
                </div><!-- .d-flex -->
            </div>
        </div>
    </div>
</div><!-- Fecha modal -->
<div class="modal fade" id="modal_localizacao_nao_permitida" style="z-index: 12000" tabindex="-1" role="dialog"
     aria-labelledby="modal_localizacao_nao_permitida" aria-hidden="true" data-backdrop="false">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <p class="font-weight-bold">Localização não permitida</p>

                <button type="button" class="close-modal" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">x</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    Essa aplicação requer à localização do seu navegador. Vá até as configurações do seu navegador e
                    permita o acesso para conseguir utilizá-la.
                    Se você bloqueou o acesso mas não clicou em 'lembrar essa decisão', recarregue a página e
                    permita o
                    acesso.
                </div><!-- .d-flex -->
            </div>
        </div>
    </div><!-- Fecha modal -->
</div>
<div class="modal fade modal-carrinho" id="modal_multiplos_pagamentos" style="z-index: 12000" tabindex="-1" role="dialog" aria-labelledby="modal_multiplos_pagamentos" aria-hidden="true" data-backdrop="false" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content" style="border-radius: 1rem;">
            <div class="modal-header py-2 px-4">
                <p class="font-weight-bold" style="font-size: 22px;">Selecione os métodos de pagamento</p>
                <div class="icon_close02 cursor-pointer" data-dismiss="modal" onclick="carrinho.instance._carregarTemplate();" style="color:#137ec2"></div>
            </div>
            <div class="modal-body py-2 px-4">
                <div class="row">
                    <div class="col-12">
                        <div data-target="bloco_pagamentos"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- Fecha modal -->

<!-- modal tabela de desconto pbm -->
<div class="modal fade" id="modal_retorno" tabindex="-1" role="dialog" aria-labelledby="modal_aviso" aria-hidden="false">
    <div class="modal-dialog modal-dialog-centered" data-target="btn-comprar-pbm" data-produto_id=""  role="document">
        <div style="border-radius: 10px;" class="modal-content">
            <div style="border-bottom: 1px solid #ffffff;" class="modal-header ">
                <img class="ml-5" src="https://farmaciapermanente.com.br/media/menus/estrutura/icon_desconto_pbm%20(1).svg" alt="pbm img">
                <h5 class="modal-title tabela-pbm mr-5">tabela de descontos do programa</h5>
                <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
            </div>
            <div class="modal-body-tabela tabela-pbm" style="max-height: 75vh; overflow-y: auto;">
            </div>
            <div style="border-top: 3px solid #911436 !important;" class="modal-footer text-right">
                <p style=" font-size: 11px; font-weight: 600; color: #8a9297;" class="text-center">
                    *Este desconto pode alterar de acordo com os itens da cesta, a quantidade do produto e o CPF, Cartão ou Cupom informado.
                </p>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_aviso" tabindex="-1" role="dialog" aria-labelledby="modal_aviso" aria-hidden="false">
  <div class="modal-dialog modal-dialog-scrollable modal-md" style="" role="document">
      <div class="modal-content ">
          <div class="modal-header">
              <h5 class="modal-title">Login Necessário</h5>
              <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
          </div>

          <div class="modal-body">
              <p class="font-sm">Para participar dos descontos do PBM (Programa de Benefício em Medicamentos) é necessário estar logado</p>
              <p class="font-xl mt-2">Faça seu <a class="font-weight-bold" href="/cliente/login">Login</a> ou <a class="font-weight-bold"
                                                                                                                                            href="/cliente/login">Cadastre-se</a></p>
          </div>
      </div>
  </div>
</div>
<div class="modal fade" id="modal_data" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="exampleModalLongTitle" aria-hidden="false">
    <div class="modal-dialog modal-dialog-scrollable " style="" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Cadastro no programa de desconto</h5>
                <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
            </div>

            <div class="modal-body">
                <form action="" class="row m-0" id="form_pbm" novalidate>

                </form>
            </div>
            <div class="modal-footer text-right">
                <button onclick="$('#form_pbm').submit()" class="btn btn-primary">
                    Enviar
                </button>
                <div data-dismiss="modal" class="btn btn-outline-light">
                    Fechar
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_aviso_termo" tabindex="-1" role="dialog" aria-labelledby="aviso_cadastro-externo" aria-hidden="false">
    <div class="modal-dialog modal-md" style="" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Necessário aceitar o termo de LGPD abaixo</h5>
                <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
            </div>
            <div class="modal-body">
                <p>Para participar do PBM (Programa de Benefício em Medicamentos) é necessário aceitar o termo.</p>
                <a id="link_url_lgpd" target="_blank"> Clique aqui para continuar </a>
            </div>
            <div class="modal-footer text-right">
                <div data-dismiss="modal" class="btn btn-outline-light">
                    Fechar
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_termo_adesao" tabindex="-1" role="dialog" aria-labelledby="aviso_cadastro-externo" aria-hidden="false">
  <div class="modal-dialog modal-md" style="" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Necessário realizar o cadastro no Programa De Beneficíos </h5>
              <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
          </div>
          <div class="modal-body">
<p>
              Para dar continuidade no processo de liberação de compra é necessário realizar a adesão ao programa de descontos. Você será direcionado para uma página externa de nosso parceiro. Concluída esta etapa, feche esta janela e solicite novamente o desconto</p>
<br>
              <a id="link_url_adesao" target="_blank"> Clique aqui para continuar </a>
          </div>
          <div class="modal-footer text-right">
              <div data-dismiss="modal" class="btn btn-outline-light">
                  Fechar
              </div>
          </div>
      </div>
  </div>
</div>
<div class="modal fade" id="modal_medico" tabindex="-1" role="dialog" aria-labelledby="modal_medico" aria-hidden="false">
    <div class="modal-dialog modal-dialog-scrollable modal-md" style="" role="document">
        <div class="modal-content ">
            <div class="modal-header">
                <h5 class="modal-title">Dados Necessários</h5>
                <div class="icon_close p-1" data-dismiss="modal" aria-label="Close"></div>
            </div>

            <div class="modal-body">
                <form action="" id="form_dados-medico" novalidate>
                    <p class="mb-2">Informe os dados do médico</p>
                    <div class="form-row mb-3">
                        <label for="crm_medico" class="w-100 d-flex justify-content-between">Documento <span class="font-xxs d-flex align-items-center">*Campo obrigatório em caso de medicamento.</span></label>
                        <div class="input-group ">
                            <div class="input-group-prepend">
                                <select class="form-control" id="tipo-doc">
                                    <option value="1" selected>CRM</option>
                                    <option value="2">CRO</option>
                                </select>
                            </div>
                            <input type="text" class="form-control form-numero" id="crm_medico" name="crm_medico">
                            <div class="invalid-feedback">Informe o CRM/CRO</div>
                        </div>
                    </div>
                    <div class="form-row mb-3">
                        <label for="uf_crm">Estado <span id="crm_cro">CRM</span></label>
                        <select name="uf_crm" id="uf_crm" class="form-control" required>
                            <option value="" disabled selected>Selecione</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                        <div class="invalid-feedback">Informe o estado</div>
                    </div>
                    <div class="form-row mb-3">
                        <label for="dt_receita">Data Receita</label>
                        <input type="date" id="dt_receita" class="form-control date" required>
                        <div class="invalid-feedback">Informe uma data</div>
                    </div>
                </form>
            </div>

            <div class="modal-footer text-right">
                <button onclick="$('#form_dados-medico').submit()" class="btn btn-primary">
                    Enviar
                </button>
                <div data-dismiss="modal" class="btn btn-outline-light">
                    Fechar
                </div>
            </div>
        </div>
    </div>
</div>


    


<div class="modal fade" id="modal_progressivo" style="z-index: 12000" tabindex="-1" role="dialog" aria-labelledby="modal_progressivo" aria-hidden="true" data-backdrop="false" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content" style="border-radius: 1rem;">
            <div class="modal-header py-2 px-4">
                <p class="font-weight-bold font-1xl" style="color: #00af66">Desconto Progressivo</p>
                <div class="icon_close02 cursor-pointer" data-dismiss="modal" style="color:#137ec2"></div>
            </div>
            <div class="p-4">
                <div class="row">
                    <div class="col-12">
                        <p class="mb-4">Descontos Oferecidos</p>

                        <div class="lista-progressivo">

                        </div>
                    </div>
                </div>
            </div>
            <div class="border-primary p-4" style="border-top: 3px solid var(--primary);">
                <p class="text-primary">Este desconto só está disponível para produtos com a tag "Desconto Progressivo"</p>
            </div>
        </div>
    </div>
</div><!-- Fecha modal -->

<div>
    <input type="hidden" id="cliente_hash" name="cliente_hash" value="">
</div>





    
        



	<div class="footer-cookie" id="footer-cookie" style="z-index: 1043;">
		<div class="row" style="position: relative">
			<div class="col-12 col-md-8 col-lg-9 mb-2 mb-md-0">
				<p class="fontOutfitBold blueText" style="font-size:1.2rem">Cookies</p>
				<p class="fontOutfitBold grayText" style="font-size:1rem">Nosso site utiliza cookies para oferecer uma melhor experiência. <a target="_blank" href="" class="blueText">Saiba mais em para que servem os cookies e como mudar suas configurações</a></p>
			</div>
			<div class="col-12 col-md-4 col-lg-3 d-flex flex-column align-items-center justify-content-center">
				<button type="button" class="btn botaoPrincipal fontOutfitBold text-white" onclick="permitir_cookie()" style="font-size:1.1rem"> Aceitar e continuar</button>
				<a target="_blank" href="" class="fontOutfitBold blueText" style="font-size:0.9rem">Preferências de Cookies</a>
			</div>
			<div class="icon_close02 cursor-pointer" data-dismiss="modal" style="position:absolute; right:10px; top:10px" onclick="$('.footer-cookie').addClass('d-none')"></div>
		</div>
	</div>

<footer class="pt-4">
	
    <div class="w-100 d-flex align-items-center py-3 py-md-0" style="min-height:47px;background-color:#81bfe8;">
        <div class="container">
                <div class="row align-items-center justify-content-center w-100">
                    <div class="d-flex align-items-center justify-content-center mr-sm-5 mr-md-5 mr-xl-5 mr-lg-5 ">
                        <img loading="lazy" src="/media/icons/phone_android2.svg" width="28" height="28" alt="Celular android">
                        <p class="fontOutfitExtraBold" style="font-size: 1.188rem; color:#00528a;">Baixe Nosso App</p>
                    </div>
                    <div>
						<a href="https://play.google.com/store/apps/details?id=com.inteliger.farmaciasrosario&hl=pt_BR"><img loading="lazy" alt="Icone Play Store" src="/media/icons/google_play.png" height="28"></a>
						<a href="https://apps.apple.com/br/developer/farm%C3%A1cia-ros%C3%A1rio/id1604958602"><img loading="lazy" alt="Icone Apple Store" src="/media/icons/app_store.png" height="28"></a>
                    </div>
                </div>
        </div>
    </div>
    
	
    <div class="container">
        <div class="row fontOutfitRegular" style="font-size: 0.75rem;">
            
            

				<div class="col-12 col-sm-12 col-md-12 col-lg col-xl mt-3">
					<!-- Institucional -->
					<p class="fontOutfitSemiBold mt-2" style="font-size: 0.875rem;">Institucional</p>
					<a href="/sobre" class="text-muted mt-2 text-nowrap d-flex">Sobre Nós</a>
					<a href="/nossas-lojas" class="text-muted mt-2 text-nowrap d-flex">Nossas lojas</a>
					<a href="/trabalhe-conosco" class="text-muted mt-2 text-nowrap d-flex">Trabalhe conosco</a>
					<a href="/fale-conosco" target="_blank" class="text-muted mt-2 text-nowrap d-flex"  data-target="entrando-contato">Fale conosco</a>
					<a href="https://www.farmaciarosario.com.br/blog/?v=1" target="_blank" class="text-muted mt-2 text-nowrap d-flex">Nosso blog</a>
				</div>
				<div class="col-12 col-xl col-lg col-md-12 col-sm-12  mt-3">
					<!-- Serviços -->
					<p class="fontOutfitSemiBold mt-2" style="font-size: 0.875rem;">Serviços</p>
					<a href="/convenio-farmacia" class="text-muted mt-2 text-nowrap d-flex">Convênios</a>
					<a href="/farmacia-popular" class="text-muted mt-2 text-nowrap d-flex">Farmácia Popular</a>
					<a href="/manipulacao" class="text-muted mt-2 text-nowrap d-flex">Manipulação</a>
				</div>
				<div class="col-12 col-xl col-lg col-md-12 col-sm-12  mt-3">
					<!-- Compra online -->
					<p class="fontOutfitSemiBold mt-2" style="font-size: 0.875rem;">Compra online</p>
					<a href="/politica-precos" class="text-muted mt-2 text-nowrap d-flex">Política de
						Pagamentos</a>
					<a href="/politica-entrega" class="text-muted mt-2 text-nowrap d-flex">Política de
						Entrega</a>
					<a href="/politica-privacidade" class="text-muted mt-2 text-nowrap d-flex">Política de Privacidade</a>
					
				</div>
				<div class="col-12 col-xl col-lg col-md-12 col-sm-12  mt-3">
					<!-- Minha conta -->
					<p class="fontOutfitSemiBold mt-2" style="font-size: 0.875rem;">Minha conta</p>
					<a href="/cliente/dados" class="text-muted mt-2 text-nowrap d-flex">Acessar</a>
					<a href="/cliente/login" class="text-muted mt-2 text-nowrap d-flex">Cadastrar</a>
					<a href="/cliente/pedidos" class="text-muted mt-2 text-nowrap d-flex">Meus pedidos</a>
					<a href="/cliente/dados" class="text-muted mt-2 text-nowrap d-flex">Editar endereços</a>
				</div>

            
            <div class="col-12 col-sm-12 col-md-3 col-lg-3 col-xl-3 d-flex justify-content-md-center justify-content-start align-items-center flex-wrap py-4 pl-4">
				<img class="mr-2" src="/media/formas_pagamento/Visa.png" alt="Pagamento visa">
				<img class="mr-2" src="/media/formas_pagamento/Mastercard.png" alt="Pagamento Mastercard">
				<img class="mr-2" src="/media/formas_pagamento/Elo.png" alt="Pagamento Elo">
				<img class="mr-2" src="/media/formas_pagamento/DinersClub.png" alt="Pagamento Diners">
				<img class="mr-2" src="/media/formas_pagamento/AmericanExpress.png" alt="Pagamento Amex">
				<img class="mr-2" src="/media/formas_pagamento/Hipercard.png" alt="Pagamento Hipercard">
				<img class="mr-2" src="/media/formas_pagamento/boleto.png" alt="Pagamento Boleto">
				<img class="mr-2" src="/media/formas_pagamento/Pix.png" alt="Pagamento Pix">
				<!-- <img src="/media/formas_pagamento/PicPay.png"> -->
            </div>
        </div>
    </div><!-- .container -->
    <div class="row mt-5" style="background-color: #f9f9f9; width: 101%">
        <div class="col-12">
            <!-- Atendimento ao cliente -->
            <div class="col-12 row d-flex baseline py-4 lightGrayText">
                <div class="col-12 col-xl-3 col-lg-3 col-md-12 col-sm-12 d-flex justify-content-center justify-content-md-end align-items-center mt-3">
                    <img src="/media/icons/support_agent.svg" class="mr-3" width="70"height="70" alt="headset">
                    <p class="fontOutfitExtraBold blueText" style="font-size: 1.3rem;">
                        Atendimento<br>ao Cliente
                    </p>
                </div>

                <div class="col-12 col-xl col-lg col-md-12 col-sm-12 mt-4 ml-4 pl-3">
                    <p class="fontOutfitBold grayText" style="font-size: 0.85rem;">SAC</p>
                    <a href="tel:1633627304" class="fontOutfitBold blueText" data-target="entrando-contato"  style="font-size: 1rem;">
                        (16) 3362-7304
                    </a>
                    <span class="text-muted fontOutfitMedium small d-flex mt-2 mb-1">Seg a Sex - 08:00 às 18:00</span>
                    <span class="text-muted fontOutfitMedium small d-flex">Sábados - 08:00 às 12:00</span>
                    <a href="https://wa.me/+5501633627304" target="_blank" class="align-items-center fontOutfitMedium text-muted">
                    	<img src="https://www.farmaciarosario.com.br/media/img/icons/whatsapp_icon.svg" width="20">
                    	<span class="ml-1 small text-muted">(16) 3362-7304</span>                        
                    </a>
               
                     <div>
                           <a href="mailto:sac@farmaciarosario.com.br?subject=Assunto do Email&body=Conteúdo da mensagem">
                                 <img src="/media/img/icons/email_img_3ItoIQh.png" width="20">
                                 <span class="ml-1 small text-muted">sac@farmaciarosario.com.br</span>
                           </a>
                      </div>
                  </div>

                <div class="col-12 col-xl col-lg col-md-12 col-sm-12 mt-4 ml-4 pl-3">
                    <p class="fontOutfitBold grayText" style="font-size: 0.85rem;">Televendas São Carlos</p><div class="mt-2">
                    <a href="tel:08007007300" class="fontOutfitBold blueText" style="font-size: 1rem;" data-target="entrando-contato">
                        0800 700 7300
                    </a><br></div><div class="mt-2">
                    <a href="tel:1633627304" class="fontOutfitBold blueText" data-target="entrando-contato" style="font-size: 1rem;">
                        (16) 3362-7300
                    </a>
                    <br></div>
    
                    <span class="text-muted fontOutfitMedium small d-flex mt-2 mb-1">Seg a Sex - 07:00 às 23:00</span>
                    <span class="text-muted fontOutfitMedium small d-flex">Sáb, Dom e feriados - 07:00 às 23:00</span>
                </div>
				<!--
                <div class="col-12 col-xl col-lg col-md-12 col-sm-12 mt-4 d-none d-md-block">
                    <p class="fontOutfitBold grayText" style="font-size: 0.85rem;">Almanaque</p>
                    <a href="/media/almanaque/almanaque_julho_2023.pdf" target="_blank" aria-label="Link do almanaque">
                        <img alt="Almanaque" loading="lazy" data-src="/media/almanaque/almanaque_julho_2023.JPG" class="mt-2 lazyload"  width="60" height="90">
                    </a>
                </div>
				-->
                <div class="col-12 col-xl col-lg col-md-12 col-sm-12 mt-4 d-none d-md-block">
                    <p class="fontOutfitBold grayText" style="font-size: 0.85rem;">Redes sociais</p>
                    <div class="d-flex justify-content-start mt-2">
                        <a href="https://www.facebook.com/farmaciarosariooficial/" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="face" src="/media/icons/facebook.svg" class="mr-4">
                        </a>
                        <a href="https://twitter.com/RosarioFarmacia" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/Twitter.svg" class="mr-4">
                        </a>
                        <a href="https://www.instagram.com/farmaciasrosario/" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/instagram.svg" class="mr-4">
                        </a>
                    </div>
                    <div class="d-flex justify-content-start mt-2">
                    	<a href="https://www.youtube.com/@farmaciarosario" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/Youtube.svg" class="mr-4">
                        </a>
                        <a href="https://br.pinterest.com/farmaciarosariooficial" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/Pinterest.svg" class="mr-4">
                        </a>
                        <a href="https://www.linkedin.com/company/farmaciarosario/" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/Linkedin.svg" class="mr-4">
                        </a>
                    </div>
                    <div class="d-flex justify-content-start mt-2">
                    	<a href="https://www.tiktok.com/@farmaciarosario_oficial" target="_blank">
                            <img loading="lazy" width="35" height="35" alt="insta" src="/media/icons/TikTok.svg" class="mr-4">
                        </a>
                    </div>
                </div>
            </div><!-- .row -->
        </div>
    </div> 
    <div class="container">
        <!-- Cliente -->
        <div class="row d-flex align-items-center pt-4">
            <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-8 mb-2 mb-lg-0 mb-xl-0 d-flex align-items-center flex-column">
                <img width="200" height="60" src="/media/logos_e_banners/logo_rosario.png" alt="Logo Rosário Rodapé">
                <p class="font-xxs text-muted text-lg-center text-md-left mt-4 px-4">Farmacia Nossa Senhora do Rosário LTDA | CNPJ: 59.603.977/0036-76 | I.E. 637.101.464.119 | Avenida Doutor Carlos Botelho, 1900 | Centro | São Carlos (SP) | CEP 13560250 | Dúvidas, elogios e reclamações: Telefone (16) 33627304 | Horário de atendimento: Segunda a Sexta das 8h às 18h, exceto feriados | Farmacêutico Responsável: Janaina Cristina Terruggi | CRF 47.716 | AFE: 0142251 | CMVS - 354890622-477-000031-1-5. As informações contidas neste site não devem ser usadas para automedicação e não substituem, em hipótese alguma, as orientações dadas pelo profissional da área médica. Somente o médico está apto a diagnosticar qualquer problema de saúde e prescrever o tratamento adequado. Ao persistirem os sintomas, um médico deverá ser consultado. Maiores esclarecimentos, consultar o site: www.anvisa.gov.br. Os preços e promoções divulgados no site são válidos apenas para compras feitas pela Internet e podem variar conforme região de entrega. Em caso de divergência, o preço válido é o do carrinho de compras. Imagens meramente ilustrativas. A Farmácia Rosário trabalha com as tecnologias mais avançadas de proteção de dados, para que você possa realizar suas compras com tranquilidade. A privacidade e a segurança dos clientes são compromissos da Farmácia Rosário. Todos os pedidos efetuados estão sujeitos à confirmação da disponibilidade de produto em nosso estoque.</p>
                <p class="font-xxs text-muted text-lg-center text-md-left mt-2 px-4"">CNPJ: 59.603.977/0036-76Razão Social: Farmacia Nossa Senhora do Rosario Ltda@ 2023 Farmacia Rosario. Todos direitos reservados.</p>
            </div><!-- .cols -->

            <!-- Anvisa, Inteliger -->
            <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 mt-4 mt-md-0 mt-lg-0 mt-xl-0 text-center">
                <div class="row align-items-center d-flex flex-column">
                    <div class="col-12 col-md-6">
                        <img loading="lazy" src="/media/logos_e_banners/anvisa.png" alt="Logo Anvisa" width="200" height="60">
                        <p class="small text-muted text-nowrap mt-3">A Rosário segue as determinações da Anvisa.</p>
                    </div>
                      <!--<div id="reputation-ra"><script type="text/javascript" id="ra-embed-reputation" src="https://s3.amazonaws.com/raichu-beta/selos/bundle.js" data-id="NDkzNDI6cm9zYXJpby1mYXJtYWNpYS1lLWRyb2dhcmlhcw==" data-target="reputation-ra" data-model="2"></script></div>-->
                    <div class="col-12 col-md-6 text-left row mt-5">
                        <div class="col-12 mb-5 pb-5 mb-md-0 pb-md-0">
                            <p class="font-xxs text-muted mt-3 mt-md-0 mb-2">Desenvolvido por</p>
                            <a href="https://vendama.is/voai-ecommerce" target="_blank">
                                <div class="d-flex text-center justify-content-center">
                                    <img loading="lazy" src="/media/outros/Venda_Mais_1.webp" alt="Logo Venda Mais" width="200" height="40">
                                </div>
                            </a>
                        </div>
                        
                    </div>
                </div>
            </div><!-- .cols -->
        </div><!-- .row -->
    </div>
</footer>



<script>

    $(document).ready(function(){
        $('.fontOutfitSemiBold').on('click', function() {
            var iconSpan = $(this).find('.icon-span');
            if (iconSpan.hasClass('icon_arrow-down01')) {
                iconSpan.removeClass('icon_arrow-down01');
                iconSpan.addClass('icon_arrow-up01');
            } else {
                iconSpan.removeClass('icon_arrow-up01');
                iconSpan.addClass('icon_arrow-down01');
            }
        });
    });

    $('a.font-weight-bold.text-navy.icon_arrow-back02.font-2xl').remove();

    /*$('main>div.container>div.d-block.mb-2').prepend(`<a class="font-weight-bold icon_arrow-back01 font-md mr-3" onclick="history.back()"></a>`);*/
    $('main>div.container>div.d-block.mb-2').removeClass('d-block').addClass('d-flex align-items-center');
	
	$(document).ready(function(){
		if($('.banner-topo').length){
			
    			$('.app-body').removeClass(["pt-3","pt-md-0"])
        		$('.app-body').css('padding-top',$('header nav').outerHeight() + 10)
				
		} else {
			
        		//$('.app-body').attr('style', 'padding-top: 140px !important');
        		$('.app-body').removeClass(["pt-3","pt-md-0"])
        		$('.app-body').css('padding-top',$('header nav').outerHeight() + 10)
			
		}

		
		
		if(typeof(window.location) === 'object' && window.location.pathname === '/' && $('#aviso_baixar_app').length && $('#footer-site').length && !localStorage.getItem('modal_aviso_app_visualizada')){
			$('#aviso_baixar_app').show(100)
		}
	    
	})

	function getMobileOS() {
		let userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/android/i.test(userAgent)) {
    		return "Android";
    	}
    	if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
    		return "iOS";
    	}
    	return "";
	}
	function redirectStore() {
    	let op_sys = getMobileOS();
    	if (op_sys == "Android") {
    		window.location.href = ""; 
    	} else if (op_sys == "iOS") {
    		window.location.href = "";
    	}
	}
	function avisoAppFechar() {
		localStorage.setItem('modal_aviso_app_visualizada', true)
		$('#aviso_baixar_app').remove()
	}

    function permitir_cookie() {
        $('.footer-cookie').addClass('d-none')
        $.ajax({
            type: "POST",
            url: "/permitir/cookie",
            data: {
                'csrfmiddlewaretoken': 'UWUl2jaYtuh4zkvjoziM8eoafXEiqAMhdr9gVrbbQJvr6mWgAWZw6KoqoVJM7Qo7',
            },
            success: function (data) {

            },
            error: function (data) {
                load('off', $('.asidebar'));
                if (data.statusText !== 'error') {
                }
            }
        });
    }

</script>


    


<!-- Facebook Pixel Code -->
<script defer>

    !function (f, b, e, v, n, t, s) { if (f.fbq) return; n = f.fbq = function () { n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments) }; if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0'; n.queue = []; t = b.createElement(e); t.defer = !0; t.src = v; s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s) }(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', 'CHAVE');
    fbq('track', 'PageView');

</script>
<noscript>
    <img height="1" width="1" style="display:none" alt="fbq" defer
         src="https://www.facebook.com/tr?id=CHAVE&ev=PageView&noscript=1" />
</noscript>
<!-- End Facebook Pixel Code -->



<script type="text/javascript" src="/staticfiles/OwlCarousel2-2.3.4/dist/owl.carousel.min.ce3a42440f40.js"></script>

<!-- Toastr, alertas de sucesso e erros JS -->
<script  type="text/javascript" src="/staticfiles/toastr/js/toastr.min.45e1a45b780c.js"></script>

<!-- Popper js -->
<script type="text/javascript" src="/staticfiles/js/popper/js/popper.min.c6946dff4854.js"></script>

<!-- Bootstrap js -->
<script type="text/javascript" src="/staticfiles/bootstrap-4.4.1/dist/js/bootstrap.min.466028b5fcb8.js"></script>

<!-- Imprimir js -->
<script defer type="text/javascript"
        src="/staticfiles/js/utilitarios/exportar_imprimir/printThis.min.cb24fa7bb121.js"></script>

<!-- Popover js -->
<script defer type="text/javascript" src="/staticfiles/js/popover/popovers.min.b465225188a6.js"></script>

<!-- Select2 -->
<script type="text/javascript" src="/staticfiles/select2/js/select2.min.cd5f56bf4f27.js"></script>

<!-- Title -->
<script type="text/javascript" src="/staticfiles/js/utilitarios/formatar/title.min.10da3b347950.js"></script>



<!-- MomentJS -->
<script type="text/javascript" src="/staticfiles/js/utilitarios/moment/moment.min.5c158b940513.js"></script>
<script type="text/javascript" src="/staticfiles/js/utilitarios/moment/moment-with-locales.min.65a5016e8598.js"></script>


<!-- Openstreetmap -->
<link rel="stylesheet" href="/staticfiles/leaflet/leaflet.da041a164293.css">
<script src="/staticfiles/leaflet/leaflet.f8b1586d921c.js"></script>

<!-- Importações para utilização do filepond -->
<script src="/staticfiles/filepond/filepond.min.dbbf05a9c2f2.js" type="text/javascript"></script>
<script src="/staticfiles/filepond/filepond.jquery.7afd04472011.js" type="text/javascript"></script>
<script src="/staticfiles/filepond/filepond-plugin-file-validate-type.5286d9d83a1f.js" type="text/javascript"></script>

<script defer type="text/javascript" id="sig-api" data-order-session-id="None" src="https://cdn-scripts.signifyd.com/api/script-tag.js"></script>

<script src="https://www.mercadopago.com/v2/security.js" view=""></script>

<script>
    moment ? moment.locale('pt-br') : '';
    FilePond.registerPlugin(FilePondPluginFileValidateType);
    function validaCPF(t) { var e, n = 0; if ("00000000000" === (t = t.replace(/[^\d]+/g, "")) || "11111111111" === t || "22222222222" === t || "33333333333" === t || "44444444444" === t || "55555555555" === t || "66666666666" === t || "77777777777" === t || "88888888888" === t || "99999999999" === t) return !1; for (i = 1; i <= 9; i++)e = 10 * (n += parseInt(t.substring(i - 1, i)) * (11 - i)) % 11; if (10 != e && 11 != e || (e = 0), e != parseInt(t.substring(9, 10))) return !1; for (n = 0, i = 1; i <= 10; i++)e = 10 * (n += parseInt(t.substring(i - 1, i)) * (12 - i)) % 11; return 10 != e && 11 != e || (e = 0), e == parseInt(t.substring(10, 11)) } function validaSenha() { return $("#senha_cadastro").val() === $("#confirm-senha_cadastro").val() } function conteudoModal(t) { "login" === t ? ($("#html_login").removeClass("d-none"), $("#html_cadastro").addClass("d-none")) : ($("#html_cadastro").removeClass("d-none"), $("#html_login").addClass("d-none")) } function onoffbody(t) { "on" === t ? $(".body-disabled").css({ visibility: "hidden", opacity: 0 }) : $(".body-disabled").css({ visibility: "visible", opacity: 1 }) } function objectifyForm(t) { let e = {}; for (var i = 0; i < t.length; i++)t[i].value && (e[t[i].name] = t[i].value); return e } $(".cpf").on("blur", function () { validaCPF(this.value) ? this.setCustomValidity("") : this.setCustomValidity("cpf invalido") }), $(".index_letra").on("click", function (t) { return t.preventDefault(), t.stopPropagation(), !1 }), $(".index_letra a").hover(function () { var t = $(this).attr("href"), t = $(t).offset().top - $(".itens_index").offset().top + $(".itens_index").scrollTop(); $(".itens_index").stop().animate({ scrollTop: t }, 200) }), $(".btn_footer-collapse").on("click", function (t) { "false" === t.target.getAttribute("aria-expanded") ? ($(t.target).html($(t.target).html().replace("Mais", "Menos")), $(t.target).children("img").css({ transform: "rotate(180deg)" })) : ($(t.target).html($(t.target).html().replace("Menos", "Mais")), $(t.target).children("img").css({ transform: "rotate(0deg)" })) });
</script>

<script>

        var originCarrinho = '';
        
            $('.app-body').css('padding-top', '150px');
            originCarrinho = 'ecommerce';
        

        var is_authenticated =  false 

        let mp;

        function converteMoedaFloat(valor){
            if(!valor){
                valor =  0;
            }else{
                valor = valor.replace(".","");
                valor = valor.replace(",",".");
                valor = parseFloat(valor);
            }
            return valor;
        }

        $.fn.focusTextToEnd = function(){
            this.focus();
            var $thisVal = this.val();
            this.val('').val($thisVal);
            return this;
        }

    </script>
<script>
        // Carrinho
        // Criação por Thiago Silva 31/10/2021
        // Ultima edição por ---
        var carrinho = {};

        function Produto(index, hash, id, nome, quantidade, valor, valor_multiplicado, imagem, url, _produto, _pacote, ultimo) {
            this.imagem = "produtos/caixa-rosario.jpg";
            this.index = index;
            this.hash = hash;
            this.id = id;
            this.nome = nome;
            this.quantidade = quantidade;
            this._valor = valor;
            this._valor_ini = _produto.valor_ini;
            this._valor_multiplicado = valor_multiplicado;
            this._produto = _produto;
            this.ultimo = ultimo;
            if (imagem) {
                if (imagem.indexOf('http') > -1){
                    this.imagem = imagem;
                }
                else {
                    if (imagem.indexOf('/media/') > -1) {
                        this.imagem = imagem;
                    }
                    else {
                        this.imagem = '/media/' + imagem;
                    }

                }
            }
            this.url = url;
            this.token_nsu = _produto.token_nsu;
            this.btn_qtd_disabled = _produto.btn_qtd_disabled;
            this._pacote = _pacote;
            this.is_controlado = _produto.produto__is_venda_controlada
            this.produto_id = _produto.produto_id
            this.estoque_original = _produto.qtd_estoque
            this._receita_id = _produto.receita_id ? _produto.receita_id : ''
        }
        Produto.prototype = {
            get valor() {
                return parseFloat(this._valor).toLocaleFixed(2);
            },
            set valor(value) {
                this.valor = value
            },
            get valor_ini() {
                return parseFloat(this._valor_ini * this.quantidade).toLocaleFixed(2);
            },
            set valor_ini(value) {
                this.valor_ini = value
            },
            get valor_multiplicado() {
                return parseFloat(this._valor_multiplicado).toLocaleFixed(2);
            },
            set valor_multiplicado(value) {
                this._valor_multiplicado = value;
            },
            get estoque_original() {
                return this._produto.qtd_estoque_original
            },
            set estoque_original(value) {
                this._produto.qtd_estoque_original = value
            },
            get receita_id() {
                return this._receita_id
            },
            set receita_id(value) {
                this._receita_id = value
            },
            get template() {
                return `
                <div class="py-2" style="${!this.ultimo ? 'border-bottom: 2px solid var(--light);' : ''} padding-left:10px;padding-right:10px;">
                    <div class="d-flex justify-content-start align-items-start">
                        <a href="/${this.url}">
                            <img class="rounded mr-2" src="${this.imagem}" width="65" height="65" alt="Foto produto">
                        </a>
                        <div class="ml-2 w-100">
                            <div class="row">
                                <div class="col-8">
                                    <p class="small text-limit-1 mt-1 font-weight-semibold">${this.nome}</p>
                                </div>
                                ${ this.is_controlado ? `
                                    <div class="col-8 col-md-4 d-md-flex justify-content-end">
                                        <div class="btn text-white font-weight-semibold font-xxs p-1 mt-1" style="cursor: default;background-color:${(carrinho.instance.is_controlado /*&& carrinho.instance.receitas && carrinho.instance.receitas.length) || (carrinho.instance.is_validar_receita && carrinho.instance.receitas && carrinho.instance.receitas.length*/) ? '#ee3a41' : '#1cb05c'}">Receita obrigatória</div>
                                    </div>` : ``
                                }
                            </div>
                            <div class="mt-2 flex-nowrap d-flex justify-content-between align-items-center">
                                <div class="d-flex justify-content-start align-items-center">
                                    <div class="d-flex align-items-center">

                                        
                                            <div class="btn botaoPadraoAzul text-white mr-0 mr-xl-2 mr-lg-2 ${this.btn_qtd_disabled ? 'isDisabled' : ''}" ${!this._produto.token_nsu ? `onclick="adicionar_remover($(this), 'menos', '${this.hash}', ${this._produto.token_nsu ? this._produto.token_nsu : ''});` : ''}"  style="padding: .1rem .1rem;">
                                                <article style="height: 23px;width: 25px;"><span class="icon_horizontal-line small font-weight-bold font-05rem"></span></article>
                                            </div>
                                            <span class="font-xl text-center" style="width:25px;" data-toggle="number_plus_minus" data-valor="${this._produto.quantidade ? this._produto.quantidade : ""}" data-receita-id="${this.receita_id}" data-limite-min="${this._produto.produto__qtd_min_venda_ecommerce ? this._produto.produto__qtd_min_venda_ecommerce : ""}" data-limite-max="${this._produto.produto__qtd_max_venda_ecommerce ? this._produto.produto__qtd_max_venda_ecommerce : ""}">${this._produto.quantidade ? this._produto.quantidade : ""}</span>
                                            <div class="btn botaoPadraoAzul text-white mr-0 mr-xl-2 mr-lg-2  ml-0 ml-xl-2 ml-lg-2 ${this.btn_qtd_disabled ? 'isDisabled' : ''}" ${!this._produto.token_nsu ? `onclick="adicionar_remover($(this), 'mais', '${this.hash}', ${this._produto.token_nsu ? this._produto.token_nsu : ''} );` : ''}" style="padding: .1rem .1rem;">
                                                <article style="height: 23px;width: 25px;"><span class="icon_plus small font-weight-bold align-middle"></span></article>
                                            </div>
                                        

                                    </div>
                                    <div class="d-flex align-items-center flex-wrap mr-2">
                                        <span class="grayText mr-2 fontOutfitRegular">R$${this.valor_ini} por</span>
                                        <span class="font-xl blueText fontOutfitExtraBold">R$${this.valor_multiplicado}</span>
                                    </div>
                                </div>

                                <a class="text-muted cursor-pointer" onclick="carrinho.instance.pacotes[${this._pacote ? this._pacote.index - 1 : ''}].produtos[${this.index ? this.index - 1 : ''}].remover()">
                                    <div class="d-flex align-items-center">
                                        <img src="/media/icons/delete_outline.svg" alt="icon delete" width="30" class="pb-3">
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }
        }
        Produto.prototype.remover = function() {
            load("on", $(".asidebar"));
            $.ajax({
                type: "POST",
                url: "/carrinho/remover/todos",
                data: {
                    "csrfmiddlewaretoken": 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    "hash_produto": this.hash,
                    "item_id": this.id ? this.id : '',
                    "token_nsu": this.token_nsu
                },
                success: (data) => {
                    load("off", $(".asidebar"));
                    filtroParaDadosAnaliticos('RemoveFromCart', {
                        items: [
                            {
                                id: this._produto ? this._produto.produto_id : '',
                                price: this._produto ? this._produto.valor_ini : '',
                                discount: this._produto ? this._produto.valor_desc : '',
                                item_name: this._produto ? this._produto.produto__nm_url_ecommerce : '',
                                promotion_name: this._produto ? this._produto.descontoprodutopreco__desconto__tipo_id : '',
                                currency: "BRL",
                                quantidade: this._produto ? this._produto.quantidade : '',
                                index: this._produto ? this._produto.origem_posicao : '',
                                item_list_name: this._produto ? this._produto.origem_descricao : '',
                                item_list_id: this._produto && this._produto.origem_descricao ? this._produto.origem_descricao.toLowerCase().replace(/\s/g, "_") : '',
                            },
                        ]
                    })
                    carrinho.instance._resetPagamentos();
                    carrinho.instance._resetEntregas();
                    carrinho.instance._setCarrinho();
                    carrinho.instance._atualizarCarrinho();
                },
                error: (data) => {
                    load("off", $(".asidebar"));
                    toastr.error("Ocorreu um erro inesperado ao remover o produto do carrinho.", "Erro ao enviar");
                }
            });
        }

        function FaixaHorario(id, faixa, _faixas) {
            this.id = id;
            this.faixa = faixa;
            this._selecionado = false;
            this._faixas = _faixas;
        }
        FaixaHorario.prototype = {
            get selecionado() {
                return this._selecionado;
            },
            set selecionado(value) {
                this._selecionado = value;
                this._faixas._carregarTemplate();
            },
            get template() {
                return `<div class="labl labl-background">
           	            <input type="radio" required name="carrinho-agendada" ${this.selecionado ? 'checked' : ''} onclick="carrinho.instance.pacotes[${this._faixas._entrega._entrega_component._pacote.index - 1}].entrega.value.entrega_complemento._faixa_componente.value = ${this.id}; carrinho.instance._setCarrinho();" id="carrinho-agendada-${this.id}" autocomplete="off" value="${this.id}">
           	            <label for="carrinho-agendada-${this.id}" class="card text-body my-1" style="height:70px; background-color: #f0f3f5;">
           	                <div class="card-body pt-2 pb-2 d-flex align-items-center">
           	                    <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
           	                    <div>
           	                        <p class="font-weight-bold small text-limit-1">${this.faixa.descricao_combobox.split('%quebralinha%')[0]}</p>
           	                        <p class="small text-limit-1">${this.faixa.descricao_combobox.split('%quebralinha%')[1]}</p>
                                </div>
           	                </div>
           	            </label>
           	        </div>`;
            }
        }

        function FaixaHorarioComponent(id, _entrega) {
            this.id = id;
            this._entrega = _entrega;
            this._faixas = null;
            this.qtd_faixas = _entrega.qtd_faixas
            this.local_compra_id = _entrega && _entrega._filial && _entrega._filial.cd_localcompra ? _entrega._filial.cd_localcompra : null
            this._carregarFaixas();
        }
        FaixaHorarioComponent.prototype = {
            get qtd_faixas() {
                return this._qtd_faixas;
            },
            set qtd_faixas(value) {
                this._qtd_faixas = value;
            },
            get local_compra_id() {
                return this._local_compra_id;
            },
            set local_compra_id(value) {
                this._local_compra_id = value;
            },
            get valid() {
                return this.value ? true : false;
            },
            get value() {
                const faixa = this._faixas ? this._faixas.filter((faixa) => { return faixa.selecionado }) : [];
                return faixa.length > 0 ? faixa[0] : null;
            },
            set value(value) {
                if (!this.value || this.value.id !== value) {
                    this._faixas.map((faixa) => {
                        faixa.id === value ? faixa.selecionado = true : faixa.selecionado ? faixa.selecionado = false : '';
                        if (faixa.id === value) {
                            this._entrega.faixa_entrega = faixa.faixa;
                            onToggleCarrinhoPopUp('', '#popupAgendada');
                        }
                    });
                }
            },
            get faixas() {
                return this._faixas;
            },
            set faixas(value) {
                const faixas = [];
                let i = 0;
                for (const faixa of value) {
                    i++;
                    faixas.push(new FaixaHorario(i, faixa, this));
                }
                this._faixas = faixas;
                this._carregarTemplate();
            },
            get template() {
                return $.map(this._faixas, (elem) => {
                    return elem.template;
                }).join('');
            }
        }
        FaixaHorarioComponent.prototype._carregarFaixas = function() {
            toastr.options.target = null;
            const _pacote = $.extend(true, {}, this._entrega._entrega_component._pacote);
            toastr.options.target = 'body';
            delete _pacote._carrinho;
            delete _pacote.filial;
            delete _pacote.entregas;
            delete _pacote.entrega;
            delete _pacote.produtos;
            const _produtos = [];
            for (const produto of _pacote._produtos) {
                const _produto = $.extend(true, {}, produto);
                delete _produto._pacote;
                _produtos.push(_produto);
            }
            _pacote._produtos = _produtos;

            load("on", $("#popupEntrega"));
            $.ajax({
                type: "POST",
                url: "/entrega/agendada",
                data: {
                    "csrfmiddlewaretoken": "ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw",
                    carrinho_completo: _pacote.carrinho_completo,
                    cd_filial: this._entrega.filial.cd_filial,
                    tempo: this._entrega.dadosComplemento.tempo,
                    local_compra_id: this.local_compra_id,
                    qtd_faixas_mostrar: this.qtd_faixas,
                },
                success: (data) => {
                    load("off", $("#popupEntrega"));
                    this.faixas = data.value;
                    onToggleCarrinhoPopUp('open', '#popupAgendada');
                },
                error: (data) => {
                    load("off", $("#popupEntrega"));
                }
            });
        }
        FaixaHorarioComponent.prototype._carregarTemplate = function() {
            $('#carrinho-horarios-agendada').html(this.template);
        }

        function Agendada(id, tipo_codigo, _entrega) {
            this.id = id;
            this.tipo_codigo = tipo_codigo;
            this._entrega = _entrega;
            this.qtd_faixas = _entrega._qtd_faixas
        }
        Agendada.prototype = {
            get entregaStorage() {
                return carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pacotes && carrinho.instance._getCarrinho().pacotes[this._entrega._entrega_component._pacote.index - 1] && carrinho.instance._getCarrinho().pacotes[this._entrega._entrega_component._pacote.index - 1].entrega && carrinho.instance._getCarrinho().pacotes[this._entrega._entrega_component._pacote.index - 1].entrega._value;
            },
            get agendadaStorage() {
                return this.entregaStorage && this.entregaStorage._faixa_entrega;
            },
            get template() {

                let html_template;

                if(this._entrega._faixa_entrega){
                    carrinho.instance._setCarrinho();
                } else if(this.agendadaStorage){
                    this._entrega._faixa_entrega = this.agendadaStorage
                }

                if (this._entrega.faixa_entrega) {
                    html_template = `
                    <p class="font-weight-bold text-nowrap small"> ${this._entrega.faixa_entrega.descricao_combobox.split('%quebralinha%')[0]} </p>
           	        <p class="text-nowrap small"> ${this._entrega.faixa_entrega.descricao_combobox.split('%quebralinha%')[1]} </p>
                `;
                }
                else {
                    html_template = `
                    <p class="font-weight-bold text-nowrap small ${this._entrega.valid ? '' : ' text-danger '}">Disponibilidades</p>
                    <p id="ancora" class="small text-limit-1 ${this._entrega.valid ? '' : ' text-danger '}">Selecione o horário que deseja receber seu pacote</p>
                `;
                }

                return `
                    <p class="blueText font-weight-bold mt-3">Selecione o horário que deseja receber</p>
                    <div class="mt-2 pt-2 pb-2 d-flex align-items-center justify-content-between cursor-pointer" onclick="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.entrega_complemento._selecionar_faixa()">
           	            <div class="d-flex align-items-center">
           	                <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
           	                <div>
                                ${html_template}
                            </div>
           	            </div>
                        <span class="text-primary icon_arrow-next01 d-flex align-items-center font-2xl font-weight-bold" style="padding: 0 5px 0 5px;"></span>
           	        </div>
                `;
            }
        }
        Agendada.prototype._selecionar_faixa = function() {
            if (!this._faixa_componente) {
                this._faixa_componente = new FaixaHorarioComponent(this.id, this._entrega);
            } else {
                onToggleCarrinhoPopUp('open', '#popupAgendada');
            }
        }
        Agendada.prototype._carregar_faixas = function (){
            /*
            if(!this.agendadaStorage){
                if (!this._faixa_componente) {
                    this._faixa_componente = new FaixaHorarioComponent(this.id, this._entrega);
                } else {
                    onToggleCarrinhoPopUp('open', '#popupAgendada');
                }
            }
            */
        }

        function Loja(id, filial, _lojas) {
            this.id = id;
            this.filial = filial;
            this._selecionado = false;
            this._lojas = _lojas;
        }
        Loja.prototype = {
            get selecionado() {
                return this._selecionado;
            },
            set selecionado(value) {
                this._selecionado = value;
                this._lojas._carregarTemplate();
            },
            get horarios() {
                let html_horarios = ``;
                if (this.filial.hr_abertura_util !== '00:00' && this.filial.hr_fechamento_util !== '00:00') {
                    html_horarios += `Seg a sex: ${this.filial.hr_abertura_util && this.filial.hr_fechamento_util ? this.filial.hr_abertura_util + ` às ` + this.filial.hr_fechamento_util : 'Fechado'} | `;
                }
                else {
                    html_horarios += `Seg a sex: 24h | `;
                }
                if (this.filial.hr_abertura_util !== '00:00' && this.filial.hr_fechamento_util !== '00:00') {
                    html_horarios += `Sáb: ${this.filial.hr_abertura_sab && this.filial.hr_fechamento_sab ? this.filial.hr_abertura_sab + ` às ` + this.filial.hr_fechamento_sab : 'Fechado'} | `;
                }
                else {
                    html_horarios += `Sáb: 24h | `;
                }
                if (this.filial.hr_abertura_util !== '00:00' && this.filial.hr_fechamento_util !== '00:00') {
                    html_horarios += `Dom: ${this.filial.hr_abertura_dom && this.filial.hr_fechamento_dom ? this.filial.hr_abertura_dom + ` às ` + this.filial.hr_fechamento_dom : 'Fechado'}`;
                }
                else {
                    html_horarios += `Dom: 24h | `;
                }
                return html_horarios;
            },
            get template() {
                return `<div class="labl labl-background">
                        <input type="radio" required name="carrinho-loja" ${this.selecionado ? 'checked' : ''} id="carrinho-loja-${this.id}" autocomplete="off" value="${this.id}">
                        <label  onclick="carrinho.instance.pacotes[${this._lojas._entrega._entrega_component._pacote.index - 1}].entrega.value.entrega_complemento._loja_componente.value = ${this.id};carrinho.instance._alterarEstoqueProdutoRetirada(${this._lojas._entrega._entrega_component._pacote.index - 1});carrinho.instance._setCarrinho();" for="carrinho-loja-${this.id}" class="card text-body my-1" style="height:85px; background-color: #f0f3f5;">
                            <div class="card-body pt-2 pb-2 d-flex align-items-center">
                                <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
                                <div>
                                    <p class="font-weight-bold small text-limit-1">${title(this.filial.nm_filial)} (${this.filial.cd_filial}) </p>
                                    <p class="small text-limit-1">${this.filial.endereco ? title(this.filial.endereco) : "--"}, ${this.filial.numero ? this.filial.numero : "--"} - ${this.filial.bairro ? title(this.filial.bairro) : "--"}, ${this.filial.cidade ? this.filial.cidade : ""} - ${this.filial.uf ? this.filial.uf : "--"}</p>
                                    <p class="small text-limit-1">
                                        ${this.horarios}
                                        <div onclick="event.stopPropagation();atualizarMapa('${this.filial.latitude}', '${this.filial.longitude}', '/assets/img/maps/pin-map-lg.png', ${this._lojas._entrega._entrega_component._pacote.index - 1}, false, 'carrinho', ${this.id}, 'estatico')" class="cursor-pointer text-primary text-nowrap">Ver mapa</div>
                                    </p>
                                </div>
                            </div>
                        </label>
                    </div>`;
            }
        }

        function LojasComponent(id, _entrega) {
            this.id = id;
            this._entrega = _entrega;
            this._lojas = null;
            this._carregarLojas();
        }
        LojasComponent.prototype = {
            get valid() {
                return this.value ? true : false;
            },
            get value() {
                const loja = this._lojas ? this._lojas.filter((loja) => { return loja.selecionado }) : [];

                return loja.length > 0 ? loja[0] : null;
            },
            set value(value) {
                if (!this.value || this.value.id !== value) {
                    this._lojas.map((loja) => {
                        loja.id === value ? loja.selecionado = true : loja.selecionado ? loja.selecionado = false : '';
                        if (loja.id === value) {
                            this._entrega.filial = loja.filial;
                            onToggleCarrinhoPopUp('', '#popupLojas');
                        }
                    });
                }
            },
            get lojas() {
                return this._lojas;
            },
            set lojas(value) {
                const filiais = [];
                let i = 0;
                for (const filial of value) {
                    i++
                    filiais.push(new Loja(filial.cd_localentrega, filial, this));
                }
                this._lojas = filiais;
                this._carregarTemplate();
            },
            get template() {
                let html_template = ``;
                html_template += `<div style="height:100%; overflow:auto; padding-bottom:8rem;">`;
                let lojas = this.lojas.filter((loja) => {
                    let texto = `${loja.filial.cd_filial} ${loja.filial.nm_filial} ${loja.filial.endereco}, ${loja.filial.numero} - ${title(loja.filial.bairro)}, ${loja.filial.cidade} - ${loja.filial.uf}`.toLowerCase();
                    return texto.indexOf(this._entrega.retirada_filtro.toLowerCase()) > -1;
                })

                html_template += $.map(lojas, (elem) => {
                    return elem.template;
                }).join('');
                html_template += `</div>`;

                return html_template;
            }
        }
        LojasComponent.prototype._carregarFiltros = function() {
                let html_template = `
                <div class="row align-items-center">
                    <div class="col-8">
                        <input value="${this._entrega.retirada_filtro}" class="form-control" style="height: 45px;" onkeyup="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.retirada_filtro = this.value" placeholder="Buscar endereço ou número
                        ">
                    </div>
                    <div class="col-4">
                        <div class="labl labl-background">
           	                <input type="radio"
                                required="" ${this._entrega.proximas_mim ? 'checked' : ''} name="carrinho-proximas-mim" onclick="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.proximas_mim = '${this._entrega.proximas_mim ? '' : 'on'}';" id="carrinho-proximas-mim" autocomplete="off" value="1">
           	                <label for="carrinho-proximas-mim" class="card text-body my-1" style="height:45px; background-color: #fff; border: 2px solid #137ec2 !important;">
           	                    <a class="card-body pt-2 pb-2 d-flex align-items-center justify-content-center text-center">
           	                        <div>
           	                            <p class="text-primary text-limit-1 font-weight-semibold">Próximas a mim</p>
           	                        </div>
           	                    </a>
           	                </label>
           	            </div>
                    </div>
                </div>
            `;
                $('#carrinho-lojas-pesquisa').html(html_template);
        }
        LojasComponent.prototype._carregarLojas = function() {
            toastr.options.target = null;
            const _pacote = $.extend(true, {}, this._entrega._entrega_component._pacote);
            toastr.options.target = 'body';
            delete _pacote._carrinho;
            delete _pacote.filial;
            delete _pacote.entregas;
            delete _pacote.entrega;
            delete _pacote.produtos;
            const _produtos = [];
            for (const produto of _pacote._produtos) {
                const _produto = $.extend(true, {}, produto);
                delete _produto._pacote;
                _produtos.push(_produto);
            }
            _pacote._produtos = _produtos;

            load("on", $("#popupEntrega"));
            load("on", $("#popupLojas"));
            $.ajax({
                type: "POST",
                url: "/entrega/buscar/retiradas",
                data: {
                    "csrfmiddlewaretoken": "ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw",
                    coordenadas: this._entrega.coordenadas,
                    endereco_id: carrinho.instance.endereco.value.id,
                    cep: carrinho.instance.endereco.value.cep,
                    pacote: JSON.stringify(_pacote),
                    tipo_entrega: this.id
                },
                success: (data) => {
                    load("off", $("#popupEntrega"));
                    load("off", $("#popupLojas"));
                    this._carregarFiltros();
                    this.lojas = data.lista_filiais;
                    carrinho.instance.filiais_retirada = data.lista_filiais
                    onToggleCarrinhoPopUp('open', '#popupLojas');
                },
                error: (data) => {
                    load("off", $("#popupLojas"));
                    load("off", $("#popupEntrega"));
                }
            });
        }
        LojasComponent.prototype._carregarTemplate = function() {
            $('#carrinho-lojas').html(this.template);
        }

        function Retirada(id, tipo_codigo, _entrega) {
            this.id = id;
            this.tipo_codigo = tipo_codigo;
            this._entrega = _entrega;
            if(_entrega.nome && this.entregaStorage && this.entregaStorage.nome && _entrega.nome != this.entregaStorage.nome){
                this._entrega ? this._entrega.filial = null : false
            } else if(!_entrega.filial && this.entregaStorage && this.entregaStorage._filial){
                this._entrega ? this._entrega.filial = this.entregaStorage._filial : false
            }
        }

        Retirada.prototype = {
            get entregaStorage(){
                let pacote_index = this._entrega && this._entrega._entrega_component && this._entrega._entrega_component._pacote ? this._entrega._entrega_component._pacote.index : null
                if(pacote_index)
                    return carrinho.instance && carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pacotes[pacote_index - 1] && carrinho.instance._getCarrinho().pacotes[pacote_index - 1].entrega && carrinho.instance._getCarrinho().pacotes[pacote_index - 1].entrega._value ? carrinho.instance._getCarrinho().pacotes[pacote_index - 1].entrega._value : null

                return null
            },
            get horarios() {

                let html_horarios = ``;

                if (this._entrega.filial) {
                    if (this._entrega.filial.hr_abertura_util !== '00:00' && this._entrega.filial.hr_fechamento_util !== '00:00') {
                        html_horarios += `Seg a sex: ${this._entrega.filial.hr_abertura_util && this._entrega.filial.hr_fechamento_util ? this._entrega.filial.hr_abertura_util + ` às ` + this._entrega.filial.hr_fechamento_util : 'Fechado'} | `;
                    }
                    else {
                        html_horarios += `Seg a sex: 24h | `;
                    }
                    if (this._entrega.filial.hr_abertura_util !== '00:00' && this._entrega.filial.hr_fechamento_util !== '00:00') {
                        html_horarios += `Sáb: ${this._entrega.filial.hr_abertura_sab && this._entrega.filial.hr_fechamento_sab ? this._entrega.filial.hr_abertura_sab + ` às ` + this._entrega.filial.hr_fechamento_sab : 'Fechado'} | `;
                    }
                    else {
                        html_horarios += `Sáb: 24h | `;
                    }
                    if (this._entrega.filial.hr_abertura_util !== '00:00' && this._entrega.filial.hr_fechamento_util !== '00:00') {
                        html_horarios += `Dom: ${this._entrega.filial.hr_abertura_dom && this._entrega.filial.hr_fechamento_dom ? this._entrega.filial.hr_abertura_dom + ` às ` + this._entrega.filial.hr_fechamento_dom : 'Fechado'}`;
                    }
                    else {
                        html_horarios += `Dom: 24h | `;
                    }
                }

                return html_horarios;
            },
            get template() {

                let html_template;
                let html_retirada;
                let titulo_retirada;
                let descricao_retirada;
                let nm_loja_retirada;
                let autorizar_outra_pessoa = true
                let popup_retirada = '#popupInformacaoLojas'

                if( ['retirada', 'entrega_cd'].includes(this._entrega.nome)){
                    titulo_retirada = 'Selecione a loja para retirar';
                    nm_loja_retirada = 'Loja'
                    descricao_retirada = 'Selecione a loja para retirar seu pacote';
                } else {
                    titulo_retirada = 'Selecione o local para retirar';
                    nm_loja_retirada = 'Local'
                    descricao_retirada = 'Selecione o local para retirar seu pacote';
                }
                if(this._entrega.nome === 'entrega_cd' || this._entrega.nome === 'retirar_carro'){
                    autorizar_outra_pessoa = false
                }

                if (this._entrega.filial) {
                    html_template = `
                    <p class="font-weight-bold text-nowrap small">${title(this._entrega.filial.nm_filial)} (${this._entrega.filial.cd_filial})</p>
           	        <p class="text-limit-1 small">${title(this._entrega.filial.endereco)}, ${this._entrega.filial.numero} - ${title(this._entrega.filial.bairro)} - ${this._entrega.filial.cidade}/${this._entrega.filial.uf}</p>
                    <p class="text-limit-1 small">${this.horarios} <div onclick="atualizarMapa('${this._entrega.filial.latitude}', '${this._entrega.filial.longitude}', '/assets/img/maps/pin-map-lg.png', ${this._entrega._entrega_component._pacote.index - 1}, false, 'carrinho', '', 'estatico')"  class="cursor-pointer text-primary text-nowrap" >Ver mapa</div></p>
                `;
                }
                else {
                    html_template = `
                    <p id="ancora" class="font-weight-bold text-nowrap small ${this._entrega.valid ? '' : 'text-danger'}">${nm_loja_retirada}</p>
                    <p class="text-nowrap small text-limit-1 ${this._entrega.valid ? '' : 'text-danger'}">${descricao_retirada}</p>
                `;
                }
                if (this._entrega.retirada_terceiro) {

                    let nm_completo = this._entrega.retirada_terceiro_nome;
                    let cpf = this._entrega.retirada_terceiro_cpf;
                    let telefone = this._entrega.retirada_terceiro_telefone;

                    html_retirada = `
                        <div class="row">
                            <div class="col-12 mt-2">
                                <input placeholder="Nome completo" value="${nm_completo ? nm_completo : ''}" onchange="carrinho.instance.pacotes[0].entrega.value.retirada_terceiro_nome = this.value;carrinho.instance._setCarrinho();" maxlength="200" type="text" style="height: 45px;" class="form-control input-padrao ${carrinho.instance._submit_retirada_por_terceiro && !nm_completo ? 'is-invalid' : ''}">
                            </div>
                            <div class="col-6 mt-2">
                                <input placeholder="CPF" value="${cpf ? cpf : ''}" onchange="carrinho.instance.pacotes[0].entrega.value.retirada_terceiro_cpf = this.value;carrinho.instance._setCarrinho();" inputmode="numeric" minlength="11" maxlength="14" type="text" style="height: 45px;" class="form-control input-padrao cpf ${carrinho.instance._submit_retirada_por_terceiro && !cpf ? 'is-invalid' : ''}">
                            </div>
                            <div class="col-6 mt-2">
                                <input placeholder="Telefone" value="${telefone ? telefone : ''}" onchange="carrinho.instance.pacotes[0].entrega.value.retirada_terceiro_telefone = this.value;carrinho.instance._setCarrinho();" inputmode="numeric" minlength="16" maxlength="16" type="text" style="height: 45px;" class="form-control input-padrao telefone ${carrinho.instance._submit_retirada_por_terceiro && !telefone ? 'is-invalid' : ''}">
                            </div>
                        </div>
                    `;
                }
                else {
                    html_retirada = ``;
                }

                if (this._entrega._entrega_component._pacote.pacote.is_marketplace) {
                    popup_retirada = `#popupInformacaoLojaParceira`;
                }

                return `
                <p class="blueText font-weight-bold mt-3">
                    <a class="p-1 cursor-pointer rounded-circle text-white font-weight-semibold mr-2" onclick="onToggleCarrinhoPopUp('open', '${popup_retirada}')" style="background-color:#f00; padding-right: .7rem!important;padding-left: .7rem!important;">i</a>
                    ${titulo_retirada}
                </p>
                <a class="mt-2 pt-2 pb-2 d-flex align-items-center justify-content-between cursor-pointer" onclick="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.entrega_complemento._selecionar_loja()">
           	        <div class="d-flex align-items-center">
           	            <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
           	            <div>
                            ${html_template}
                        </div>
           	        </div>
                    <span class="text-primary icon_arrow-next01 d-flex align-items-center font-2xl font-weight-bold" style="padding: 0 5px 0 5px;"></span>
           	    </a>
                <hr>
                <div class="${autorizar_outra_pessoa ? "d-flex" : "d-none"} align-items-center">
                    <span class="font-weight-semibold mr-2">Autorizar outra pessoa a retirar</span>
                    <div class="row">
                        <div class="col-6">
                            <div class="radio-ecomm" onclick="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.retirada_terceiro = true;carrinho.instance._setCarrinho();">
                                <input id="carrinho-terceiro-sim" ${this._entrega.retirada_terceiro ? 'checked' : ''} type="radio" value="on" name="carrinho-terceiro">
                                <label for="carrinho-terceiro-sim">
                                    Sim
                                </label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="radio-ecomm" onclick="carrinho.instance.pacotes[${this._entrega._entrega_component._pacote.index - 1}].entrega.value.retirada_terceiro = '';carrinho.instance._setCarrinho();">
                                <input id="carrinho-terceiro-nao" ${!this._entrega.retirada_terceiro ? 'checked' : ''} type="radio" value="" name="carrinho-terceiro">
                                <label for="carrinho-terceiro-nao">
                                    Não
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                ${html_retirada}
            `;
            }
        }
        Retirada.prototype._selecionar_loja = function() {
            if (!this._loja_componente) {
                this._loja_componente = new LojasComponent(this.id, this._entrega);
            }
            else {
                onToggleCarrinhoPopUp('open', '#popupLojas');
            }
        }
        Retirada.prototype._carregar_lojas = function() {
            if(!this.entregaStorage){
                if (!this._loja_componente) {
                    this._loja_componente = new LojasComponent(this.id, this._entrega);
                }
                else {
                    onToggleCarrinhoPopUp('open', '#popupLojas');
                }
            }
        }

        function Entrega(index, nome, _filial, nome_descritivo, vlr_frete, descricao, imagem, tipo_codigo, dadosComplemento, is_programada, qtd_faixas, _entrega_component) {
            this._entrega_component = _entrega_component;
            this.index = index;
            this.nome = nome;
            this.dadosComplemento = dadosComplemento;
            this._valid = true;
            if (tipo_codigo !== 'retirada') {
                this.filial = _filial;
            } else {
                this.filial = null;
            }
            this.is_programada = is_programada
            this.qtd_faixas = qtd_faixas
            this.nome_descritivo = nome_descritivo;
            this._vlr_frete = vlr_frete;
            this.descricao = descricao;
            this.imagem = imagem;
            this.tipo_codigo = tipo_codigo;
            this._selecionado = false;
            if (_entrega_component && _entrega_component.value && _entrega_component.value.nome == nome) {
                this._selecionado = true;
            }
            if(this.entrega_storage && this.entrega_storage._retirada_terceiro){
                this.retirada_terceiro = this.entrega_storage._retirada_terceiro
                this.retirada_terceiro_nome = this.entrega_storage._retirada_terceiro_nome ? this.entrega_storage._retirada_terceiro_nome : ''
                this.retirada_terceiro_cpf = this.entrega_storage._retirada_terceiro_cpf ? this.entrega_storage._retirada_terceiro_cpf : ''
                this.retirada_terceiro_telefone = this.entrega_storage._retirada_terceiro_telefone ? this.entrega_storage._retirada_terceiro_telefone : ''
            }
        }
        Entrega.prototype = {
            get entrega_storage(){
                return carrinho.instance && carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pacotes.length && carrinho.instance._getCarrinho().pacotes[this.index - 1] && carrinho.instance._getCarrinho().pacotes[this.index - 1].entrega && carrinho.instance._getCarrinho().pacotes[this.index - 1].entrega._value ? carrinho.instance._getCarrinho().pacotes[this.index - 1].entrega._value : ''
            },
            get filial() {
                return this._filial;
            },
            set filial(value) {
                if (value && (!this.filial || this.filial.cd_localentrega != value.cd_localentrega)) {
                    this._filial = value;
                    this._entrega_component._carregarTemplate();
                } else {
                    this._filial = value;
                }
            },
            get valid() {
                return this._valid;
            },
            set valid(value) {
                this._valid = value;
            },
            get faixa_entrega() {
                return this._faixa_entrega;
            },
            set faixa_entrega(value) {
                this._faixa_entrega = value;
                this._entrega_component._carregarTemplate();
            },
            get retirada_filtro() {
                return this._retirada_filtro ? this._retirada_filtro : '';
            },
            set retirada_filtro(value) {
                this._retirada_filtro = value;
                this.entrega_complemento && this.entrega_complemento._loja_componente ? this.entrega_complemento._loja_componente._carregarTemplate() : '';
            },
            get proximas_mim() {
                return this._proximas_mim;
            },
            set proximas_mim(value) {
                this._pegarLocalizacao(value);
            },
            get coordenadas() {
                return this._coordenadas ? this._coordenadas : '';
            },
            set coordenadas(value) {
                this._coordenadas = value;
            },
            get is_programada() {
                return this._is_programada;
            },
            set is_programada(value) {
                this._is_programada = value;
            },
            get qtd_faixas() {
                return this._qtd_faixas;
            },
            set qtd_faixas(value) {
                this._qtd_faixas = value;
            },
            get retirada_terceiro() {
                return this._retirada_terceiro;
            },
            set retirada_terceiro(value) {
                if (value) {
                    this._retirada_terceiro = true;
                }
                else {
                    this._retirada_terceiro = false;
                }
                this._entrega_component._carregarTemplate();
            },
            get retirada_terceiro_nome() {
                return this._retirada_terceiro_nome;
            },
            set retirada_terceiro_nome(value) {
                this._retirada_terceiro_nome = value;
                this.retirada_terceiro = 'on';
            },
            get retirada_terceiro_telefone() {
                return this._retirada_terceiro_telefone;
            },
            set retirada_terceiro_telefone(value) {
                this._retirada_terceiro_telefone = value;
                this.retirada_terceiro = 'on';
            },
            get retirada_terceiro_cpf() {
                return this._retirada_terceiro_cpf;
            },
            set retirada_terceiro_cpf(value) {
                if(value && value.toString().length === 14){
                    if(validaCPF(value)){
                        this._retirada_terceiro_cpf = value;
                    } else if(!validaCPF(value)){
                        this._retirada_terceiro_cpf = ''
                        this._entrega_component._carregarTemplate();
                        toastr.error('O CPF informado para retirada por terceiro é inválido.')
                    }
                } else {
                    this._retirada_terceiro_cpf = ''
                    this._entrega_component._carregarTemplate();
                    toastr.error('O CPF informado para retirada por terceiro é inválido.')
                }
                this.retirada_terceiro = 'on';
            },
            get vlr_frete() {
                return this._vlr_frete > 0 ? 'R$ ' + parseFloat(this._vlr_frete).toLocaleFixed(2) : 'Grátis';
            },
            set vlr_frete(value) {
                this._vlr_frete = value;
            },
            get selecionado() {
                return this._selecionado;
            },
            set selecionado(value) {
                this._selecionado = value;
            },
            get entregaComplemento() {
                if (this._entrega_component.value && this._selecionado) {
                    if (this.tipo_codigo == 'retirada') {
                        this.entrega_complemento = new Retirada(this.nome, this.tipo_codigo, this);
                        return this.entrega_complemento.template;
                    } else if (this.is_programada) {
                        this.entrega_complemento = new Agendada(this.nome, this.tipo_codigo, this);
                        return this.entrega_complemento.template;
                    }
                } 
                return '';
            },
            get template() {
                return `<span class="badge badge-danger mt-1 text-wrap pointer-event-none ${ this.selecionado ? 'd-block': 'd-none' }" style="border-radius: 3px;">Pedidos realizados das 19h01M até 06h, serão entregues a partir das 8h do dia seguinte. </span>
                    <div class="col-6 col-md-4 labl labl-background">
          	           <input type="radio" required name="carrinho-entrega" ${ this.selecionado ? 'checked': '' } onclick="carrinho.instance.pacotes[${this._entrega_component._pacote.index - 1}].entrega.value = '${ this.nome }'; carrinho.instance._mensagemTempoDeEntrega(carrinho.instance._pacotes[${this._entrega_component._pacote.index - 1}]); carrinho.instance._alterarEstoqueProdutoRetirada(${this._entrega_component._pacote.index - 1}); carrinho.instance._setCarrinho();" id="carrinho-entrega-${this.index}" autocomplete="off" value="${this.nome}">
          	           <label for="carrinho-entrega-${this.index}" class="card text-body my-1" style="height:85px; background-color: #f0f3f5;">
          	               <a class="card-body pt-2 pb-2 d-flex align-items-center justify-content-center">
          	                   <div class="text-center">
                                    <p class="fontOutfitExtraBold" style="font-size:13px;">${this.nome_descritivo}</p>
          	                        <p class="text-nowrap fontOutfitSemiBold" style="font-size:10px;">${this.vlr_frete}</p>
          	                        <p class="text-nowrap fontOutfitSemiBold" style="font-size:10px;">${this.descricao}</p>
                                </div>
          	               </a>
          	           </label>
          	       </div>`;
            }
        }
        Entrega.prototype._pegarLocalizacao = function (value) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this._proximas_mim = value;
                        if(value){
                            this.coordenadas = `${position.coords.latitude}, ${position.coords.longitude}`;
                        }
                        else {
                            this.coordenadas = '';
                        }
                        this.entrega_complemento._loja_componente._carregarLojas();
                    },
                    (error) => {
                        $('#modal_localizacao_nao_permitida').modal('show');
                        this._proximas_mim = '';
                        this.coordenadas = '';
                        this.entrega_complemento._loja_componente._carregarLojas();
                    }
                );
            } else {
                $('#modal_localizacao_bloqueada').modal('show');
                this._proximas_mim = '';
                this.coordenadas = '';
                this.entrega_complemento._loja_componente._carregarLojas();
            }
        }

        function EntregaComponent(entregas, _pacote, entregaStorage) {
            // Tipo de entrega == entrega_transportadora, back nao consegue mandar como entrega 
            // ai tem esse xaxo para renomear 
            this.entregas = entregas.map((entrega) => {
                entrega.tipo_codigo = entrega.tipo_codigo == 'entrega_transportadora' ? "entrega" : entrega.tipo_codigo;
                return entrega;
            });
            this._pacote = _pacote;
            this._entregaStorage = entregaStorage
            this._value = entregaStorage
            this._tipo_entrega = this._entregaStorage && this._entregaStorage.tipo_codigo ? this._entregaStorage.tipo_codigo : ''
            this._entregaStorage && this._entregaStorage.tipo_codigo ? this._carregarEntregas() : ''

            if(this._entregaStorage && this._entregaStorage.nome){
                this.value = this._entregaStorage.nome
            }
        }
        EntregaComponent.prototype = {
            get valid() {
                if (!this.value) {
                    return false;
                }
                else {
                    if(this._pacote && this._pacote.is_digital){
                        return true;
                    } else if (this.value && this.value.is_programada) {
                        if (!this.value.faixa_entrega) {
                            toastr.error('Selecione o horário para receber o pacote', 'Erro');
                            this.value.valid = false;
                            return false;
                        }
                    } else {

                        if (!this.value.filial && !this.value._filial) {
                            this.value.valid = false;
                            toastr.error('Selecione a Loja para retirar seu pacote.', 'Erro');
                            return false;
                        }

                        if(this.value.retirada_terceiro && (!this.value.retirada_terceiro_nome || !this.value.retirada_terceiro_cpf || !this.value.retirada_terceiro_telefone)){
                            this.value.valid = false
                            toastr.error('Preencha os campos obrigatórios de retirada por terceiro para prosseguir.', 'Erro');
                            return false;
                        }
                    }
                }
                return true;
            },
            get is_frete_gratis(){
                if(this._pacote && this._pacote._carrinho && this._pacote._carrinho._cupom){
                    if(this._pacote._carrinho._cupom.is_frete_gratis){
                        return true;
                    } else {
                        return false;
                    }
                }
                return false;
            },
            get nome() {
                if (this.value && this.value.nome_descritivo) {
                    return this.value.nome_descritivo + ' - ' + (this.value._vlr_frete === 'Grátis' && !this.is_frete_gratis ? this.value._vlr_frete : +this.value._vlr_frete > 0 && !this.is_frete_gratis ? 'R$ ' + parseFloat(this.value._vlr_frete).toLocaleFixed(2) : 'Grátis')
                } else {
                    return null;
                }
            },
            get value() {
                return this._value;
            },
            set value(value) {
                if (value != this.value) {
                    if(this.entregasDoTipo){
                        this.entregasDoTipo.filter((entrega) => { entrega.nome === value ? entrega.selecionado = true : entrega.selecionado = false; });
                        const entrega = this.entregasDoTipo.filter((entrega) => { return entrega.selecionado });
                        this._value = entrega.length > 0 ? entrega[0] : null;
                    }
                    this._pacote && this._pacote._carrinho && this._pacote._carrinho ? this._pacote._carrinho.cupom = '' : ''
                    carrinho.instance.entrega_alterada = true;
                }
                this._logicaFrete();

                this._carregarTemplate();
                this._pacote._carregarTemplate();

                if($('#ancora') && $('#ancora').offset()){
                    $('#carrinho-tipo-entregas').animate({
                        scrollTop: $('#ancora').offset().top / 3
                    }, 100);
                }

                if(this._value  && this._value.entrega_complemento){
                    if(this._value.entrega_complemento._selecionar_loja){
                        this._value.entrega_complemento._carregar_lojas();
                    }
                    else if (this._value.entrega_complemento._selecionar_faixa) {
                        this._value.entrega_complemento._carregar_faixas();
                    }
                }

            },
            get tipo_entrega() {
                return this._tipo_entrega;
            },
            set tipo_entrega(value) {
                this._tipo_entrega = value;
                this._carregarEntregas();
            },
            get entregasDoTipo() {
                return this._entregasDoTipo;
            },
            set entregasDoTipo(value) {
                this._entregasDoTipo = value;
                this._carregarTemplate();
            },
            get entregaStorage(){
                return this._entregaStorage;
            },
            get template() {

                const template_entregas = `<div class="row align-items-center justify-content-center mt-3">
                    ${$.map(this.entregasDoTipo, (elem) => {
                    return elem.template;
                }).join('')}
                </div>`;

                const retiradas_filtro = this.entregas.filter((val) => {
                    if (val.tipo_codigo === 'retirada') {
                        return val;
                    }
                });

                const entregas_filtro = this.entregas.filter((val) => {
                    if (val.tipo_codigo === 'entrega') {
                        return val;
                    }
                });

                let html_template = entregas_filtro.length > 0 ? `
                <div class="labl mt-3" onclick="">
                    <input type="radio" required="" onclick="carrinho.instance.pacotes[${this._pacote.index - 1}].entrega.tipo_entrega = 'entrega';carrinho.instance._setCarrinho();" ${this.tipo_entrega == 'entrega' ? 'checked' : ''} name="carrinho-tipo-entrega" id="carrinho-tipo-entrega" autocomplete="off" value="entrega">
                    <label for="carrinho-tipo-entrega" class="card text-body text-center my-1" style="height:50px; background-color: transparent;">
                        <a class="card-body pt-2 pb-2 text-center">
                            <p class="text-muted fontOutfitExtraBold text-nowrap small">Receber</p>
                            <p class="text-muted fontOutfitMedium text-nowrap small">Entregas Expresso ou Normal</p>
                        </a>
                    </label>
                </div>
                ${this.tipo_entrega == 'entrega' ? template_entregas : ''}

                ${this.tipo_entrega == 'entrega' && this.value && this.value.tipo_codigo == 'entrega' && this.value.entregaComplemento ? this.value.entregaComplemento : ''}
                ` : ``;
                html_template +=
                    retiradas_filtro.length > 0 ? `
                <div class="labl mt-3" onclick="">
                    <input type="radio" required="" onclick="carrinho.instance.pacotes[${this._pacote.index - 1}].entrega.tipo_entrega = 'retirada';carrinho.instance._setCarrinho();" ${this.tipo_entrega == 'retirada' ? 'checked' : ''} name="carrinho-tipo-entrega" id="carrinho-tipo-retirada" autocomplete="off" value="retirada">
                    <label for="carrinho-tipo-retirada" class="card text-body text-center my-1" style="height:50px; background-color: transparent;">
                        <a class="card-body pt-2 pb-2  text-center">
                            <p class="text-muted font-weight-bolder  text-nowrap small">Compre e Retire</p>
                            <p class="text-muted text-nowrap small">Retire na loja</p>
                        </a>
                    </label>
                </div>
                ${this.tipo_entrega == 'retirada' ? template_entregas : ''}

                ${this.tipo_entrega == 'retirada' && this.value && this.value.tipo_codigo == 'retirada' && this.value.entregaComplemento ? this.value.entregaComplemento : ''}

                <div style="height:90px;"></div>
                ` : ``;
                return html_template;
            }
        }
        EntregaComponent.prototype._logicaFrete = function () {
            let maior_frete = 0;
            let maior_entrega_nome = '';

            let entregas = [];

            if(this._pacote && this._pacote._carrinho && this._pacote._carrinho.pacotes){
                for (const index in this._pacote._carrinho.pacotes) {

                    const pac = this._pacote._carrinho.pacotes[index];

                    if (pac.entrega && pac.entrega.value && (pac.entrega.value.tipo_codigo === 'entrega' && pac.entrega.value.nome !== 'correios')) {
                        entregas.push(1);
                    }

                    // atualiza valores das entregas do front com a do back
                    for (const entrega of pac.entrega.entregas) {
                        if (pac.entrega.value && entrega.nome === pac.entrega.value.nome) {
                            pac.entrega.value._vlr_frete = entrega.valor;
                        }
                    }

                    // faz logica para pegar o frete mais caro das entregas que n sao correios
                    for (const pacote of this._pacote._carrinho.pacotes) {
                        if(!pacote.pacote.is_marketplace){
                            let entrega = pacote.entrega.value;
                            if ( entrega && (entrega.tipo_codigo === 'entrega' && entrega.nome !== 'correios') ) {
                                if( ( pac.entrega && pac.entrega.value ) && pac.entrega.value.tipo_codigo === 'entrega' && pac.entrega.value.nome !== 'correios' ){
                                    if (pac.entrega.value._vlr_frete > entrega._vlr_frete) {
                                        maior_frete = pac.entrega.value._vlr_frete;
                                        maior_entrega_nome = pac.entrega.value.nome;
                                    }
                                }
                            }
                        }
                    }
                }

                let esseEoPrimeiroFreteGratisDaEntrega = 0;

                for (const index in this._pacote._carrinho.pacotes) {
                    const pac = this._pacote._carrinho.pacotes[index];

                    // logica para cupom frete gratis
                    if (this._pacote._carrinho.cupom && this._pacote._carrinho.cupom.cupom_id && this._pacote._carrinho.cupom.is_frete_gratis && this._pacote._carrinho.cupom.pacotes.indexOf(+index + 1) > - 1) {
                        pac.entrega.value._vlr_frete = 0;
                    }
                    // faz logica para o frete gratis e deixar cobrar apenas o mais caro das entregas, exceto para correios, pacotes marketplace ou pacotes com produto controlado com receita física
                    else if (entregas.length > 1 && pac.entrega.value && pac.entrega.value.tipo_codigo === 'entrega' && pac.entrega.value.nome !== 'correios' && !this._pacote._carrinho.is_marketplace && (pac.pacote && !pac.pacote.is_receita_fisica)) {
                        let isFretegratis = 0;
                        if (pac.entrega.value.nome === maior_entrega_nome && esseEoPrimeiroFreteGratisDaEntrega == 0) {
                            isFretegratis = 1;
                            esseEoPrimeiroFreteGratisDaEntrega = 1;
                        }
                        if (isFretegratis == 0) {
                            pac.entrega.value._vlr_frete = 0;
                        }
                    }
                }
            }
        }
        EntregaComponent.prototype._carregarEntregas = function () {
            let _entregas = []
            for (const entrega of this.entregas) {
                if (this.tipo_entrega == entrega.tipo_codigo) {
                    _entregas.push(entrega);
                }
            }
            var i = 0;
            _entregas = _entregas.map((entrega) => {
                let filial = entrega.filial, nome = entrega.nome, nm_descritivo = entrega.nm_descritivo, valor = entrega.valor, descricao = entrega.descricao, imagem = entrega.imagem, tipo_codigo = entrega.tipo_codigo, is_programada = entrega.is_programada, qtd_faixas = entrega.qtd_faixas;
                i++;
                return new Entrega(i, nome, filial, nm_descritivo, valor, descricao, imagem, tipo_codigo, entrega, is_programada, qtd_faixas, this);
            })
            this.entregasDoTipo = _entregas;
        }
        EntregaComponent.prototype._carregarTemplate = function () {

            $('#carrinho-entrega-pacote').html(`
                <a class="cursor-pointer rounded-circle text-white font-weight-semibold mr-2" onclick="onToggleCarrinhoPopUp('open', '#popupInformacaoPacote')" style="background-color: #F00; cursor:pointer; padding: 0px 10px 0px 10px; position: absolute; left: 20px">i</a>
                <p class="fontOutfitRegular" style="color: #444444"><span class="blueText fontOutfitBold text-uppercase">Pacote ${this._pacote.index}: </span>${ this.nome ? this.nome : 'Escolher a Entrega' }<p>
                <a class="icon_close02 cursor-pointer" onclick="onToggleCarrinhoPopUp('', '#popupEntrega')" style="color:#137ec2; position: absolute; right: 20px"></a>
            `);

            $('#carrinho-tipo-entregas').html(this.template);
            $('#carrinho-tipo-entregas').attr('data-pacote-ativo', this._pacote.index)

            $(".cpf").mask("000.000.000-00"), $(".telefone").mask("(00) 0 0000-0000");

        }

        function Pacote(index, id, produtos, tipos_entrega, carrinho_completo, pacote, _carrinho) {
            this.index = index;
            this.id = id;
            this.produtos = produtos;
            this.carrinho_completo = carrinho_completo;
            let entregaStorage = this.carrinhoStorage && this.carrinhoStorage.pacotes && this.carrinhoStorage.pacotes[this.index - 1] && this.carrinhoStorage.pacotes[this.index - 1].entrega && this.carrinhoStorage.pacotes[this.index - 1].entrega._value ? this.carrinhoStorage.pacotes[this.index - 1].entrega._value : null
            this.entrega = new EntregaComponent(tipos_entrega, this, entregaStorage);
            this._carrinho = _carrinho;
            this.pacote = pacote
            this.is_digital = pacote.is_digital
            this.is_entrega_disponivel = true

            if(!this.pacote.entregas || !this.pacote.entregas.length)
                this.is_entrega_disponivel = false

            if(this.pacote && this.pacote.is_marketplace)
                _carrinho.is_marketplace = true

            if(this.mensagemStorage && this.mensagemStorage.length && this.mensagemStorage[this.index - 1]){
                carrinho.instance._mensagem[this.index - 1] = this.mensagemStorage[this.index - 1]
            }

            if(typeof(this.pacote.mensagem) === 'string' && this.pacote.mensagem){
                carrinho.instance._mensagem[this.index - 1] = this.pacote.mensagem
            }
        }
        Pacote.prototype = {
            get valid() {
                if(this.entrega && this.entrega.value && (this.entrega.value && this.entrega.value.retirada_terceiro)){
                    carrinho.instance.submit_retirada_por_terceiro = true;
                }
                return this.entrega && this.entrega.valid ? true : false
            },
            get produtos() {
                return this._produtos;
            },
            set produtos(value) {
                const products = [];
                var i = 0;
                for (const produto of value) {
                    let hash = produto.hash,
                        id = produto.id,
                        produto__nm_ecommerce = produto.produto__nm_ecommerce,
                        quantidade = produto.quantidade,
                        valor = produto.valor,
                        valor_mult = produto.valor_mult,
                        produto__imagem_pequena = produto.produto__imagem_pequena,
                        produto__nm_url_ecommerce = produto.produto__nm_url_ecommerce,
                        token_nsu = produto.token_nsu;

                    products.push(new Produto(i + 1, hash, id, produto__nm_ecommerce, quantidade, valor, valor_mult, produto__imagem_pequena, produto__nm_url_ecommerce, produto, this, value.length - 1 === i));
                    i++;
                }
                this._produtos = products;
            },
            get mensagem() {
                return this._mensagem;
            },
            set mensagem(value){
                this._mensagem = value
            },
            get is_digital() {
                return this._is_digital;
            },
            set is_digital(value){
                this._is_digital = value
            },
            get is_entrega_disponivel() {
                return this._is_entrega_disponivel;
            },
            set is_entrega_disponivel(value){
                this._is_entrega_disponivel = value
            },
            get mensagemStorage() {
                return this._carrinho && this._carrinho._getCarrinho() && this._carrinho._getCarrinho().mensagem ? this._carrinho._getCarrinho().mensagem : [];
            },
            get carrinhoStorage(){
                return carrinho.instance._getCarrinho();
            },
            get template() {

                const template_produtos = $.map(this.produtos, (elem) => {
                    return elem.template;
                }).join('');
                return `
                    <div class="card" style="box-shadow:unset !important; border:0 !important; border-radius:7px;">
                        <div class="card-header bg-white py-2 mb-0" style="border-bottom: 2px solid var(--light);">
                            <div class="align-items-center justify-content-between">
                                <div class="d-flex align-items-center flex-md-fill">
                                    <p class="col-4 col-md-3 pr-0 text-uppercase font-xl" style="color: #137ec2; font-family: 'Outfit',sans-serif;font-weight: 900">Pacote ${ this.index }:</p>
                                    
                                    
                                </div>
                            </div>
                            <div class="row my-1 px-2" style="${!this.mensagemStorage || !this.mensagemStorage.length || !this.mensagemStorage[this.index - 1] ? 'display: none;' : ''}">
                                <p class="fontOutfitRegular" id="msg-tempo-entrega-${this.index - 1}" style="font-size: 13px !important; color: #989898!important;">
                                    ${this.mensagemStorage && this.mensagemStorage.length && this.mensagemStorage[this.index - 1] ? this.mensagemStorage[this.index - 1]  : ''}
                                </p>
                            </div>
                        </div>
                        <div id="carrinho-lista_produtos_${this.index}" class="card-body" style="padding-left: 0; padding-right: 0; ">
                            ${template_produtos}
                        </div>
                        ${this.pacote.nm_pacote ? `
                            <div class="card-footer bg-white py-2 mb-0 d-flex align-items-center justify-content-center" style="padding-right: 10px; padding-left: 10px;">
                                <p onclick="onToggleCarrinhoPopUp('open', '#popupInformacaoPacote');"></p>
                            </div>
                        ` : ``}
                    </div>
                `;
            }
        }
        Pacote.prototype._carregarTemplate = function () {
            this._carrinho ? this._carrinho._carregarTemplate() : ''
        }

        function Endereco(id, apelido, cep, logradouro, numero, bairro, cidade, estado, complemento, _enderecos, is_principal) {
            this.id = id;
            this.apelido = apelido;
            this.logradouro = logradouro;
            this.cep = cep;
            this.numero = numero;
            this.bairro = bairro;
            this.cidade = cidade;
            this.estado = estado;
            this.complemento = complemento;
            this._selecionado = false;
            this._enderecos = _enderecos;
        }
        Endereco.prototype = {
            get selecionado() {
                return this._selecionado;
            },
            set selecionado(value) {
                this._selecionado = value;
                this._enderecos._carregarTemplate();
            },
            get endereco() {
                return this.logradouro + ', ' + this.numero + ', ' + this.bairro;
            },
            get municipio() {
                return this.cidade + '/' + this.estado;
            },
            get endereco_completo() {
                return this.endereco + ' - ' + this.municipio;
            },
            get editar() {
                return `
                event.stopPropagation();
                carrinho.instance.endereco.id = '${this.id}';
                carrinho.instance.endereco.cep = '${this.cep}';
                carrinho.instance.endereco.estado = '${this.estado}';
                carrinho.instance.endereco.numero = '${this.numero}';
                carrinho.instance.endereco.rua = '${this.logradouro}';
                carrinho.instance.endereco.complemento = '${this.complemento}';
                carrinho.instance.endereco.bairro = '${this.bairro}';
                carrinho.instance.endereco.apelido = '${this.apelido}';
                carrinho.instance.endereco.is_principal = '${this.is_principal}';
                carrinho.instance.endereco._carregarEdicaoEndereco();
           `;
            },
            get template() {
                return `<div class="labl labl-background">
           	        <input type="radio" required name="carrinho-endereco" ${this.selecionado ? 'checked' : ''} onclick="carrinho.instance.endereco.value = ${this.id};onToggleCarrinhoPopUp('', '#popupEndereco');" id="carrinho-endereco-${this.id}" autocomplete="off" value="${this.id}">
           	        <label for="carrinho-endereco-${this.id}" class="card text-body my-1" style="height:70px; background-color: #f0f3f5;">
           	            <a class="card-body pt-2 pb-2 d-flex align-items-center">
           	                <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
           	                <div>
           	                    <p class="font-weight-bold small text-limit-1">${this.apelido}</p>
           	                    <p class="small text-limit-1">${this.endereco}</p>
           	                    <p class="small text-limit-1">${this.municipio}</p>
           	                </div>
                            <div class="h-100 d-flex align-items-top ml-auto">
           	                    <p class="font-weight-bold text-nowrap small px-3 font-xl" onclick="${this.editar}">...</p>
           	                </div>
           	            </a>
           	        </label>
           	    </div>`;
            }
        };

        function EnderecoComponent() {
            this._enderecos = null;
            this._carregarEnderecos();
        }
        EnderecoComponent.prototype = {
            get valid() {
                return this.value ? true : false;
            },
            get value() {
                const endereco = this._enderecos ? this._enderecos.filter((endereco) => { return endereco.selecionado }) : [];
                return endereco.length > 0 ? endereco[0] : null;
            },
            set value(value) {
                this._enderecos.map((endereco) => {
                    if(endereco.id === value){
                        endereco.selecionado = true
                    }
                    else {
                        endereco.selecionado = false;
                    }
                });
                if (value) {
                    localStorage.setItem('carrinho_endereco_id', value);
                }
                carrinho.instance._atualizarCarrinho();
            },
            get ultimo_editado_criado() {
                return this._ultimo_editado_criado;
            },
            set ultimo_editado_criado(value) {
                this._ultimo_editado_criado = value;
            },
            get enderecos() {
                return this._enderecos;
            },
            set enderecos(value) {
                const end = [];
                let principal = null;
                let primeiro = null;

                let ultimo_salvo = localStorage.getItem('carrinho_endereco_id');

                let ultimo_salvo_id = null;

                for (const { id, apelido, cep__cep_form, endereco, numero, bairro, cep__bairro_cep, cep__municipio__nome, cep__municipio__uf__nm_abrev, complemento, is_principal } of value) {
                    if (!principal) {
                        if (this.ultimo_editado_criado) {
                            principal = this.ultimo_editado_criado;
                            this.ultimo_editado_criado = null;
                        }
                        else {
                            if (ultimo_salvo == id) {
                                ultimo_salvo_id = id;
                            }
                            else {
                                if (!primeiro) {
                                    primeiro = id;
                                }
                                if (is_principal) {
                                    principal = id;
                                }
                            }
                        }
                    }
                    end.push(new Endereco(id, apelido, cep__cep_form, endereco, numero, cep__bairro_cep ? cep__bairro_cep : bairro, cep__municipio__nome, cep__municipio__uf__nm_abrev, complemento, this, is_principal));
                }
                this._enderecos = end;
                this._carregarTemplate();
                this.value = ultimo_salvo_id ? ultimo_salvo_id : principal ? principal : primeiro;
            },
            get template() {
                return $.map(this._enderecos, (elem) => {
                    return elem.template;
                }).join('');
            },
            get cep() {
                return this._cep ? this._cep : '';
            },
            set cep(value) {
                this._cep = value;
                let cep = value.replace(/-/g, '').replace(/\./g, '').trim();
                let urlStr = `https://viacep.com.br/ws/${cep}/json/`;
                $.ajax({
                    url: urlStr,
                    type: "GET",
                    dataType: "json",
                    success: (response_endereco) => {
                        if (response_endereco.logradouro)
                            this.rua = response_endereco.logradouro;
                        if (response_endereco.uf)
                            this.estado = response_endereco.uf;
                        if (response_endereco.localidade)
                            this.cidade = response_endereco.localidade;
                        if (response_endereco.bairro)
                            this.bairro = response_endereco.bairro;
                        this._carregarEdicaoEndereco();
                        $("#carrinho-endereco-numero").focus();
                    },
                    error: (erro) => {
                        toastr.error('Não foi possível localizar automaticamente, por favor, tente novamente ou preencha manualmente.', 'Erro CEP');
                    }
                });
            },
            get id() {
                return this._id;
            },
            set id(value) {
                this._id = value;
            },
            get rua() {
                return this._rua ? this._rua : '';
            },
            set rua(value) {
                this._rua = value;
            },
            get estado() {
                return this._estado ? this._estado : '';
            },
            set estado(value) {
                this._estado = value;
            },
            get cidade() {
                return this._cidade ? this._cidade : '';
            },
            set cidade(value) {
                this._cidade = value;
            },
            get numero() {
                return this._numero ? this._numero : '';
            },
            set numero(value) {
                this._numero = value;
            },
            get complemento() {
                return this._complemento ? this._complemento : '';
            },
            set complemento(value) {
                this._complemento = value;
            },
            get bairro() {
                return this._bairro ? this._bairro : '';
            },
            set bairro(value) {
                this._bairro = value;
            },
            get apelido() {
                return this._apelido ? this._apelido : '';
            },
            set apelido(value) {
                this._apelido = value;
            },
            get is_principal() {
                return this._is_principal;
            },
            set is_principal(value) {
                this._is_principal = value;
            },
            get template_novo_endereco() {
                return `
                <div class="row m-0">
                    <div class="col-12 col-sm-4 pb-2">
                        <input id="carrinho-endereco-cep" type="text" placeholder="CEP" value="${this.cep}" style="height:40px;" onchange="carrinho.instance.endereco.cep = this.value" onkeyup="$(this).mask('99.999-999');" class="form-control input-padrao font-weight-semibold cep">
                    </div>
                    <div class="col-6 col-sm-4 pb-2">
                        <input id="carrinho-endereco-estado" type="text" disabled placeholder="Estado" value="${this.estado}" onchange="carrinho.instance.endereco.estado = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-6 col-sm-4 pb-2">
                        <input id="carrinho-endereco-cidade" type="text" disabled placeholder="Cidade" value="${this.cidade}" onchange="carrinho.instance.endereco.cidade = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-12 col-sm-8 pb-2">
                        <input id="carrinho-endereco-rua" type="text" placeholder="Rua" value="${this.rua}" style="height:40px;" onchange="carrinho.instance.endereco.rua = this.value" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-4 col-sm-4 pb-2">
                        <input id="carrinho-endereco-numero" type="text" placeholder="Número" value="${this.numero}" onchange="carrinho.instance.endereco.numero = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-4 col-sm-6 pb-2">
                        <input id="carrinho-endereco-complemento" type="text" placeholder="Complemento" value="${this.complemento}" onchange="carrinho.instance.endereco.complemento = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-4 col-sm-6 pb-2">
                        <input id="carrinho-endereco-bairro" type="text" placeholder="Bairro" value="${this.bairro}" onchange="carrinho.instance.endereco.bairro = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-6 col-sm-12 pb-2">
                        <input id="carrinho-endereco-apelido" type="text" placeholder="Nome do endereço (ex: Casa, Trabalho)" value="${this.apelido}" onchange="carrinho.instance.endereco.apelido = this.value" style="height:40px;" class="form-control input-padrao font-weight-semibold">
                    </div>
                    <div class="col-6">
                        <div>
                            <div class="switch">
                                <label>
                                    <input  tabindex="0" name="is_principal" ${this.is_principal ? 'checked' : ''} value="${this.is_principal ? 'on' : false}" onchange="carrinho.instance.endereco.is_principal = this.value" id="carrinho-endereco-padrao" type="checkbox" class="d-none">
                                    <span class="ml-0 lever"></span>
                                </label>
                            </div>
                            <label for="carrinho-endereco-padrao" class="small font-weight-semibold">Definir padrão</label>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 d-flex align-items-center justify-content-between">
                        <a tabindex="0" onclick="carrinho.instance.endereco._salvarEndereco()" class="btn botaoPrincipal text-white font-weight-semibold px-5" id="carrinho-salvar-endereco">Salvar Endereço</a>
                    </div>
                </div>
            `;
            },
        }
        EnderecoComponent.prototype._carregarEnderecos = function () {
            load("on", $(".asidebar"));
            $.ajax({
                type: "POST",
                url: "/cliente/endereco/atualizar",
                data: {
                    "csrfmiddlewaretoken": "ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw",
                },
                success: (data) => {
                    load("off", $(".asidebar"));
                    this.enderecos = data.enderecos;
                    if(data.enderecos && data.enderecos.length){
                        let end = data.enderecos[0]
                        $('[data-target="endereco-cliente"]').html(`
                            ${end.endereco}, ${end.numero} - ${end.cep__municipio__nome}/${end.cep__municipio__uf__nm_abrev}
                        `)
                    } else if (data.enderecos.length === 0) {
                        this._limparCamposEndereco();
                        this._carregarEdicaoEndereco();
                        $('#carrinho-voltar-endereco').addClass('hidden')
                    }
                },
                error: (data) => {
                    load("off", $(".asidebar"));
                    toastr.error("Ocorreu um erro inesperado ao atualizar os endereços.", "Erro ao enviar");
                }
            });
        },
        EnderecoComponent.prototype._limparCamposEndereco = function () {
            this.id = '';
            this._cep = '';
            this.rua = '';
            this.estado = '';
            this.cidade = '';
            this.numero = '';
            this.complemento = '';
            this.bairro = '';
            this.apelido = '';
            this.is_principal = false;
        },


        EnderecoComponent.prototype._salvarEndereco = function () {
            
            //Verificar campos obrigatórios
            var campos = [
            {selector: '#carrinho-endereco-rua', valor: this.rua},
            {selector: '#carrinho-endereco-numero', valor: this.numero},
            {selector: '#carrinho-endereco-bairro', valor: this.bairro}
            ];

            var campoVazioEncontrado = false;

            $.each(campos, function(index, campo) {
            if (campo.valor === '') {
                $(campo.selector).addClass('border-danger');
                campoVazioEncontrado = true;
            } else {
                $(campo.selector).removeClass('border-danger');
            }
            });

            if (campoVazioEncontrado) {
            return toastr.warning('Há campos que precisam ser preenchidos.');
            }

            // form.addClass('was-validated');
            load('on', $('#popupEndereco'));
            // if (this.checkValidity()) {
            $.ajax({
                url: "/cliente/endereco/cadastrar",
                type: "POST",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    endereco_id: this.id,
                    cep: this.cep,
                    rua: this.rua,
                    numero: this.numero,
                    complemento: this.complemento,
                    bairro: this.bairro,
                    nome: this.apelido,
                    is_principal: this.is_principal
                },
                success: (data) => {
                    load("off", $("#popupEndereco"));
                    this._carregarEnderecos();
                    this.ultimo_editado_criado = data.endereco_id;
                },


                error: function (data) {
                    load("off", $("#popupEndereco"));
                }
            });
            // }
        },
        EnderecoComponent.prototype._carregarEdicaoEndereco = function () {
            $('#carrinho-voltar-endereco').removeClass('hidden');
            $('#carrinho-enderecos').html(this.template_novo_endereco);
            $('#carrinho-novo-endereco').addClass('d-none');
        },
        EnderecoComponent.prototype._carregarTemplate = function () {
            $('#carrinho-enderecos').html(this.template);
            $('[data-target="carrinho-endereco-resumo"]').html(this.value && this.value.endereco_completo ? this.value.endereco_completo : '');
            $('#carrinho-voltar-endereco').addClass('hidden');

            $('#carrinho-novo-endereco').removeClass('d-none').on('click', () => {
                this._limparCamposEndereco();
                this._carregarEdicaoEndereco();
            });
        }

        function Convenio(tipo, _pagamento) {
            this.tipo = tipo;
            this._pagamento = _pagamento;
            this.id = null;
            this._getConvenios();
        }
        Convenio.prototype = {
            get convenios(){
                return this._convenios;
            },
            set convenios(value){
                this._convenios = value;
            },
            get convenio(){
                return this._convenio;
            },
            set convenio(value) {
                if(value && this.convenios && this.convenios.length){
                    let convenio_selecionado = this.convenios.filter((convenio) => { return convenio.id == value })
                    if(convenio_selecionado.length){
                        this._convenio = convenio_selecionado[0]
                    }
                }
            },
            get parcelas() {
                return this._parcelas;
            },
            set parcelas(value){
                this._parcelas = value;
            },
            get parcela(){
                return this._parcela;
            },
            set qtd_parcelas(value){
                if(this._pagamento)
                    this._pagamento._qtd_parcelas = value
                this._qtd_parcelas = value;
            },
            get qtd_parcelas(){
                return this._qtd_parcelas;
            },
            set parcela(value){
                if(this._pagamento)
                    this._pagamento._qtd_parcelas = value
                if(this.parcelas && Object.keys(this.parcelas).length){
                    if(this.parcelas[value] && this.parcelas[value]["1"] && this.parcelas[value]["1"].valor){
                        if(parseFloat(this.parcelas[value]["1"].valor) <= parseFloat(this.convenio && this.convenio.saldo ? this.convenio.saldo : 0)){
                            this._parcela = value
                        } else {
                            this._parcela = null
                            toastr.warning('Selecione uma parcela que se encaixe no saldo do seu convênio de acordo com o valor total dos produtos que possuem cobertura.')
                        }
                    } else {
                        this._parcela = null
                    }
                } else {
                    this._parcela = null
                }
            },
            get is_pagamento_incompleto(){
                return this._is_pagamento_incompleto;
            },
            set is_pagamento_incompleto(value){
                this._is_pagamento_incompleto = value;
            },
            get produtos_disponiveis(){
                return this._produtos_disponiveis;
            },
            set produtos_disponiveis(value){
                this._produtos_disponiveis = value
            },
            get produtos_indisponiveis(){
                return this._produtos_indisponiveis;
            },
            set produtos_indisponiveis(value){
                this._produtos_indisponiveis = value
            },
            get vlr_convenio(){
                return this._vlr_convenio ? this._vlr_convenio : 0;
            },
            set vlr_convenio(value){
                this._vlr_convenio = value;
            },
            get vlr_restante(){
                return this._vlr_restante;
            },
            set vlr_restante(value){
                this._vlr_restante = value;
            },
            get request_parcelas_completo(){
                return this._request_parcelas_completo;
            },
            set request_parcelas_completo(value){
                this._request_parcelas_completo = value
            },
            get convenio_storage(){
                if(carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pagamento && carrinho.instance._getCarrinho().pagamento._infoPagamento){
                    return carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pagamento && carrinho.instance._getCarrinho().pagamento._infoPagamento;
                }
                return null;
            },
            get template_convenios(){
                let html_convenios = ``
                if(this.convenios && this.convenios.length){
                    $(this.convenios).each((chave, convenio) => {
                        html_convenios += `
                            <option value="${convenio.id}" ${convenio.id == this.id ? 'selected' : ''}>${convenio.clube_nome} - (${convenio.saldo ? 'R$' + parseFloat(convenio.saldo ? convenio.saldo : 0).toLocaleFixed(2) : ``})</option>
                        `
                    });
                } else {
                    html_convenios = `<option value="-1" disabled selected>Nenhum convênio disponível</option>`
                }

                return html_convenios
            },
            get template_parcelas(){
                let html_parcelas = ``
                let _this = this
                let _carrinho = carrinho.instance
                if(this.parcelas && Object.keys(this.parcelas).length){
                    $.each(this.parcelas, function(parcela, parcelas){

                        let vlr_total = 0
                        let html_parcela = parcela && +parcela > 1 ? `<p>${parcela}x sem juros</p>` : `<p>À vista</p>`
                        html_parcela += `breakRow`

                        if(parcelas && Object.keys(parcelas).length){
                            $.each(parcelas, function(quantidade, valor){
                                html_parcela += `breakRow`
                                if(parcela && +parcela > 1){
                                    html_parcela += `
                                        <p>${quantidade}º parcela de R$ ${valor && valor.valor ? parseFloat(valor.valor).toLocaleFixed(2) : ''}</p>
                                        breakRow
                                    `
                                }
                                vlr_total += parseFloat(valor.valor ? valor.valor : 0)
                            })
                        }

                        _this._vlr_convenio = vlr_total
                        _carrinho._vlr_total_convenio = vlr_total

                        if(!_this.parcela && +parcela === 1){
                            _this.parcela = parcela
                        }

                        html_parcela += `
                            breakRow
                            <p><b>Total a pagar: R$ ${parseFloat(vlr_total ? vlr_total : 0).toLocaleFixed(2)}</b></p>
                        `

                        html_parcelas += `<option value="${parcela}">${html_parcela}</option>`
                    })
                } else {
                    html_parcelas = `<option value="-1" disabled selected>Nenhuma parcela disponível</option>`
                }

                return html_parcelas
            },
            get template() {
                return `
                    <p class="blueText font-weight-bold mt-3">
                        Seus convênios
                    </p>
                    <div class="row">
                        <div class="col-12 pb-2">
                            <fieldset>
                                <select required onchange="carrinho.instance.pagamento._setConvenio(this.value);carrinho.instance._setCarrinho();" class="input-padrao" name="carrinho-parcelas" tabindex="-1">
                                    ${this.template_convenios ? this.template_convenios : ''}
                                </select>
                            </fieldset>
                        </div>
                    </div>
                    <p class="blueText font-weight-bold mt-3">
                        Parcelas
                    </p>
                    <div class="row">
                        <div class="col-12 pb-2">
                            <fieldset>
                                <select required onchange="carrinho.instance.pagamento._setConvenioParcela(this.value);carrinho.instance._setCarrinho();" class="input-padrao" name="carrinho-parcelas" tabindex="-1">
                                    ${this.template_parcelas ? this.template_parcelas : ''}
                                </select>
                            </fieldset>
                        </div>
                    </div>
                    ${ this.is_pagamento_incompleto && this.produtos_indisponiveis.length ? `
                        <div class="row">
                            <div class="col-12 px-3">
                                <p class="text-danger font-weight-bold mt-2">
                                    ${ this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos.pagamento_dividido_selecionado ? `
                                        O convênio selecionado não cobre todos os produtos da sua cesta. Adicione uma nova opção de pagamento para ${ this.produtos_indisponiveis.length === 1 ? this.produtos_indisponiveis.length + ' produto'  : this.produtos_indisponiveis.length + ' produtos' } no valor de R$ ${ this.vlr_restante ? parseFloat(this.vlr_restante).toLocaleFixed(2) : 0}
                                    ` : `
                                        O convênio selecionado não cobre todos os produtos da sua cesta. Utilize a opção "Pagamento Dividido" acima e adicione uma nova opção de pagamento para ${ this.produtos_indisponiveis.length === 1 ? this.produtos_indisponiveis.length + ' produto'  : this.produtos_indisponiveis.length + ' produtos' } no valor de R$ ${ this.vlr_restante ? parseFloat(this.vlr_restante).toLocaleFixed(2) : 0}
                                    ` }
                                </p>
                            </div>
                        </div>
                    ` : '' }
                    ${ this.request_parcelas_completo && (!this.parcelas || !Object.keys(this.parcelas).length) && this.is_pagamento_incompleto === false  ? `
                        <div class="row">
                            <div class="col-12 px-3">
                                <p class="text-danger font-weight-bold mt-2">
                                    O convênio selecionado não cobre nenhum produto da sua cesta
                                </p>
                            </div>
                        </div>
                    ` : ``}
                `;
            }
        }
        Convenio.prototype._getConvenios = function() {

            if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos.pagamento_dividido_selecionado){
                load('on', $('#modal_multiplos_pagamentos'));
            } else {
                load('on', $('.asidebar'));
            }

            $.ajax({
                type: "POST",
                url: "/clube/buscar/convenios",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success:  (response) => {
                    if(response.status){

                        this.convenios = response.convenios

                        if(response.convenios && response.convenios.length){

                            this.id = response.convenios[0].id

                            /*
                            if(!this.id){
                                if(this.convenio_storage.id === 'convenio' && this.convenio_storage.convenio){
                                    this.id = this.convenio_storage.convenio.id
                                } else {
                                    this.id = response.convenios[0].id
                                }
                            }

                            if(!this.convenio){
                                if(this.convenio_storage.id === 'convenio' && this.convenio_storage.convenio){
                                    this.convenio = this.convenio_storage.convenio.id
                                } else {
                                    this.convenio = response.convenios[0].id
                                }
                            }
                            */

                            this._getParcelas()

                        } else {

                            load('off', $('.asidebar'));
                            load('off', $('#modal_multiplos_pagamentos'));

                            this.id = null
                        }

                        if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos.pagamento_dividido_selecionado){
                            this._pagamento._pagamentos._carregarTemplatePagamentoDividido();
                        } else {
                            this._pagamento._pagamentos._carregarTemplate();
                        }

                    } else {
                        toast.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao exibir seus convênios.')
                    }
                },
                error:  (response) => {
                    load('off', $('.asidebar'));
                    load('off', $('#modal_multiplos_pagamentos'));
                    toastr.error('Ocorreu um erro interno ao exibir seus convênios.')
                },
            })
        }
        Convenio.prototype._getParcelas = function() {

            this.request_parcelas_completo = false

            if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos.pagamento_dividido_selecionado){
                load('on', $('#modal_multiplos_pagamentos'));
            } else {
                load('on', $('.asidebar'));
            }

            const carrinhoPacotes = _.cloneDeep(carrinho.instance.pacotes)
            const pacotes = [];

            if(carrinhoPacotes && carrinhoPacotes.length){
                for (const pacote of carrinhoPacotes) {
                    const _pacote = _.cloneDeep(pacote)
                    delete _pacote._carrinho;
                    delete _pacote.filial;
                    delete _pacote.entregas;
                    delete _pacote.carrinhoStorage;
                    delete _pacote.mensagem;
                    delete _pacote.mensagemStorage;
                    delete _pacote.template;

                    const produtos = [];
                    for (const produto of pacote.produtos) {
                        const _produto = _.cloneDeep(produto)
                        delete _produto._pacote;
                        produtos.push(_produto);
                    }
                    _pacote.produtos = produtos;

                    const _produtos = [];
                    for (const produto of pacote._produtos) {
                        const _produto = _.cloneDeep(produto)
                        delete _produto._pacote;
                        _produtos.push(_produto);
                    }
                    _pacote._produtos = _produtos;

                    const entrega = _.cloneDeep(_pacote.entrega)
                    delete entrega.value;
                    delete entrega._pacote;
                    delete entrega.entregasDoTipo;
                    delete entrega._entregasDoTipo;
                    delete entrega.entregas;
                    delete entrega._tipo_entrega;
                    delete entrega.filial;
                    delete entrega.template;

                    _pacote.entrega = entrega;

                    const entregaValor = _pacote.entrega && _pacote.entrega._value ? _.cloneDeep(_pacote.entrega._value) : null;
                    entregaValor ? delete entregaValor._entrega_component : null;

                    _pacote.entrega._value = entregaValor;

                    if (_pacote.entrega._value.entrega_complemento) {
                        const entregaComplemento = _.cloneDeep(_pacote.entrega._value.entrega_complemento)
                        delete entregaComplemento._entrega;

                        _pacote.entrega._value.entrega_complemento = entregaComplemento;
                    }
                    pacotes.push(_pacote);
                }
            }

            this.convenio = this.id

            let _this = this
            let _convenio = this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos._getPagamentoFromId('convenio')
            let clube = this.convenios.filter((c) => { return c.id == this.id })

            $.ajax({
                type: "POST",
                url: "/clube/buscar/parcelas",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'clube': clube && clube.length ? clube[0].clube_id : '',
                    'pacotes': JSON.stringify(pacotes),
                },
                success:  (response) => {
                    if(response.status){

                        if(response.parcelas && Object.keys(response.parcelas).length){
                            
                            $.each(response.parcelas, function(id, clube){
                                _this.parcelas = clube.parcelas
                                _this.is_pagamento_incompleto = clube.is_pagamento_incompleto
                                _this.vlr_restante = clube.vlr_restante;
                                _this.produtos_disponiveis = clube.produtos_disponiveis
                                _this.produtos_indisponiveis = clube.produtos_indisponiveis
                            })

                            _this.qtd_parcelas = 1
                            
                        } else {

                            _this.parcelas = []
                            _this.is_pagamento_incompleto = false
                            _this.produtos_disponiveis = []
                            _this.produtos_indisponiveis = []
                            _this.vlr_restante = 0

                            if(!_this._pagamento || !_this._pagamento._pagamentos || !_this._pagamento._pagamentos.pagamento_dividido_selecionado){
                                let pagamentos = _this._pagamento._pagamentos.meus_pagamentos.concat(_this._pagamento._pagamentos.tipos_pagamento)
                                if(pagamentos && pagamentos.length){
                                    pagamentos.map((pagamento) => {
                                        if(pagamento.id != 'convenio'){
                                            pagamento.selecionado = false;
                                        }
                                    })
                                }
                            }

                            _this.vlr_dividido = 0
                        }

                        _this.request_parcelas_completo = true

                        if(_this._pagamento && _this._pagamento._pagamentos && _this._pagamento._pagamentos.pagamento_dividido_selecionado){
                            if(_convenio)
                                _convenio.vlr_dividido =  _this.vlr_restante || (response.parcelas && Object.keys(response.parcelas).length && _this.vlr_restante === 0) ? ((_this._pagamento._pagamentos._carrinho ? _this._pagamento._pagamentos._carrinho.vlr_subtotal : 0) + _this._pagamento._pagamentos._carrinho.vlr_frete) - _this.vlr_restante : 0
                            _this._pagamento._pagamentos._carregarTemplatePagamentoDividido();
                        } else {
                            if(_convenio)
                                _convenio.vlr_dividido = 0
                            _this._pagamento._pagamentos._carregarTemplate();
                        }

                    } else {
                        _this.request_parcelas_completo = false;
                        toast.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao exibir as parcelas do convênio selecionado.')
                    }
                    load('off', $('.asidebar'));
                    load('off', $('#modal_multiplos_pagamentos'));
                },
                error:  (response) => {
                    load('off', $('.asidebar'));
                    load('off', $('#modal_multiplos_pagamentos'));
                    toastr.error('Ocorreu um erro interno ao exibir as parcelas do convênio selecionado.')
                },
            })
        }

        function FolhaPagamento(tipo, _pagamento){
            this.tipo = tipo;
            this._pagamento = _pagamento;
            this.id = null;
            setTimeout(() => {
                this._getParcelas()
            });
        }
        FolhaPagamento.prototype = {
            get parcelas() {
                return this._parcelas;
            },
            set parcelas(value){
                this._parcelas = value;
            },
            get parcela(){
                return this._parcela;
            },
            set qtd_parcelas(value){
                if(this._pagamento)
                    this._pagamento._qtd_parcelas = value
                this._qtd_parcelas = value;
            },
            get qtd_parcelas(){
                return this._qtd_parcelas;
            },
            set parcela(value){
                if(this._pagamento)
                    this._pagamento._qtd_parcelas = value
                if(this.parcelas && Object.keys(this.parcelas).length){
                    if(this.parcelas[value] && this.parcelas[value]["1"] && this.parcelas[value]["1"].valor){
                        this._parcela = value
                    } else {
                        this._parcela = null
                    }
                } else {
                    this._parcela = null
                }
            },
            get is_pagamento_incompleto(){
                return this._is_pagamento_incompleto;
            },
            set is_pagamento_incompleto(value){
                this._is_pagamento_incompleto = value;
            },
            get produtos_disponiveis(){
                return this._produtos_disponiveis;
            },
            set produtos_disponiveis(value){
                this._produtos_disponiveis = value
            },
            get produtos_indisponiveis(){
                return this._produtos_indisponiveis;
            },
            set produtos_indisponiveis(value){
                this._produtos_indisponiveis = value
            },
            get vlr_folha_pagamento(){
                return this._vlr_folha_pagamento ? this._vlr_folha_pagamento : 0;
            },
            set vlr_folha_pagamento(value){
                this._vlr_folha_pagamento = value;
            },
            get vlr_restante(){
                return this._vlr_restante;
            },
            set vlr_restante(value){
                this._vlr_restante = value;
            },
            get folha_pagamento_storage(){
                if(carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pagamento && carrinho.instance._getCarrinho().pagamento._infoPagamento){
                    return carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pagamento && carrinho.instance._getCarrinho().pagamento._infoPagamento;
                }
                return null;
            },
            get template_parcelas(){
                let html_parcelas = ``
                let _this = this
                let _carrinho = carrinho.instance
                let parcela_atual = this._pagamento._pagamentos._getPagamentoFromId('folha_pagamento') && this._pagamento._pagamentos._getPagamentoFromId('folha_pagamento').parcela ? this._pagamento._pagamentos._getPagamentoFromId('folha_pagamento').parcela : ''
                if(this.parcelas && Object.keys(this.parcelas).length){
                    $.each(this.parcelas, function(parcela, parcelas){

                        let vlr_total = 0
                        let html_parcela = parcela && +parcela > 1 ? `<p>${parcela}x sem juros</p>` : `<p>À vista</p>`
                        html_parcela += `breakRow`

                        if(parcelas && Object.keys(parcelas).length){
                            $.each(parcelas, function(quantidade, valor){
                                html_parcela += `breakRow`
                                if(parcela && +parcela > 1){
                                    html_parcela += `
                                        <p>${quantidade}º parcela de R$ ${valor && valor.valor ? parseFloat(valor.valor).toLocaleFixed(2) : ''}</p>
                                        breakRow
                                    `
                                }
                                vlr_total += parseFloat(valor.valor ? valor.valor : 0)
                            })
                        }

                        _this._vlr_folha_pagamento = vlr_total
                        _carrinho._vlr_total_folha_pagamento = vlr_total

                        if(!_this.parcela && +parcela === 1){
                            _this.parcela = parcela
                        }

                        html_parcela += `
                            breakRow
                            <p><b>Total a pagar: R$ ${parseFloat(vlr_total ? vlr_total : 0).toLocaleFixed(2)}</b></p>
                        `

                        html_parcelas += `<option ${parcela_atual == parcela ? "selected" : ""} value="${parcela}">${html_parcela}</option>`
                    })
                } else {
                    html_parcelas = `<option value="-1" disabled selected>Nenhuma parcela disponível</option>`
                }
                return html_parcelas
            },
            get template() {
                return `
                    <p class="blueText font-weight-bold mt-3">
                        Parcelas
                    </p>
                    <div class="row">
                        <div class="col-12 pb-2">
                            <fieldset>
                                <select required onchange="carrinho.instance.pagamento._setFolhaPagamentoParcela(this.value);" class="input-padrao" name="carrinho-parcelas" id='parcelas_folha_pagamento' tabindex="-1">
                                    ${this.template_parcelas ? this.template_parcelas : ''}
                                </select>
                            </fieldset>
                        </div>
                    </div>
                    ${ this.is_pagamento_incompleto && this.produtos_indisponiveis.length ? `
                        <div class="row">
                            <div class="col-12 px-3">
                                <p class="text-danger font-weight-bold mt-2">
                                    A folha de pagamento não cobre todos os produtos da sua cesta. Utilize a opção "Pagamento Dividido" acima e selecione uma nova opção de pagamento para ${ this.produtos_indisponiveis.length === 1 ? this.produtos_indisponiveis.length + ' produto'  : this.produtos_indisponiveis.length + ' produtos' } no valor de R$ ${ this.vlr_restante ? parseFloat(this.vlr_restante).toLocaleFixed(2) : 0}
                                </p>
                            </div>
                        </div>
                    ` : '' }
                `;
            }
        }
        FolhaPagamento.prototype._getParcelas = function() {

            if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos.pagamento_dividido_selecionado){
                load('on', $('#modal_multiplos_pagamentos'));
            } else {
                load('on', $('.asidebar'));
            }

            let carrinhoPacotes
            if (!carrinho.instance) {
                carrinhoPacotes = []
            }else{
                carrinhoPacotes = _.cloneDeep(carrinho.instance.pacotes)
            }
            const pacotes = [];

            if(carrinhoPacotes && carrinhoPacotes.length){
                for (const pacote of carrinhoPacotes) {
                    const _pacote = _.cloneDeep(pacote)
                    delete _pacote._carrinho;
                    delete _pacote.filial;
                    delete _pacote.entregas;
                    delete _pacote.carrinhoStorage;
                    delete _pacote.mensagem;
                    delete _pacote.mensagemStorage;
                    delete _pacote.template;

                    const produtos = [];
                    for (const produto of pacote.produtos) {
                        const _produto = _.cloneDeep(produto)
                        delete _produto._pacote;
                        produtos.push(_produto);
                    }
                    _pacote.produtos = produtos;

                    const _produtos = [];
                    for (const produto of pacote._produtos) {
                        const _produto = _.cloneDeep(produto)
                        delete _produto._pacote;
                        _produtos.push(_produto); 
                    }
                    _pacote._produtos = _produtos;

                    const entrega = _.cloneDeep(_pacote.entrega)
                    delete entrega.value;
                    delete entrega._pacote;
                    delete entrega.entregasDoTipo;
                    delete entrega._entregasDoTipo;
                    delete entrega.entregas;
                    delete entrega._tipo_entrega;
                    delete entrega.filial;
                    delete entrega.template;

                    _pacote.entrega = entrega;

                    const entregaValor = _pacote.entrega && _pacote.entrega._value ? _.cloneDeep(_pacote.entrega._value) : null;
                    entregaValor ? delete entregaValor._entrega_component : null;

                    _pacote.entrega._value = entregaValor;

                    if (_pacote.entrega._value.entrega_complemento) {
                        const entregaComplemento = _.cloneDeep(_pacote.entrega._value.entrega_complemento)
                        delete entregaComplemento._entrega;

                        _pacote.entrega._value.entrega_complemento = entregaComplemento;
                    }
                    pacotes.push(_pacote);
                }
            }

            this.folha_pagamento = this.id

            let _this = this
            let _folha_pagamento = this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos._getPagamentoFromId('folha_pagamento')

            $.ajax({
                type: "POST",
                url: "/clube/buscar/parcelas",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'clube': "funcionario",
                    'pacotes': JSON.stringify(pacotes),
                },
                success:  (response) => {
                    if(response.status){

                        if(response.parcelas && Object.keys(response.parcelas).length){

                            $.each(response.parcelas, function(id, clube){
                                _this.parcelas = clube.parcelas
                                _this.is_pagamento_incompleto = clube.is_pagamento_incompleto
                                _this.vlr_restante = clube.vlr_restante;
                                _this.produtos_disponiveis = clube.produtos_disponiveis
                                _this.produtos_indisponiveis = clube.produtos_indisponiveis
                            })

                            _this.qtd_parcelas = 1

                        } else {

                            _this.parcelas = []
                            _this.is_pagamento_incompleto = false
                            _this.produtos_disponiveis = []
                            _this.produtos_indisponiveis = []
                            _this.vlr_restante = 0

                            if(!_this._pagamento || !_this._pagamento._pagamentos || !_this._pagamento._pagamentos.pagamento_dividido_selecionado){
                                let pagamentos = _this._pagamento._pagamentos.meus_pagamentos.concat(_this._pagamento._pagamentos.tipos_pagamento)
                                if(pagamentos && pagamentos.length){
                                    pagamentos.map((pagamento) => {
                                        if(pagamento.id != 'folha_pagamento'){
                                            pagamento.selecionado = false;
                                        }
                                    })
                                }
                            }

                            _this.vlr_dividido = 0
                        }

                        if(_this._pagamento && _this._pagamento._pagamentos && _this._pagamento._pagamentos.pagamento_dividido_selecionado){
                            if(_folha_pagamento)
                                _folha_pagamento.vlr_dividido =  _this.vlr_restante || (response.parcelas && Object.keys(response.parcelas).length && _this.vlr_restante === 0) ? ((_this._pagamento._pagamentos._carrinho ? _this._pagamento._pagamentos._carrinho.vlr_subtotal : 0) + _this._pagamento._pagamentos._carrinho.vlr_frete) - _this.vlr_restante : 0
                            _this._pagamento._pagamentos._carregarTemplatePagamentoDividido();
                        } else {
                            if(_folha_pagamento)
                                _folha_pagamento.vlr_dividido = 0
                            _this._pagamento._pagamentos._carregarTemplate();
                        }

                    } else {
                        toast.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao exibir as parcelas por folha de pagamentos.')
                    }
                    load('off', $('.asidebar'));
                    load('off', $('#modal_multiplos_pagamentos'));
                },
                error:  (response) => {
                    load('off', $('.asidebar'));
                    load('off', $('#modal_multiplos_pagamentos'));
                    toastr.error('Ocorreu um erro interno ao exibir as parcelas por folha de pagamentos.')
                },
            })
        }

        function Cartao(tipo, _pagamento) {
            this.tipo = tipo;
            this.pagamento = _pagamento;
            this._submit = false;
            this.doPay = this.doPay.bind(this);                                                             
            this.sdkResponseHandler = this.sdkResponseHandler.bind(this);
            this.construirFormMP = this.construirFormMP.bind(this);
            this._status = false;
        }

        Cartao.prototype = {
            get submit() {
                return this._submit;
            },
            set submit(value) {
                if (value === true) {
                    load('on', $('.asidebar'));
                } else {
                    load('off', $('.asidebar'));
                }
                this._submit = value;
            },
        get template() {
            return `
            <form id="pay" novalidate= name="pay">
                <div class="card">
                    <div class="card-header bg-white mb-1" style="border-bottom: 2px solid var(--light);">
                        <p class="blueText font-weight-bold">
                            Adicionar novo Cartão
                        </p>
                    </div>
                    <div class="card-body">
                        <p class="font-sm blueText font-weight-semibold">
                            *Compras no crédito são efetuadas pelo mercado pago.
                        </p>
                        <div class="row">

                            <div class="col-12 pb-2">
                                <div id="cardNumber" class="input-padrao form-control p-2" style="height: 40px !important"></div>
                            </div>

                            <div class="col-6 pb-2">
                                <div id="expirationDate" class="input-padrao form-control p-2" style="height: 40px !important"></div>
                            </div>

                            <div class="col-6 pb-2">
                                <div id="securityCode" class="input-padrao form-control p-2" style="height: 40px !important"></div>
                            </div>

                            <div class="col-12 pb-2">
                                <input id="cardholder-name" type="text" placeholder="Nome impresso no cartão" class="input-padrao form-control text-uppercase font-weight-semibold" style="height:40px; color: #5e5d5d;" required>
                                <div class="small text-danger invalid"></div>
                            </div>

                            <div class="col-12 pb-2">
                                <input id="carrinho-cartao-cpf_titular" type="text" placeholder="CPF/CNPJ" class="input-padrao form-control font-weight-semibold" required style="height:40px; color: #5e5d5d;">
                                <div class="small text-danger invalid"></div>
                            </div>

                            <div class="col-12 pb-2">
                                <div class="check-ecomm">
                                    <input type="checkbox" class="form-control" id="is-salvar-cartao" name="is-salvar-cartao" checked>
                                    <label for="is-salvar-cartao" class="font-sm font-weight-medium text-label">
                                        Deseja salvar o cartão para compras futuras?
                                    </label>
                                </div>
                            </div>

                            <div class="form-group-float d-none">
                                <select id="docType" class="input-padrao form-control" tabindex="-1" aria-hidden="true">
                                    <option value="CPF">CPF</option>
                                    <option value="CNPJ">CNPJ</option>
                                </select>
                            </div>

                            <div class="form-group-float d-none">
                                <input id="card-number" type="text" placeholder="0000 0000 0000 0000" class="input-padrao form-control font-weight-semibold" style="height:40px;" minlength="19" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off" maxlength="19">
                                <div class="small text-danger invalid"></div>
                            </div>

                            <div class="form-group-float d-none">
                                <input id="carrinho-cartao-validade" placeholder="MM/AA" type="text" class="input-padrao font-weight-semibold form-control" style="height:40px;" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off" maxlength="5">
                                <div class="small text-danger invalid"></div>
                            </div>

                            <div class="form-group-float d-none">
                                <input id="security-code" type="text" class="form-control input-padrao font-weight-semibold" placeholder="000" style="height:40px;" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off" maxlength="3">
                                <div class="small text-danger invalid"></div>
                            </div>

                            <div class="form-group-float d-none">
                                <input type="text" class="input-padrao form-control" id="cardExpirationMonth" data-checkout="cardExpirationMonth" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off">
                            </div>

                            <div class="form-group-float d-none">
                                <input type="text" class="input-padrao form-control" id="cardExpirationYear" data-checkout="cardExpirationYear" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off/">
                            </div>

                            <div class="col-12">
                                <a id="carrinho-salvar-cartao" class="btn botaoPrincipal text-white w-100 font-weight-semibold" onclick="carrinho.instance.pagamento.valueNotCashback.cartao.doPay()"> <article> Salvar Cartão </article> </a>
                            </div>

                        </div>
                    </div>
                </div>
            </form>`;
        }
    } 
        /*Cartao.prototype = {
            get submit() {
                return this._submit;
            },
            set submit(value) {
                if (value !== this._submit) {
                    if (value) {
                        if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos._pagamento_dividido_selecionado === 'on'){
                            load('on', $('#modal_multiplos_pagamentos')); 
                        } else {
                            load('on', $('.asidebar'));
                        }
                    } else {
                        if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos._pagamento_dividido_selecionado === 'on'){
                            load('off', $('#modal_multiplos_pagamentos')); 
                        } else {
                            load('off', $('.asidebar'));
                        }
                    }
                    this._submit = value;
                }
            },
            get bandeira() {
                return this._bandeira;
            },
            set bandeira(value){
                this._bandeira = value;
            },
            get pagamento() {
                return this._pagamento;
            },
            set pagamento(value){
                this._pagamento = value;
            },
            get template() {
                return `
                <form id="pay" novalidate name="pay">
                    <div class="card">
                        <div class="card-header bg-white mb-0" style="border-bottom: 2px solid var(--light);">
                            <p class="blueText font-weight-bold">
                                Adicionar novo Cartão
                            </p>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 pb-2">
                                    <input type="text" placeholder="0000 0000 0000 0000" class="input-padrao form-control font-weight-semibold" style="height:40px;" minlength="19" required="" id="number" name="number" data-checkout="number" autocomplete="off" maxlength="19">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-6 pb-2">
                                    <input id="carrinho-cartao-validade" name="carrinho-cartao-validade" placeholder="MM/AA" type="text" class="input-padrao font-weight-semibold form-control" required="" style="height:40px;" autocomplete="off" maxlength="5">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-6 pb-2">
                                    <input type="text" class="form-control input-padrao font-weight-semibold" placeholder="000" style="height:40px;" required="" id="securityCode" name="securityCode" data-checkout="securityCode" autocomplete="off" maxlength="4">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-12 pb-2">
                                    <input type="text" placeholder="Nome impresso no cartão" class="input-padrao form-control text-uppercase font-weight-semibold" style="height:40px;" required="" id="cardholderName" name="cardholderName" data-checkout="cardholderName">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-12 pb-2">
                                    <input type="text" id="carrinho-cartao-cpf_titular" name="carrinho-cartao-cpf_titular" placeholder="CPF/CNPJ" class="input-padrao form-control font-weight-semibold" required="" style="height:40px;">
                                    <input type="text" class="d-none" id="docNumber" name="docNumber" data-checkout="docNumber">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-12 pb-2">
                                    <div class="check-ecomm">
                                        <input type="checkbox" class="form-control" id="is-salvar-cartao" name="is-salvar-cartao" checked>
                                        <label for="is-salvar-cartao" class="font-sm font-weight-medium text-label">
                                            Deseja salvar o cartão para compras futuras?
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group-float d-none">
                                    <select id="docType" class="input-padrao form-control" data-checkout="docType" data-select2-id="docType" tabindex="-1" aria-hidden="true"><option value="CPF">CPF</option><option value="CNPJ">CNPJ</option></select><span class="select2 select2-container select2-container--bootstrap" dir="ltr" data-select2-id="5" style="width: auto;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-docType-container"><span class="select2-selection__rendered" id="select2-docType-container" role="textbox" aria-readonly="true" title="CPF">CPF</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                                </div>
                                <div class="form-group-float d-none">
                                    <input type="text" class="input-padrao form-control" id="cardExpirationMonth" data-checkout="cardExpirationMonth" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off">
                                </div>
                                <div class="form-group-float d-none">
                                    <input type="text" class="input-padrao form-control" id="cardExpirationYear" data-checkout="cardExpirationYear" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off/">
                                </div>

                                <div class="col-12">
                                    <button type="submit" id="carrinho-salvar-cartao" class="btn botaoPrincipal text-white w-100 font-weight-semibold"> Salvar Cartão </button>
                                </div>
                            </div>
                            <input type="hidden" name="payment_method_id" id="payment_method_id">
                        </div>
                    </div>
                </form>`;
            },
            get template_pagamento_dividido() {
                return `
                <form action="/processar_pagamento" method="post" id="pay-modal" novalidate="" name="pay-modal">
                    <div class="card">
                        <div class="card-header bg-white" style="border-bottom: 2px solid var(--light);">
                            <p class="blueText font-weight-bold">
                                Adicionar novo Cartão
                            </p>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12 pb-2">
                                    <input type="text" placeholder="0000 0000 0000 0000" class="input-padrao form-control font-weight-semibold" style="height:40px;" minlength="19" required="" id="number-modal" name="number-modal" data-checkout="number" autocomplete="off" maxlength="19">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-6 pb-2">
                                    <input id="carrinho-cartao-validade-modal" name="carrinho-cartao-validade-modal" placeholder="MM/AA" type="text" class="input-padrao font-weight-semibold form-control" required="" style="height:40px;" autocomplete="off" maxlength="5">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-6 pb-2">
                                    <input type="text" class="form-control input-padrao font-weight-semibold" placeholder="000" style="height:40px;" required="" id="securityCode-modal" name="securityCode-modal" data-checkout="securityCode" autocomplete="off" maxlength="4">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-12 pb-2">
                                    <input type="text" placeholder="Nome impresso no cartão" class="input-padrao form-control text-uppercase font-weight-semibold" style="height:40px;" required="" id="cardholderName-modal" name="cardholderName-modal" data-checkout="cardholderName">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="col-12 pb-2">
                                    <input type="text" id="carrinho-cartao-cpf_titular-modal" name="carrinho-cartao-cpf_titular-modal" placeholder="CPF/CNPJ" class="input-padrao form-control font-weight-semibold" required="" style="height:40px;">
                                    <input type="text" class="d-none" id="docNumber-modal" name="docNumber-modal" data-checkout="docNumber">
                                    <div class="small text-danger invalid"></div>
                                </div>

                                <div class="form-group-float d-none">
                                    <select id="docType-modal" class="input-padrao form-control" data-checkout="docType" data-select2-id="docType" tabindex="-1" aria-hidden="true"><option value="CPF">CPF</option><option value="CNPJ">CNPJ</option></select><span class="select2 select2-container select2-container--bootstrap" dir="ltr" data-select2-id="5" style="width: auto;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-docType-container"><span class="select2-selection__rendered" id="select2-docType-container" role="textbox" aria-readonly="true" title="CPF">CPF</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>
                                </div>
                                <div class="form-group-float d-none">
                                    <input type="text" class="input-padrao form-control" id="cardExpirationMonth-modal" data-checkout="cardExpirationMonth" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off">
                                </div>
                                <div class="form-group-float d-none">
                                    <input type="text" class="input-padrao form-control" id="cardExpirationYear-modal" data-checkout="cardExpirationYear" onselectstart="return false" onpaste="return false" oncopy="return false" oncut="return false" ondrag="return false" ondrop="return false" autocomplete="off/">
                                </div>

                                <div class="col-12">
                                    <button type="submit" id="carrinho-salvar-cartao-modal" class="btn botaoPrincipal text-white w-100 font-weight-semibold">Salvar Cartão</button>
                                </div>
                            </div>
                            <input type="hidden" name="payment_method_id" id="payment_method_id">
                        </div>
                    </div>
                </form>`;
            }
        }*/
        
        Cartao.prototype.getPaymentMethods = async function() {

            if(typeof(mp) === 'object'){
                let bin = cardnumber.substring(0, 8);
                let response = await mp.getPaymentMethods({ bin });
            }
        }

        /*Cartao.prototype.guessPaymentMethod = function() {

            let cardnumber = ''

            if(typeof(carrinho.instance) === 'object' && carrinho.instance.pagamento && carrinho.instance.pagamento._pagamento_dividido_selecionado === 'on'){
                cardnumber = $("#number-modal").val().split(' ').join('');
            } else {
                cardnumber = $("#number").val().split(' ').join('');
            }
            
            if (cardnumber.length >= 6) {
                let bin = cardnumber.substring(0, 6);
                
                // window.Mercadopago.getPaymentMethod({
                //     "bin": bin
                // }, setPaymentMethod);
            }
        }*/

        Cartao.prototype.doPay = async function(event) {

            if(!$('#pay')[0].checkValidity()){
                toastr.warning('Preencha os campos do cartão para prosseguir')
                return
            }

            if (event)
                event.preventDefault();
            
            if (!this.submit) {
                this.submit = true;

                //window.Mercadopago.clearSession()

                if(typeof(mp) === 'object'){
                    
                    let cardholderName = $('#cardholder-name').val()
                    let identificationType = $('#docType').val()
                    let identificationNumber = $("#carrinho-cartao-cpf_titular").val() ? $("#carrinho-cartao-cpf_titular").val().replace(/\./g, '').replace(/-/g, '').replace('\/', '') : $("#carrinho-cartao-cpf_titular").val()

                    let _token = await mp.fields.createCardToken({
                                    cardholderName,
                                    identificationType, 
                                    identificationNumber, 
                                });

                    if(_token && _token.id){
                        this.token = _token.id;
                        this.adicionarCartao();
                    } else {
                        this.submit = false;
                        toastr.error('Ocorreu um erro ao adicionar o cartão.')
                    }
                }

                //window.Mercadopago.createToken(document.querySelector('#pay'), carrinho.instance.pagamento.valueNotCashback.cartao.sdkResponseHandler);
                //return false;
            }
        }
        /*Cartao.prototype.doPay = function(event) {
            //event.preventDefault();
            var card = {} 
            card.card_holder_name = $("#pay #cardholderName").val()
            card.card_expiration_date = $("#pay #carrinho-cartao-validade").val().replace('/', '')
            card.card_number = $("#pay #number").val()
            card.card_cvv = $("#pay #securityCode").val()
    
            var cardValidations = pagarme.validate({card: card})
            if(!cardValidations.card.card_number || !cardValidations.card.card_holder_name || !cardValidations.card.card_cvv || !cardValidations.card.brand || !cardValidations.card.card_expiration_date){
                toastr.error("Informações do cartão inválidas", "Erro")
            }else{
                pagarme.client.connect({ encryption_key: 'ek_live_2m2HvzPUmGcDrmOKfhv1Ir3W0jspkW' })
                .then(client => client.security.encrypt(card))
                .then(card_hash => {
                    this.token = card_hash;
                    this.bandeira = cardValidations.card.brand;
                    this.adicionarCartao();
                    toastr.success("Cartão adicionado com sucesso!")
                })
                .catch(error => {
                    toastr.error("Erro ao enviar as informações do cartão!", "Erro")
                    console.error(error);
                });
            }
            return false
        }*/

        Cartao.prototype.sdkResponseHandler = function(status, response) {
            let numero_cartao = document.getElementById('card-number');
            let nome_titular = document.getElementById('cardholder-name');
            let data_vencimento = document.getElementById('carrinho-cartao-validade');
            let codigo_seguranca = document.getElementById('security-code');
            let cpf_titular = document.getElementById('carrinho-cartao-cpf_titular');

            setarInputInvalid(numero_cartao, '');
            setarInputInvalid(nome_titular, '');
            setarInputInvalid(data_vencimento, '');
            setarInputInvalid(codigo_seguranca, '');
            setarInputInvalid(cpf_titular, '');

            if (status !== 200 && status !== 201) {
                this.submit = false;
                for (let i = 0; i < response['cause'].length; i++) {
                    errosNoCartao(response['cause'][i].code);
                }
            } else {
                this.token = response.id;
                this.adicionarCartao();
            }
        }
        /*Cartao.prototype.sdkResponseHandler = function(status, response) {

            let numero_cartao = document.getElementById('number');
            let nome_titular = document.getElementById('cardholderName');
            let data_vencimento = document.getElementById('carrinho-cartao-validade');
            let codigo_seguranca = document.getElementById('securityCode');
            let cpf_titular = document.getElementById('carrinho-cartao-cpf_titular');

            setarInputInvalid(numero_cartao, '');
            setarInputInvalid(nome_titular, '');
            setarInputInvalid(data_vencimento, '');
            setarInputInvalid(codigo_seguranca, '');
            setarInputInvalid(cpf_titular, '');

            if (status !== 200 && status !== 201) {
                this.submit = false;
                for (let i = 0; i < response['cause'].length; i++) {
                    errosNoCartao(response['cause'][i].code);
                }
            } else {
                this.token = response.id;
                this.adicionarCartao();
            }
        }*/

        Cartao.prototype.adicionarCartao = function() {
            let _card = {}

            _card = {
                salvarCartao: $('#pay').find('#is-salvar-cartao').is(':checked')
            }

            $.ajax({
                type: "POST",
                url: "/pagamento/mercadopago/salvar/cartao",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'token_cartao': this.token,
                    'is_salvar': _card.salvarCartao,
                    'password': this.securityCode,
                    'tipo_id': this.tipo,
                },
                success: (data) => {
                    this.submit = false;
                    if (data.status) {
                        carrinho.instance.pagamento.cartao_adicionado = data.cartao_id;
                        carrinho.instance.pagamento.tokens_temporarios = data.cartao_id;
                        carrinho.instance.pagamento._carregarPagamentos();
                        if (carrinho.instance.pagamento.valueNotCashback) {
                            $('#carrinho-botao-finalizar').click();
                        }
                        this.desconstruirFormMP();
                    }
                    else {
                        toastr.error(data.descricao, 'Erro');
                    }
                },
                error: (data) => {
                    this.submit = false;
                }
            });
        }
        Cartao.prototype.construirFormMP = function() {

            if(typeof(mp) === 'object'){

                cardNumberElement = mp.fields.create('cardNumber', {
                    placeholder: "0000 0000 0000 0000",
                    style: {
                        height: "24px",
                        fontFamily: "MontSerrat",
                        color: "#5e5d5d",
                        fontWeight: "600",
                        fontSize: "14px",
                        placeholderColor: "#bbbcbd",
                        width: "100%",   
                    },
                    customFonts: [
                            {
                                src: "https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap",
                            },
                        ],

                }).mount('cardNumber');
                expirationMonthElement = mp.fields.create('expirationDate', {
                    placeholder: "MM/AA",
                    mode: "short",
                    style: {
                        height: "24px",
                        fontFamily: "MontSerrat",
                        color: "#5e5d5d",
                        fontWeight: "600",
                        fontSize: "14px",
                        placeholderColor: "#bbbcbd",
                        width: "100%",
                    },
                    customFonts: [
                            {
                                src: "https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap",
                            },
                        ],
                }).mount('expirationDate')
                securityCodeElement = mp.fields.create('securityCode', {
                    placeholder: "000",
                    style: {
                        height: "24px",
                        fontFamily: "MontSerrat",
                        color: "#5e5d5d",
                        fontWeight: "600",
                        fontSize: "14px",
                        placeholderColor: "#bbbcbd",
                        width: "100%",
                    },
                    customFonts: [
                            {
                                src: "https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap",
                            },
                        ],
                }).mount('securityCode')
                

                $('#carrinho-body').find('iframe').css('height', '40px');
            }

            setTimeout(() => {
                load('off', $('.asidebar'));
            }, 2000);
        }
        Cartao.prototype.desconstruirFormMP = function() {
            try {
                carrinho.instance.is_formulario_cartao_construido = false
                if(typeof(cardNumberElement) === 'object')
                    cardNumberElement.unmount()
                if(typeof(expirationMonthElement) === 'object')    
                    expirationMonthElement.unmount()
                if(typeof(securityCodeElement) === 'object')    
                    securityCodeElement.unmount()
                setTimeout(() => {
                    load('off', $('.asidebar'));
                }, 2500);    
            } catch (error) {}
        }

        let cardNumberElement
        let securityCodeElement
        let expirationMonthElement

        /*Cartao.prototype.adicionarCartao = function() {

            let _card = {}

            if(this._pagamento && this._pagamento._pagamentos && this._pagamento._pagamentos._pagamento_dividido_selecionado === 'on'){
                _card = {
                    brand: this.bandeira,
                    number: $('#pay-modal').find('#number-modal').val().split(' ').join(''),
                    holderName: $('#pay-modal').find('#cardholderName-modal').val(),
                    holderDocument: $("#carrinho-cartao-cpf_titular-modal").val().replace(/\./g, '').replace(/-/g, '').replace('\/', ''),
                    expirationMonth: moment($('#pay-modal').find('#carrinho-cartao-validade-modal').val(), 'MM/YY').format('MM'),
                    expirationYear: moment($('#pay-modal').find('#carrinho-cartao-validade-modal').val(), 'MM/YY').format('YYYY'),
                    cvv: $('#pay-modal').find('#securityCode-modal').val()
                }
            } else {
                _card = {
                    brand: this.bandeira,
                    number: $('#pay').find('#number').val().split(' ').join(''),
                    holderName: $('#pay').find('#cardholderName').val(),
                    holderDocument: $("#carrinho-cartao-cpf_titular").val().replace(/\./g, '').replace(/-/g, '').replace('\/', ''),
                    expirationMonth: moment($('#pay').find('#carrinho-cartao-validade').val(), 'MM/YY').format('MM'),
                    expirationYear: moment($('#pay').find('#carrinho-cartao-validade').val(), 'MM/YY').format('YYYY'),
                    cvv: $('#pay').find('#securityCode').val(),
                    salvarCartao: $('#pay').find('#is-salvar-cartao').is(':checked')
                }
            }

            if(!this.submit)
                this.submit = true;

            $.ajax({
                type: "POST",
                url: "/pagamento/mercadopago/salvar/cartao",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'token_cartao': this.token,
                    'is_salvar': _card.salvarCartao,
                    'password': this.securityCode,
                    'tipo_id': this.tipo,
                    'cartao': JSON.stringify(_card),
                },
                success: (data) => {
                    toastr.success("Cartão adicionado com sucesso!")
                    this.submit = false;

                    if (data.status) {
                        carrinho.instance.pagamento.cartao_adicionado = data.cartao_id;

                        

                        if(!_card.salvarCartao)
                            carrinho.instance.pagamento.tokens_temporarios = data.cartao_id;
                    }
                    else {
                        toastr.error(data.descricao, 'Erro');
                    }

                    carrinho.instance.pagamento._carregarPagamentos();
                },
                error: (data) => {
                    this.submit = false;
                }
            });
        }*/

        function Pagamento(index, id, nome_descritivo, imagem, is_validar_antifraude, dadosComplemento, _pagamentos) {
            this.index = index;
            this.id = id;
            this.nome_descritivo = nome_descritivo;
            this.imagem = imagem;
            this._selecionado = false;
            this._pagamentos = _pagamentos;
            this.dadosComplemento = dadosComplemento;
            this.is_validar_antifraude = is_validar_antifraude ? is_validar_antifraude : false
            this.valores_pre_definidos = {}

            if(this.pagamentoStorage){
                if(this.id === this.pagamentoStorage.id){
                    this.qtd_parcelas = this.pagamentoStorage._qtd_parcelas
                }
            }
        }
        Pagamento.prototype = {
        get selecionado() {
            return this._selecionado;
        },
        set selecionado(value) {
            this._selecionado = value;
            this._pagamentos._carregarTemplate();
        },
        get pagamento_divido_selecionado() {
            return this._pagamento_divido_selecionado;
        },
        set pagamento_divido_selecionado(value) {
            this._pagamento_divido_selecionado = value;
            this._pagamentos._carregarTemplate();
        },
        get pagamentoStorage(){
            return carrinho.instance && carrinho.instance._getCarrinho() && carrinho.instance._getCarrinho().pagamento && carrinho.instance._getCarrinho().pagamento._infoPagamento ? carrinho.instance._getCarrinho().pagamento._infoPagamento : null
        },
        get qtd_parcelas() {
            return this._qtd_parcelas ? this._qtd_parcelas : 1;
        },
        set qtd_parcelas(value) {
            this._qtd_parcelas = value;
        },
        get vlr_dividido(){
            return this._vlr_dividido
        },
        set vlr_dividido(value){
            this._vlr_dividido = value;
        },
        get qtd_parcelas(){
            return this._qtd_parcelas
        },
        set qtd_parcelas(value){
            this._qtd_parcelas = value
        },
        get vlr_total(){
            return this._vlr_total
        },
        set vlr_total(value){
            this._vlr_total = value
        },
        get valores_pre_definidos(){
            return this._valores_pre_definidos;
        },
        set valores_pre_definidos(value){
            this._valores_pre_definidos = value
        },
        get pagamentoComplemento() {

            var template = ``;
            if (this._pagamentos.value && this.selecionado) {
                this._pagamentos.qtd_parcelas = null;

                    // Criacao de cartão
                    if (!this.dadosComplemento && (this.id == 'credito' || this.id == 'debito' || this.id == 'auxilio')) {
                        this.cartao = new Cartao(this.id, this)
                        template = this._pagamentos._pagamento_dividido_selecionado === 'on' ? this.cartao.template_pagamento_dividido : this.cartao.template
                    }
                    // Pagamento convênio
                    else if (this.id === 'convenio') {
                        if(!this.convenio)
                            this.convenio = new Convenio(this.id, this);

                        template = this.convenio.template;
                    }
                    // Pagamento por Folha de Pagamento
                    else if (this.id === 'folha_pagamento') {
                        if(!this.folha_pagamento)
                            this.folha_pagamento = new FolhaPagamento(this.id, this);

                        template = this.folha_pagamento.template;
                    }
                    // Cartão já salvo
                    else if (this.dadosComplemento && this.dadosComplemento.tipo_codigo && (this.dadosComplemento.tipo_codigo == 'credito' || this.dadosComplemento.tipo_codigo == 'auxilio')) {
                        if (!this.cartao) {
                            this.cartao = {
                                id: this.dadosComplemento.cartao_id,
                                token: this.dadosComplemento.token,
                                cvv: this.dadosComplemento.cvv,
                                bandeira_id: this.dadosComplemento.bandeira_id,
                            };
                        }
                    }

                    if(
                        (!this.dadosComplemento && !(this.id == 'credito' || this.id == 'auxilio' || this.id == 'debito')) ||
                        (this.dadosComplemento && (this.dadosComplemento.tipo_codigo == 'credito' || this.dadosComplemento.tipo_codigo == 'auxilio' || this.dadosComplemento.tipo_codigo == 'debito'))
                    ){

                        let vlr_total = this._pagamentos.cashback_selecionado ? (this._pagamentos._carrinho._calculaVlrTotalFloat() - this._pagamentos._carrinho._saldo_cashback) : this._pagamentos._carrinho._calculaVlrTotalFloat();
                        let pagamento_selecionado = {}
                        
                        /* Fluxo para validar caso o pagamento dividido tenha sido selecionado e qual o valor informado neste método de pagamento. Este valor irá servir de base para a construção do combo de parcelas  */
                        let pagamento_dividido = this._pagamentos && this._pagamentos.value && this._pagamentos.value.length ? this._pagamentos.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
                        let this_pagamento = {}

                        if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length)
                            this_pagamento = pagamento_dividido._pagamentos.find((pag) => { return pag.index === this.index })

                        if(this_pagamento && this_pagamento._vlr_dividido)
                            vlr_total = this_pagamento._vlr_dividido

                        if(pagamento_dividido && this_pagamento && !this_pagamento._vlr_dividido)    
                            return template;
                        
                        /* Fim do fluxo de validação do método de pagamento selecionado */

                        /* Validação do tipo de pagamento selecionado para exibição do combo de parcelas */
                        
                        

                            if(!pagamento_dividido){
                                pagamento_selecionado = this._pagamentos.value.find((pag) => { return pag.id === "credito" })
                            } else {
                                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.id === "credito" })
                            }

                            if(pagamento_selecionado && pagamento_selecionado.id === this.id){
                                

                                    template += `
                                        <p class="blueText font-weight-bold mt-3">Parcelas</p>
                                        <fieldset>
                                            <select required="" onchange="carrinho.instance.pagamento._setParcela(${this.index}, this.value); carrinho.instance._setCarrinho();" class="input-padrao"  name="carrinho-parcelas" tabindex="-1">`;
                                                for(let parcela = 1; parcela <= 6; parcela++) {
                                                    template += ((vlr_total / parcela) >= 50 || (+parcela === 1)) ? `<option ${ this.qtd_parcelas == parcela ? 'selected': ''} value = "${ parcela }" > ${ parcela }x(R$ ${(vlr_total / parcela).toLocaleFixed(2)}) - Sem juros</option>` : '';
                                                }
                                                template += `
                                            </select>
                                        </fieldset>
                                    `;
                                
                            }
                        

                            if(!pagamento_dividido){
                                pagamento_selecionado = this._pagamentos.value.find((pag) => { return pag.id === "pix" })
                            } else {
                                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.id === "pix" })
                            }

                            if(pagamento_selecionado && pagamento_selecionado.id === this.id){
                                
                            }
                        

                            if(!pagamento_dividido){
                                pagamento_selecionado = this._pagamentos.value.find((pag) => { return pag.id === "boleto" })
                            } else {
                                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.id === "boleto" })
                            }

                            if(pagamento_selecionado && pagamento_selecionado.id === this.id){
                                
                            }
                        

                        /* Fim validação do tipo de pagamento selecionado para exibição do combo de parcelas */
                    }
                }
                return template;
            },
            get template_pagamento_dividido() {
                return `
                    <div class="col-12 col-md-6 mt-2">
                        <div class="labl labl-background">
                            ${ !this.selecionado ? `
                                <input type="checkbox" required name="carrinho-pagamento-modal" onclick="carrinho.instance.pagamento.value = '${this.index}';carrinho.instance.pagamento._carregarTemplatePagamentoDividido(${this.index});carrinho.instance._setCarrinho();" id="carrinho-pagamento-${this.index}-modal" autocomplete="off" value="${this.index}"> 
                            ` : `
                                <input type="checkbox" required name="carrinho-pagamento-modal" checked onclick="carrinho.instance.pagamento._removerPagamentoSelecionado(${this.index});carrinho.instance.pagamento.value = '';carrinho.instance.pagamento._carregarTemplatePagamentoDividido(${this.index});carrinho.instance._setCarrinho();" id="carrinho-pagamento-${this.index}-modal" autocomplete="off" value="${this.index}">
                            ` }
                            <label for="carrinho-pagamento-${this.index}-modal" class="card text-body my-1" style="height:60px; background-color: #f0f3f5;">
                                <a class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img alt="icone" width="42" class="mr-3" src="/media/${this.imagem}">
                                        <p class="font-weight-semibold text-nowrap" style="font-size:14px; color:#989898">${this.nome_descritivo}</p>
                                    </div>
                                    ${ this.selecionado ? `
                                        <span onclick="event.stopPropagation();event.preventDefault();carrinho.instance.pagamento._removerPagamentoSelecionado(${this.index});carrinho.instance.pagamento._carregarTemplatePagamentoDividido(${this.index});carrinho.instance._setCarrinho();" class="icon_trash text-muted font-lg">
                                        </span>
                                    ` : `` }
                                </a>
                            </label>
                        </div>
                        ${this.selecionado && !(this.id === 'credito' && !this.dadosComplemento) ? this.template_vlr_dividido : ``}
                        ${typeof(carrinho.instance) === 'object' && this._pagamentos ? this.pagamentoComplemento : ''}
                    </div>
                `;
            },
            get template_valores_pre_definidos() {
                
                let template = ``;

                if(this.selecionado && !this.vlr_dividido && this._pagamentos && this._pagamentos.vlr_restante_calculado === 0){
                    this._pagamentos._removerPagamentoSelecionado(this.index);
                    setTimeout(() => {this._pagamentos._carregarTemplatePagamentoDividido(this.index)}, 100)                    
                    return template;
                }

                let _valores_pre_estabelecidos = []
                let _pagamento_dividido = this._pagamentos && this._pagamentos.value && this._pagamentos.value.length ? this._pagamentos.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : false
                let _pagamentos_selecionados = _pagamento_dividido && _pagamento_dividido._pagamentos && _pagamento_dividido._pagamentos.length ? _pagamento_dividido._pagamentos : []
                let _vlr_total = this._pagamentos && this._pagamentos._carrinho ? this._pagamentos._carrinho.vlr_subtotal + this._pagamentos._carrinho.vlr_frete : 0
                
                if(!this.valores_pre_definidos || !this.valores_pre_definidos.length || !this.vlr_dividido && (this._pagamentos && this._pagamentos.vlr_restante_calculado)){
                    for(let i = 1; i <= 3; i++){
                        if((_pagamentos_selecionados && _pagamentos_selecionados.length > 1) && !this.vlr_dividido){
                            _valores_pre_estabelecidos.push({
                                valor: parseFloat(parseFloat(this._pagamentos.vlr_restante_calculado / i).toFixed(2)),
                                valor_formatado: parseFloat(this._pagamentos.vlr_restante_calculado / i).toLocaleFixed(2)
                            })
                        } else {
                            _valores_pre_estabelecidos.push({
                                valor: parseFloat(parseFloat(_vlr_total / i).toFixed(2)),
                                valor_formatado: parseFloat(_vlr_total / i).toLocaleFixed(2)
                            })
                        }
                    }  
                    this.valores_pre_definidos = _valores_pre_estabelecidos && _valores_pre_estabelecidos.length ? _valores_pre_estabelecidos.reverse() : []
                }
    
                if(this.valores_pre_definidos.length){
                    template += `<div class="row mt-2">`;
                        this.valores_pre_definidos.map((val) => {
                        template += `
                            <div class="col-4 valores-pre-estabelecidos">
                                <div class="p-2 font-weight-bold text-primary text-center font-sm" style="background-color: #f0f3f5; border-radius: .4rem;" onclick="carrinho.instance.pagamento._setValorPagamentoDividido(${this.index}, ${val.valor})">
                                    R$ ${val.valor_formatado}
                                </div>
                            </div>
                        `;
                    })
                    template += `</div>`
                }

                return template;

            },
            get template_vlr_dividido(){

                let template = ``;

                template += `
                    <div class="input-group mt-2 ${this.id === 'convenio' || this.id === 'folha_pagamento' ? 'isDisabled' : ''}">
                        <div class="input-group-prepend" style="align-self: center;">
                            <span class="input-group-text font-weight-semibold">R$</span>
                        </div>
                        <input type="text" class="form-control font-weight-semibold mascara-valor" required name="carrinho-pagamento-vlr-dividido-${this.index}" id="carrinho-pagamento-vlr-dividido-${this.index}" autocomplete="off" value="${this._vlr_dividido ? parseFloat(this._vlr_dividido).toLocaleFixed(2) : ''}" onchange="carrinho.instance.pagamento._setValorPagamentoDividido(${this.index}, converteMoedaFloat(this.value))">
                    </div>
                    ${this.id != 'convenio' && this.id != 'folha_pagamento' ? this.template_valores_pre_definidos : ''}
                `;

                return template;
            },
            get template() {
                return `
                        <div class="labl labl-background ${this.index === 1 ? '' : 'mt-3'}">
                            <input type="radio" required name="carrinho-pagamento" ${ this.selecionado && (!this._pagamentos || !this._pagamentos.pagamento_dividido_selecionado) ? 'checked' : '' } onclick="carrinho.instance.pagamento.value = '${this.index}';carrinho.instance._setCarrinho();" id="carrinho-pagamento-${this.index}" autocomplete="off" value="${this.index}">
                            <label for="carrinho-pagamento-${this.index}" class="card text-body my-1" style="height:60px; background-color: #fff;">
                                <a class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img alt="icone" width="45" class="mr-3" src="/media/${this.imagem}">
                                        <p class="font-weight-semibold text-nowrap" style="font-size:14px; color:#989898">${this.nome_descritivo}</p>
                                    </div>
                                </a>
                            </label>
                        </div>
                        ${(!this._pagamentos || !this._pagamentos.pagamento_dividido_selecionado) ? this.pagamentoComplemento : ''}
                    `;
            },
            get template_pagamentos_selecionados(){
                return `
                    <div class="labl labl-background ${this.index === 1 ? '' : 'mt-3'}">
                        <input name="carrinho-pagamento" id="carrinho-pagamento-${this.index}" autocomplete="off" value="${this.index}">
                        <label for="carrinho-pagamento-${this.index}" class="card text-body my-1" style="height:60px; background-color: #fff;">
                            <a class="card-body pt-2 pb-2 d-flex align-items-center justify-content-between">
                                <div class="col-6 m-0 p-0">
                                    <div class="d-flex align-items-center">
                                        <img alt="icone" width="45" class="mr-3" src="/media/${this.imagem}">
                                        <p class="font-weight-semibold text-nowrap text-limit-1" style="font-size:14px; color:#989898">${this.nome_descritivo}</p>
                                    </div>
                                </div>
                                <div class="col-4 m-0 p-0">
                                    <div class="d-flex align-items-center justify-content-center">
                                        <span class="font-weight-semibold">Valor: ${this.qtd_parcelas ? this.qtd_parcelas : 1}x R$ ${this.vlr_dividido ? parseFloat(this.vlr_dividido / (this.qtd_parcelas ? this.qtd_parcelas : 1)).toLocaleFixed(2) : '--'}</span>
                                    </div>
                                </div>
                                <div class="col-2 m-0 p-0">
                                    <div class="d-flex align-items-center justify-content-end">
                                        <span class="icon_edit" onclick="carrinho.instance.pagamento._carregarTemplatePagamentoDividido(${this.index});carrinho.instance.pagamento._visualizarInfoPagamentoDividido(${this.index});carrinho.instance._carregarTemplate();"></span>
                                    </div>
                                </div>
                            </a>
                        </label>
                    </div>
                `;
            }
        }
        Pagamento.prototype._pagamentoMeuCartao = function() {
            if (this.dadosComplemento) {
                this.cartao = {
                    id: this.dadosComplemento.cartao_id,
                    token: this.dadosComplemento.token,
                    cvv: this.dadosComplemento.cvv,
                    bandeira_id: this.dadosComplemento.bandeira_id,
                };
            }
        }
        
        function PagamentoComponent(_carrinho) {
            this._carrinho = _carrinho;
            this._carregarPagamentos();
            this._cartao_adicionado = null;
            this._infoPagamento = null
            this._tokens_temporarios = [];
            if(this.pagamento_storage && this.pagamento_storage.index)
                this.value = this.pagamento_storage.index
        }
        PagamentoComponent.prototype = {
            get valid() {
                return this._validacaoPagamento();
            },
            get value() {
                const pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)
                const pagamento = pagamentos.filter((pagamento) => { return pagamento.selecionado });
                const convenio = pagamentos.filter((pagamento) => { return pagamento.id === 'convenio' })
                const folha_pagamento = pagamentos.filter((pagamento) => { return pagamento.id === 'folha_pagamento' })
                const pagamento_dividido = pagamentos.filter((pagamento) => { return pagamento.id === 'pagamento_dividido' })

                if (this.cashback_selecionado && this._carrinho._saldo_cashback > 0) {
                    let retorno = [];
                    retorno.push({
                        "index": -1,
                        "id": "cashback",
                        "nome_descritivo": "",
                        "imagem": "pagamentos/cashback.png",
                        "qtd_parcelas": 1,
                        "_selecionado": true,
                        "_pagamentos": this,
                        "_vlr_total": this._carrinho._saldo_cashback >= this._carrinho._calculaVlrTotalFloat() ? this._carrinho._calculaVlrTotalFloat() : this._carrinho._saldo_cashback
                    });

                    if (pagamento.length > 0 && this._carrinho._saldo_cashback < this._carrinho._calculaVlrTotalFloat()) {
                        pagamento[0]._vlr_total = this._carrinho._calculaVlrTotalFloat() - this._carrinho._saldo_cashback;
                        retorno.push(pagamento[0]);
                    }
                    return retorno.length > 0 ? retorno : null;
                }
                
                if (pagamento && pagamento.length) {
                    if(!convenio || !convenio.length || !folha_pagamento || !folha_pagamento.length){
                        if(typeof(this._carrinho) == 'object') {
                            if(!this._carrinho._is_multiplos_pagamentos){
                                pagamento[0]._vlr_total = this._carrinho._calculaVlrTotalFloat();
                            }
                        }
                    } else if(convenio && convenio.length){
                        pagamento.map((pag) => {
                            if(pag.id === 'convenio' && pag.convenio){
                                pag.convenio._vlr_total = this._carrinho.vlr_total_convenio
                                pag._vlr_total = this._carrinho.vlr_total_convenio
                            } else {
                                let tem_convenio = this.pagamentos_selecionados.find(item => item.id == 'convenio')
                                if (tem_convenio) {
                                    pag._vlr_total = parseFloat(this._carrinho._calculaVlrTotalFloat()) - parseFloat(this._carrinho.vlr_total_convenio)
                                }else{
                                    pag._vlr_total = parseFloat(this._carrinho._calculaVlrTotalFloat())
                                }
                            }
                        })
                    } else if(folha_pagamento && folha_pagamento.length){
                        pagamento.map((pag) => {
                            if(pag.id === 'folha_pagamento' && pag.folha_pagamento){
                                pag._qtd_parcelas = $('#parcelas_folha_pagamento').val()
                                pag.folha_pagamento._vlr_total = this._carrinho.vlr_total_folha_pagamento
                                pag._vlr_total = this._carrinho.vlr_total_folha_pagamento
                            } else {
                                let tem_folha_pagamento = this.pagamentos_selecionados.find(item => item.id == 'folha_pagamento')
                                if (tem_folha_pagamento) {
                                    pag._vlr_total = parseFloat(this._carrinho._calculaVlrTotalFloat()) - parseFloat(this._carrinho.vlr_total_folha_pagamento)
                                }else{
                                    pag._vlr_total = parseFloat(this._carrinho._calculaVlrTotalFloat())
                                }
                            }
                        })
                    }

                    if(this._pagamento_dividido_selecionado){
                        let _split_pagamento = []
                        _split_pagamento.push({
                            "index": -1,
                            "id": "pagamento_dividido",
                            "nome_descritivo": "Pagamento dividido",
                            "_pagamentos": pagamento,
                            "value": pagamento,
                            "_vlr_total": this._carrinho._calculaVlrTotalFloat() 
                        })
                        return _split_pagamento
                    }

                    return pagamento;
                }
                return null;
            },
            set value(value) {

                if (!this.value || this.value.index !== value) {

                    let pagamentoSelecionado;

                    let pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)

                    if(pagamentos && pagamentos.length){

                        let pagamentosSelecionados = pagamentos.filter((pag) => { return pag.selecionado })

                        if(pagamentosSelecionados && pagamentosSelecionados.length){
                            if(this._carrinho._is_multiplos_pagamentos && this._carrinho.qtd_max_pagamentos_diferentes && (pagamentosSelecionados.length + 1) > +this._carrinho.qtd_max_pagamentos_diferentes){
                                toastr.warning('Limite máximo de formas de pagamento atingido. Remova algum meio de pagamento e selecione uma nova opção.')
                                return;
                            }
                        }
                        
                        if(this.value){
                            let pagamento_dividido = this.value.find((pag) => { return pag.id === 'pagamento_dividido' })
                            if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length)
                                if(this.vlr_restante_calculado === 0){
                                    toastr.warning('O valor somado do(s) meio(s) de pagamento(s) selecionado(s) cobrem o total da sua compra.');
                                    return;
                                }
                        }

                        pagamentos.map((pagamento) => {

                            if(pagamento.index == value){

                                pagamento.selecionado = value
                                pagamentoSelecionado = pagamento;

                            } else {
                                
                                if(!this.pagamento_dividido_selecionado)
                                    pagamento._qtd_parcelas = 1

                                if(!this._carrinho._is_multiplos_pagamentos)
                                    pagamento.selecionado = false;
                                
                            }

                            if (pagamento.id == 'folha_pagamento') {
                                pagamento._qtd_parcelas = $('#parcelas_folha_pagamento').val()
                            }

                        })
                    }

                    this._infoPagamento = pagamentoSelecionado

                    if(typeof filtroParaDadosAnaliticos === "function"){
                        filtroParaDadosAnaliticos('AddPaymentInfo', {
                            currency: 'BRL',
                            payment_type: pagamentoSelecionado ? pagamentoSelecionado.id : '',
                            coupon: this._carrinho && this._carrinho.cupom && this._carrinho.cupom.codigo ? this._carrinho.cupom.codigo : '',
                            value: this._carrinho._calculaVlrTotalFloat(),
                        });
                    }
                }
            },
            get valueNotCashback() {
                const pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)
                const pagamento = pagamentos.filter((pagamento) => { return pagamento.selecionado });

                if (this.cashback_selecionado && this._carrinho._saldo_cashback > 0) {
                    if (pagamento.length > 0 && this._carrinho._saldo_cashback < this._carrinho._calculaVlrTotalFloat()) {
                        pagamento[0]._vlr_total = this._carrinho._calculaVlrTotalFloat() - this._carrinho._saldo_cashback;
                    }

                    return pagamento.length > 0 ? pagamento[0] : null;
                }
                if (pagamento.length > 0) {
                    pagamento[0]._vlr_total = this._carrinho._calculaVlrTotalFloat();
                    return pagamento[0];
                }
                return null;
            },
            get cashback_selecionado() {
                return this._cashback_selecionado;
            },
            set cashback_selecionado(value) {
                this._cashback_selecionado = value;
                this._carregarTemplate();
            },
            get pagamento_dividido_selecionado() {
                return this._pagamento_dividido_selecionado;
            },
            set pagamento_dividido_selecionado(value) {
                if(!value){
                    this._carrinho.is_multiplos_pagamentos = false
                    this.pagamento_dividido_confirmado = '';
                    let pagamento_divido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : false
                    if(pagamento_divido && pagamento_divido._pagamentos && pagamento_divido._pagamentos.length)
                        pagamento_divido._pagamentos.map((pag) => { pag.vlr_dividido = 0 })
                }
                this._pagamento_dividido_selecionado = value;
            },
            get pagamento_dividido_confirmado() {
                return this._pagamento_dividido_confirmado;
            },
            set pagamento_dividido_confirmado(value) {
                this._pagamento_dividido_confirmado = value;
            },
            get cartao_adicionado() {
                return this._cartao_adicionado;
            },
            set cartao_adicionado(value) {
                this._cartao_adicionado = value;
            },
            get meus_pagamentos() {
                return this._meus_pagamentos;
            },
            set meus_pagamentos(value) {
                this._meus_pagamentos = value;
            },
            get tipos_pagamento() {
                return this._tipos_pagamento;
            },
            set tipos_pagamento(value) {
                this._tipos_pagamento = value;
            },
            get outros_pagamentos(){
                return this._outros_pagamentos;    
            },
            set outros_pagamentos(value) {
                this._outros_pagamentos = value;
            },
            get tokens_temporarios(){
                return this._tokens_temporarios;
            },
            set tokens_temporarios(value){
                this._tokens_temporarios.push(value);
            },
            get pagamento_storage() {
                if(this._carrinho && this._carrinho._getCarrinho() && this._carrinho._getCarrinho().pagamento && this._carrinho._getCarrinho().pagamento._infoPagamento){
                    let pag = this._carrinho._getCarrinho().pagamento._infoPagamento
                    if(!(pag.id === 'credito' || pag.id === 'auxilio' || pag.id === 'debito')){
                        return pag
                    }
                }
                return null
            },
            get pagamentos_selecionados(){
                let pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)
                if(pagamentos && pagamentos.length){
                    let pagamentosSelecionados = pagamentos.filter((pag) => { return pag.selecionado })
                    return pagamentosSelecionados;
                }
                return [];
            },
            get vlr_restante_calculado(){
                this._vlr_restante_calculado = this._calcularValorRestantePagamentoDividido()
                return this._vlr_restante_calculado;
            },
            get template() {

                let pagamentos_selecionados_template = ``
                //Caso pagamento dividido tenha sido selecionado exibe somente os pagamentos selecionados
                let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
                if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                    pagamentos_selecionados_template = `<div class="mt-4 px-3 ${this.cashback_selecionado && this._carrinho._saldo_cashback > this._carrinho._calculaVlrTotalFloat() ? 'isDisabled' : ''}"> <p class="blueText font-weight-bold" style="-0.8rem">Pagamento(s) selecionado(s)</p>` + $.map(pagamento_dividido._pagamentos, (elem) => {
                        return elem.template_pagamentos_selecionados;
                    }).join('') + `</div>`
                }

                const pagamento_dividido_selecionado_template = pagamentos_selecionados_template

                const meus_pagamentos_template = this.meus_pagamentos.length > 0 ? `<div class="mt-4 px-3 ${this.cashback_selecionado && this._carrinho._saldo_cashback > this._carrinho._calculaVlrTotalFloat() ? 'isDisabled' : ''}"> <p class="blueText fontOutfitBold" style="-0.8rem">Seus pagamentos</p>` + $.map(this.meus_pagamentos, (elem) => {
                    return elem.template;
                }).join('') + `</div>` : '';

                const tipo_pagamentos_template = this.tipos_pagamento.length > 0 ? `<div class="mt-4 px-3 ${this.cashback_selecionado && this._carrinho._saldo_cashback > this._carrinho._calculaVlrTotalFloat() ? 'isDisabled' : ''}"> <p class="blueText fontOutfitBold">Outras formas de pagamento</p>` + $.map(this.tipos_pagamento, (elem) => {
                    return elem.template;
                }).join('') + `</div>` : '';

                let html_template = ``;
                html_template += `<div style="margin-right:16px; margin-left: 16px; ">
                        <h2 class="fontOutfitBold blueText text-center mt-2" style="font-size:18px">Escolha a forma de pagamento</h2>
                        <div class="mt-3">
                            <p class="blueText fontOutfitBold">Adicionar cupom de desconto</p>
                            <div class="input-group">
                                <input style="font-size:13px !important; height:45px;" class="text-uppercase form-control font-weight-semibold text-body" ${this._carrinho && this._carrinho.cupom && this._carrinho.cupom.codigo ? 'disabled' : ''} value="${this._carrinho && this._carrinho.cupom && this._carrinho.cupom.codigo ? this._carrinho.cupom.codigo : ''}" onchange="carrinho.instance.cupom = {cupom_id: this.value}" name="carrinho-cupom" placeholder="Cupom de Desconto" />
                                `;
                if (!this._carrinho || !this._carrinho.cupom || !this._carrinho.cupom.codigo) {
                    html_template += `<div class="input-group-append">
                                      <span class="btn botaoPrincipal text-white font-weight-bold d-flex align-items-center justify-content-center" onclick="carrinho.instance.cupom = {cupom_id: this.value};carrinho.instance._setCarrinho();" name="carrinho-cupom" style="-webkit-transform: none; width:100px;">Aplicar</span>
                                  </div>`;
                }
                else if (this._carrinho && this._carrinho.cupom && this._carrinho.cupom.codigo) {
                    html_template += `<div class="input-group-append">
                                      <span class="btn btn-danger font-weight-bold d-flex align-items-center justify-content-center" onclick="carrinho.instance.cupom = '';carrinho.instance._setCarrinho();" name="carrinho-cupom" style="-webkit-transform: none; width:100px;">Remover</span>
                                  </div>`;
                }

                html_template += `
                            </div>
                        </div>`
                // false para nunca cair no if
                if(false && !this.vlr_minimo_multiplos_pagamentos || this.vlr_minimo_multiplos_pagamentos <= this._carrinho._calculaVlrTotalFloat()){
                    html_template += `
                        <div class="input-group align-items-center mt-4 ${this.cashback_selecionado && this._carrinho._saldo_cashback > this._carrinho._calculaVlrTotalFloat() ? 'isDisabled' : ''}">
                            <div class="labl labl-background" style="-ms-flex: 1 1 0%; flex: 1 1 0%;">
                                <label class="card text-body cursor-pointer my-1" ${this.pagamento_dividido_selecionado ? `onclick="carrinho.instance.pagamento._carregarTemplatePagamentoDividido();carrinho.instance.pagamento._visualizarInfoPagamentoDividido();carrinho.instance._carregarTemplate();"` : ``} style="height:45px; background-color: #fff; border: 0 !important; border-bottom-right-radius: 0 !important; border-top-right-radius: 0 !important;">
                                    <div class="card-body py-2 d-flex align-items-center justify-content-start">
                                        <img class="mr-3" src="" width="30" height="30">
                                        <p class="text-limit-1 font-weight-bold font-xl" style="color: #3f84c7 !important;">Pagamento dividido</p>
                                    </div>
                                </label>
                            </div>
                            <div class="input-group-append" style="height:45px;">
                            ${!this.pagamento_dividido_selecionado ? `
                                <span class="btn btn-primary font-weight-bold d-flex align-items-center text-white justify-content-center ${!this._carrinho || !this._carrinho.pacotes || !this._carrinho.pacotes.length ? 'isDisabled' : '' }" onclick="carrinho.instance.pagamento._removerTodosPagamentoSelecionado();carrinho.instance.pagamento._carregarTemplatePagamentoDividido();carrinho.instance.pagamento._visualizarInfoPagamentoDividido();carrinho.instance.pagamento.pagamento_dividido_selecionado = 'on';carrinho.instance.is_multiplos_pagamentos = true;carrinho.instance._carregarTemplate();" style="-webkit-transform: none; width:100px;">Selecionar</span>
                            ` : `
                                <span class="btn btn-primary font-weight-bold d-flex align-items-center text-white justify-content-center ${!this._carrinho || !this._carrinho.pacotes || !this._carrinho.pacotes.length ? 'isDisabled' : '' }" onclick="carrinho.instance.pagamento.pagamento_dividido_selecionado = '';carrinho.instance.pagamento._pagamento_dividido_confirmado = '';carrinho.instance.pagamento._removerTodosPagamentoSelecionado();carrinho.instance._carregarTemplate();" style="-webkit-transform: none; width:100px;">Remover</span>
                            `}
                            </div>
                        </div>`;
                }

                html_template += `</div>`;

                if(pagamento_dividido_selecionado_template && this._pagamento_dividido_confirmado){
                    html_template += `
                        ${pagamento_dividido_selecionado_template}
                    `;
                } else {
                    html_template += `
                        ${meus_pagamentos_template}
                        ${tipo_pagamentos_template}
                    `;
                }
                        
                html_template += `</div>`;

                return html_template;
            },
            get template_multiplos_pagamentos() {

                const meus_pagamentos_template = this.meus_pagamentos.length > 0 ? $.map(this.meus_pagamentos, (elem) => {
                    return elem.template_pagamento_dividido;
                }).join('') : '';
                const tipo_pagamentos_template = this.tipos_pagamento.length > 0 ? $.map(this.tipos_pagamento, (elem) => {
                    return elem.template_pagamento_dividido;
                }).join('') : '';

                let html_template = ``;

                html_template += `
                    <div class="row mt-3 mb-2">
                        <div class="col-12">
                            <p class="font-weight-bold" style="font-size: 17px; color: #3f84c7;">Valor restante: R$ <span data-target="vlr-restante-pagamento-dividido">${this._carrinho.vlr_total_calculado}</span></p>
                        </div>    
                    </div>
                    <div class="row mt-3 mb-2">
                        ${meus_pagamentos_template}
                        ${tipo_pagamentos_template}
                    </div>
                    <div class="row mt-3 mb-2">
                        <div class="col-12">
                            <p class="font-weight-bolder" style="font-size: 18px; color: #1cb05c;">Dinheiro de volta: R$ ${this._carrinho.vlr_cashback}</p>       
                        </div>    
                    </div>
                    <div class="row mt-3 mb-2">
                        <div class="col-12">
                            <p class="font-weight-bold" style="font-size: 17px; color: #3f84c7;">Valor a ser pago: R$ ${this._carrinho.vlr_total_calculado}</p>        
                        </div>    
                    </div>
                    <div class="row mt-3 mb-2">
                        <div class="col-12">
                            <a id="btn-confirmar-pagamento-dividido" class="btn btn-warning w-100 text-white font-weight-semibold my-2 p-2" style="font-size: 22px; transform: unset;">Finalizar pagamento</a> 
                        </div>        
                    </div>
                `

                return html_template;
            },
            get template_pagamento_dividido_selecionado(){
                let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
                let pagamentos_selecionados_template = ``

                if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                    pagamentos_selecionados_template = `<div class="mt-3 ${this.cashback_selecionado && this._carrinho._saldo_cashback > this._carrinho._calculaVlrTotalFloat() ? 'isDisabled' : ''}"> <p class="blueText font-weight-bold" style="-0.8rem">Pagamento(s) selecionado(s)</p>` + $.map(pagamento_dividido._pagamentos, (elem) => {
                        return elem.template;
                    }).join('') + `</div>`;
                }

                let template = `
                    ${pagamentos_selecionados_template}
                `
                
                return template    
            }
        }
        PagamentoComponent.prototype._setParcela = function(index, valor) {
            let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
            let pagamento_selecionado = {}
            if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.index === index })    
            } else {
                pagamento_selecionado = this.value && this.value.length ? this.value.find((pag) => { return pag.index === index }) : {}
            }
            if(pagamento_selecionado)
                pagamento_selecionado.qtd_parcelas = valor
        }
        PagamentoComponent.prototype._setConvenio = function(valor) {
            let convenio = this._getPagamentoFromId('convenio')
            if(convenio && convenio.convenio){
                convenio.convenio.id = valor
                convenio.convenio._getParcelas()
            }
        }
        PagamentoComponent.prototype._setConvenioParcela = function(valor) {
            let convenio = this._getPagamentoFromId('convenio')
            if(convenio && convenio.convenio){
                convenio.convenio.parcela = valor
                convenio.convenio.qtd_parcelas = valor
            }
        }
        PagamentoComponent.prototype._setFolhaPagamentoParcela = function(valor) {
            let folha_pagamento = this._getPagamentoFromId('folha_pagamento')
            if(folha_pagamento && folha_pagamento.folha_pagamento){
                folha_pagamento.folha_pagamento.parcela = valor
                folha_pagamento.folha_pagamento.qtd_parcelas = valor
            }
        }
        PagamentoComponent.prototype._getPagamentoFromIndex = function(index) {
            let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
            let pagamento_selecionado = {}
            if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.index == index })    
            } else {
                pagamento_selecionado = this.value && this.value.length ? this.value.find((pag) => { return pag.index == index }) : {}
            }
            return pagamento_selecionado && Object.keys(pagamento_selecionado).length ? pagamento_selecionado : false;
        }
        PagamentoComponent.prototype._getPagamentoFromId = function(id) {
            let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : {}
            let pagamento_selecionado = null
            if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                pagamento_selecionado = pagamento_dividido._pagamentos.find((pag) => { return pag.id == id })    
            } else {
                pagamento_selecionado = this.value && this.value.length ? this.value.find((pag) => { return pag.id == id }) : {}
            }
            return pagamento_selecionado && Object.keys(pagamento_selecionado).length ? pagamento_selecionado : false;
        }
        PagamentoComponent.prototype._carregarPagamentos = function() {

            this.meus_pagamentos = [];
            this.tipos_pagamento = [];
            let i = 1;

            
                if(["convenio", "folha_pagamento"].includes('credito')){
                    this.meus_pagamentos.push(new Pagamento(i, 'credito', 'Cartão de crédito', 'pagamentos/credito2.webp',  false , null, this));
                } else {
                    this.tipos_pagamento.push(new Pagamento(i, 'credito', 'Cartão de crédito', 'pagamentos/credito2.webp',  false , null, this));
                }
                i++;
            
                if(["convenio", "folha_pagamento"].includes('pix')){
                    this.meus_pagamentos.push(new Pagamento(i, 'pix', 'Pix', 'pagamentos/pix.png',  false , null, this));
                } else {
                    this.tipos_pagamento.push(new Pagamento(i, 'pix', 'Pix', 'pagamentos/pix.png',  false , null, this));
                }
                i++;
            
                if(["convenio", "folha_pagamento"].includes('boleto')){
                    this.meus_pagamentos.push(new Pagamento(i, 'boleto', 'Boleto Bancário', 'formas_pagamento/boleto.png',  false , null, this));
                } else {
                    this.tipos_pagamento.push(new Pagamento(i, 'boleto', 'Boleto Bancário', 'formas_pagamento/boleto.png',  false , null, this));
                }
                i++;
            

            load('on', $('.asidebar'))

            $.ajax({
                type: "POST",
                url: "/pagamento/atualizar/cartoes",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'tokens': this.tokens_temporarios
                },
                success: (data) => {

                    load('off', $('.asidebar'))

                    if (data.status) {
                        let selecionado = null;
                        for (let count = 1; count <= data.cartoes.length; count++) {
                            const cartao = data.cartoes[count - 1];

                            this.meus_pagamentos.push(new Pagamento(i, cartao.tipo_codigo, cartao.bandeira__nm_descritivo + ' ***** ' + cartao.ultimos_4, cartao.bandeira__imagem, true, cartao, this));

                            if (cartao.cartao_id === this.cartao_adicionado) {
                                selecionado = i.toString();
                            }
                            i++;
                        }
                        this._carregarTemplate();
                        if (selecionado != null) {
                            this.value = selecionado;
                        }

                        this.cartao_adicionado = null;

                    }
                },
                error: (data) => {
                    load('off', $('.asidebar'))
                }
            });
        }
        PagamentoComponent.prototype._carregarTemplate = function() {
            this._carrinho._carregarTemplate();
        }
        PagamentoComponent.prototype._validacaoPagamento = function() {
            if (this.cashback_selecionado && this._carrinho._saldo_cashback >= this._carrinho._calculaVlrTotalFloat()) {
                return true;
            } else {
                if (!this.value) {
                    toastr.error('Selecione uma forma de pagamento', 'Erro');
                } else if (this.cashback_selecionado && this._carrinho._saldo_cashback < this._carrinho._calculaVlrTotalFloat() && this.value.length === 1)  {
                    toastr.error('Selecione uma 2° forma de pagamento para complementar o valor restante da sua compra', 'Erro');
                    return false;
                } else if ((this._getPagamentoFromId('credito') && (!this._getPagamentoFromId('credito').dadosComplemento || !this._getPagamentoFromId('credito').cartao)) || (this._getPagamentoFromId('auxilio') && (!this._getPagamentoFromId('auxilio').dadosComplemento || !this._getPagamentoFromId('auxilio').cartao))) {
                    if(this._getPagamentoFromId('credito') && this._getPagamentoFromId('credito').cartao){
                        if($('#pay') && $('#pay')[0] && $('#pay')[0].checkValidity()){
                            //this._getPagamentoFromId('credito').cartao.doPay();
                        } else {
                            $('#pay').addClass('was-validated')
                            toastr.warning('Preencha os dados do cartão para prosseguir')
                        }
                    }
                    if(this._getPagamentoFromId('auxilio') && this._getPagamentoFromId('auxilio').cartao){
                        if($('#pay') && $('#pay')[0] && $('#pay')[0].checkValidity()){
                            this._getPagamentoFromId('auxilio').cartao.doPay();
                        } else {
                            $('#pay').addClass('was-validated')
                            toastr.warning('Preencha os dados do cartão para prosseguir')
                        }
                    }
                    return false;
                } else if (this._getPagamentoFromId('convenio') && (!this._getPagamentoFromId('convenio').convenio || !this._getPagamentoFromId('convenio').convenio.id)) {
                    toastr.error('Selecione um convênio', 'Erro');
                    return false;
                } else if (this._getPagamentoFromId('convenio') && (!this._getPagamentoFromId('convenio').convenio || !this._getPagamentoFromId('convenio').convenio.parcela)){
                    toastr.error('Selecione uma parcela para o seu convênio', 'Erro');
                    return false;
                } else if (this._getPagamentoFromId('folha_pagamento') && (!this._getPagamentoFromId('folha_pagamento').folha_pagamento || !this._getPagamentoFromId('folha_pagamento').folha_pagamento.parcela)){
                    toastr.error('Selecione uma parcela para a folha de pagamento', 'Erro');
                    return false;
                } else if (this.value) {
                    return true;
                }
            }
        }
        PagamentoComponent.prototype._validarPagamentosMultiplos = function(el) {
            let pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)
            if(pagamentos && pagamentos.length){
                let pagamentosSelecionados = pagamentos.filter((pag) => { return pag.selecionado })
                if(pagamentosSelecionados && pagamentosSelecionados.length){
                    if(this._carrinho._is_multiplos_pagamentos && this._carrinho.qtd_max_pagamentos_diferentes && (pagamentosSelecionados.length + 1) > +this._carrinho.qtd_max_pagamentos_diferentes){
                       $(el).prop('checked', false)
                    }
                }
            }
        }
        PagamentoComponent.prototype._removerPagamentoSelecionado = function(index) {
            let pagamento_divido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : false
            let pagamento_selecionado
            if(pagamento_divido && pagamento_divido._pagamentos && pagamento_divido._pagamentos.length)
                pagamento_selecionado =  pagamento_divido._pagamentos.find((pag) => { return pag.index === index})

            if(pagamento_selecionado) {

                if(pagamento_selecionado.id === 'convenio' && pagamento_selecionado.convenio)
                    delete pagamento_selecionado.convenio

                if(pagamento_selecionado.id === 'folha_pagamento' && pagamento_selecionado.folha_pagamento)
                    delete pagamento_selecionado.folha_pagamento

                pagamento_selecionado.selecionado = false;
                pagamento_selecionado._vlr_dividido = 0;
                pagamento_selecionado._qtd_parcelas = 1;
                pagamento_selecionado.valores_pre_definidos = [];
            }
            
            this._carregarTemplate();
        }
        PagamentoComponent.prototype._removerTodosPagamentoSelecionado = function() {
            let pagamentos = this.meus_pagamentos.concat(this.tipos_pagamento)

            if(pagamentos && pagamentos.length){
                pagamentos.map((pagamento) => {

                    if(pagamento.id === 'convenio' && pagamento.convenio)
                        delete pagamento.convenio

                    if(pagamento.id === 'folha_pagamento' && pagamento.folha_pagamento)
                        delete pagamento.folha_pagamento

                    pagamento.selecionado = false;
                    pagamento._qtd_parcelas = 1;
                    pagamento._vlr_dividido = 0;
                })
            }
            
            this._infoPagamento = null
            this._carregarTemplate(); 
        }
        PagamentoComponent.prototype._validarSplitPagamento = function (index, valor) {
            let _pagamento = this.value && this.value.length ? this.value.filter(pag => { return pag.index == index}) : []
            let _valor = converteMoedaFloat(valor.replace(/\s+/g, "").replace('R$', ''))
            
            if(_pagamento && _pagamento.length)
                _pagamento[0]._vlr_total = _valor
        }
        PagamentoComponent.prototype._carregarTemplatePagamentoDividido = function (index) {
            $('[data-target="bloco_pagamentos"]').html(this.template_multiplos_pagamentos)

            $('[data-target="vlr-restante-pagamento-dividido"]').html(parseFloat(this.vlr_restante_calculado).toLocaleFixed(2))

            $("#modal_multiplos_pagamentos").find("select").each(function (e, a) { var r = $("#modal_multiplos_pagamentos").find('.modal-body'); a && $(a).select2({ theme: "bootstrap", dropdownParent: r, minimumResultsForSearch: -1, escapeMarkup: function(markup) { return markup; }, templateResult: function (data) { let template = data && data.text && data.text.split('breakRow') ? data.text.split('breakRow') : '';if(template.length && template.length > 1){let html_retorno = ``;$(template).each(function(i, html){if(html){if(i === 0){ html_retorno += `<p class="font-weight-bold mb-1">${html}</p>`;} else if(i === (template.length - 1)){html_retorno += `<p class="font-weight-bold">${html}</p>`;} else {html_retorno += `<p class="mb-1">${html}</p>`;}}});return html_retorno;};return data.text; }, templateSelection: function (data) { let template = data && data.text && data.text.split('breakRow') ? data.text.split('breakRow') : ''; if(template.length && template.length > 1){ return `<p>${template[0]} - <b>${template[template.length - 1]}</b></p>` }; return data.text; } }) });    

            $('#modal_multiplos_pagamentos .select2-selection__rendered').hover(function () {
                $(this).removeAttr('title');
            });

            $('.mascara-valor').mask('#.##0,00', { reverse: true });

            $('#btn-confirmar-pagamento-dividido').off('click').on('click', function(){ carrinho.instance.pagamento._validarPagamentoDividido(); })

            if(index){
                if (this._getPagamentoFromIndex(index) && this._getPagamentoFromIndex(index).cartao && this._getPagamentoFromIndex(index).cartao.tipo) {
                    eventosCartaoPagamentoDividido(this._getPagamentoFromIndex(index).cartao);
                }

                if (this._getPagamentoFromIndex(index) && this._getPagamentoFromIndex(index).cartao && this._getPagamentoFromIndex(index).cartao.tipo) {
                    eventosCartaoPagamentoDividido(this._getPagamentoFromIndex(index).cartao);
                }

                return;
            }

            if (this._getPagamentoFromId('credito') && this._getPagamentoFromId('credito').cartao && this._getPagamentoFromId('credito').cartao.tipo) {
                eventosCartaoPagamentoDividido(this._getPagamentoFromId('credito').cartao);
            }

            if (this._getPagamentoFromId('auxilio') && this._getPagamentoFromId('auxilio').cartao && this._getPagamentoFromId('auxilio').cartao.tipo) {
                eventosCartaoPagamentoDividido(this._getPagamentoFromId('auxilio').cartao);
            }
        }
        PagamentoComponent.prototype._visualizarInfoPagamentoDividido = function (index) {
            $('#modal_multiplos_pagamentos').modal('show');
            if(index){
                if(this._getPagamentoFromIndex(index) && (this._getPagamentoFromIndex(index).id != 'convenio' && this._getPagamentoFromIndex(index).id != 'folha_pagamento')){
                    $("#modal_multiplos_pagamentos").off("shown.bs.modal").on("shown.bs.modal", function(){
                        $('#carrinho-pagamento-vlr-dividido-' + index).focusTextToEnd();
                    })
                }
            }
        }
        PagamentoComponent.prototype._setValorPagamentoDividido = function(index, valor) {
            
            let _pagamento_dividido = this.value ? this.value.find((pag) => { return pag.id === 'pagamento_dividido'}) : []
            let _pagamentos_selecionados = _pagamento_dividido && _pagamento_dividido._pagamentos && _pagamento_dividido._pagamentos.length ? _pagamento_dividido._pagamentos : []
            let _pagamento_selecionado = _pagamento_dividido && _pagamento_dividido._pagamentos && _pagamento_dividido._pagamentos.length ? _pagamento_dividido._pagamentos.find((pag) => { return pag.index === index }) : {}

            if(_pagamento_selecionado)
                _pagamento_selecionado._vlr_dividido = parseFloat(valor)

            if(_pagamentos_selecionados.length){
                let _vlr_total_dividido = 0
                _pagamentos_selecionados.map((pag) => { _vlr_total_dividido += (pag.vlr_dividido) })
                if(_vlr_total_dividido > this._carrinho._calculaVlrTotalFloat()){
                    _pagamento_selecionado._vlr_dividido = 0;
                    toastr.warning('Informe um valor menor ou igual ao valor restante da sua compra.');
                }
            }

            this._carregarTemplatePagamentoDividido();
        }
        PagamentoComponent.prototype._calcularValorRestantePagamentoDividido = function() {

            let _pagamento_dividido = this.value ? this.value.find((pag) => { return pag.id === 'pagamento_dividido'}) : []
            let _vlr_total_carrinho = _pagamento_dividido._vlr_total
            let _vlr_restante = _pagamento_dividido._vlr_total ? _pagamento_dividido._vlr_total : this._carrinho._calculaVlrTotalFloat();
            let _vlr_total_dividido = 0

            if(_pagamento_dividido && _pagamento_dividido._pagamentos && _pagamento_dividido._pagamentos.length){
                _pagamento_dividido._pagamentos.map((pag) => {
                    _vlr_total_dividido += (pag._vlr_dividido ? pag._vlr_dividido : 0)
                })
            }

            if(_vlr_total_carrinho && _vlr_total_dividido)
                return parseFloat(parseFloat(_vlr_total_carrinho - _vlr_total_dividido).toFixed(2))
            
            return _vlr_restante
        }
        PagamentoComponent.prototype._validarPagamentoDividido = function() {
            $('#btn-confirmar-pagamento-dividido').off('click').on('click', function(){ carrinho.instance.pagamento._validarPagamentoDividido(); })
            
            let pagamento_dividido = this.value && this.value.length ? this.value.find((pag) => { return pag.id === 'pagamento_dividido' }) : false
            if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){
                for(let pag of pagamento_dividido._pagamentos){
                    if(!pag.vlr_dividido){
                        this.pagamento_dividido_confirmado = ''
                        toastr.warning(`Informe um valor para o tipo de pagamento "${pag.nome_descritivo}" ou remova a opção selecionada para prosseguir.`);
                        return;
                    }
                }
            }

            if(converteMoedaFloat(parseFloat(this.vlr_restante_calculado).toLocaleFixed(2)) > 0){
                this.pagamento_dividido_confirmado = ''
                toastr.warning(`Selecione um novo método de pagamento para cobrir o valor restante de R$ ${parseFloat(this.vlr_restante_calculado).toLocaleFixed(2)} da sua compra ou altere os valores do(s) método(s) de pagamento(s) selecionado(s) para prosseguir.`);
                return;
            }

            if(converteMoedaFloat(parseFloat(this.vlr_restante_calculado).toLocaleFixed(2)) < 0){
                this.pagamento_dividido_confirmado = ''
                toastr.warning(`O valor restante não pode ser negativo. Altere os pagamentos selecionados para prosseguir.`);
                return;
            }

            this.pagamento_dividido_confirmado = true
            this._carregarTemplate();

            $('#modal_multiplos_pagamentos').modal('hide')
        }

        function CarrinhoConfirmacao(qtd_produtos, pacotes, vlr_subtotal, vlr_desconto_pbm, vlr_desconto_valor, vlr_frete, entrega, endereco, pagamento, cupom, informacoes_pbm, vlr_total)  {
            this.qtd_produtos = qtd_produtos;
            this.pacotes = pacotes;
            this._vlr_subtotal = vlr_subtotal;
            this._vlr_desconto_pbm = vlr_desconto_pbm;
            this._vlr_desconto_valor =  vlr_desconto_valor;
            this._vlr_frete = vlr_frete;
            this.endereco = endereco;
            this.pagamento = pagamento;
            this.informacoes_pbm = informacoes_pbm;
            this.cupom = cupom;

            this._vlr_total = vlr_total;

            $('#carrinho-confirmacao').html(this.template);

            onToggleCarrinhoPopUp('open', '#popupConfirmacao');

            let produtos = [];
            for (const pacote of this.pacotes) {
                for (const { _produto } of pacote._produtos) {
                    produtos.push({
                        id: _produto.produto_id,
                        price: _produto.valor_ini,
                        discount: _produto.valor_desc,
                        item_name: _produto.produto__nm_ecommerce,
                        promotion_name: _produto.descontoprodutopreco__desconto__tipo_id,
                        quantidade: _produto.quantidade,
                        currency: 'BRL',
                        index: _produto.origem_posicao,
                        item_list_name: _produto.origem_descricao,
                        item_list_id: _produto.origem_descricao ? _produto.origem_descricao.toLowerCase().replace(/\s/g, '_') : '',
                    });
                }
            }
            filtroParaDadosAnaliticos('InitiateCheckout', {
                currency: 'BRL',
                value: this._vlr_total,
                coupon: this.cupom && this.cupom.codigo ? this.cupom.codigo : '',
                items: produtos
            });
        }
        CarrinhoConfirmacao.prototype = {
            get qtd_pacotes() {
                return this.pacotes.length;
            },
            get vlr_subtotal() {
                return parseFloat(this._vlr_subtotal).toLocaleFixed(2);
            },
            get vlr_desconto_pbm() {
                return parseFloat(this._vlr_desconto_pbm).toLocaleFixed(2);
            },
            get vlr_desconto_valor() {
                return parseFloat(this._vlr_desconto_valor).toLocaleFixed(2);
            },
            get vlr_total() {
                return parseFloat(this._vlr_total).toLocaleFixed(2);
            },
            get vlr_frete() {
                return this.cupom && this.cupom.is_frete_gratis ? parseFloat(0).toLocaleFixed(2) : parseFloat(this._vlr_frete).toLocaleFixed(2);
            },
            get template() {

                let pagamento_dividido = this.pagamento && this.pagamento.length ? this.pagamento.find((pag) => { return pag.id === 'pagamento_dividido' }) : false;

                let html_template = ``;
                
                for (const pacote of this.pacotes) {
                    html_template += `
                    <div class="rounded py-2 mt-3" style="margin-left:16px;margin-right:16px;background-color: #f0f2f5;">
                        <p class="blueText font-weight-bold font-xl text-limit-1" style="font-size:14px;margin-left:16px;margin-right:16px;">`;
                    if (pacote.entrega._value.tipo_codigo === 'retirada') {
                        if(pacote.entrega._value.nome === 'retirada'){
                            html_template += `
                                    Pacote ${pacote.index} ( ${pacote.produtos.length} ite${pacote.produtos.length > 1 ? 'ns' : 'm'} ) - ${pacote.entrega._value.nome_descritivo} em ${title(pacote.entrega._value.filial.nm_filial)}
                                `;
                        } else {
                            html_template += `
                                    Pacote ${pacote.index} ( ${pacote.produtos.length} ite${pacote.produtos.length > 1 ? 'ns' : 'm'} ) - ${pacote.entrega._value.nome_descritivo} em ${title(pacote.entrega._value.filial.endereco)}, ${pacote.entrega._value.filial.numero} - ${pacote.entrega._value.filial.bairro}
                                `;
                        }

                    }
                    else if (pacote.entrega._value.is_programada) {
                        html_template += `
                                    Pacote ${pacote.index} ( ${pacote.produtos.length} ite${pacote.produtos.length > 1 ? 'ns' : 'm'} ) - ${pacote.entrega._value.nome_descritivo} - ${pacote.entrega._value._faixa_entrega.descricao_combobox.split('%quebralinha%')[0] + ' ' + pacote.entrega._value._faixa_entrega.descricao_combobox.split('%quebralinha%')[1]}
                                `;
                    }
                    else {
                        html_template += `
                                    Pacote ${pacote.index} ( ${pacote.produtos.length} ite${pacote.produtos.length > 1 ? 'ns' : 'm'} ) - ${pacote.entrega._value.nome_descritivo}
                                `;
                            }
                            html_template += `
                        </p> `;

                        if(carrinho.instance._mensagem[pacote.index - 1]){
                            html_template += `
                                <p class="text-dark" style="margin-left:16px;margin-right:16px;font-size: 13px !important;">
                                    ${carrinho.instance._mensagem[pacote.index - 1]}
                                </p>
                            </div>`
                        } else {
                            html_template += `</div>`
                        }

                }

                let html_pagamento = ``;

                if(pagamento_dividido && pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length){

                    html_pagamento += `
                        <div class="row align-items-center m-0 p-0 mt-1" style="font-size:13px; margin-left:16px !important; margin-right:16px !important;">
                            <div class="col-12 m-0 p-0">
                                <p class="font-weight-bold">
                                    ${pagamento_dividido.nome_descritivo}:
                                </p>
                            </div>
                    `;

                    pagamento_dividido._pagamentos.map((pay) => {
                        html_pagamento += `
                            <div class="col-12 d-flex m-0 p-0 mt-2">
                                <img width="42" class="mr-2" alt="pagamento" src="/media/${pay.imagem}"/>
                                <div>
                                    <p class="font-weight-semibold">
                                        ${pay.nome_descritivo}
                                    </p>
                                    <p class="small text-muted">
                                        ${pay.qtd_parcelas ? pay.qtd_parcelas : 1}x R$${(pay._vlr_dividido / parseFloat(pay.qtd_parcelas ? pay.qtd_parcelas : 1)).toLocaleFixed(2)}
                                    </p>
                                </div>
                            </div>
                        `;
                    })

                    html_pagamento += `</div>`;
                } else {
                    for(const pay of this.pagamento){
                        html_pagamento += `
                            <div class="d-flex align-items-center mt-1" style="font-size:13px; margin-left:16px; margin-right:16px;">
                                <img width="45" class="mr-2" alt="pagamento" src="/media/${pay.imagem}"/>
                                <div>
                                    <p class="font-weight-semibold">
                                        ${pay.nome_descritivo}
                                    </p>
                                    <p class="small text-muted">
                                        ${pay.qtd_parcelas ? pay.qtd_parcelas : 1}x R$${(pay._vlr_total / parseFloat(pay.qtd_parcelas ? pay.qtd_parcelas : 1)).toLocaleFixed(2)}
                                    </p>
                                </div>
                            </div>
                        `;
                    }
                }

                let html_cashback = ``;
                try {
                    let vlr_cashback = 0
                    if(pagamento_dividido){
                        vlr_cashback = pagamento_dividido._pagamentos && pagamento_dividido._pagamentos.length ? pagamento_dividido._pagamentos[0]._pagamentos._carrinho._vlr_cashback : 0
                    } else {
                        vlr_cashback = this.pagamento[0]._pagamentos._carrinho._vlr_cashback
                    }
                    if (vlr_cashback > 0){
                        html_cashback += `
                            <p class="font-weight-bold mt-3" style="color:#1cb05c !important;font-size:13px;margin-left:16px;margin-right:16px;">
                                Você receberá R$${vlr_cashback} de dinheiro de volta por essa compra
                            </p>
                        `;
                    }   
                } catch (error) {}

                let template_retorno = `
                    <div class="mt-3" style="margin-left:16px;margin-right:16px;">
                        <p class="text-dark font-weight-bold font-xl" style="font-size:14px;">${this.qtd_produtos} Produto${this.qtd_produtos == 1 ? '' : 's'}</p>
                        <p class="font-weight-semibold" style="font-size:13px;">Dividido${this.qtd_pacotes == 1 ? '' : 's'} em ${this.qtd_pacotes} pacote${this.qtd_pacotes == 1 ? '' : 's'}</p>
                    </div>

                    ${html_template}
                    `;
                    for (const pacote of this.pacotes) {
                        if(pacote.index == 1){
                            if(pacote.entrega._value.tipo_codigo === 'retirada' || pacote.entrega._value.is_programada || pacote.is_digital){

                            } else {
                                    template_retorno  += `<div class="mt-2 pt-2">
                                        <p class="text-dark font-weight-bold font-xl" style="font-size:14px;margin-left:16px;margin-right:16px;">Endereço</p>
                                        <div class="d-flex align-items-center mt-1" style="font-size:13px;margin-left:16px;margin-right:16px;">
                                            <img alt="icone" width="40" height="40" class="mr-3" src="/staticfiles/img/carrinho/icon_endereco.svg">
           	                                <div>
           	                                    <p class="text-nowrap text-md fontOutfitRegular" style="color:#444444">${this.endereco.endereco}</p>
           	                                    <p class="text-nowrap text-sm fontOutfitMedium">${this.endereco.municipio}</p>
           	                                </div>
                                        </div>
                                    </div>`;
                            }
                        }
                    }

                    template_retorno += `<div class="mt-2 pt-2" >
                        <p class="text-dark font-weight-bold font-xl" style="font-size:14px;margin-left:16px;margin-right:16px;">Forma de Pagamento</p>
                        ${html_pagamento}
                        ${html_cashback}
                    </div>

                    <div class="mt-3 pt-2" style="border-top: 2px solid var(--light);">
                        
                        <div class="d-flex align-items-center justify-content-between font-weight-semibold small" style="margin-left:16px;margin-right:16px;">
                            <span>Desconto:</span>
                            <span>${this.vlr_desconto_valor ? this.vlr_desconto_valor : "R$ 00,00"}</span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between font-weight-semibold small" style="margin-left:16px;margin-right:16px;">
                            <span>Subtotal:</span>
                            <span>R$ ${this.vlr_subtotal}</span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between font-weight-semibold small" style="margin-left:16px;margin-right:16px;">
                            <span>Frete:</span>
                            <span>R$ ${this.vlr_frete}</span>
                        </div>`;

                    if (this.cupom && this.cupom.vlr_cupom) {
                        template_retorno += `
                                <div class="d-flex align-items-center justify-content-between font-weight-semibold small" style="margin-left:16px;margin-right:16px;">
                                    <span>Desconto:</span>
                                    <span>R$ ${parseFloat(this.cupom.vlr_cupom).toLocaleFixed(2)}</span>
                                </div>
                            `;
                    }

                    template_retorno += `<div class="d-flex align-items-center justify-content-between font-xl font-weight-bold blueText py-2" style="margin-left:16px;margin-right:16px;">
                            <span>Total:</span>
                            <span>R$${this.vlr_total}</span>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button class="btn botaoPrincipal text-white py-2 w-100" onclick="carrinho.instance.popupConfirmacao._confirmar()">
                            <span class="font-weight-bold text-nowrap font-xl">Finalizar Compra</span>
                        </button>
                    </div>
                `;
                return template_retorno;
            }
        }
        CarrinhoConfirmacao.prototype._confirmar = function() {
            toastr.options.target = null;
            const pacotes = [];
            var endereco = $.extend(true, {}, this.endereco);
            delete endereco._enderecos;
            endereco = removeTemplates(endereco);
            for (const pacote of this.pacotes) {
                const _pacote = $.extend(true, {}, pacote);
                delete _pacote._carrinho;
                delete _pacote.filial;
                delete _pacote.entregas;
                delete _pacote.produtos;
                const entrega = $.extend(true, {}, _pacote.entrega);
                delete entrega._pacote;
                delete entrega.value;
                delete entrega.entregasDoTipo;
                delete entrega._entregasDoTipo;
                delete entrega.entregas;
                delete entrega._tipo_entrega;
                delete entrega.filial;

                _pacote.entrega = entrega;

                const entregaValor = $.extend(true, {}, _pacote.entrega._value);
                delete entregaValor._entrega_component;

                _pacote.entrega._value = entregaValor;

                if(_pacote.entrega && _pacote.entrega.is_frete_gratis){
                    _pacote.entrega._value && _pacote.entrega._value.vlr_frete ? _pacote.entrega._value._vlr_frete = 0 : null
                }

                if (_pacote.entrega._value.entrega_complemento) {
                    const entregaComplemento = $.extend(true, {}, _pacote.entrega._value.entrega_complemento);
                    delete entregaComplemento._entrega;
                    _pacote.entrega._value.entrega_complemento = entregaComplemento;
                }

                const _produtos = [];
                for (const produto of pacote._produtos) {
                    const _produto = $.extend(true, {}, produto);
                    delete _produto._pacote;
                    _produtos.push(_produto);
                }
                _pacote._produtos = _produtos;
                pacotes.push(removeTemplates(_pacote));
            }
            const pagamentos = [];
            for (const pay of this.pagamento) {
                const payment = _.cloneDeep(pay)
                delete payment._pagamentos;
                delete payment._carrinho;
                delete payment._meus_pagamentos;
                delete payment._tipos_pagamento;
                payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento.convenio : ''
                payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento._pagamentos : ''
                
                if(payment.value && payment.value.length)
                    payment.value.map((pag) => { pag._pagamentos ? delete pag._pagamentos : null })

                if (payment.folha_pagamento) {
                    payment.lista_parcelas = payment.folha_pagamento.parcelas
                }
                payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento.folha_pagamento : ''
                payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento._pagamentos : ''

                if (payment.cartao) {
                    delete payment.cartao._pagamento;
                }
                pagamentos.push(removeTemplates(payment));
            }

            let button = $("#carrinho-confirmacao .btn")
        
            button.addClass('disabled')
                    setTimeout(() => {
                        button.removeClass('disabled')
                    }, 30000);

            toastr.options.target = 'body';
            load('on', $('#popupConfirmacao'));
            $.ajax({
                type: "POST",
                url: "/pedido/fazer",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    lista_pacotes: JSON.stringify(pacotes),
                    endereco: JSON.stringify(endereco),
                    pagamento: JSON.stringify(pagamentos),
                    cupom: JSON.stringify(this.cupom),
                    informacoes_pbm: JSON.stringify(this.informacoes_pbm),
                    origin: originCarrinho ? originCarrinho : '',
                    //session_key: typeof(SIGNIFYD_GLOBAL) === 'object' && SIGNIFYD_GLOBAL.scriptTagHasLoaded() ? 'None' : '',
                    session_key: 'None',
                },
                success: (data) => {
                    if (data) {
                        if (data.status === true) {
                            if (data.ultimo_status_pagamento === 'pedido_pendente' || data.ultimo_status_pagamento === 'pagamento_pendente') {

                                let produtos = [];
                                for (const pacote of this.pacotes) {
                                    for (const { _produto } of pacote._produtos) {
                                        produtos.push({
                                            id: _produto.produto_id,
                                            price: _produto.valor_ini,
                                            discount: _produto.valor_desc,
                                            item_name: _produto.produto__nm_ecommerce,
                                            promotion_name: _produto.descontoprodutopreco__desconto__tipo_id,
                                            quantidade: _produto.quantidade,
                                            currency: 'BRL',
                                            index: _produto.origem_posicao,
                                            item_list_name: _produto.origem_descricao,
                                            item_list_id: _produto.origem_descricao ? _produto.origem_descricao.toLowerCase().replace(/\s/g, '_') : '',
                                        });
                                    }
                                }

                                filtroParaDadosAnaliticos('Purchase', {
                                    currency: 'BRL',
                                    value: this._vlr_total,
                                    items: produtos,
                                    shipping: this._vlr_frete,
                                    affiliation: 'Online Store',
                                    coupon: this.cupom && this.cupom.codigo ? this.cupom.codigo : '',
                                    transaction_id: data.pedido_id
                                });
                            }
                            carrinho.instance._deleteCarrinho();
                            document.location.href = "/cliente/pedido/0".replace(0, data.pedido_hash);
                        }
                        else {
                            load('off', $('#popupConfirmacao'));
                            toastr.error(data.descricao, 'Erro');

                             if(pagamentos && pagamentos.length > 0 && pagamentos[0].id === 'credito'){
                                 Mercadopago.clearSession()
                                 let $form = document.querySelector('#pay_fast');
                                 Mercadopago.createToken($form, pegarTokenSeForCartao);
                             }
                        }
                    }
                },
                error: (data) => {
                    load('off', $('#popupConfirmacao'));
                }
            });
        }

        function CarrinhoComponent() {
            this.id = null;
            this.passoAtual = 'entregas';
            this.endereco = new EnderecoComponent();
            this.pagamento = new PagamentoComponent(this);
            this._atualizarCarrinho();
            this._index = null
            this._mensagem = []
            this._vlr_minimo_multiplos_pagamentos = null

            if(this._getCarrinho() && this._getCarrinho().passoAtual && this._getCarrinho().passoAtual != 'entregas'){

                this.passoAtual = this._getCarrinho().passoAtual

                this._carregarTemplate();
                this._atualizarProgressoCarrinho();
            }
        }
        CarrinhoComponent.prototype = {
            get valid() {
               return this._validacaoEndereco() && this._validacaoPacotes() && this.pagamento.valid;
            },
            get passos() {
                return [
                    {
                        nome: 'entregas',
                        valid: () => {
                            return this._validacaoEndereco() && this._validacaoPacotes() && this._validacaoReceita();
                        },
                        progresso: () => {
                            return this._validacaoPacotes() ? 75 : 25
                        },
                        texto: () => {
                            if("False" === "True"){
                                return this._validacaoPacotes() ? 'Continuar' : 'Escolher Entrega';
                            }
                            else {
                                return 'Entrar ou Cadastrar';
                            }
                        }
                    },
                    {
                        nome: 'pagamentos',
                        valid: () => {
                            return this.pagamento.valid;
                        },
                        texto: () => {
                            return 'Finalizar Compra';
                        },
                        progresso: () => {
                            return 100
                        }
                    }
                ];
            },
            get saldo_cashback() {
                return this._saldo_cashback ? this._saldo_cashback.toLocaleFixed(2) : (0).toLocaleFixed(2);
            },
            set saldo_cashback(value) {
                this._saldo_cashback = +value > 0 ? +value : 0;
            },
            get vlr_cashback() {
                return this._vlr_cashback && this._vlr_cashback.toLocaleFixed(2) ? this._vlr_cashback.toLocaleFixed(2) : (0).toLocaleFixed(2);
            },
            set vlr_cashback(value) {
                this._vlr_cashback = +value;
            },
            get cupom() {
                return this._cupom;
            },
            set cupom(value) {

                if (value) {
                    const pacotes = [];
                    var endereco = $.extend(true, {}, this.endereco.value);
                    delete endereco._enderecos;
                    endereco = removeTemplates(endereco);

                    if(this.pacotes && this.pacotes.length){
                        for (const pacote of this.pacotes) {
                            const _pacote = $.extend(true, {}, pacote);
                            delete _pacote._carrinho;
                            delete _pacote.filial;
                            delete _pacote.entregas;
                            delete _pacote.produtos;
                            const entrega = $.extend(true, {}, _pacote.entrega);
                            delete entrega.value;
                            delete entrega._pacote;
                            delete entrega.entregasDoTipo;
                            delete entrega._entregasDoTipo;
                            delete entrega.entregas;
                            delete entrega._tipo_entrega;
                            delete entrega.filial;

                            _pacote.entrega = entrega;

                            const entregaValor = $.extend(true, {}, _pacote.entrega._value);
                            delete entregaValor._entrega_component;

                            _pacote.entrega._value = entregaValor;

                            if (_pacote.entrega._value.entrega_complemento) {
                                const entregaComplemento = $.extend(true, {}, _pacote.entrega._value.entrega_complemento);
                                delete entregaComplemento._entrega;

                                _pacote.entrega._value.entrega_complemento = entregaComplemento;
                            }

                            const _produtos = [];
                            for (const produto of pacote._produtos) {
                                const _produto = $.extend(true, {}, produto);
                                delete _produto._pacote;
                                _produtos.push(_produto);
                            }
                            _pacote._produtos = _produtos;
                            pacotes.push(removeTemplates(_pacote));
                        }
                    }

                    const pagamentos = [];
                    if(this.pagamento && this.pagamento.value && this.pagamento.value.length > 0){
                        for (const pay of this.pagamento.value) {
                            const payment = _.cloneDeep(pay)
                            delete payment._pagamentos;
                            delete payment._carrinho;
                            delete payment._meus_pagamentos;
                            delete payment._tipos_pagamento;
                            payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento.convenio : ''
                            payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento._pagamentos : ''
                            payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento.folha_pagamento : ''
                            payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento._pagamentos : ''
                            if (payment.cartao) {
                                delete payment.cartao._pagamento;
                            }
                            pagamentos.push(removeTemplates(payment));
                        }
                    }

                    load('on', $('.asidebar'));
                    $.ajax({
                        type: "POST",
                        url: "/cupom/validar",
                        data: {
                            csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                            lista_pacotes: JSON.stringify(pacotes),
                            endereco: JSON.stringify(endereco),
                            pagamento: JSON.stringify(pagamentos),
                            cupom: JSON.stringify(value)
                        },
                        success: (data) => {
                            load('off', $('.asidebar'));
                            if (data.status) {
                                this._cupom = {
                                    codigo: data.codigo,
                                    cupom_id: data.cupom_id,
                                    vlr_cupom: data.vlr_cupom,
                                    is_frete_gratis: data.is_frete_gratis,
                                    pacotes: data.pacotes
                                };
                            } else {
                                toastr.error(data.descricao, 'Erro');
                            }
                            for (const pacote of carrinho.instance.pacotes) {
                                pacote.entrega._logicaFrete()
                            }
                            carrinho.instance._setCarrinho();
                            this._carregarTemplate();
                        },
                        error: (data) => {
                            load('off', $('.asidebar'));
                        }
                    });
                }
                else {
                    this._cupom = {
                        cupom_id: '',
                        codigo: '',
                        vlr_cupom: 0,
                        is_frete_gratis: false,
                        pacotes: [],
                    };
                    for (const pacote of carrinho.instance.pacotes) {
                        pacote.entrega._logicaFrete()
                    }
                    this._carregarTemplate();
                }
            },
            get passoAtual() {
                return this._passoAtual;
            },
            set passoAtual(value) {
                this._passoAtual = value;
                this._atualizarProgressoCarrinho();
            },
            get pacotes() {
                return this._pacotes;
            },
            set pacotes(value) {
                const packages = [];
                for (const index in value) {
                    const pac = value[index];
                    let i = parseFloat(index) + 1;
                    packages.push(new Pacote(i, i, pac.produtos, pac.entregas, pac.completo, pac, this));
                }

                this._pacotes = packages;
                this._carregarTemplate();
            },
            get qtd_itens() {
                return this._qtd_itens;
            },
            set qtd_itens(value) {
                this._qtd_itens = value;
                this._carregarTemplate();
            },
            get vlr_subtotal() {
                return this._vlr_subtotal;
            },
            set vlr_subtotal(value) {
                if (value) {
                    if (value != this.value) {
                        this._vlr_subtotal = parseFloat(value);
                    }
                }
                else {
                    this._vlr_subtotal = 0;
                }
                this._carregarTemplate();
            },
            get vlr_subtotal_sem_marketplace() {
                return this._vlr_subtotal_sem_marketplace;
            },
            set vlr_subtotal_sem_marketplace(value) {
                if (value) {
                    this._vlr_subtotal_sem_marketplace = parseFloat(value);
                } else {
                    this._vlr_subtotal_sem_marketplace = 0;
                }
                this._carregarTemplate();
            },
            get entrega_alterada() {
                return this._entrega_alterada;
            },
            set entrega_alterada(value) {
                this._entrega_alterada = value;
            },
            get vlr_frete() {
                let f = 0;
                let entregas = [];
                this.pacotes ? this.pacotes.map(({ entrega }) => {
                    if(entrega && entrega.value){
                        if (entrega.value._vlr_frete) {
                            f += +entrega.value._vlr_frete;
                        }
                        entregas.push({
                            price: entrega.value._vlr_frete ? entrega.value._vlr_frete : 0,
                            item_id: entrega.value.nome ? entrega.value.nome : '',
                            item_name: entrega.value.nome_descritivo ? entrega.value.nome_descritivo : '',
                            currency: 'BRL',
                        });
                    }
                }) : '';
                if (entregas.length > 0 && this.entrega_alterada) {
                    this.entrega_alterada = false;
                    filtroParaDadosAnaliticos('AddShippingInfo', {
                        value: f,
                        currency: 'BRL',
                        coupon: this.cupom && this.cupom.codigo ? this.cupom.codigo : '' ,
                        items: entregas,
                    });
                }
                return f;
            },
            get vlr_frete_gratis() {
                return this._vlr_frete_gratis;
            },
            set vlr_frete_gratis(value) {
                this._vlr_frete_gratis = value;
                this._carregarTemplate();
            },
            get vlr_restante_frete_gratis() {
                return this._calculaRestanteFreteGratis();
            },
            get vlr_restante_frete_gratis_sem_marketplace() {
                return this._calculaRestanteFreteGratisSemMarketplace();
            },
            get perc_restante_frete_gratis() {
                return this._calculaPercentualFreteGratis();
            },
            get perc_restante_frete_gratis_sem_marketplace() {
                return this._calculaPercentualFreteGratisSemMarketplace();
            },
            get texto_frete_gratis() {
                // if (this.vlr_restante_frete_gratis_sem_marketplace > 0) {
                //     return `Faltam apenas <span class="font-weight-semibold text-danger">R$ ${parseFloat(this.vlr_restante_frete_gratis_sem_marketplace).toLocaleFixed(2)}</span> para <span class="font-weight-bold text-danger">Frete Grátis</span> na Entrega`;
                // }
                // else {
                //     return `Parabéns seu Frete é <span class="font-weight-semibold text-danger">GRÁTIS *</span>`;
                // }
                //return `<p class="fontOutfitMedium" style="font-size: 1rem;"><span class="blueText fontOutfitBold">Frete Grátis</span> nas compras acima de <span class="blueText fontOutfitBold">R$ ${parseFloat(this.vlr_frete_gratis ? this.vlr_frete_gratis : 'R$ 200,00').toLocaleFixed(2)}</span> para pedidos agendados.<p>`;
                return `<p class="fontOutfitMedium" style="font-size: 1rem;"><span class="blueText fontOutfitBold">Entrega Rápida e Segura</span><p>`;
            },
            get vlr_total_calculado() {
                return this._calculaVlrTotal();
            },
            get vlr_total_convenio(){
                return this._vlr_total_convenio ? this._vlr_total_convenio : 0;
            },
            get vlr_total_folha_pagamento(){
                return this._vlr_total_folha_pagamento ? this._vlr_total_folha_pagamento : 0;
            },
            get informacoes_pbm() {
                return this._informacoes_pbm;
            },
            set informacoes_pbm(value) {
                this._informacoes_pbm = value;
            },
            get pacotes_juntos() {
                return this._pacotes_juntos;
            },
            set pacotes_juntos(value) {
                this._pacotes_juntos = value;
                this._atualizarCarrinho();
            },
            get index() {
                return this._index
            },
            set index(value) {
                this._index = value
            },
            get mensagem() {
                return this._mensagem
            },
            set mensagem(value) {
                this._mensagem[this._index] = value
            },
            get popupConfirmacao() {
                return this._popupConfirmacao;
            },
            set popupConfirmacao(value) {
                this._popupConfirmacao = value;
            },
            set submit_retirada_por_terceiro(value) {
                this._submit_retirada_por_terceiro = value ? value : false
            },
            get is_controlado() {
                return this._is_controlado
            },
            set is_controlado(value) {
                this._is_controlado = value
            },
            get receitas(){
                return this._receitas
            },
            set receitas(value) {
                this._receitas = value
            },
            get is_validar_receita(){
                return this._is_validar_receita
            },
            set is_validar_receita(value) {
                this._is_validar_receita = value
            },
            get is_validar_controlado(){
                return this._is_validar_controlado
            },
            set is_validar_controlado(value){
                this._is_validar_controlado = value
            },
            get carrinhoStorage() {
                return this._getCarrinho()
            },
            get is_multiplos_pagamentos(){
                return this._is_multiplos_pagamentos;
            },
            set is_multiplos_pagamentos(value){
                this._is_multiplos_pagamentos = value;
            },
            get qtd_max_pagamentos_diferentes(){
                return this._qtd_max_pagamentos_diferentes;
            },
            set qtd_max_pagamentos_diferentes(value){
                this._qtd_max_pagamentos_diferentes = value ? parseInt(value) : null;
            },
            get vlr_minimo_multiplos_pagamentos(){
                return this._vlr_minimo_multiplos_pagamentos;
            },
            set vlr_minimo_multiplos_pagamentos(value){
                this._vlr_minimo_multiplos_pagamentos = value ? parseInt(value) : null;
            },
            get is_marketplace(){
                return this._is_marketplace;
            },
            set is_marketplace(value){
                this._is_marketplace = value;
            },
            get template() {

                if (this.passoAtual === this.passos[0].nome) {
                    let html_template = ``;
                    if(this.is_controlado || (this.receitas && this.receitas.length)){
                        /*html_template += `
                            <div class="labl labl-background" style="border-radius: 7px;margin:0px 16px;">
                                <label class="card text-body my-1" style="background-color: ${this.is_controlado && (!this.receitas || !this.receitas.length) ? '#ee3a41' : '#1cb05c'}">
                                    <div class="card-body align-items-center py-2">
                                        <div class="row justify-content-between align-items-center pl-1 pl-md-2 pr-1 pr-md-2">
                                            <p class="text-white text-uppercase font-weight-bold font-xl">${!this.receitas || !this.receitas.length ? 'Insira uma receita' : this.receitas && this.receitas.length === 1 ? 'Receita anexada com sucesso' : this.receitas && this.receitas.length > 1 ? 'Receitas anexadas com sucesso' : 'Insira uma receita'}</p>
                                            <div class="btn btn-sm text-white" onclick="carrinho.instance._visualizarReceita();" style="background-color:#fff">
                                                <span style="height:10px;width:10px;" class="icon_plus small font-weight-black align-middle font-lg text-dark"></span>
                                            </div>
                                        </div> `*/
                        if(this.receitas && this.receitas.length){
                            this.receitas.forEach(receita => {
                                html_template += `
                                    <div class="row align-items-center justify-content-between pl-1 pl-md-2 pr-1 pr-md-2 mt-2">
                                        <p class="text-white font-weight-semibold font-lg">Cód. ${receita.id}</p>
                                        <span class="d-flex pr-1">
                                            ${receita.is_digital ? `
                                                <p classs="pr-md-2 font-weight-semibold" style="color:#fff !important;">Token: ${receita.token}</p>
                                            ` : `
                                                <a href="${receita.imagem && receita.imagem.includes('media/') ? receita.imagem : '/media/' + receita.imagem}" target="_blank" class="pr-md-2 text-white font-weight-semibold font-lg">Ver receita</a>
                                            `}
                                            <div class="cursor-pointer d-flex align-items-center ml-2" onclick="carrinho.instance._excluirReceita(${receita.id})">
                                                <span class="icon_trash" style="color:#fff !important;"></span>
                                            </div>
                                        </span>
                                    </div>
                                `
                            });
                        }

                        html_template += `</div>
                                </label>
                            </div>
                        `
                    }
                    if(this.pacotes){
                        html_template += $.map(this.pacotes, (elem) => {
                            return elem.template;
                        }).join('');
                    }
                    if (this.pacotes && this.pacotes.length > 0) {
                        if (this.pacotes.length > 1 || this.pacotes_juntos) {
                            html_template += `
                        <div class="labl labl-background px-3">
           	                <input type="radio" required="" ${this.pacotes_juntos ? 'checked' : ''} name="carrinho-juntar-pacotes" onclick="carrinho.instance.pacotes_juntos = '${this.pacotes_juntos ? '' : 'on'}'; carrinho.instance._index = null; carrinho.instance._resetEntregas();carrinho.instance._resetPagamentos();" id="carrinho-juntar-pacotes" autocomplete="off" value="1">
           	                <label for="carrinho-juntar-pacotes" class="card text-body my-1" style="height:60px; background-color: #fff; border: 2px solid var(--primary) !important;">
           	                    <div class="card-body pt-2 pb-2 d-flex align-items-center justify-content-center text-center">
           	                        <div>
           	                            <p class="text-primary text-limit-1 font-weight-semibold">Juntar tudo em um pacote</p>
           	                            <p class="font-weight-semibold text-body text-limit-1">(pode aumentar o prazo de entrega)</p>
           	                        </div>
           	                    </div>
           	                </label>
           	            </div>`;
                        }
                        html_template += `<p class="mt-3 text-center text-muted cursor-pointer font-weight-semibold" onclick="onToggleCarrinhoPopUp('open', '#popupInformacaoPacote');">
                        <span class="rounded-circle text-white mr-2 font-weight-semibold" onclick="onToggleCarrinhoPopUp('open', '#popupInformacaoPacote');" style="background-color: #989898;cursor:pointer;padding: 3px 8px 3px 8px;">?</span>
                        Saiba mais sobre os pacotes
                    </p>
                    `;
                    }

                    if (!html_template) {
                        html_template = `
                        <div class="row">
                            <div class="col-12 px-0 overflow-hidden" id="carrinho-lista_produtos">
                                <div class="row  mt-3">
                                    <div class="col-12 text-center">
                                            <span class="font-xl fontOutfitBold">Sua cesta está vazia!</span>
                                            <p class="mt-2 text-muted fontOutfitBold small">Adicione produtos à sua cesta e eles aparecerão aqui.</p>
                                    </div>
                                    <div class="col"></div>
                                    <div class="col-6 mt-5">
                                        <img src="/staticfiles/img/carrinho/cesta_vazia.svg" class="w-100"   width="300" height='300'  style="max-height:calc( 100vh - 26.25rem) !important;" alt="carrinho vazio">
                                    </div>
                                    <div class="col"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    }

                    // Pacotes
                    return html_template;
                }
                else if (this.passoAtual === this.passos[1].nome) {
                    // Pagamento
                    return this.pagamento.template;
                }
            }
        };

        CarrinhoComponent.prototype._calculaVlrTotalFloat = function () {
            const vlrSubTotal = +this.vlr_subtotal ? +this.vlr_subtotal : 0;
            const vlrFrete = this.cupom && this.cupom.is_frete_gratis ? 0 : +this.vlr_frete ? +this.vlr_frete : 0;
            const vlrCupom = this.cupom && this.cupom.vlr_cupom ? this.cupom.vlr_cupom : 0;
            const calculo1 = vlrSubTotal + vlrFrete;
            const calculo2 = calculo1 - vlrCupom;

            return calculo2;
        },
        CarrinhoComponent.prototype._calculaVlrTotal = function () {
            return this._calculaVlrTotalFloat().toLocaleFixed(2) ? this._calculaVlrTotalFloat().toLocaleFixed(2) : (0).toLocaleFixed(2);
        },
        CarrinhoComponent.prototype._calculaRestanteFreteGratis = function () {
            const calculo = +this.vlr_frete_gratis - +this.vlr_subtotal
            return calculo > 0 ? calculo : 0
        },
        CarrinhoComponent.prototype._calculaPercentualFreteGratis = function () {
            //return (this.vlr_frete_gratis * +this.vlr_subtotal) / 100 > 100 ? 100 : (this.vlr_frete_gratis * +this.vlr_subtotal) / 100;
            return (+this.vlr_subtotal / +this.vlr_frete_gratis) * 100 > 100 ? 100 : (+this.vlr_subtotal / +this.vlr_frete_gratis) * 100 
        },
        CarrinhoComponent.prototype._calculaRestanteFreteGratisSemMarketplace = function () {
            const calculo = +this.vlr_frete_gratis - +this.vlr_subtotal_sem_marketplace
            return calculo > 0 ? calculo : 0
        },
        CarrinhoComponent.prototype._calculaPercentualFreteGratisSemMarketplace = function () {
            //return (this.vlr_frete_gratis * +this.vlr_subtotal_sem_marketplace) / 100 > 100 ? 100 : (this.vlr_frete_gratis * +this.vlr_subtotal_sem_marketplace) / 100;
            return (+this.vlr_subtotal_sem_marketplace / +this.vlr_frete_gratis) * 100 > 100 ? 100 : (+this.vlr_subtotal_sem_marketplace / +this.vlr_frete_gratis) * 100 
        },
        CarrinhoComponent.prototype._calculaVlrTotalSemConvenio = function (){
            return parseFloat(this._calculaVlrTotal) - parseFloat(this.vlr_total_convenio);
        },
        CarrinhoComponent.prototype._calculaVlrTotalSemFolhaPagamento = function (){
            return parseFloat(this._calculaVlrTotal) - parseFloat(this.vlr_total_folha_pagamento);
        },
        CarrinhoComponent.prototype._atualizarCashback = function () {
            load('on', $('.asidebar'));
            $.ajax({
                type: "POST",
                url: "/cashback/buscar",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw'
                },
                success: (data) => {
                    load('off', $('.asidebar'));
                    this.saldo_cashback = data.valor;
                },
                error: (data) => {
                    load('off', $('.asidebar'));
                }
            });
            if (this.pacotes.length > 0) {
                const pacotes = [];
                var endereco = $.extend(true, {}, this.endereco.value);
                delete endereco._enderecos;
                endereco = removeTemplates(endereco);
                for (const pacote of this.pacotes) {
                    const _pacote = _.cloneDeep(pacote)
                    delete _pacote._carrinho;
                    delete _pacote.filial;
                    delete _pacote.entregas;
                    delete _pacote.produtos;
                    const entrega = _.cloneDeep(_pacote.entrega)
                    delete entrega.value;
                    delete entrega._pacote;
                    delete entrega.entregasDoTipo;
                    delete entrega._entregasDoTipo;
                    delete entrega.entregas;
                    delete entrega._tipo_entrega;
                    delete entrega.filial;

                    _pacote.entrega = entrega;

                    const entregaValor = _.cloneDeep(_pacote.entrega._value);
                    entregaValor ? delete entregaValor._entrega_component : ''
                    entregaValor ? delete entregaValor._valid : ''

                    _pacote.entrega._value = entregaValor;

                    if (_pacote && _pacote.entrega && _pacote.entrega._value && _pacote.entrega._value.entrega_complemento) {
                        const entregaComplemento = _.cloneDeep(_pacote.entrega._value.entrega_complemento);
                        entregaComplemento ? delete entregaComplemento._entrega : ''
                        entregaComplemento && entregaComplemento._faixa_componente ? delete entregaComplemento._faixa_componente : ''
                        entregaComplemento && entregaComplemento._loja_componente ? delete entregaComplemento._loja_componente : ''
                        _pacote.entrega._value.entrega_complemento = entregaComplemento;
                    }

                    const _produtos = [];
                    for (const produto of pacote._produtos) {
                        const _produto = $.extend(true, {}, produto);
                        delete _produto._pacote;
                        _produtos.push(_produto);
                    }
                    _pacote._produtos = _produtos;

                    if(_pacote && _pacote.template)
                        delete _pacote.template;

                    pacotes.push(_pacote);
                }
                const pagamentos = [];
                if (this.pagamento && this.pagamento.value && this.pagamento.value.length > 0) {
                    for (const pay of this.pagamento.value) {
                        const payment = _.cloneDeep(pay)
                        delete payment._pagamentos;
                        delete payment._carrinho;
                        delete payment._meus_pagamentos;
                        delete payment._tipos_pagamento;
                        payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento.convenio : ''
                        payment.convenio && payment.convenio._pagamento ? delete payment.convenio._pagamento._pagamentos : ''
                        payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento.folha_pagamento : ''
                        payment.folha_pagamento && payment.folha_pagamento._pagamento ? delete payment.folha_pagamento._pagamento._pagamentos : ''
                        if (payment.cartao) {
                            delete payment.cartao._pagamento;
                        }
                        pagamentos.push(removeTemplates(payment));
                    }
                }
                $.ajax({
                    type: "POST",
                    url: "/cashback/calcular",
                    data: {
                        csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                        lista_pacotes: JSON.stringify(pacotes),
                        endereco: JSON.stringify(endereco),
                        pagamento: JSON.stringify(pagamentos),
                        cupom: JSON.stringify(this.cupom)
                    },
                    success: (data) => {
                        load('off', $('.asidebar'));
                        this.vlr_cashback = data.valor;
                        this._carregarTemplate();
                    },
                    error: (data) => {
                        load('off', $('.asidebar'));
                    }
                });
            }
            else {
                this.vlr_cashback = 0;
                this._carregarTemplate();
            }
        },
        CarrinhoComponent.prototype._atualizarCarrinho = function () {

            load('on', $('.asidebar'));

            if (this.endpointPacotes) {
                this.endpointPacotes.abort();
            }

            let _this = this

            this.endpointPacotes = $.ajax({
                type: "POST",
                url: "/entrega/buscar/pacotes",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'cep':  this.endereco.value && this.endereco.value.cep ? this.endereco.value.cep : '',
                    'endereco_id': this.endereco.value && this.endereco.value.id ? this.endereco.value.id : '',
                    'is_pacote_unico': this.pacotes_juntos,
                    'is_validar_controlado': this.is_validar_controlado
                },
                success: (response_pacotes) => {

                    load('off', $('.asidebar'));

                    this._mensagem = [];
                    this._setCarrinho();

                    this.is_marketplace = response_pacotes.is_marketplace
                    this.endpointPacotes = null;
                    this.id = response_pacotes.carrinho_id;
                    this.qtd_itens = response_pacotes.qtd_itens;
                    this.vlr_subtotal = +response_pacotes.subtotal_valor;
                    this.vlr_frete_gratis = response_pacotes.valor_frete_gratis;
                    this.is_controlado = response_pacotes.is_controlado;
                    this.is_validar_receita = response_pacotes.validar_receitas;
                    this.informacoes_pbm = response_pacotes.informacoes_pbm;
                    this.pacotes = response_pacotes.pacotes;
                    this.vlr_desconto_pbm = response_pacotes.vlr_desconto_pbm;
                    this.vlr_desconto_pbm = this.vlr_desconto_pbm != 0 ? this.vlr_desconto_pbm : '0,00'
                    this.vlr_desconto_valor = response_pacotes.desconto_valor;
                    this.vlr_desconto_valor = this.vlr_desconto_valor != 0 ? this.vlr_desconto_valor : '0,00'

                    try {
                        this.vlr_subtotal_sem_marketplace = parseFloat(response_pacotes.subtotal_valor) - parseFloat(response_pacotes.subtotal_valor_marketplace)    
                    } catch (error) {}
                    
                    this.qtd_max_pagamentos_diferentes = 99 // Valor temporário até que seja criado um campo no banco para cadastro da qtd máxima de pagamentos
                    this.is_multiplos_pagamentos = false

                    //if (this.passoAtual === 'pagamentos') {
                    if (!this.pacotes || !this.pacotes.length) {
                        this._passoAtual = 'entregas';
                        this._carregarTemplate();
                    }

                    this._atualizarCashback();

                    if(this.is_validar_receita){
                        this._atualizarListaReceitas();
                    } else {
                        this.receitas = []
                    }

                    if(!this.is_controlado){
                        this.receitas = []
                    }

                    if(this._getCarrinho() && this._getCarrinho().cupom && this._getCarrinho().cupom.codigo){
                        this.cupom = {"cupom_id": this._getCarrinho().cupom.codigo}
                    }

                    this._setCarrinho();

                    if(this.pacotes && this.pacotes.length){
                        for(let i in this.pacotes){

                            if(this.pacotes[i].is_digital){
                                this._preSelecionarEntregaDigital(i)
                            }

                            if(this.pacotes[i].mensagem && this.pacotes[i].mensagem.length){
                                carrinho.instance.mensagem[i] = this.pacotes[i].mensagem
                            }
                        }
                    }

                    if(this._getCarrinho() && this._getCarrinho().pacotes && this._getCarrinho().pacotes.length){
                        for(let value of this._getCarrinho().pacotes){
                            this._mensagemTempoDeEntrega(value)
                        }
                    }
                },
                error: (data) => {
                    load('off', $('.asidebar'));
                }
            });
        },
        CarrinhoComponent.prototype._validacaoDosPassos = async function () {
            if (this.passoAtual === 'pagamentos' && this.valid) {
                this.popupConfirmacao = new CarrinhoConfirmacao(this.qtd_itens, this.pacotes, this.vlr_subtotal, this.vlr_desconto_pbm, this.vlr_desconto_valor, this.vlr_frete, null, this.endereco.value, this.pagamento.value, this.cupom, this.informacoes_pbm, this._calculaVlrTotalFloat());
            }
            else {
                for (const index in this.passos) {
                    if (this.passoAtual === this.passos[index].nome) {
                        if (await this.passos[index].valid()) {
                            if (this.passos[parseFloat(index) + 1].nome) {
                                this.passoAtual = this.passos[parseFloat(index) + 1].nome;
                                this._setCarrinho()
                                break;
                            }
                        } else {
                            return
                        }
                    }
                }
                this._carregarTemplate();
                this._atualizarProgressoCarrinho();
            }
        },
        CarrinhoComponent.prototype._validacaoPacotes = function () {
            let packValid = true;
            let isValid = this.pacotes && this.pacotes.length > 0 ? $.map(this.pacotes, (pacote) => {
                if (packValid) {
                    packValid = pacote.valid;
                    if (!packValid) {
                        if(carrinho.instance.pacotes[pacote.index - 1].is_entrega_disponivel){
                            carrinho.instance.pacotes[pacote.index - 1].entrega._carregarTemplate();
                            onToggleCarrinhoPopUp('open', '#popupEntrega');
                        } else {
                            toastr.warning(`O pacote ${pacote.index} não possui entregas disponíveis. Remova os produtos para prosseguir.`)
                        }
                        return pacote.valid;
                    }
                }
            }) : [false];
            if (this.pacotes && this.pacotes.length > 0) {
                isValid = [packValid];
            }
            else {
                isValid = [false];
            }
            return isValid[0];
        },
        CarrinhoComponent.prototype._validacaoEndereco = function () {
            if (this.endereco.valid) {
                return true;
            }
            else {
                onToggleCarrinhoPopUp('open', '#popupEndereco');
                return false;
            }
        },
        CarrinhoComponent.prototype._validacaoReceita = async function () {
            /**/
            return true
        },
        CarrinhoComponent.prototype._carregarTemplate = function () {
                let subtotal = this.vlr_subtotal ? (parseFloat(this.vlr_subtotal) + parseFloat(this.vlr_desconto_valor)).toLocaleFixed(2) : "0,00";
                let frete = this.vlr_frete ? this.vlr_frete.toFixed(2).toString().replace(".", ",") : "0,00";
                $('#carrinho-itens').html(this.qtd_itens > 0 ? '(' + this.qtd_itens + (this.qtd_itens > 1 ? ' itens)' : ' item)') : '(Vazia)');
                $('[data-target="carrinho-vlr_cashback"]').html('R$ ' + this.vlr_cashback);
                $('[data-target="carrinho-vlr_desconto_pbm"]').html('R$ ' + parseFloat(this.vlr_desconto_pbm || 0.00).toLocaleFixed(2));
                $('[data-target="carrinho-desconto_valor"]').html('R$ ' + parseFloat(this.vlr_desconto_valor || 0.00).toLocaleFixed(2));
                $('[data-target="carrinho-subtotal"]').html(`R$ ${subtotal}`);
                $('[data-target="carrinho-vlr_frete"]').html(`R$ ${frete}`);
                $('[data-target="carrinho-vlr_total"]').html('R$ ' + this.vlr_total_calculado);
                $('#carrinho-texto-frete-gratis').html(this.texto_frete_gratis);
                //$('#carrinho-restante_frete_bar').css('width', this.perc_restante_frete_gratis_sem_marketplace + '%');
                $('#carrinho-body').html(this.template);
                $(".asidebar").find("select").each(function (e, a) { var r = $(".asidebar"); a && $(a).select2({ theme: "bootstrap", dropdownParent: r, minimumResultsForSearch: -1, escapeMarkup: function(markup) { return markup; }, templateResult: function (data) { let template = data && data.text && data.text.split('breakRow') ? data.text.split('breakRow') : '';if(template.length && template.length > 1){let html_retorno = ``;$(template).each(function(i, html){if(html){if(i === 0){ html_retorno += `<p class="font-weight-bold mb-1">${html}</p>`;} else if(i === (template.length - 1)){html_retorno += `<p class="font-weight-bold">${html}</p>`;} else {html_retorno += `<p class="mb-1">${html}</p>`;}}});return html_retorno;};return data.text; }, templateSelection: function (data) { let template = data && data.text && data.text.split('breakRow') ? data.text.split('breakRow') : ''; if(template.length && template.length > 1){ return `<p>${template[0]} - <b>${template[template.length - 1]}</b></p>` }; return data.text; } }) });

                if(!this.is_marketplace){
                    $('[data-target="mensagem-agrupamento-pacote"]').html(`
                        Seus produtos foram agrupados em pacotes de acordo com o menor prazo de entrega que temos disponível.
                    `)
                } else {
                    $('[data-target="mensagem-agrupamento-pacote"]').html(`
                        Os produtos VENDIDOS E ENTREGUES pelos nossos parceiros NÃO SERÃO agrupados.
                        <br>
                        <br>
                        Os itens serão faturados de lugares diferentes, por isso haverá mais de um frete e a entrega do seu pedido ocorrerá separadamente.
                    `)
                }

                if (this.qtd_itens > 0) {
                    $('.btn-market').addClass('contain_item').attr('data-content', this.qtd_itens);
                } else {
                    $('.btn-market').removeClass('contain_item')
                }
                if (this.pagamento && this.pagamento.valueNotCashback && this.pagamento.valueNotCashback.cartao && this.pagamento.valueNotCashback.cartao.tipo){
                    if(!this.is_formulario_cartao_construido || this.is_formulario_cartao_construido == undefined){
    
                        load('on', $('.asidebar'));
    
                        this.is_formulario_cartao_construido = true
    
                        eventosCartao();
    
                        setTimeout(() => {
                            try {
                                this.pagamento.valueNotCashback.cartao.desconstruirFormMP()
                            } catch (error) {
                                load('off', $('.asidebar'));
                            }
                            setTimeout(() => {
                                try {
                                    this.pagamento.valueNotCashback.cartao.construirFormMP()
                                } catch (error) {
                                    load('off', $('.asidebar'));
                                }
                            }, 250); 
                        }, 500);
                    }
                }

                $('#carrinho-botao-finalizar').off('click.cart').on('click.cart', () => {
                    
                        window.location.href = "/cliente/login";
                    
                });

                $('#carrinho-continuar-entrega').off('click.cart').on('click.cart', () => {
                    const isValid = this._validacaoPacotes();
                    if (isValid) {
                        this._atualizarProgressoCarrinho();
                        blackPanel(document.getElementById('carrinho_desfoco'));
                    }
                });
            },
        CarrinhoComponent.prototype._atualizarProgressoCarrinho = function () {
            var textoBotao = 'Escolher Entrega';
            let pas = $.map(this.passos, (passo) => {
                if (this.passoAtual === passo.nome) {
                    textoBotao = passo.texto();
                }
                return passo.nome;
            })

            const perc = this.passos[pas.indexOf(this.passoAtual)].progresso();

            $('#carrinho-botao-finalizar').html(`<span class="font-weight-bold text-nowrap font-xl fontOutfitBold" style="color: #fff">${textoBotao}</span>`);

            if (this.passoAtual !== 'entregas') {
                $('[data-target="carrinho-resumo-endereco"]').addClass('d-none').removeClass('d-flex');
                $('#carrinho-voltar-entrega').removeClass('d-none').off('click.cart').on('click.cart', () => {
                    this.passoAtual = 'entregas';
                    this._setCarrinho();
                    this._carregarTemplate();
                });
            }
            else {
                $('[data-target="carrinho-resumo-endereco"]').removeClass('d-none').addClass('d-flex');
                $('#carrinho-voltar-entrega').addClass('d-none').off('click.cart');
            }

            $('[data-target="carrinho-progresso"]').css('width', perc + '%');
        },
        CarrinhoComponent.prototype._setCarrinho = function (){
            let _carrinho = this._getCarrinho()
            let carrinhoStorage = {
                'passoAtual': _.cloneDeep(carrinho.instance._passoAtual),
                'pacotes': _.cloneDeep(carrinho.instance.pacotes),
                'pagamento': _.cloneDeep(carrinho.instance.pagamento),
                'cupom': _.cloneDeep(!carrinho.instance._cupom && this._getCarrinho() && this._getCarrinho().cupom ? this._getCarrinho().cupom : carrinho.instance._cupom),
                'mensagem': _.cloneDeep(carrinho.instance.mensagem),
                //'mensagem': _.cloneDeep(this._getCarrinho() && this._getCarrinho().mensagem ? this._getCarrinho().mensagem : ''),
            }

            try {
                carrinhoStorage && carrinhoStorage.endereco ? delete carrinhoStorage.endereco._enderecos : ''

                const pacotes = [];
                if(carrinhoStorage.pacotes && carrinhoStorage.pacotes.length){
                    for (const pacote of carrinhoStorage.pacotes) {

                        const _pacote = _.cloneDeep(pacote);
                        delete _pacote._carrinho;
                        delete _pacote.filial;
                        delete _pacote.entregas;
                        delete _pacote.produtos;

                        const entrega = _.cloneDeep(_pacote.entrega);
                        delete entrega._pacote;
                        delete entrega.value;
                        delete entrega.entregasDoTipo;
                        delete entrega._entregasDoTipo;
                        delete entrega._tipo_entrega;

                        _pacote.entrega = entrega;

                        const entregaValor = _.cloneDeep(_pacote.entrega._value);
                        entregaValor ? delete entregaValor._entrega_component : ''
                        entregaValor ? delete entregaValor._valid : ''

                        _pacote.entrega._value = entregaValor;

                        if (_pacote && _pacote.entrega && _pacote.entrega._value && _pacote.entrega._value.entrega_complemento) {
                            const entregaComplemento = _.cloneDeep(_pacote.entrega._value.entrega_complemento);
                            entregaComplemento ? delete entregaComplemento._entrega : ''
                            entregaComplemento && entregaComplemento._faixa_componente ? delete entregaComplemento._faixa_componente : ''
                            entregaComplemento && entregaComplemento._loja_componente ? delete entregaComplemento._loja_componente : ''
                            _pacote.entrega._value.entrega_complemento = entregaComplemento;
                        }

                        const _produtos = [];
                        for (const produto of pacote._produtos) {
                            const _produto = _.cloneDeep(produto);
                            _produto ? delete _produto._pacote : ''
                            _produtos.push(_produto);
                        }
                        _pacote._produtos = _produtos;
                        pacotes.push(_pacote)
                    }
                }

                carrinhoStorage.pacotes = pacotes

                delete carrinhoStorage.pagamento._pagamentos;
                delete carrinhoStorage.pagamento._carrinho;
                delete carrinhoStorage.pagamento._meus_pagamentos;
                delete carrinhoStorage.pagamento._tipos_pagamento;
                delete carrinhoStorage.pagamento.qtd_parcelas;
                delete carrinhoStorage.pagamento._cartao_adicionado;

                if(carrinhoStorage.pagamento.convenio){
                    delete carrinhoStorage.pagamento.convenio._pagamento
                }
                if(carrinhoStorage.pagamento.folha_pagamento){
                    delete carrinhoStorage.pagamento.folha_pagamento._pagamento
                }
                if (carrinhoStorage.pagamento.cartao) {
                    delete carrinhoStorage.pagamento.cartao._pagamento;
                }
                if(carrinhoStorage.pagamento._infoPagamento){
                    delete carrinhoStorage.pagamento._infoPagamento._pagamentos;

                    if(carrinhoStorage.pagamento._infoPagamento.cartao){
                        delete carrinhoStorage.pagamento._infoPagamento.cartao._pagamento
                    }

                    if(carrinhoStorage.pagamento._infoPagamento.convenio){
                        delete carrinhoStorage.pagamento._infoPagamento.convenio._pagamento
                    }
                    if(carrinhoStorage.pagamento._infoPagamento.folha_pagamento){
                        delete carrinhoStorage.pagamento._infoPagamento.folha_pagamento._pagamento
                    }
                }

                localStorage.setItem('carrinho', JSON.stringify(carrinhoStorage));

            } catch (error) {
                this._deleteCarrinho()
            }
        },
        CarrinhoComponent.prototype._getCarrinho = function (){
            let car = localStorage.getItem('carrinho');
            return car && JSON.parse(car)
        },
        CarrinhoComponent.prototype._deleteCarrinho = function(){
            localStorage.removeItem('carrinho')
            this._carregarTemplate()
        },
        CarrinhoComponent.prototype._mensagemTempoDeEntrega = function (pacote) {
            if(pacote.entrega && pacote.entrega._value){
                const _entregas = pacote.entrega._value.dadosComplemento;
                let carrinho = pacote._carrinho;
                let _this = this

                $.ajax({
                    type: 'POST',
                    url: '/alerta/horarios',
                    data: {
                        'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                        'cd_filial': _entregas && _entregas.filial && _entregas.filial.cd_filial ? _entregas.filial.cd_filial : '',
                        'tempo_entrega': _entregas.tempo,
                        'tipo': _entregas.tipo_codigo,
                        'tempo_limite': _entregas.hora_limite,
                        'hr_inicio': _entregas.hr_inicio,
                        'entrega_id': _entregas.nome,
                        'is_mensagem_horario': _entregas.is_mensagem_horario,
                    },
                    success: function (response) {

                        let pacote_index = +pacote.index - 1

                        if(response.status){
                            _this.mensagem[pacote_index] = response.mensagem;
                            $('#msg-tempo-entrega-' + pacote_index).html(response.mensagem);
                            $('#msg-tempo-entrega-' + pacote_index).parent().show(300);
                            _this._setCarrinho();
                        } else {
                            _this.mensagem[pacote_index] = '';
                            $('#msg-tempo-entrega-' + pacote_index).parent().hide(300);
                        }
                    },
                    error: function (response) {
                        _this.mensagem[+pacote.index - 1] = '';
                    }
                });
            }
        },
        CarrinhoComponent.prototype._alterarEstoqueProdutoRetirada = function(pacote){
            let tipo_retirada = carrinho.instance.pacotes[pacote].entrega && carrinho.instance.pacotes[pacote].entrega._value && carrinho.instance.pacotes[pacote].entrega._value.tipo_codigo ? carrinho.instance.pacotes[pacote].entrega._value.tipo_codigo : ''
            if(tipo_retirada === 'retirada') {
                let estoque_filial = carrinho.instance.pacotes[pacote].entrega._value && carrinho.instance.pacotes[pacote].entrega._value._filial && carrinho.instance.pacotes[pacote].entrega._value._filial.produtos ? carrinho.instance.pacotes[pacote].entrega._value._filial.produtos : []
                carrinho.instance.pacotes[pacote]._produtos.forEach(produto => {
                    let item = estoque_filial.findIndex(estoque => estoque.produto_id === produto.produto_id)
                    produto._produto.qtd_estoque = item > -1 ? estoque_filial[item].qtd_estoque : produto.estoque_original
                })
            } else {
                carrinho.instance.pacotes[pacote]._produtos.forEach(produto => {
                    produto._produto.qtd_estoque = produto.estoque_original
                })
            }
        },
        CarrinhoComponent.prototype._atualizarListaReceitas = function () {
            load('on', $('.asidebar'));
            $.ajax({
                type: "POST",
                url: "/buscar/receitas/pacotes",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success: (data) => {

                    load('off', $('.asidebar'));

                    this.receitas = data.receitas;

                    let form_envio_receita = $('#form_envio_receita')
                    if(data.receitas && data.receitas.length){
                        $(form_envio_receita).find('[name="receita-tipo"]').parent().parent().removeClass('col-md-6').addClass('col-md-4')
                        $(form_envio_receita).find('[name="receita-tipo"]').parent().parent().show(300)

                        
                        $(form_envio_receita).find('[name="receita-tipo"]').next().css('height', '70px')
                        

                    } else {

                        $(form_envio_receita).find('[name="receita-tipo"]').parent().parent().removeClass('col-md-4').addClass('col-md-6')
                        $(form_envio_receita).find('[name="receita-tipo"]').last().parent().parent().hide(300)

                        
                        $(form_envio_receita).find('[name="receita-tipo"]').next().css('height', '50px')
                        
                    }

                    this._carregarTemplate();
                },
                error: (data) => {
                    load('off', $('.asidebar'));
                }
            });
        },
        CarrinhoComponent.prototype._validarTipoEntregaPorReceita = async function () {
            return new Promise(function(resolve, reject) {
                load('on', $('.asidebar'));

                let json_pacotes = []
                let lista_pacotes = carrinho.instance.pacotes
                if(lista_pacotes && lista_pacotes.length){
                    lista_pacotes.forEach(pct => {
                        if(pct.produtos && pct.produtos.length){
                            pct.produtos.forEach(prod => {
                                delete prod._pacote
                                delete prod.template
                            });
                        }
                        json_pacotes.push({
                           'pacote': +pct.index - 1,
                           'produtos': pct.produtos,
                           'tipo_entrega': pct.entrega ? pct.entrega.tipo_entrega : '',
                        })
                    })
                }

                $.ajax({
                    type: "POST",
                    url: "/validar/receitas/pacotes",
                    data: {
                        'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                        'pacotes': JSON.stringify(json_pacotes),
                    },
                    success: (data) => {

                        if(data.status){
                            carrinho.instance.is_validar_controlado = ''
                            load('off', $('.asidebar'));
                        } else {
                            toastr.error('Sua cesta contém um produto com venda controlada. Insira uma nova receita ou selecione uma opção de entrega do tipo "Compre e retire" para prosseguir.', 'Atenção');
                            carrinho.instance.is_validar_controlado = true
                            carrinho.instance._atualizarCarrinho();
                        }

                        resolve(data.status);
                    },
                    error: (data) => {
                        load('off', $('.asidebar'));
                        if(this.receitas && this.receitas.length){
                            resolve(true);
                        } else {
                            resolve(false);
                        }
                    }
                });
            })
        },
        CarrinhoComponent.prototype._excluirReceita = function (receita_id) {

            load('on', $('.asidebar'));

            $.ajax({
                type: "POST",
                url: "/remover/receitas/carrinho",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'receita_id': receita_id,
                },
                success: (data) => {

                    if(data.status){

                        if(this.receitas && this.receitas.length){
                            let index = this.receitas.findIndex(val => val.id == receita_id)
                            index > -1 ? this.receitas.splice(index, 1) : ''
                        }

                        this._atualizarCarrinho();

                    } else {
                        toastr.error(data.descricao ? data.descricao : 'Ocorreu um erro interno ao realizar a exclusão da receita', 'Erro');
                        load('off', $('.asidebar'));
                    }

                },
                error: (data) => {
                    toastr.error('Ocorreu um erro interno ao realizar a exclusão da receita', 'Erro');
                    load('off', $('.asidebar'));
                }
            });

        },
        CarrinhoComponent.prototype._visualizarReceita = async function () {

            let form_upload_receita_carrinho = $('#form_upload_receita_carrinho')

            let dat_nasc = '' + '-' + '' + '-' + ''
            if(dat_nasc){
                dat_nasc = moment(dat_nasc, 'YYYY-MM-DD').format('DD/MM/YYYY')
                $(form_upload_receita_carrinho).find('[name="dat_nasc"]').val(dat_nasc)
            }

            filepond_receita_carrinho(false)

            load('on', $('.asidebar'));

            await Promise.all([
                getEstados($('#form_upload_receita_carrinho')),
                getTiposCr($('#form_upload_receita_carrinho')),
                getFornecedorPrescricao($('#form_upload_receita_carrinho'))
            ])

            load('off', $('.asidebar'));

            $(form_upload_receita_carrinho).find("[name='receita-tipo']").off('change').on('change', function(e){

                if($(form_upload_receita_carrinho).hasClass('was-validated')){
                    $(form_upload_receita_carrinho).find('.labl').children('input').addClass('is-valid')
                }

                $(form_upload_receita_carrinho).find("[name='receita_numero_token']").val('')
                $(form_upload_receita_carrinho).find("[name='fornecedor_prescricao']").val('-1').trigger('change')

                $('#receita_anexo_carrinho').filepond("removeFiles")

                let forma_envio = $(this).val()
                if(forma_envio === 'token'){
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_digital']").show(300)
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_anexo']").hide(300)
                    $(form_upload_receita_carrinho).find("[name='receita_numero_token']").attr('required', true)
                    filepond_receita_carrinho(false)
                } else if(forma_envio === 'path_receita'){
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_anexo']").show(300)
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_digital']").hide(300)
                    $(form_upload_receita_carrinho).find("[name='receita_numero_token']").attr('required', false)
                    filepond_receita_carrinho(true)
                } else {
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_anexo']").hide(300)
                    $(form_upload_receita_carrinho).find("[name='bloco_receita_digital']").hide(300)
                    $(form_upload_receita_carrinho).find("[name='receita_numero_token']").attr('required', false)
                    filepond_receita_carrinho(false)
                }
            })

            onToggleCarrinhoPopUp('open', '#popupUploadReceita');
        },
        CarrinhoComponent.prototype._submitReceita = function () {

            let form_upload_receita_carrinho = $('#form_upload_receita_carrinho')

            let dat_nasc = $(form_upload_receita_carrinho).find("[name='dat_nasc']").val()
            dat_nasc = moment(dat_nasc, 'DD/MM/YYYY').format('YYYYMMDD')

            let dat_receita = $(form_upload_receita_carrinho).find("[name='dat_receita']").val()
            dat_receita = moment(dat_receita, 'DD/MM/YYYY').format('YYYYMMDD')

            if(!$(form_upload_receita_carrinho).find('[name=receita-tipo]:checked').val()){
                $(form_upload_receita_carrinho).find('.labl').children('input').addClass('is-invalid')
                $(form_upload_receita_carrinho).find('.is-invalid-text').show(300)
            } else {
                $(form_upload_receita_carrinho).find('.labl').children('input').addClass('is-valid')
                $(form_upload_receita_carrinho).find('.is-invalid-text').hide(300)
            }

            if($(form_upload_receita_carrinho).find('[name=receita-tipo]:checked').val() === 'path_receita' && path_receita_carrinho){
                $(form_upload_receita_carrinho).find('#receita_anexo_arquivo').addClass('is-valid')
            } else if($(form_upload_receita_carrinho).find('[name=receita-tipo]:checked').val() === 'path_receita' && !path_receita_carrinho){
                toastr.warning('Envie sua receita para prosseguir.')
                $(form_upload_receita_carrinho).find('#receita_anexo_arquivo').addClass('is-invalid')
                return
            }

            if($('#form_upload_receita_carrinho')[0].checkValidity()){

                onToggleCarrinhoPopUp('', '#popupUploadReceita');

                load('on', $('.asidebar'));

                $.ajax({
                    type: 'POST',
                    url: "/receita/salvar",
                    data: {
                        'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                        'nm_completo': $(form_upload_receita_carrinho).find("[name='nm_completo']").val(),
                        'uf_rg': $(form_upload_receita_carrinho).find("[name='estado-documento']").val(),
                        'documento': $(form_upload_receita_carrinho).find("[name='documento']").val(),
                        'dat_nasc': dat_nasc ? dat_nasc : '',
                        'sexo': $(form_upload_receita_carrinho).find("[name='sexo']:checked").val(),
                        'dat_receita': dat_receita ? dat_receita : '',
                        'qtd': $(form_upload_receita_carrinho).find("[name='qtd_medicamentos']").val(),
                        'cr': $(form_upload_receita_carrinho).find("[name='cr']").val(),
                        'uf': $(form_upload_receita_carrinho).find("[name='uf_cr']").val(),
                        'conselho': $(form_upload_receita_carrinho).find("[name='codigo_cr']").val(),
                        'nm_medico': $(form_upload_receita_carrinho).find("[name='nm_medico']").val(),
                        'token': $(form_upload_receita_carrinho).find("#tipo_digital_carrinho").is(':checked') ? $(form_upload_receita_carrinho).find("[name='receita_numero_token']").val() : '',
                        'path_receita': $(form_upload_receita_carrinho).find("#tipo_anexo_carrinho").is(':checked') ? path_receita_carrinho : '',
                    },
                    success: function (response) {

                        if(response.status){

                            carrinho.instance._resetFormularioReceitaCarrinho();
                            carrinho.instance._atualizarCarrinho()

                        } else {
                            toastr.error(response.descricao ? response.descricao : 'Ocorreu um erro interno ao enviar a receita', 'Erro');
                            load('off', $('.asidebar'));
                        }

                    },
                    error: function () {
                        load('off', $('.asidebar'));
                        toastr.error('Ocorreu um erro interno ao enviar a receita', 'Erro');
                    }
                });

            } else {
                toastr.warning('Preencha os campos obrigatórios para prosseguir.')
                $('#form_upload_receita_carrinho').addClass('was-validated')
            }
        },
        CarrinhoComponent.prototype._resetFormularioReceitaCarrinho = function () {
            let _form = $('#form_upload_receita_carrinho')
            $(_form).removeClass('was-validated')

            $(_form).get(0).reset()

            $(_form).find(".is-valid").removeClass('is-valid')
            $(_form).find(".is-invalid").removeClass('is-invalid')

            $(_form).find("[name='bloco_receita_anexo']").hide(300)
            $(_form).find("[name='bloco_receita_digital']").hide(300)
            $(_form).find("[name='bloco_tipo_receita_required']").hide(300)

            filepond_receita_carrinho(false)
            path_receita_carrinho = ''
            $('#receita_anexo_carrinho').filepond("removeFiles")
        },
        CarrinhoComponent.prototype._resetEntregas = function () {
            if(this.pacotes && this.pacotes.length){
                for(let value of this.pacotes){
                    if(value && value.entrega){
                        value.entrega ? value.entrega.value = '' : null
                    }
                }
                carrinho.instance._mensagem = []
                this._setCarrinho()
                this._carregarTemplate()
            }
        },
        CarrinhoComponent.prototype._resetPagamentos = function () {
            this.pagamento._removerTodosPagamentoSelecionado()
            this.is_multiplos_pagamentos = false
            this._getCarrinho() && this._getCarrinho().pagamento && this._getCarrinho().pagamento._infoPagamento ? this._getCarrinho().pagamento._infoPagamento = null : null
            this._setCarrinho()
            this.pagamento = new PagamentoComponent(this);        
            this._carregarTemplate()
        },
        CarrinhoComponent.prototype._preSelecionarEntregaDigital = function(pct) {
            this.pacotes[pct].entrega.tipo_entrega = 'entrega'
            this.pacotes[pct].entrega.value = 'digital'
            this._mensagemTempoDeEntrega(this._pacotes);
        },
        carrinho.instance = new CarrinhoComponent();

        function removeTemplates(obj) {
            for(prop in obj) {
                if(prop != 'valid'){
                    if (prop === 'template' || prop === 'pagamentoComplemento' || prop === 'template_novo_endereco' || prop === 'editar' || prop === 'template_convenios' || prop === 'template_parcelas')
                        delete obj[prop];
                    else if (typeof obj[prop] === 'object')
                        obj[prop] = removeTemplates(obj[prop]);
                }
            }
            return obj;
        }


        atualizarCarrinho = () => {
            carrinho.instance._atualizarCarrinho();
        }

        
            async function loadScript(url, callback) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                if (script.readyState) {  // only required for IE <9
                    script.onreadystatechange = function () {
                        if (script.readyState === "loaded" || script.readyState === "complete") {
                            script.onreadystatechange = null;
                            if (callback) {
                                callback();
                            }
                        }
                    };
                } else {  //Others
                    script.onload = function () {
                        if (callback) {
                            callback();
                        }
                    };
                }

                script.src = url;
                document.getElementsByTagName("head")[0].appendChild(script);
            }

             const chaveMercadoPago = async () => {
                 $('.modal-carrinho').on('shown.bs.modal', function () {
                     $('.asidebar').css('zIndex', 10000);
                 }).on('hidden.bs.modal', function () {
                     if ($('.modal-carrinho').hasClass('show') === false) {
                         $('.asidebar').css('zIndex', '');
                         do_submit_confirmar_compra = false;
                         do_submit_comprar = false;
                         is_loader_confirmar_compra = false;
                         load('off', $('.asidebar'));
                     }
                 });
                 loadScript('https://www.mercadopago.com/v2/security.js');

                 loadScript('https://sdk.mercadopago.com/js/v2', function () {
                    integracaoMercadoPago();
                 });
             };

             const integracaoMercadoPago = async () => {
                if(typeof(MercadoPago) === 'function')
                    mp = new MercadoPago("APP_USR-a45fbe5b-6022-4c13-881d-8c474fa64fd7")
            }

            async function getIdentificationTypes() {
                try {
                    if(typeof(mp) === 'object'){
                        let opcoes = await mp.getIdentificationTypes()
                        let html = ``;
                        if(opcoes && opcoes.length){
                            opcoes.forEach(opcao => {
                                html += `
                                    <option value="${opcao.id}">${opcao.name}<option>
                                `;
                            })
                        }
                        $('#docType').html(html)
                    }
                } catch (error) {
                    return console.error('Error getting identificationTypes: ', error);
                }
            }

            //chaveMercadoPago();
            

            

            function eventosCartao(cartao) {

                getIdentificationTypes()

                if(cardNumberElement)
                    cardNumberElement.on('binChange', carrinho.instance.pagamento.valueNotCashback.cartao.getPaymentMethods);
            

                /*if(typeof(SafraPayTransparent) === 'object'){
                    $('#number').off('keyup.mercado').on('keyup.mercado', cartao.guessPaymentMethod);
                    $('#number').off('change.mercado').on('change.mercado', cartao.guessPaymentMethod);
                }*/

                // if(window.Mercadopago){
                //     window.Mercadopago.getIdentificationTypes()
                //     $('#number').off('keyup.mercado').on('keyup.mercado', cartao.guessPaymentMethod);
                //     $('#number').off('change.mercado').on('change.mercado', cartao.guessPaymentMethod);
                // }

                /*$('#number').mask('9999 9999 9999 9999');

                $('#carrinho-cartao-validade').mask('00/00').off('change.mercado').on('change.mercado', function () {
                    let valor = this.value.split('/');
                    if (valor.length === 2)
                        $("#cardExpirationMonth").val(valor[0]);
                    $("#cardExpirationYear").val(valor[1]);
                });*/

                setTimeout(() => {

                    $('#securityCode').mask('999').off('change.mercado').on('change.mercado', () => {
                        cartao.securityCode = $('#securityCode').val();
                    });

                    var cpfMascara = function (val) {
                            if (val.replace(/\D/g, '').length > 11) {
                                $('#docType').val('CNPJ');
                                return '00.000.000/0000-00';
                            }
                            else {
                                $('#docType').val('CPF');
                                return '000.000.000-009';
                            }
                        },
                        cpfOptions = {
                            onKeyPress: function (val, e, field, options) {
                                field.mask(cpfMascara.apply({}, arguments), options);
                            }
                        };

                    $('#carrinho-cartao-cpf_titular').mask(cpfMascara, cpfOptions);
                    $("#carrinho-endereco-cep").mask('99.999-999');

                }, 500);

                //window.Mercadopago ? $('#pay').off('submit.mercado').on('submit.mercado', carrinho.instance.pagamento.valueNotCashback.cartao.doPay) : '';

                /*$('#carrinho-salvar-cartao').off('click').on('click', function(event){
                    if(event)
                        event.preventDefault()
                    if($('#pay') && $('#pay')[0] && $('#pay')[0].checkValidity()){
                        cartao.doPay()
                    } else {
                        $('#pay').addClass('was-validated')
                        toastr.warning('Preencha os dados do cartão para prosseguir')
                    }
                })*/
                //$('#pay').off('submit.mercado').on('submit.mercado', cartao.doPay)
            }

            chaveMercadoPago();

            /*function eventosCartaoPagamentoDividido(cartao){
                

                $('#number-modal').mask('9999 9999 9999 9999');

                $('#carrinho-cartao-validade-modal').mask('00/00').off('change.mercado').on('change.mercado', function () {
                    let valor = this.value.split('/');
                    if (valor.length === 2)
                        $("#cardExpirationMonth-modal").val(valor[0]);
                    $("#cardExpirationYear-modal").val(valor[1]);
                });

                $('#securityCode-modal').mask('9999').off('change.mercado').on('change.mercado', () => {
                    cartao.securityCode = $('#securityCode-modal').val();
                });

                var cpfMascara = function (val) {
                        if (val.replace(/\D/g, '').length > 11) {
                            $('#docType-modal').val('CNPJ');
                            return '00.000.000/0000-00';
                        }
                        else {
                            $('#docType-modal').val('CPF');
                            return '000.000.000-009';
                        }
                    },
                    cpfOptions = {
                        onKeyPress: function (val, e, field, options) {
                            field.mask(cpfMascara.apply({}, arguments), options);
                        }
                    };

                $('#carrinho-cartao-cpf_titular-modal').mask(cpfMascara, cpfOptions);
                $("#carrinho-endereco-cep-modal").mask('99.999-999');

                $('#pay-modal').off('submit.mercado').on('submit.mercado', cartao.doPay)
            }*/


            /*function setarInputInvalid(dom, mensagem) {
                if (mensagem) {
                    $(dom).addClass('border-danger');
                    $(dom).parent().find(".text-danger.invalid").html(mensagem);
                }
                else {
                    $(dom).removeClass('border-danger');
                    $(dom).parent().find(".text-danger.invalid").html('');
                }
            }*/

            function errosNoCartao(status) {
                let numero_cartao = document.getElementById("number"),
                    nome_titular = document.getElementById("cardholderName"),
                    data_vencimento = document.getElementById("carrinho-cartao-validade"),
                    codigo_seguranca = document.getElementById("securityCode"),
                    cpf_titular = document.getElementById("carrinho-cartao-cpf_titular");
                switch (status.toString().toUpperCase()) {
                    case "326":
                    case "325":
                        setarInputInvalid(data_vencimento, "Data de vencimento inválida.");
                        break;
                    case "324":
                    case "323":
                    case "322":
                        setarInputInvalid(cpf_titular, "Confira o CPF do titular.");
                        break;
                    case "316":
                        setarInputInvalid(nome_titular, "Por favor, digite um nome válido.");
                        break;
                    case "E302":
                        setarInputInvalid(codigo_seguranca, "Código de segurança inválido.");
                        break;
                    case "E301":
                        setarInputInvalid(numero_cartao, "Há algo de errado com o número do cartão. Digite novamente.");
                        break;
                    case "224":
                        setarInputInvalid(codigo_seguranca, "Digite o código de segurança.");
                        break;
                    case "221":
                        setarInputInvalid(nome_titular, "Digite o nome e sobrenome.");
                        break;
                    case "214":
                    case "213":
                    case "212":
                        setarInputInvalid(cpf_titular, "Informe seu CPF.");
                        break;
                    case "209":
                    case "208":
                        setarInputInvalid(data_vencimento, "Informe a data de vencimento.");
                        break;
                    case "205":
                        setarInputInvalid(numero_cartao, "Digite o número do seu cartão.");
                        break;
                    default:
                        toastr.error("Confira os dados do cartão.", "Erro");
                }
            }
            // function setPaymentMethod(status, response) {
            //     let numero_cartao = document.getElementById('number');
            //     let nome_titular = document.getElementById('cardholderName');
            //     let data_vencimento = document.getElementById('carrinho-cartao-validade');
            //     let codigo_seguranca = document.getElementById('securityCode');
            //     let cpf_titular = document.getElementById('carrinho-cartao-cpf_titular');

            //     setarInputInvalid(numero_cartao, '');
            //     setarInputInvalid(nome_titular, '');
            //     setarInputInvalid(data_vencimento, '');
            //     setarInputInvalid(codigo_seguranca, '');
            //     setarInputInvalid(cpf_titular, '');

            //     if (status === 200) {
            //         if (response[0].id === "amex") {
            //             $('#number').mask('9999 999999 99999');
            //             $('#securityCode').mask('9999');
            //         } else {
            //             $('#number').mask('9999 9999 9999 9999');
            //             $('#securityCode').mask('999');
            //         }
            //         $('#number').attr('minlength', response[0].settings[0].card_number.length);
            //         $('#payment_method_id').val(response[0].id);
            //     }
            //     else {
            //         errosNoCartao(status);
            //     }
            // }
            // function pegarTokenSeForCartao(status, response) {
            //     if (status !== 200 && status !== 201) {
            //     } else {
            //         carrinho.instance.pagamento.valueNotCashback.dadosComplemento.token = response.id;
            //         carrinho.instance.pagamento.valueNotCashback._pagamentoMeuCartao();
            //     }
            // }
        

        function pegarTokenSeForCartao(status, response) {
            if (status !== 200 && status !== 201) {
            } else {
                carrinho.instance.pagamento.valueNotCashback.dadosComplemento.token = response.id;
                carrinho.instance.pagamento.valueNotCashback._pagamentoMeuCartao();
            }
        }

        
            $('#aviso_controlado').css('height', '');
        

        let json_hashs = {};
        /**
         * função especifica para o carrinho, adicionar ou remover itens do carrinho de 1 em 1 armazenando qtd de clicks e enviando a qtd de clicks em um intervalo após 700 milisegundos sem click do usuário
         * @param __this DOM botao + ou -
         * @param acao mais ou menos string
         * @param hash hash_produto
         */

        function adicionar_remover(__this, acao, hash, token_nsu) {
            let _this = __this.parent().find(`[data-toggle='number_plus_minus']`);
            let receita_id = $(_this).attr("data-receita-id")
            if (!hash) {
                hash = null;
            }
            if (acao) {
                if (acao === "menos") {
                    if (_this.attr('data-valor') > parseInt(_this.attr('data-limite-min')) || _this.attr('data-limite-min') === "") {
                        $(__this).parent().find('a').removeClass('isDisabled');
                        if (_this.attr('data-valor') <= parseInt(_this.attr('data-limite-min')) || _this.attr('data-valor') <= 1) {
                            $(__this).addClass('isDisabled');
                        } else {
                            $(__this).removeClass('isDisabled');
                            _this.html(
                                parseInt(_this.attr('data-valor')) - 1
                            ).attr('data-valor', parseInt(_this.attr('data-valor')) - 1);
                            if (hash) {
                                if (!json_hashs[hash + acao]) {
                                    json_hashs[hash + acao] = 0;
                                }
                                json_hashs[hash + acao]++;
                                let click = json_hashs[hash + acao];
                                setTimeout(() => {
                                    if (click === json_hashs[hash + acao]) {
                                        load('on', $('.asidebar'));
                                        $.ajax({
                                            type: "POST",
                                            url: "/carrinho/remover",
                                            data: {
                                                'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                                                'hash_produto': hash,
                                                'quantidade': json_hashs[hash + acao],
                                                'token_nsu': token_nsu,
                                                'receita_id': receita_id ? receita_id : '',
                                            },
                                            success: (data) => {
                                                load('off', $('.asidebar'));
                                                if (data.status === true) {
                                                    carrinho.instance._resetEntregas();
                                                    carrinho.instance._resetPagamentos();
                                                    atualizarCarrinho();
                                                } else {
                                                    toastr.error(data.descricao, 'Erro ao enviar');
                                                }
                                            },
                                            error: (data) => {
                                                load('off', $('.asidebar'));
                                            }
                                        });
                                        json_hashs[hash + acao] = 0;
                                    }
                                }, 700);
                            }
                        }
                    } else {
                        $(__this).addClass('isDisabled');
                    }
                } else if (acao === "mais") {
                    if (_this.attr('data-valor') < parseInt(_this.attr('data-limite-max')) || _this.attr('data-limite-max') === "") {
                        $(__this).parent().find('a').removeClass('isDisabled');
                        _this.html(
                            parseInt(_this.attr('data-valor')) + 1
                        ).attr('data-valor', parseInt(_this.attr('data-valor')) + 1);
                        _this.attr('data-valor') === parseInt(_this.attr('data-limite-max')) ? $(__this).addClass('isDisabled') : $(__this).removeClass('isDisabled');
                        if (hash) {
                            if (!json_hashs[hash + acao]) {
                                json_hashs[hash + acao] = 0;
                            }
                            json_hashs[hash + acao]++;
                            let click = json_hashs[hash + acao];
                            setTimeout(function () {
                                if (click === json_hashs[hash + acao]) {
                                    adicionarProdutoCarrinho(hash, json_hashs[hash + acao], _this);
                                    json_hashs[hash + acao] = 0;
                                }
                            }, 700)
                        }
                    } else {
                        $(__this).addClass('isDisabled');
                    }
                }
            }
        }


    </script>

<script>
        function filtroParaDadosAnaliticos(referencia, termo) {
            var items_gtag = [];
            var items_fbq = [];
            switch (referencia) {
                case "AddShippingInfo":
                    gtag('event', 'add_shipping_info', {
                        value: termo.value,
                        currency: termo.currency,
                        coupon: termo.coupon,
                        items: termo.items,
                    });
                    break;
                case "Search":
                    fbq("track", referencia, termo ? termo : undefined);
                    gtag('event', 'search', {
                        search_term: termo
                    });
                    break;
                case "AddPaymentInfo":
                    fbq('track', 'AddPaymentInfo');
                    gtag('event', 'add_payment_info', {
                        currency: termo.currency,
                        payment_type: termo.payment_type,
                        coupon: termo.coupon,
                        value: termo.value,
                    });
                    break;
                case "InitiateCheckout":
                    fbq('track', 'InitiateCheckout');
                    gtag('event', 'begin_checkout');
                    break;
                case "Purchase":
                    for (let i = 0; i < termo.items.length; i++) {
                        items_gtag.push({
                            item_id: termo.items[i].id,
                            id: termo.items[i].id,
                            item_name: termo.items[i].item_name,
                            name: termo.items[i].item_name,
                            quantity: termo.items[i].quantidade,
                            discount: termo.items[i].discount,
                            currency: termo.items[i].currency,
                            price: termo.items[i].price,
                            promotion_name: termo.items[i].promotion_name,
                            promotion_id: termo.items[i].promotion_name,
                            index: termo.items[i].index,
                            item_list_name: termo.items[i].item_list_name,
                            item_list_id: termo.items[i].item_list_id
                        });
                        items_fbq.push({
                            id: termo.items[i].id,
                            quantity: termo.items.quantidade
                        });
                    }
                    fbq('track', 'Purchase', {
                        currency: 'BRL',
                        value: termo.value + termo.shipping,
                        content_type: 'product',
                        contents: items_fbq,
                    });

                    gtag('event', 'purchase', {
                        currency: 'BRL',
                        value: termo.value,
                        items: items_gtag,
                        shipping: termo.shipping,
                        tax: termo.tax,
                        affiliation: termo.affiliation,
                        coupon: termo.coupon,
                        transaction_id: termo.transaction_id,
                        'e-mail': '',
                        phone_number: '+55'
                    });
                    break;
                case "ViewContent":
                    for (let i = 0; i < termo.items.length; i++) {
                        items_gtag.push({
                            item_id: termo.items[i].id,
                            id: termo.items[i].id,
                            item_name: termo.items[i].item_name,
                            name: termo.items[i].item_name,
                            discount: termo.items[i].discount,
                            currency: termo.items[i].currency,
                            price: termo.items[i].price,
                            promotion_name: termo.items[i].promotion_name,
                            promotion_id: termo.items[i].promotion_name,
                            index: termo.items[i].index,
                            item_list_name: termo.items[i].item_list_name,
                            item_list_id: termo.items[i].item_list_id
                        });
                        items_fbq.push({
                            id: termo.items[i].id,
                        });
                    }
                    fbq('track', 'ViewContent', {
                        content_type: 'product',
                        contents: items_fbq,
                    });
                    gtag('event', 'view_item', {
                        items: items_gtag,
                    });
                    break;
                case "AddToCart":
                    for (let i = 0; i < termo.items.length; i++) {
                        items_gtag.push({
                            item_id: termo.items[i].id,
                            id: termo.items[i].id,
                            item_name: termo.items[i].item_name,
                            name: termo.items[i].item_name,
                            quantity: termo.items[i].quantidade,
                            discount: termo.items[i].discount,
                            currency: termo.items[i].currency,
                            price: termo.items[i].price,
                            promotion_name: termo.items[i].promotion_name,
                            promotion_id: termo.items[i].promotion_name,
                            index: termo.items[i].index,
                            item_list_name: termo.items[i].item_list_name,
                            item_list_id: termo.items[i].item_list_id
                        });
                        items_fbq.push({
                            id: termo.items[i].id,
                            quantity: termo.items[i].quantidade
                        });
                    }

                    fbq('track', 'AddToCart', {
                        currency: 'BRL',
                        value: termo.value,
                        content_type: 'product',
                        contents: items_fbq,
                    });
                    gtag('event', 'add_to_cart', {
                        currency: 'BRL',
                        value: termo.value,
                        items: items_gtag,
                    });
                    if (window.SYNDI){
                        window.SYNDI.push({
                            "type": "track",
                            "event": "addToCart",
                            qty: items_gtag[0].quantidade,
                            sku: items_gtag[0].id,
                            price: termo.value,
                            "items": items_gtag
                        })
                    }
                    break;
                case "RemoveFromCart":
                    for (let i = 0; i < termo.items.length; i++) {
                        items_gtag.push({
                            item_id: termo.items[i].id,
                            id: termo.items[i].id,
                            item_name: termo.items[i].item_name,
                            name: termo.items[i].item_name,
                            quantity: termo.items[i].quantidade,
                            discount: termo.items[i].discount,
                            currency: termo.items[i].currency,
                            price: termo.items[i].price,
                            promotion_name: termo.items[i].promotion_name,
                            promotion_id: termo.items[i].promotion_name,
                            index: termo.items[i].index,
                            item_list_name: termo.items[i].item_list_name,
                            item_list_id: termo.items[i].item_list_id
                        });
                        items_fbq.push({
                            id: termo.items[i].id,
                            quantity: termo.items[i].quantidade
                        });
                    }
                    gtag('event', 'remove_from_cart', {
                        currency: 'BRL',
                        value: termo.value,
                        items: items_gtag,
                    });
                    break;
                case "CompleteRegistration":
                    fbq('track', 'CompleteRegistration');
                    gtag('event', 'sign_up');
                    break;
                case "Login":
                    gtag('event', 'login');
                    break;
                case "ViewItemList":
                    items_gtag = termo.items;
                    gtag('event', 'view_item_list', termo);
                    break;
                case "ViewCart":
                    gtag('event', 'view_cart', termo)
                    break;
                case "CloseCart":
                    gtag('event', 'close_cart', termo)
                    break;
                case "RequestContact":
                    fbq('track', 'FindLocation', termo.value)
                    gtag('event', 'request_contact', termo);
                    break;
            }
        }

        $('[data-target="entrando-contato"]').on('click', function() {
            filtroParaDadosAnaliticos('RequestContact', {
                value: this.getAttribute('href')
            });
        });
    </script>



<script>
        function pesquisar_post(termo) {
            filtroParaDadosAnaliticos("Search", { "search_string": termo });
            $.ajax({
                type: "POST",
                url: "/pesquisa/buscar/sugestoes",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'q': termo,
                },
                success: function (data) {

                    $(".dropdown-search").html(""), $(".dropdown-search").append('<hr class="mt-0"><div class="col-12 col-md-12" id="search-product"><p class="blueText font-weight-bold pl-2 font-sm mb-3 text-border-bottom-amarelo">Produtos</p></div></div>'), $("#search-suggestion").html(""), data.indices.forEach(function (a) { let e = a._source.indice; a = document.createElement("a"); a.classList.add("text-search"), a.setAttribute("href", "/pesquisa/" + e.replace(/\s/g, "-")), a.classList.add("my-1"), a.innerHTML = e, $("#search-suggestion").append(a) }), $("#search-suggestion").append("<hr>"); let todas_categorias = []; data.dados.categorias ? data.dados.categorias.forEach(function (a) { todas_categorias.includes(a._source.categoria_principal_url) || void 0 === a._source.categoria_principal_url || $("#search-suggestion").append("<p>" + termo + ' em <a href="/categorias/' + a._source.categoria_principal_url + '">' + a._source.categoria_principal_nome + "</a></p>"), todas_categorias.push(a._source.categoria_principal_url) }) : '', $("#search-suggestion").append('<hr class="d-md-none">'), $("#search-product").html("");

                    data.dados.produtos.forEach(function (value) {
                        var img_produto = 'produtos/caixa-rosario.jpg';
                        if (value._source.imagem_produto) {
                            img_produto = value._source.imagem_produto;
                        }
                        $("#search-product").append(`
                            <a href="/${value._source.url_produto}" data-produto_id="${value._source.cd_produto}" class="produto d-flex w-100 align-items-center item-search position-relative mb-3" style="transition: none;">
                                <div class="px-3 text-center">
                                    <div class="img-search-produto">
                                        <img src="/media/${img_produto}" width="50" height="50" alt="produto">
                                    </div>
                                </div>
                                <div class="w-100 pl-0">
                                    <div class="d-block">
                                        <p class="font-sm">${value._source.nm_produto}</p>
                                    </div>
                                </div>
                                <div class="w-100 text-right d-flex">
                                <div class="d-block w-75">
                                <p data-target="preco-produto"></p>
                                </div>
                                </div>
                            </a>
                        `);
                    });

                    $('.dropdown-search').append(`<hr>`);
                    $('.dropdown-search').append(`<a href="/pesquisa/` + termo.replace(/\s/g, '-').trim() + `"  class="w-100 d-block text-sm text-center py-2"> Ver todos os resultados ></a>`);

                    pegarPrecosAtribuirDescontos(true);
                },
                error: function (data) {
                    load('off', $('.asidebar'));
                    if (data.statusText !== 'error') {
                        doSubmit = false;
                    }
                }
            });
        }
        function pesquisar_get() {
            let valor = $('#barra-pesquisa').val();
            valor = valor.replace(/\s/g, 'r3pl4c3').trim().toLowerCase();
            valor = valor.slugify()
            valor = valor.replace(/r3pl4c3/g, '%20')
            window.location.replace("/pesquisa/" + valor);
        }
        function pesquisar_get_sugestao(termo) {
            let valor = termo;
            valor = valor.replace(/\s/g, 'r3pl4c3').trim();
            valor = valor.slugify()
            valor = valor.replace(/r3pl4c3/g, '%20')
            window.location.replace("/pesquisa/" + valor);
        }
        var typingTimer; //timer identifier
        var doneTypingInterval = 500; //time in ms, 1 second for example
        //quando digita inicia o contador
        $('#barra-pesquisa').on('keyup', function (e) {
            timer = 0;
            if (e.key === 'Enter' || e.keyCode === 13) {
                pesquisar_get();
            }
            clearTimeout(typingTimer);
            if ($('#barra-pesquisa').val) {
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            }
        });

        var timer = 0;
        setInterval(function () {
            timer += 1
        }, 1);
        //quando o usuario para de digitar
        function doneTyping() {
            var $search = $('#barra-pesquisa');
            if ($search.val().length >= 3) {
                pesquisar_post($search.val());
                $search.css({ borderRadius: '7px 7px 0px 0px', borderBottom: 'none' });
            }
        }

    </script>
<!-- Início do carrinho script -->

<script type="text/javascript">
        function onToggleCarrinho(status) {
            status ? "open" === status && ($(".asidebar").removeClass("asidebar-closed"), $("#carrinho_desfoco").addClass("asidebar-desfoco")) : ($(".asidebar").toggleClass("asidebar-closed"), $("#carrinho_desfoco").toggleClass("asidebar-desfoco")), $(".asidebar").hasClass("asidebar-closed") ? $("body").removeClass("overflow-hidden") : $("body").addClass("overflow-hidden")

            let produtos = [];

            

            if (!script_leaflet_load) {
                script_leaflet_load = true;
                loadScript("/staticfiles/leaflet/leaflet.f8b1586d921c.js", function(){})
            }

            if (!$('.asidebar').hasClass('asidebar-closed')) {

                if (carrinho.instance && carrinho.instance._pacotes) {
                    for (const pacote of carrinho.instance._pacotes) {
                        for ({ _produto } of pacote._produtos) {
                            produtos.push({
                                id: _produto.produto_id,
                                price: _produto.valor_ini,
                                discount: _produto.valor_desc,
                                item_name: _produto.produto__nm_ecommerce,
                                promotion_name: _produto.descontoprodutopreco__desconto__tipo_id,
                                quantidade: _produto.quantidade,
                                currency: 'BRL',
                                index: _produto.origem_posicao,
                                item_list_name: _produto.origem_descricao,
                                item_list_id: _produto.origem_descricao ? _produto.origem_descricao.toLowerCase().replace(/\s/g, '_') : '',
                            });
                        }
                    }
                }
                filtroParaDadosAnaliticos('ViewCart', {
                    currency: 'BRL',
                    value: carrinho.instance._calculaVlrTotalFloat(),
                    items: produtos
                })
            }
            else {
                filtroParaDadosAnaliticos('CloseCart', {
                    currency: 'BRL',
                    value: carrinho.instance._calculaVlrTotalFloat(),
                    items: produtos
                })
            }
        }
        function onToggleCarrinhoPopUp(status, seletor) {
            if (status === "open") {

                if ('#' + $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).attr('id') !== seletor) {
                    $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).css('z-index', '10002');
                }

                $(seletor).removeClass("asidebar-closed")
                $("#carrinho_desfoco").addClass("asidebar-desfoco-confirmacao")
                $("#carrinho_desfoco").attr('data-seletor', seletor);
            }
            else {
                $(seletor).toggleClass("asidebar-closed")
                if ($('.asidebar-confirmacao:not(.asidebar-closed)').length == 0) {
                    $("#carrinho_desfoco").toggleClass("asidebar-desfoco-confirmacao")
                    $("#carrinho_desfoco").removeAttr('data-seletor')
                }
                else {
                    $("#carrinho_desfoco").attr('data-seletor', '#' + $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).attr('id'));

                    if ('#' + $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).attr('id') !== seletor) {
                        $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).css('z-index', $($('.asidebar-confirmacao:not(.asidebar-closed)')[0]).attr('data-zindex'));
                    }
                }
            }
        }

        var __esse;

        function quantidadeProduto(__this, status, seletor) {

            __esse = __this;

            let html_quantidade = " ";

            var qtdMin = __this.attr("data-limite-min");
            var qtdMax = __this.attr("data-limite-max");
            var valor_escolhido = __this.attr("data-valor");

            for(let cont = qtdMin; cont <= qtdMax; cont++){
                html_quantidade += `<div class="cell" id="quantidade_${cont}" onclick="scrollToCell(${cont})" data-valor="${cont}" style="width: 100%;">${cont}</div>`;
            }

            $("#corpoModalQuantidade").html(html_quantidade);
            $('#modalQuantidade').modal('show');

            ouvirScroll(valor_escolhido);

            $(`#quantidade_${valor_escolhido}`).addClass('selected');
        }

        function scrollToCell(id) {
            ouvirScroll(id);
        }

        function ouvirScroll(valor_escolhido){

            var id = `quantidade_${valor_escolhido}`;
            const selected = "selected";

            function check(e) {
                const rect = e.target.getBoundingClientRect();
                const centerCell = document.elementFromPoint(
                    rect.left + e.target.offsetWidth / 2,
                    rect.top + e.target.offsetHeight / 2
                );
                if(centerCell){
                    if(!$(centerCell).hasClass(selected)){
                        for (const cell of e.target.getElementsByClassName(selected)) {
                            if(cell){
                                $(cell).removeClass(selected);
                            }
                        }
                        $(centerCell).addClass(selected);
                    }
                }
            }

            $('#corpoModalQuantidade').off('scroll').on('scroll', (ev)=> {
                check(ev);
            });

            // Seleciona o valor inicial
            $('#corpoModalQuantidade').animate({
                scrollTop: (valor_escolhido - 1) * 85
            }, 300);


        }


        function atualizarQuantidade(__this){

            var id = document.getElementById($(__this).prop('id'));
            var hash = id.getAttribute("hash");
            var token = id.getAttribute("token");
            var quantidadeAtual = id.getAttribute("data-quantidade");
            var quantidade;
            var acao;
            var selecionado;

            let lista = document.getElementById('corpoModalQuantidade');

            selecionado = $(lista).find('.selected').html();

            $("#quatidadeProdutoMobile").attr("data-valor", selecionado);


            let modalQuantidade = document.getElementById("corpoModalQuantidade");
            modalQuantidade.innerHTML = "";

            if(selecionado){

                if(selecionado > quantidadeAtual){
                    acao = "mais";
                    quantidade = selecionado - quantidadeAtual;
                    adicionar_remover_mobile(__this, acao, hash, token, quantidade);
                }
                else if(selecionado < quantidadeAtual){
                    acao = "menos";
                    quantidade = quantidadeAtual - selecionado;
                    adicionar_remover_mobile(__this, acao, hash, token, quantidade);
                }

            }
        }

        $("#modalQuantidade").on('hidden.bs.modal', function(){
            atualizarQuantidade(__esse);
        });


        function construirComboQtdcarrosselProduto(el, qtdMax){
            const qtd_max_produto = qtdMax ? qtdMax : 12
            let html_qtd_produto = ``
            for(let i = 1; i <= qtd_max_produto; i++){
                html_qtd_produto += `
                    <option value="${i}">${i}</option>
                `
            }
            $(el).html(html_qtd_produto)
        }


        function adicionar_remover_mobile(__this, acao, hash, token_nsu, quantidade) {
            let _this = __this
            let receita_id = $(_this).attr("data-receita-id")
            if (!hash) {
                hash = null;
            }
            if (acao) {
                if (acao === "menos") {
                    if (_this.attr('data-valor') > parseInt(_this.attr('data-limite-min')) || _this.attr('data-limite-min') === "") {

                        _this.html(_this.attr('data-valor'));

                        if (hash) {

                            load('on', $('.asidebar'));
                            $.ajax({
                                type: "POST",
                                url: "/carrinho/remover",
                                data: {
                                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                                    'hash_produto': hash,
                                    'quantidade': quantidade,
                                    'token_nsu': token_nsu,
                                    'receita_id' : receita_id ? receita_id : '',
                                },
                                success: (data) => {
                                    load('off', $('.asidebar'));
                                    if (data.status === true) {
                                        carrinho.instance._resetEntregas();
                                        carrinho.instance._resetPagamentos();
                                        atualizarCarrinho();
                                    } else {
                                        toastr.error(data.descricao, 'Erro ao enviar');
                                    }
                                },
                                error: (data) => {
                                    load('off', $('.asidebar'));
                                }
                            });
                        }
                    }
                } else if (acao === "mais") {
                    if (_this.attr('data-valor') < parseInt(_this.attr('data-limite-max')) || _this.attr('data-limite-max') === "") {

                        __this.html(_this.attr('data-valor'));

                        if (hash) {

                            adicionarProdutoCarrinho(hash, quantidade , _this);

                        }
                    }
                }
            }
        }


        doSubmitViewItem = false;

        var qtd_adicionado = 0;
        function adicionarProdutoCarrinho(produto, quantidade, _this, preco) {
            if(typeof(_this) == 'string'){
                _this = document.getElementById(_this)
            }
            var index_list, item_list_name, limite = !1; if (load("on", $(".asidebar")), isLoaderProduto = !0, $(_this).attr("data-approved") && qtd_adicionado > parseInt($(_this).attr("data-approved")) && ($(_this).parent().find('[data-toggle]="number_plus_minus"').attr("data-limite-max", $(_this).attr("data-approved")), $(_this).parent().find('[data-toggle]="number_plus_minus"').html(parseInt($(_this).attr("data-approved")) - quantidade), quantidade = parseInt($(_this).attr("data-approved")), parseInt($(_this).attr("data-approved")) - quantidade <= 0 && ($(_this).attr("disabled", !0), limite = !0)), _this) if (_this = $(_this), _this.attr("data-text", _this.html()), _this.html('<article><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><article>'), _this.addClass("isDisabled"), "number_plus_minus" === _this.attr("data-toggle")) { let t = $(_this).parents("[data-produto_id_carrinho]")[0]; index_list = $(t).attr("data-index"), item_list_name = $(t).attr("data-item_list_name"), filtroParaDadosAnaliticos("AddToCart", { value: parseFloat($(t).attr("data-valor_un")) * quantidade, items: [{ id: $(t).attr("data-produto_id_carrinho"), price: $(t).attr("data-valor_ini") ? $(t).attr("data-valor_ini") : "", discount: $(t).attr("data-valor_desc") ? $(t).attr("data-valor_desc") : "", item_name: $(t).attr("data-produto__nm_ecommerce") ? $(t).attr("data-produto__nm_ecommerce") : "", promotion_name: $(t).attr("data-desconto__tipo") ? $(t).attr("data-desconto__tipo") : "", currency: "BRL", quantidade: quantidade, item_list_name: item_list_name, item_list_id: item_list_name && item_list_name.toLowerCase() ?  item_list_name.toLowerCase().replace(/\s/g, "_") : '', index: index_list }] }) } else { let t = $(_this).parents("[data-produto_id]")[0], d = []; $(t).parents(".owl-stage").find(".owl-item:not(.cloned) .produto").each((t, a) => { d.push($(a).attr("data-produto_id")) }), index_list = -1 !== d.indexOf($(t).attr("data-produto_id")) ? d.indexOf($(t).attr("data-produto_id")) + 1 : 1, item_list_name = $(t).parents(".owl-stage").parent().parent().parent().find(".text-border-bottom-amarelo").text() ? $(t).parents(".owl-stage").parent().parent().parent().find(".text-border-bottom-amarelo").text() : "Pagina de Produto", filtroParaDadosAnaliticos("AddToCart", { quantidade, items: [{ id: $(t).attr("data-produto_id"), price: $(t).find("[data-vlr_desc]").attr("data-vlr_ini") ? $(t).find("[data-vlr_desc]").attr("data-vlr_ini") : "", discount: $(t).find("[data-vlr_desc]").attr("data-vlr_desc") ? $(t).find("[data-vlr_desc]").attr("data-vlr_desc") : "", item_name: $(t).find('[data-target="nome_produto"]').text(), promotion_name: $(t).find("[data-vlr_desc]").attr("data-tipo_desc") ? $(t).find("[data-vlr_desc]").attr("data-tipo_desc") : "", currency: "BRL", quantidade: quantidade, item_list_name: item_list_name, item_list_id: item_list_name && item_list_name.toLowerCase() ? item_list_name.toLowerCase().replace(/\s/g, "_") : '', index: index_list }] }) } var auth = "", codigo_produto = "", preco_compra = ""; $(_this).attr("data-auth") && (auth = $(_this).attr("data-auth"), codigo_produto = $(_this).attr("data-cod-produto"), preco_compra = $(_this).attr("data-preco_compra"));
            var receita_id = $(_this).attr("data-receita-id")
            let hash_preco = $(_this).attr("data-valor")
            $.ajax({
                type: "POST",
                url: "/carrinho/adicionar",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'hash_produto': produto,
                    'quantidade': quantidade,
                    'item_list_name': item_list_name,
                    'auth': auth,
                    'cod_produto': codigo_produto,
                    'hash_preco': hash_preco,
                    '_valor_unitario': preco,
                    'preco_compra': preco_compra,
                    'index': index_list,
                    'receita_id': receita_id ? receita_id : '',
                },
                success: function (data) {
                    $('#modal_retorno').modal('hide')
                    carrinho.instance._resetEntregas();
                    carrinho.instance._resetPagamentos();
                    qtd_adicionado += parseInt(quantidade), load("off", $(".asidebar")), _this && (_this.html(_this.attr("data-text")), _this.removeClass("isDisabled"), _this.attr("data-approved") && !limite && qtd_adicionado <= parseInt(_this.attr("data-approved")) && _this.addClass("isDisabled")), data.status ? (toastr.options.positionClass = "toast-top-right-carrinho", "success" === data.informacoes.status && toastr.success("O produto foi adicionado à sua cesta.", "Produto Adicionado"), "warning" === data.informacoes.status && toastr.warning("", data.informacoes.descricao), toastr.options.positionClass = "toast-top-right") : toastr.error(data.descricao, "Erro ao adicionar produto"), atualizarCarrinho();
                },
                error: function (data) {
                    isLoaderProduto = !1, load("off", $(".asidebar")), _this && (_this.html(_this.attr("data-text")), _this.removeClass("isDisabled")), "error" !== data.statusText && toastr.error("Ocorreu um erro inesperado ao adicionar um produto a cesta.", "Erro ao enviar");
                }
            });
        }
    </script>
    <script>

    let tabela_descontos_pbm = ''
    var idsku = [];
    var dataID;
    var configurationId;
    var autorizador;
    var termo_id;
    var programa_pbm;

    function verificarBeneficiario(info, data) {
        var cpf = $("#cpf_desconto").val();
        let cod_produto = $('.produto-comprar').find('[data-target="btn-comprar"]').attr('data-cod-produto')
        data_formulario = data
        //if ($('#cpf_desconto')[0].checkValidity()) {
            $('#cpf_error').addClass('d-none')
            load('on', $('body'));
            $.ajax({
                type: 'POST',
                url: "/core/produto/pbm/verificar_beneficiario",
                data: {
                    'cpf': cpf ? cpf : info?.cpf,
                    'cupom_desconto': $("#cupom_desconto") ? $("#cupom_desconto").val() : '',
                    'produto_id': info?.produto_id ? info?.produto_id : cod_produto,
                    'ean': info?.ean,
                    'uf': $("#uf_select").val(),
                },
                success: function (data) {

                    if (data?.erros) {
                        toastr.error(data.mensagens[0], 'Erro');
                        load('off', $('body'));
                    } else {
                        if (data?.carregar_cadastro) {
                            montarFormulario(data, info)
                            $('#modal_data').modal('show');
                        }
                        if (!data?.termo_aceito) {
                            $("#modal_aviso_termo").modal('show');
                            $("#link_url_lgpd").attr('href', data?.url_termo);
                            load('off', $('body'));
                        } else {
                            load('off', $('body'));
                            if (!data?.dados?.is_membro) {
                                termo_id = data.valor_id;
                                if(data?.autorizador === 'tnr_center'){
                                    $("#modal_termo_adesao").modal('show');
                                    $("#link_url_adesao").attr('href', data?.url_termo);
                                }else{
                                    if(data && !data.carregar_cadastro){
                                        $('#modal_data').modal('show');
                                        montarFormulario(data_formulario, info)
                                    }
                                }
                            } else {
                                termo_id = data.valor_id;
                                verificaElegebilidade(info);
                            }
                        }

                        programa_pbm = data && data.programa ? data.programa : ''
                    }
                },
                error: function (error) {
                    toastr.error('Não foi possível consultar o cadastro do CPF informado.')
                }
            });
        // } else {
        //     $(this).addClass('was-validated');
        //     $('#cpf_error').removeClass('d-none')
        //     toastr.warning('CPF informado está incorreto.', 'CPF inválido.')
        // }
    }



var data = new Date();
data = (data.getFullYear()) + "-0" + (data.getMonth() + 1) + "-" + (data.getDate());
$("#dt_receita")[0].setAttribute('max', data);
$("#dt_receita").attr('value', data);
$("#tipo-doc").on('change', function () {
    if (this.value == 1) {
        $("#crm_cro").html('CRM');
    } else {
        $("#crm_cro").html('CRO');
    }
});
function dadosCadastroBeneficiario(info) {
    let cpf = $("#cpf_desconto").val();
    let cod_produto = $('.produto-comprar').find('[data-target="btn-comprar-levemais"]').attr('data-cod-produto')
    
    if(!validaCPF(cpf)){
        return toastr.warning('Cpf inválido', "Erro")
    }

    load('on', $('body'));
    $.ajax({
        type: 'POST',
        url: "/core/produto/pbm/dados_cadastro_beneficiario",
        data: {
            'cpf': cpf ? cpf : info.cpf,
            'ean': info.ean,
            'produto_id': info?.produto_id ? info?.produto_id : cod_produto,
            //'cd_produto': cod_produto,
        },
        success: function (data) {
            load('off', $('body'));
            if (data && !data.carregar_cadastro) {
                montarFormulario(data)
            }
            verificarBeneficiario(info, data)
        },
        error: function (error) {
            toastr.error('Erro ao consultar dados do cadastro.')
        }
    });
}

function gerarCompra(tabela_descontos_pbm, info) {


    load('on', $("body"));
    //var qtd = $('[data-produto="pbm"]').attr('data-valor');
    var qtd = $('[data-target="combo-qtd-produto"]').val();
    var cpf = $("#cpf_desconto").val();
    var tipo_doc = $('#tipo-doc').val();
    var doc = $("#crm_medico").val();
    var uf = $("#uf_crm").val();
    var date_receita = $("#dt_receita").val();
    let cod_produto = $('.produto-comprar').find('[data-target="btn-comprar"]').attr('data-cod-produto');

    load('on', $(".modal.show .modal-content"));
    $.ajax({
        type: 'POST',
        url: "/core/produto/pbm/gerar_compra",
        data: {
            'ean': info.ean,
            'produto_id': info?.produto_id ? info?.produto_id : cod_produto,
            'qtd_item': qtd,
            'cpf': cpf,
            'programa': programa_pbm ? programa_pbm : '',
            'valor_id': termo_id ? termo_id : '',
            'tipo_doc': tipo_doc ? tipo_doc : '',
            'doc': doc ? doc : '',
            'uf': uf ? uf : '',
            'date_receita': date_receita ? date_receita : '',
            'programa': programa_pbm ? programa_pbm : '',
        },
        success: function (data) {
            // let html_desconto_ativo = ''

            var html = ''

            if (data.sucesso == true) {
                if (data.dados.qtd_aprovada > 0) {
                    $('[data-target="btn-comprar-pbm"]')[0].setAttribute('data-approved', data.dados.qtd_aprovada)
                    $("#modal_medico").modal('hide');
                    $('[data-auth].btn-pbm').attr('data-auth', data.dados.autorizacao);
                    var valor = data.dados.valor_venda;
                    $('[data-target="btn-comprar-pbm"]').attr('data-valor', valor);
                    $('[data-auth].btn-pbm article').html('R$ ' + parseFloat(valor).toLocaleFixed(2));
                    $("#preco_pbm").html('R$ ' + parseFloat(valor).toLocaleFixed(2));
                    $('[data-produto="pbm"]').attr('data-limite-max', data.dados.qtd_aprovada);
                    $(".btn-pbm").attr('disabled', true);
                    $('[data-auth]').attr('disabled', false);
                    $('[data-target="btn-comprar-pbm"]')[0].setAttribute('data-preco_compra', data.dados.valor_compra);


                    construirComboQtdcarrosselProduto(data.dados && data.dados.qtd_aprovada ? data.dados.qtd_aprovada : 1)
                    $('[data-target="combo-qtd-produto"]').val(data.dados && data.dados.qtd_aprovada ? data.dados.qtd_aprovada : 1);

                    if (parseInt(data.dados.qtd_aprovada) < parseInt($("[data-target=combo-qtd-produto]").attr('data-valor'))) {
                        $('[data-produto="pbm"]').attr('data-valor', parseInt(data.dados.qtd_aprovada))
                        $('[data-produto="pbm"]').text(parseInt(data.dados.qtd_aprovada))
                        $("[data-target=btn-comprar-pbm]").attr('data-qtd_produto', data.dados.qtd_aprovada)
                    }

                    toastr.success('Compra Liberada.', 'Sucesso');
                    if (data.autorizador === 'tnr_center') {
                        if (data.dados.qtd_aprovada >= 1) {
                            tabelaDescontoPBM(tabela_descontos_pbm)
                        }
                    }else{
                        $("#modal_medico").modal('hide')
                        autorizacao_pbm = true
                        qtd_pbm_aprovada = data.dados.qtd_aprovada
                    }
                    $(`[data-target="btn-pbm-${pegarCod_pbm}"]`).find(`[data-cod-produto="${pegarCod_pbm}"]`).show()
                    $(`[data-target="btn-pbm-${pegarCod_pbm}"]`).find('#input-cpf').hide()
                } else {
                    $("#modal_medico").modal('hide');
                    toastr.error('Venda não autorizada do produto  pelo Programa de Benefício em Medicamentos', 'Erro');
                }

                if (data.autorizador === 'tnr_center') {
                    $("#modal_retorno").modal('show');
                }

            } else {
                if (data.mensagens) {
                    toastr.error(data.mensagens.message ? data.mesages.message : "Erro", 'Erro');
                }else{
                    if(data.messages){
                        toastr.error(data.messages ? data.messages : "Erro", 'Erro');
                    }
                }
            }

            load('off', $('body'));
            load('off', $(".modal.show .modal-content"))
        },
        error: function () {
            load('off', $('body'));
            load('off', $(".modal.show .modal-content"))
            toastr.error('Houve algum problema na requisição, tente novamente mais tarde', 'Erro');
        }
    });
    }


    function verificaElegebilidade(info) {
        var cpf = $("#cpf_desconto").val();
        let cod_produto = $('.produto-comprar').find('[data-target="btn-comprar"]').attr('data-cod-produto')
        //var qtd = $('[data-toggle="number_plus_minus"]').attr('data-valor');
        var qtd = $('[data-target="combo-qtd-produto"]').val();
        if ($(".modal.show").length > 0) {
            load('on', $(".modal.show .modal-content"));
        } else {
            load('on', $("body"));
        }
        $.ajax({
            type: 'POST',
            url: "/core/produto/pbm/elegibilidade",
            data: {
                'cpf': cpf ? cpf : info?.cpf,
                'valor_id': termo_id,
                'ean': info?.ean,
                'produto_id': info?.produto_id ? info?.produto_id : cod_produto,
                'qtd_item': qtd,
                'uf': $("#uf_select").val(),
                'programa': programa_pbm ? programa_pbm : '',
            },
            success: function (data) {
                $(".modal").modal('hide');
                if (data.sucesso == true) {

                    let tabela_descontos_pbm = data.tabela_descontos_pbm;

                    if (data.autorizador != 'dermaclub') {
                        $('#form_dados-medico').off('submit').on('submit', function (event) {
                            event.preventDefault();
                            event.stopPropagation();
                            if (this.checkValidity() == true) {
                                //var qtd = $('[data-toggle="number_plus_minus"]').attr('data-valor');
                                var qtd = $('[data-target="combo-qtd-produto"]').val();
                                var tipo_doc = $('#tipo-doc').val();
                                var doc = $("#crm_medico").val();
                                var uf = $("#uf_crm").val();
                                var date_receita = $("#dt_receita").val();
                                var cpf = $("#cpf_desconto").val();
                                load('on', $(".modal.show .modal-content"));
                            }
                            gerarCompra(data.tabela_descontos_pbm, info)
                        })
                        $("#modal_medico").modal('show')
                        load('off', $(".modal.show .modal-content"));
                        load('off', $("body"));
                    } else {
                        gerarCompra(data.tabela_descontos_pbm, info)
                    }
                } else {
                    $('#modal_retorno').find('.modal-title').html('Não autorizada');
                    $('#modal_retorno').find('.modal-body').html('Baseado nas informações cadastradas, o usuário é inelegivel de desconto por meio do PBM.');

                    if (data.autorizador != 'dermaclub') {
                        $("#modal_retorno").modal('show');

                    }

                    load('off', $(".modal.show .modal-content"));
                    load('off', $("body"));
                }
            },
        })
    }


    function tabelaDescontoPBM(tabela_descontos_pbm) {
        tabela_descontos_pbm
        let produto_hash = $('.produto-comprar').find('[data-target="btn-comprar-pbm"]').attr('data-hash-produto')
        let auth = $('.produto-comprar').find('[data-target="btn-comprar-pbm"]').attr('data-auth')
        let cod_produto = $('.produto-comprar').find('[data-target="btn-comprar-pbm"]').attr('data-cod-produto')
        let hash_preco = $('.produto-comprar').find('[data-target="btn-comprar-levemais"]').attr('data-vlr_ini')
        html = ''
        $('#modal_retorno').find('.modal-body-tabela').html('')
        for(let [i,value] of tabela_descontos_pbm.entries()){
            let btn_comprar = 'btn-comprar-'+i
            html += `
            <div class="row col-12 d-flex align-items-center justify-content-center mb-3">
                <span class="col-4 qtd-tabela">${value.quantidade} Unidade${value.quantidade == 1 ? '' : 's'}</span>
                <span class="col-4 valor-tabela">R$ ${value.valor_final}</span>
                <button id="btn-comprar-${i}" item_list_name="" data-auth="${auth}" data-cod-produto="${cod_produto}" data-valor="${hash_preco}" data-receita-id=""  class="col-4 btn-tabela-pbm btn btn-warning text-white produto-comprar btn-comprar-pbm" onclick="adicionarProdutoCarrinho('${produto_hash}', ${value.quantidade}, '${btn_comprar}', '${value.valor_unitario}')">Comprar</button>         
            </div>` 
        }             
        $('#modal_retorno').find('.modal-body-tabela').append(html);
    }

    $("#form_pbm").on('submit', function (event) {
        load('off', $('body'))
        event.preventDefault();
        event.stopPropagation();
        if ($("#beneficiario_dt_inicio").val()) {
            var dt_inicio = $("#beneficiario_dt_inicio").val().split('/');
            var date = new Date();
            dt_inicio = new Date(dt_inicio[2], dt_inicio[1], dt_inicio[0]);
            if (dt_inicio != 'Invalid Date') {
                if (dt_inicio < date) {
                    $("#beneficiario_dt_inicio")[0].setCustomValidity('Erro');
                    $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('A data de início deve ser maior que a atual');
                } else {
                    $("#beneficiario_dt_inicio")[0].setCustomValidity('');
                    $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('O campo é obrigatório');
                }
            } else {
                $("#beneficiario_dt_inicio")[0].setCustomValidity('Erro');
                $("#beneficiario_dt_inicio").parent().find('.invalid-feedback').html('Data inválida');
            }
        }
        if (this.checkValidity() == false) {
            $(this).addClass('was-validated');
            $("input:invalid").focus();
            if ($("[type='radio']:invalid").length > 0) {
                $('#modal_data').animate({'scrollTop': 500}, 500);
            }
            return
        }
        var inputs = $(this).find('input, select').get();
        var arrayEnvio = {
            'data': {
                'fields': [],
                'quiz': [{
                    "id": dataID,
                    "configurationId": configurationId,
                    "skuId": idsku,
                    'questions': []
                }],

            },
            'autorizador': autorizador,
        };
        inputs.forEach(function (input) {
            var valor_default = $(input).attr('valor_default')
            var elementmask = $(input).attr('masktype');
            var valor = '';
            if (elementmask === 'cpf' || elementmask === 'cep' || elementmask === 'telefone' || elementmask === 'data') {
                valor = valor_default ? valor_default : $(input).val().slugify().replace(/[( . \/\ )]/g, '');
            } else {
                valor = valor_default ? valor_default : $(input).val();
            }
            if ($(input).attr('coluna_id')) {
                if ($(input).attr('type') == 'radio') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": valor,
                        });
                    }
                } else if ($(input).attr('type') == 'checkbox') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": 'true',
                        });
                    } else {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": 'false',
                        });
                    }
                } else {
                    if ($(input).attr('tabela_id') == 1 && ($(input).attr('coluna_id') == 6 || $(input).attr('coluna_id') == 7 || $(input).attr('coluna_id') == 28)) {
                        let value = $("#cpf_desconto").val() ? $("#cpf_desconto").val() : pegarCPF_pbm
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": value.slugify().replace(/[( . \/\ )]/g, ''),
                        });
                    } else {
                        arrayEnvio['data']['fields'].push({
                            "tableId": $(input).attr('tabela_id'),
                            "columnId": $(input).attr('coluna_id'),
                            "value": valor,
                        });

                    }
                }
            } else {
                if ($(input).attr('type') == 'radio') {
                    if ($(input).is(':checked')) {
                        arrayEnvio['data']['quiz'][0]['questions'].push({
                            'id': $(input).attr('questionid'),
                            'value': valor,
                        });
                    }
                } else {
                    arrayEnvio['data']['quiz'][0]['questions'].push({
                        'id': $(input).attr('questionid'),
                        'value': valor,
                    });
                }
            }
        });

        load('on', $(".modal.show .modal-content"));
        var cod_produto = $('.produto-comprar').find('[data-target="btn-comprar-pbm"]').attr('data-cod-produto');
        $.ajax({
            url: "/core/produto/pbm/cadastro_beneficiario",
            type: 'POST',
            data: {
                'json_resposta': JSON.stringify(arrayEnvio['data']),
                'valor_id': termo_id,
                'produto_id': pegarCod_pbm ?? cod_produto,
                'cpf': $("#cpf_desconto").val() ?? pegarCPF_pbm,
                'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
            },
            success: function (data) {
                if (data.sucesso) {
                    $('#modal_data').modal('hide')
                    toastr.success('Cadastro feito com sucesso.', 'Cadastrado')
                } else {
                    if(data.mensagens && data.mensagens.length){
                        toastr.error(data.mensagens[0], 'Erro');
                    } else {
                        toastr.error('Erro ao cadastrar usuário', 'Erro');
                    }
                }
                load('off', $(".modal.show .modal-content"));
            }
        })

        });

        function montarFormulario(data) {
        autorizador = data.autorizador;
        if (data.sucesso) {
            data.dados.campos.sort(function (a, b) {
                return a.order - b.order;
            });
            $("#form_pbm").html(' ')
            $("#form_pbm").append(`<p class="font-weight-bold my-2 w-100">Dados Pessoais:</p>`);
            data.dados.campos.forEach(function (e, i) {
                var d_none = '';

                var type = e.tipo ? e.tipo.toLowerCase() : '';
                var mask = '';
                var typemask = '';
                if (e.is_obrigatorio) {
                    var required = 'required';
                    var labelopcional = '';
                } else {
                    var required = '';
                    var labelopcional = '(opcional)'
                }
                if (e['tabela_id'] == 1 && (e['coluna_id'] == 6 || e['coluna_id'] == 7 || e['coluna_id'] == 28 || e['coluna_id'] == 33 || e['coluna_id'] == 4)) {
                    d_none = 'd-none';
                    required = '';
                }
                if (e['label'].toLowerCase().indexOf('cpf') > -1) {
                    mask = 'cpf';
                    typemask = 'cpf'
                } else if (e['label'].toLowerCase().indexOf('data') > -1) {
                    mask = 'input-data';
                } else if (e['label'].toLowerCase().indexOf('cep') > -1) {
                    mask = 'cep';
                    typemask = 'cep'
                } else if (e['label'].toLowerCase().indexOf('telefone') > -1 || e['label'].toLowerCase().indexOf('celular') > -1) {
                    mask = 'telefone';
                    typemask = 'telefone'
                }

                var input = '';
                if (e.tipo == 'radio') {
                    input = "<div class='d-block '>";
                    e['valores_permitidos'].forEach(function (value) {
                        input += `<div class="radio-ecomm  my-2 ml-md-2">
                                <input type="${e.tipo}" ${required}     class="form-control" id="${e['api_alias']}${value['valor']}${value['id']}" value="${value['valor']}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">
                                <label class="w-100" tabindex="0" for="${e['api_alias']}${value['valor']}${value['id']}">${value['label']}</label>
                                 </div>`;
                    });
                    input += "</div>";
                } else if (e.tipo == 'checkbox') {
                    input = `<div class="check-ecomm my-2 ml-md-2">
                                <input type="${e.tipo}" class="form-control" ${required} tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" id="question${e['api_alias']}" questionid="${e['api_alias']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}" value="true">
                                <label class="w-100" for="question${e['api_alias']}">${e['label']}</label>
                                 </div>`;
                } else if (e.tipo == 'select') {
                    input = document.createElement('select');
                    input.setAttribute('type', type);
                    input.setAttribute('name', e['api_alias']);
                    input.setAttribute('tabela_id', e['tabela_id']);
                    input.setAttribute('coluna_id', e['coluna_id']);
                    input.setAttribute('valor_default', e['valor_default'] ? e['valor_default'] : '');
                    if (required) {
                        input.setAttribute('required', 'true');
                    }
                    input.classList.add('form-control');
                    var option = document.createElement('option');
                    option.setAttribute('value', '');
                    input.append(option);
                    e['valores_permitidos'].forEach(function (value) {
                        var option = document.createElement('option');
                        option.setAttribute('value', value['valor']);
                        option.innerHTML = value['label'];
                        input.append(option);
                    });
                    input = input.outerHTML;
                } else {
                    if (autorizador === 'epharma' && (e['coluna_id'] === 33 || e['coluna_id'] === 4)) {
                        var date = new Date();
                        date = date.toLocaleDateString('en-GB', ['short'])
                        input = `<input ${required} value="${date}" type="${e.tipo}" id="${e['api_alias']}" masktype='${typemask}' class="form-control ${mask}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">`
                    } else {
                        input = `<input ${required} type="${e.tipo}" id="${e['api_alias']}" masktype='${typemask}' class="form-control ${mask}" name="${e['api_alias']}" tabela_id="${e['tabela_id']}" coluna_id="${e['coluna_id']}" valor_default="${e['valor_default'] ? e['valor_default'] : ''}">`
                    }
                }
                $("#form_pbm").append(`<div class="form-row m-0 my-2 w-100 ${d_none}">
                    <div class="col">
                    ${e.tipo != 'checkbox' ? `<label class="w-100" for="${e['api_alias']}">${e['label']} <span class="font-xxs float-right">${labelopcional}</span></label>` : ''}
                    ${input}
                    <div class='invalid-feedback'>O campo é obrigatório</div>
                    </div>
                    </div>
                `);
            });

            if (data['dados']['quiz'] && data['dados']['quiz'].length > 0) {
                dataID = data['dados']['quiz'][0].id;
                configurationId = data['dados']['quiz'][0].configuracao_id;
                if (data['dados']['quiz'][0]['medicamentos']) {
                    data['dados']['quiz'][0]['medicamentos'].forEach(function (e) {
                        idsku.push(e['id_sku']);
                    });
                }
                $("#form_pbm").append(`<p class="font-weight-bold my-2 w-100">Dados do médico:</p>`);
                if (data.dados.quiz[0].perguntas) {
                    data.dados.quiz[0].perguntas.forEach(function (e) {
                        var type = e.tipo;
                        if (e.is_obrigatorio == true) {
                            var required = 'required';
                            var labelopcional = '';
                        } else {
                            var required = '';
                            var labelopcional = '(Opcional)';
                        }
                        var mask = '';
                        var typemask = '';
                        if (e['titulo'].toLowerCase().indexOf('cpf') > -1) {
                            mask = 'cpf';
                            typemask = 'cpf';
                        } else if (e['titulo'].toLowerCase().indexOf('data') > -1) {
                            mask = 'input-data';
                        } else if (e['titulo'].toLowerCase().indexOf('cep') > -1) {
                            mask = 'cep';
                            typemask = 'cep';
                        } else if (e['titulo'].toLowerCase().indexOf('telefone') > -1 || e['titulo'].toLowerCase().indexOf('celular') > -1) {
                            mask = 'telefone';
                            typemask = 'telefone';
                        }

                        var input = '';
                        if (e.tipo == 'radio') {
                            input = `<div class='d-block'>
                                <label  for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>`;
                            e['valores_permitidos'].forEach(function (value) {
                                input += `<div class="radio-ecomm  my-2 ml-md-2 ">
                                <input type="${e.tipo}" class="form-control" name='radio${e['id']}' ${required} id="question${value['id']}" questionid="${e['id']}" value="${value['valor']}">
                                <label class="w-100" for="question${value['id']}">${value['label']}</label>
                                 </div>`;
                            });
                            input += "</div>";
                        } else if (e.tipo == 'checkbox') {
                            input = `<div class="check-ecomm my-2 ml-md-2">
                                <input type="${e.tipo}" class="form-control" ${required} id="question${e['id']}" questionid="${e['id']}" value="true">
                                <label class="w-100" for="question${e['id']}">${e['titulo']}</label>
                                 </div>`;
                        } else if (e.tipo == 'select') {
                            input = document.createElement('select');
                            input.setAttribute('type', type);
                            input.setAttribute('questionid', e['id']);
                            if (required) {
                                input.setAttribute('required', 'true');
                            }
                            input.classList = 'form-control question-pbm';
                            var option = document.createElement('option');
                            option.setAttribute('value', '');
                            input.append(option);
                            e['valores_permitidos'].forEach(function (value) {
                                var option = document.createElement('option');
                                option.setAttribute('value', value['valor']);
                                option.innerHTML = value['label'];
                                input.append(option);
                            });
                            input = `<label class="w-100"  for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>  ${input.outerHTML} `;
                        } else {
                            input = `<label class="w-100" for="question${e['id']}">${e['titulo']} <span class="font-xxs float-right">${labelopcional}</span></label>
                            <input type="${e.tipo}" masktype='${typemask}' ${required} questionid="${e['id']}" id="question${e['id']}" class="form-control question-pbm ${mask}">`
                                                    }
                                                    $("#form_pbm").append(`<div class="form-row m-0 my-2 w-100">
                                        <div class="col">
                                        ${input}
                            </div>
                            <div class='invalid-feedback'>O campo é obrigatório</div>
                            </div> `);
                    });
                }
            }
        }
        $(".cpf").mask('000.000.000-00');
        $(".cep").mask('00.000-000');
        $(".input-data").mask('00/00/0000');
        $(".telefone").mask('(99) 9999-99999');
        $(".telefone").on('blur', function () {
            if ($(this).val().length > 14) {
                $(this).unmask();
                $(this).mask('(99) 99999-9999');
            } else {
                $(this).unmask();
                $(this).mask('(99) 9999-9999');
            }
        });
    }
    </script>
<script>

    $("#modal").modal("show");
        var produtosParaCashback = [];
        var ajaxPrecos = null;
        let produtosDescontoRelampago = []
        let responsePreco = {}

        var pegarCPF_pbm = ''
        var pegarCod_pbm = ''
        var autorizacao_pbm = false
        var qtd_pbm_aprovada = 0

        function pegarPrecosAtribuirDescontos(loader) {

            if (!loader)
                load('on', $('body'));
            let produtos_ids = $("[data-produto_id]").map(function () {
                return $(this).attr("data-produto_id");
            }).get();

            function removeDups(names) {
                let unique = {};
                names.forEach(function (i) {
                    if (!unique[i]) {
                        unique[i] = true;
                    }
                });
                return Object.keys(unique);
            }
            produtos_ids = removeDups(produtos_ids);

            for (let i = 0; i < produtos_ids.length; i++) {
                load('on', $('[data-produto_id="' + produtos_ids[i] + '"]:not([data-target="produto_view"])'));
            }

            $(".d-none-valor-banco").removeClass("d-none-valor-banco");
            if (produtos_ids.length > 0) {
                ajaxPrecos = $.ajax({
                    type: "POST",
                    url: "/pegar/preco",
                    data: {
                        'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                        'produtos_ids': produtos_ids
                    },
                    success: function (data) {
                        produtosParaCashback = [];

                        load('off', $('body'));

                        var classe_img = "";
                        for (let i = 0; i < produtos_ids.length; i++) {
                            load('off', $('[data-produto_id="' + produtos_ids[i] + '"]'));
                        }

                        let is_mobile = 'False'
                        let path_atual = '/desodorante-aerosol-nivea-invisible-black-white-clear-200ml'

                        let novo_array = [];
                        produtosDescontoRelampago = [];

                        if (data) {
                            if (data.precos) {

                                responsePreco = data.precos

                                $.each(data.precos, function (index, objeto_preco) {

                                    var preco_publico = objeto_preco.publico, preco_pbm = objeto_preco.pbm, preco_clube = objeto_preco.clube, preco_parceiro = objeto_preco.parceiro, preco_convenio = objeto_preco.convenio, preco_progressivo = objeto_preco.progressivo;

                                    if(preco_publico && Object.keys(preco_publico).length && preco_publico.desconto_id){
                                        produtosDescontoRelampago.push(preco_publico.desconto_id)
                                    }

                                    if(preco_pbm && Object.keys(preco_pbm).length && preco_pbm.desconto_id){
                                        produtosDescontoRelampago.push(preco_pbm.desconto_id)
                                    }

                                    if(preco_clube && Object.keys(preco_clube).length && preco_clube.desconto_id){
                                        produtosDescontoRelampago.push(preco_clube.desconto_id)
                                    }

                                    //Variável com a hash do produto(ordem de prioridade: pbm -> clube -> público) para inserção nos botões de compra
                                    let produto_hash = preco_pbm && Object.keys(preco_pbm).length > 0 ? preco_pbm.hash : preco_clube && Object.keys(preco_clube).length > 0 ? preco_clube.hash : preco_publico && Object.keys(preco_publico).length > 0 ? preco_publico.hash : ""

                                    //Variável com o tipo do produto(ordem de prioridade: pbm -> clube -> público) para inserção nos botões de compra
                                    let is_controlado = preco_pbm && Object.keys(preco_pbm).length > 0 ? preco_pbm.is_controlado : preco_clube && Object.keys(preco_clube).length > 0 ? preco_clube.is_controlado : preco_publico && Object.keys(preco_publico).length > 0 ? preco_publico.is_controlado : ""

                                    //Variável com a url ecommerce do produto(ordem de prioridade: pbm -> clube -> público) para inserção nos botões de compra
                                    let produto_url_ecommerce = preco_pbm && Object.keys(preco_pbm).length > 0 ? preco_pbm.produto_url : preco_clube && Object.keys(preco_clube).length > 0 ? preco_clube.produto_url : preco_publico && Object.keys(preco_publico).length > 0 ? preco_publico.produto_url : ""

                                    produtosParaCashback.push(objeto_preco);

                                    let botao_clube = `
                                        <div class="produto-comprar pt-2 px-2" style="width:inherit">
                                            <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" data-auth data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%" style="background-color: #%classe_cor_botao_desconto%" class="btn btn-qtd text-white d-block text-center mw-200px font-weight-bold" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar-levemais" data-qtd_produto="%qtd_produto%">
                                                <article class="text-nowrap">
                                                    %texto_desconto%
                                                </article>
                                            </button>
                                        </div>
                                    `;

                                    let botao_desconto = `
                                        <div class="produto-comprar pt-2 px-2" style="width:inherit">
                                            <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" data-auth data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%" style="background-color: #%classe_cor_botao_desconto%" class="btn ${preco_pbm ? 'btn-qtd' : ''} text-white d-block text-center mw-200px font-weight-bold" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar-levemais" data-qtd_produto="%qtd_produto%">
                                                <article class="text-nowrap">
                                                    %texto_desconto%
                                                </article>
                                            </button>
                                        </div>
                                    `;

                                    // botao de comprar padrão
                                    let botao_default = `
                                        <div class="produto-comprar pt-2 px-2 d-flex" style="width:inherit">
                                                <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%"  class="btn btn-qtd botaoPadraoAzul text-white d-block text-center mw-200px fontOutfitBold font-weight-bold %classebotao%" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar" data-qtd_produto="1">
                                                    <span class="text-nowrap">
                                                        %comprar%
                                                    </span>
                                                </button>
                                            </div>
                                        </div>`;
                                    // botao de comprar padrão com seletor de quantidade
                                    let botao_default_com_seletor_quantidade = `
                                        <div class="produto-comprar d-flex justify-content-center m-0 p-0 pt-2 pl-0 pl-lg-2 pr-0 pr-lg-2 w-100" style="width:inherit">
                                            <div class="d-flex m-0 p-0 mw-200px">
                                                <fieldset class="col-5 m-0 p-0 pr-1 pr-lg-3">
                                                    <select class="form-control btn select2-qtd-produtos" style="border-radius: 3px";>
                                                        <option value="1">1</option>
                                                    </select>
                                                </fieldset>
                                                <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%"  class="btn btn-qtd botaoPadraoAzul text-white d-block text-center mw-200px fontOutfitBold font-weight-bold %classebotao%" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar" data-qtd_produto="1">
                                                    <span class="text-nowrap">
                                                        %comprar%
                                                    </span>
                                                </button>
                                            </div>
                                        </div>`;

                                    let botao_pbm_tabela = `<div class="produto-comprar d-flex justify-content-center m-0 pt-2 px-2" style="width:inherit">
                                        <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" ${path_atual == '/' || path_atual.includes('pesquisa/') ? '' : 'disabled'} data-auth data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%"  class="btn btn-pbm text-white d-block text-center mw-200px font-weight-bold" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar-pbm" data-qtd_produto="1">
                                            <article class="text-nowrap ${is_mobile == 'True' ? path_atual === '/' || path_atual.includes('pesquisa/') ? 'font-xxs' : '' : ''}">
                                                %texto_desconto%
                                            </article>
                                        </button>
                                    </div>`;

                                    let botao_pbm = `
                                            <div class="produto-comprar d-flex justify-content-center m-0 pt-2 px-2" data-target="btn-pbm-${index}" style="width:inherit">
                                                <button data-valor="%valor_produto%" data-cod-produto="${index}" data-url-ecommerce="${produto_url_ecommerce ? produto_url_ecommerce : ''}" data-is-controlado="${is_controlado ? is_controlado : ''}" data-hash-produto="${produto_hash ? produto_hash : ''}" data-receita-id="" ${path_atual == '/' || path_atual.includes('pesquisa/') ? '' : 'disabled'} data-auth data-vlr_ini="%vlr_ini%" data-vlr_desc="%vlr_desc%" data-tipo_desc="%tipo_desc%"  class="btn btn-pbm text-white text-center mw-200px space-limit-preco font-weight-bold" data-loading-text="<article><i class='fa fa-spinner fa-spin '></i> aguarde...</article>" data-target="btn-comprar-pbm" data-qtd_produto="1">
                                                    <article class="text-nowrap ${is_mobile == 'True' ? path_atual === '/' || path_atual.includes('pesquisa/') ? '' : '' : ''}">
                                                        %texto_desconto%
                                                    </article>
                                                </button>
                                                <form data-target="btn-comprar-pbm" data-cod-produto="${index}" id="input-cpf" class="input-group" style="display: none;" novalidate="novalidate">
                                                    <input id="cpf_home-${index}" type="text" class="form-control form-cpf" placeholder="Digite seu CPF" maxlength="14" required>
                                                        <div class="btn submit-cpf cursor-pointer"><img class="done-submit" alt="icone" width="25" height="25" src="/staticfiles/img/icons/done.svg"></div>
                                                </form>
                                            </div>
                                        `;


                                    let html_desconto = '';
                                    let class_img = '';
                                    let botoes = '', botao_comprar_pbm = '';
                                    texto_botao_padrao = "Comprar";
                                    texto_preco = `<span class="font-xl blueText fontOutfitExtraBold">R$ ${preco_clube && preco_clube.valor_fim && parseFloat(preco_clube.valor_fim) ? parseFloat(preco_clube.valor_fim).toLocaleFixed(2) : preco_publico && preco_publico.valor_fim && parseFloat(preco_publico.valor_fim) ? parseFloat(preco_publico.valor_fim).toLocaleFixed(2) : preco_publico.valor_ini && parseFloat(preco_publico.valor_ini) ? parseFloat(preco_publico.valor_ini).toLocaleFixed(2) : parseFloat('0.00').toLocaleFixed(2)}</span>`;
                                    texto_preco_pbm = `<p><span class="fontOutfitSemiBold font-weight-bold" style="color: #a3a3a3; font-size: 16px;">R$ ${preco_clube && preco_clube.valor_fim && parseFloat(preco_clube.valor_fim) ? parseFloat(preco_clube.valor_fim).toLocaleFixed(2) : preco_publico && preco_publico.valor_fim && parseFloat(preco_publico.valor_fim) ? parseFloat(preco_publico.valor_fim).toLocaleFixed(2) : preco_publico.valor_ini && parseFloat(preco_publico.valor_ini) ? parseFloat(preco_publico.valor_ini).toLocaleFixed(2) : parseFloat('0.00').toLocaleFixed(2)}<br/> <span class="fontOutfitBold font-weight-bold" style="color: #00af66 ;font-size: 30px;">R$ ${parseFloat(preco_pbm?.valor_fim).toLocaleFixed(2)} no desconto do programa</span></span> </p>`
                                    texto_preco_pbm_home = `<p><span class="fontOutfitSemiBold font-weight-bold" style="color: #a3a3a3; font-size: 13px;">R$ ${preco_clube && preco_clube.valor_fim && parseFloat(preco_clube.valor_fim) ? parseFloat(preco_clube.valor_fim).toLocaleFixed(2) : preco_publico && preco_publico.valor_fim && parseFloat(preco_publico.valor_fim) ? parseFloat(preco_publico.valor_fim).toLocaleFixed(2) : preco_publico.valor_ini && parseFloat(preco_publico.valor_ini) ? parseFloat(preco_publico.valor_ini).toLocaleFixed(2) : parseFloat('0.00').toLocaleFixed(2)}<br/> <span class="fontOutfitBold font-weight-bold" style="color: #00af66 ;font-size: 16px;">R$ ${parseFloat(preco_pbm?.valor_fim).toLocaleFixed(2)} no desconto do programa</span></span> </p>`
                                    if (preco_publico && preco_publico.imagem_selo) {
                                        html_desconto += `<img src="/media/${preco_publico.imagem_selo ? preco_publico.imagem_selo : ""}" alt="img-selo" width="60" height="60" class="desconto-produto float-left">`;
                                        classe_img = 'img-selo w-100'
                                    } else if (preco_publico.imagem_selo) {
                                        html_desconto += `<img src="/media/${preco_publico.imagem_selo ? preco_publico.imagem_selo : ""}" alt="img-selo" style='max-width: 70px' width="60" height="60" class="desconto-produto float-left">`;
                                        classe_img = 'img-selo w-100'
                                    }
                                    if (preco_publico && preco_publico.is_desc) {
                                        if (preco_publico.is_label_desc) {
                                            if (preco_publico['per_desc'] && parseFloat(preco_publico['per_desc']) > 0)
                                                html_desconto += `<div class="desconto-produto font-weight-bold w-100" style="min-height:30px"> -${preco_publico['per_desc'] ? parseFloat(preco_publico['per_desc']) < 9.6 ? parseFloat(preco_publico['per_desc']).toFixed(1) : parseFloat(preco_publico['per_desc']).toFixed(0) : ""}%</div>`;
                                            classe_img = 'img-div';
                                        } else {
                                            html_desconto += `<img src="/media/${preco_publico.imagem_desc ? preco_publico.imagem_desc : ""}" alt="selo desc" width="60" height="60" class="desconto-produto">`;
                                            classe_img = 'img-selo w-100'
                                        }

                                        var texto_preco = ``, classe_botao_default = "",
                                            texto_botao_desconto = "", texto_botao_pbm, texto_preco_pbm,
                                            classe_cor_botao_desconto = "btn-danger", classe_cor_botao_desconto_hover = "",
                                            qtd_produto = `${preco_publico['qtd_ini_desc'] ? preco_publico['qtd_ini_desc'] : ""}`,
                                            qtd_fim_produto = `${preco_publico['qtd_fim_desc'] ? preco_publico['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_publico['cd_produto_final_url'] ? preco_publico['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_publico['cd_produto_final_nome'] ? preco_publico['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_publico['referencia'] ? parseFloat(preco_publico['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_publico['valor_fim'] ? parseFloat(preco_publico['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_publico['valor_fim_somado'] ? parseFloat(preco_publico['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_publico['vlr_desc'] ? preco_publico['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_publico['tipo_desc'] ? preco_publico['tipo_desc'] : "";

                                        classe_cor_botao_desconto = preco_publico['cor_desc'];

                                        classe_cor_botao_desconto_hover = preco_publico['cor_hover_desc'];

                                        // botao de desconto
                                        texto_botao_desconto = preco_publico['descricao_botao_html'] ? preco_publico['descricao_botao_html']
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : "";

                                        texto_botao_padrao = preco_publico['descricao_botao_padrao_html'] ? preco_publico['descricao_botao_padrao_html']
                                            .replace(/\${valor_ini}/g, valor_ini)
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : "";
                                        // texto do desconto
                                        texto_preco = preco_publico['descricao_html'] ? preco_publico['descricao_html']
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${referencia}/g, referencia)
                                            .replace(/\${valor_ini}/g, valor_ini)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome)
                                            .replace(/\${cd_produto_final_url}/g, cd_produto_final_url) : "";
                                    }
                                    else if(preco_publico){
                                        var qtd_produto = `${preco_publico['qtd_ini_desc'] ? preco_publico['qtd_ini_desc'] : ""}`,
                                            qtd_fim_produto = `${preco_publico['qtd_fim_desc'] ? preco_publico['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_publico['cd_produto_final_url'] ? preco_publico['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_publico['cd_produto_final_nome'] ? preco_publico['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_publico['referencia'] ? parseFloat(preco_publico['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_publico['valor_fim'] ? parseFloat(preco_publico['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_publico['valor_fim_somado'] ? parseFloat(preco_publico['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_publico['vlr_desc'] ? preco_publico['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_publico['tipo_desc'] ? preco_publico['tipo_desc'] : "";
                                    }
                                    if (preco_clube) {
                                        if (preco_clube.imagem_selo) {
                                            html_desconto += `<img src="/media/${preco_clube.imagem_selo ? preco_clube.imagem_selo : ""}" alt="selo desconto"  width="60" height="60" class="desconto-produto float-left w-100">`;
                                            classe_img = 'img-selo w-100'
                                        }
                                        var x = (((preco_publico.referencia - preco_clube.referencia) / preco_publico.referencia) * 100).toFixed(2).toString();
                                        if (x && parseFloat(x) > 5.0)
                                            html_desconto += `<div class="desconto-produto font-weight-bold  w-100" style="min-height:30px"><article class="font-xl"> -${x ? parseFloat(x) < 9.6 ? parseFloat(x).toFixed(1) : parseFloat(x).toFixed(0) : ""}% </article></div>`;
                                        classe_img = 'img-div';
                                        var texto_preco = ``, classe_botao_default = "",
                                            texto_botao_clube = "",
                                            classe_cor_botao_desconto = preco_clube['cor_desc'], classe_cor_botao_desconto_hover = "",
                                            qtd_produto = `${preco_clube['qtd_ini_desc'] ? preco_clube['qtd_ini_desc'] : ""}`,
                                            qtd_fim_produto = `${preco_clube['qtd_fim_desc'] ? preco_clube['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_clube['cd_produto_final_url'] ? preco_clube['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_clube['cd_produto_final_nome'] ? preco_clube['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_clube['referencia'] ? parseFloat(preco_clube['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_clube['valor_fim'] ? parseFloat(preco_clube['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_clube['valor_fim_somado'] ? parseFloat(preco_clube['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_clube['vlr_desc'] ? preco_clube['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_clube['tipo_desc'] ? preco_clube['tipo_desc'] : "";

                                        texto_botao_desconto = preco_clube.descricao_botao_html ? preco_clube.descricao_botao_html
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : "";

                                        texto_botao_padrao = preco_clube.descricao_botao_padrao_html ? preco_clube.descricao_botao_padrao_html
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : ''

                                        texto_preco = preco_clube.descricao_html ? preco_clube.descricao_html
                                            .replace(/\${valor_fim}/g, valor_fim ? valor_fim : '')
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : '';
                                    }
                                    if (preco_pbm) {
                                        var classe_botao_default = "",
                                            texto_botao_clube = "",
                                            classe_cor_botao_desconto_hover = "",
                                            qtd_produto = `${preco_pbm['qtd_ini_desc'] ? preco_pbm['qtd_ini_desc'] : ""}`,
                                            qtd_fim_produto = `${preco_pbm['qtd_fim_desc'] ? preco_pbm['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_pbm['cd_produto_final_url'] ? preco_pbm['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_pbm['cd_produto_final_nome'] ? preco_pbm['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_pbm['referencia'] ? parseFloat(preco_pbm['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_pbm['valor_fim'] ? parseFloat(preco_pbm['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_pbm['valor_fim_somado'] ? parseFloat(preco_pbm['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_pbm['vlr_desc'] ? preco_pbm['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_pbm['tipo_desc'] ? preco_pbm['tipo_desc'] : "";

                                        var texto_botao_pbm = preco_pbm['descricao_botao_html'] ? preco_pbm['descricao_botao_html']
                                            .replace(/\${qtd_ini_desc}/g, preco_pbm['qtd_produto'] ? preco_pbm['qtd_produto'] : '')
                                            .replace(/\${qtd_fim_desc}/g, preco_pbm['qtd_fim_produto'] ? preco_pbm['qtd_fim_produto'] : '')
                                            .replace(/\${valor_fim}/g, preco_pbm['valor_fim'] ? parseFloat(preco_pbm['valor_fim']).toLocaleFixed(2) : '')
                                            .replace(/\${valor_fim_somado}/g, preco_pbm['valor_fim_somado'] ? preco_pbm['valor_fim_somado'] : '')
                                            .replace(/\${cd_produto_final_nome}/g, preco_pbm['cd_produto_final_nome'] ? preco_pbm['cd_produto_final_nome'] : "") : '';

                                        texto_botao_padrao = preco_publico.descricao_botao_padrao_html ? preco_publico.descricao_botao_padrao_html
                                            .replace(/\${valor_ini}/g, preco_publico.valor_ini ? preco_publico.valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, preco_publico.qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, preco_publico.qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, preco_publico.valor_fim)
                                            .replace(/\${valor_fim_somado}/g, preco_publico.valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, preco_publico.cd_produto_final_nome) : 'Comprar'

                                        texto_preco = preco_pbm.descricao_html ? preco_pbm.descricao_html
                                            .replace(/\${valor_fim}/g, valor_fim ? valor_fim : '')
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : '';

                                    }

                                    if(preco_parceiro){
                                        var classe_botao_default = "",
                                            texto_botao_clube = "",
                                            classe_cor_botao_desconto_hover = "",
                                            qtd_produto = `${preco_parceiro['qtd_ini_desc'] ? preco_parceiro['qtd_ini_desc'] : ""}`,
                                            qtd_fim_produto = `${preco_parceiro['qtd_fim_desc'] ? preco_parceiro['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_parceiro['cd_produto_final_url'] ? preco_parceiro['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_parceiro['cd_produto_final_nome'] ? preco_parceiro['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_parceiro['referencia'] ? parseFloat(preco_parceiro['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_parceiro['valor_fim'] ? parseFloat(preco_parceiro['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_parceiro['valor_fim_somado'] ? parseFloat(preco_parceiro['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_parceiro['vlr_desc'] ? preco_parceiro['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_parceiro['tipo_desc'] ? preco_parceiro['tipo_desc'] : "";

                                            texto_botao_desconto = preco_parceiro.descricao_botao_html ? preco_parceiro.descricao_botao_html
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : "";

                                            texto_botao_padrao = preco_parceiro.descricao_botao_padrao_html ? preco_parceiro.descricao_botao_padrao_html
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : ''

                                            texto_preco = preco_parceiro.descricao_html ? preco_parceiro.descricao_html
                                            .replace(/\${valor_fim}/g, valor_fim ? valor_fim : '')
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, cd_produto_final_nome) : '';
                                    }

                                    if(preco_progressivo) {
                                            classe_cor_botao_desconto_hover = "",
                                            qtd_fim_produto = `${preco_progressivo['qtd_fim_desc'] ? preco_progressivo['qtd_fim_desc'] : ""}`,
                                            cd_produto_final_url = `${preco_progressivo['cd_produto_final_url'] ? preco_progressivo['cd_produto_final_url'] : ""}`,
                                            cd_produto_final_nome = `${preco_progressivo['cd_produto_final_nome'] ? preco_progressivo['cd_produto_final_nome'] : ""}`,
                                            referencia = preco_progressivo['referencia'] ? parseFloat(preco_progressivo['referencia']).toLocaleFixed(2) : "",
                                            valor_ini = preco_publico['valor_ini'] ? parseFloat(preco_publico['valor_ini']).toLocaleFixed(2) : "",
                                            valor_fim = preco_publico['valor_fim'] ? parseFloat(preco_publico['valor_fim']).toLocaleFixed(2) : "",
                                            valor_fim_somado = preco_progressivo['valor_fim_somado'] ? parseFloat(preco_progressivo['valor_fim_somado']).toLocaleFixed(2) : "",
                                            vlr_desc = preco_progressivo['vlr_desc'] ? preco_progressivo['vlr_desc'] : "",
                                            vlr_ini = preco_publico['valor_ini'] ? preco_publico['valor_ini'] : "",
                                            tipo_desc = preco_progressivo['tipo_desc'] ? preco_progressivo['tipo_desc'] : "";

                                        let descontoProg = preco_progressivo.progressivos[0];
                                        let listaDescontosProg = '';
                                        let descontoInicial = preco_progressivo.progressivos[0];
                                        let descontoFinal = preco_progressivo.progressivos[preco_progressivo.progressivos.length - 1];
                                        valor_ini = descontoInicial['vlr_final'] ? parseFloat(descontoInicial['vlr_final']).toLocaleFixed(2) : "",
                                        valor_fim = descontoFinal['vlr_final'] ? parseFloat(descontoFinal['vlr_final']).toLocaleFixed(2) : "",
                                        valor_fim_somado = parseFloat(valor_fim * descontoFinal['quantidade']).toLocaleFixed(2);
                                        qtd_fim_produto = descontoFinal['quantidade'];
                                        vlr_ini = valor_ini;

                                        /*preco_progressivo.progressivos.forEach(objeto => {
                                            if (objeto.quantidade > descontoProg.quantidade) {
                                                descontoProg = objeto;
                                            }
                                        });*/

                                        qtd_produto = qtd_fim_produto;
                                        texto_botao_desconto = `${qtd_fim_produto} un R$ ${valor_fim} cada`

                                        texto_preco = `<p> ${qtd_fim_produto} por <span class="font-weight-bold font-xl blueText">R$ ${valor_fim} </span> cada</p><p>   <span class="text-muted small">1 por <span>R$ ${valor_ini}</span> cada</span></p>`

                                        texto_botao_padrao = preco_progressivo.descricao_botao_padrao_html ? preco_progressivo.descricao_botao_padrao_html
                                            .replace(/\${valor_ini}/g, valor_ini ? valor_ini : '')
                                            .replace(/\${qtd_ini_desc}/g, preco_publico.qtd_produto)
                                            .replace(/\${qtd_fim_desc}/g, qtd_fim_produto)
                                            .replace(/\${valor_fim}/g, valor_fim)
                                            .replace(/\${valor_fim_somado}/g, valor_fim_somado)
                                            .replace(/\${cd_produto_final_nome}/g, preco_publico.cd_produto_final_nome) : 'Comprar'

                                        scriptInfoProgressivo({dados: preco_progressivo})
                                    }

                                    let produto = $(`[data-produto_id=${index}]`);

                                    if (texto_botao_padrao) {
                                        //Verificação para adicionar o botão comum na página do produto ou o botão com seletor de quantidade nos carrosséis.
                                        if(produto.attr('data-target') === 'produto_view'){
                                            botoes += botao_default.replace('%comprar%', texto_botao_padrao).replace('%classebotao%', preco_clube ? '' : '').replace('%valor_produto%', valor_ini).replace('%vlr_ini%', vlr_ini).replace('%vlr_desc%', vlr_desc).replace('%tipo_desc%', tipo_desc);
                                        } else {
                                            botoes += botao_default_com_seletor_quantidade.replace('%comprar%', texto_botao_padrao).replace('%classebotao%', preco_clube ? '' : '').replace('%valor_produto%', valor_ini).replace('%vlr_ini%', vlr_ini).replace('%vlr_desc%', vlr_desc).replace('%tipo_desc%', tipo_desc);
                                        }
                                    }
                                    
                                    if (texto_botao_pbm) {
                                        botao_comprar_pbm += botao_pbm.replace('%texto_desconto%', texto_botao_pbm).replace('%qtd_produto%', qtd_produto ? qtd_produto : 1).replace('%valor_produto%', preco_pbm.valor_fim);
                                        botoes += botao_pbm.replace('%texto_desconto%', texto_botao_pbm).replace('%qtd_produto%', qtd_produto ? qtd_produto : 1).replace('%valor_produto%', preco_pbm.valor_fim);
                                        texto_botao_desconto = ''

                                        let qtd_btn = $('.produto-footer').attr('data-qtd-btn')
                                        if(qtd_btn == '2'){
                                            if(preco_clube){
                                                texto_botao_padrao = ''
                                            } else {
                                                texto_botao_desconto = ''
                                            }
                                        }

                                        if(texto_botao_padrao && texto_botao_desconto){
                                            texto_botao_padrao = ''
                                        }
                                    }

                                    if (texto_botao_desconto) {
                                        if(preco_clube){
                                            botoes += botao_clube.replace('%classe_cor_botao_desconto%', classe_cor_botao_desconto).replace('%texto_desconto%', texto_botao_desconto).replace('%qtd_produto%', qtd_produto ? qtd_produto : 1).replace('%valor_produto%', valor_fim).replace('%vlr_ini%', vlr_ini).replace('%vlr_desc%', vlr_desc).replace('%tipo_desc%', tipo_desc);
                                        } else {
                                            botoes += botao_desconto.replace('%classe_cor_botao_desconto%', classe_cor_botao_desconto).replace('%texto_desconto%', texto_botao_desconto).replace('%qtd_produto%', qtd_produto ? qtd_produto : 1).replace('%valor_produto%', valor_fim).replace('%vlr_ini%', vlr_ini).replace('%vlr_desc%', vlr_desc).replace('%tipo_desc%', tipo_desc);
                                        }
                                    }


                                    // if (preco_pbm) {
                                    //     produto.find('#preco_pbm').html(`R$ ${parseFloat(preco_pbm.valor_fim).toLocaleFixed(2)}`);
                                    //     produto.find('[data-target="btn-comprar-pbm"]').html(botao_pbm_tabela)
                                    // }

                                    produto.find('[data-target="desconto-produto"]').html(html_desconto);
                                    produto.find('[data-target="desconto-produto"]').addClass('view-produto ' + classe_img);

                                    if(!preco_publico && !preco_clube && !preco_pbm){
                                        botoes = `
                                        <div class="produto-comprar pt-2  pb-3" style="width:inherit">
                                            <span class="font-weight-bold  text-danger bg-white text-nowrap small">Produto indisponível</span>
                                        </div>
                                        `;
                                    }

                                    produto.find('.produto-footer').html(botoes);
                                    // produto.find('.produto-footer-pbm').html(botao_comprar_pbm ? botao_comprar_pbm : '');

                                    if (preco_publico && (preco_publico.produto_tipo === 'vacina' || preco_publico.produto_tipo === 'exame' || preco_publico.produto_tipo === 'kit_agendamento' || preco_publico.produto_tipo === 'brinco' || preco_publico.produto_tipo === 'injetavel')) {
                                        var botao_servicos = ``;
                                        if (produto.attr('data-target') !== "produto_view") {
                                            botao_servicos += `
                                            <div class="produto-comprar pt-2 px-2" style="width:inherit">
                                                <a href="/${preco_publico.produto_url}" data-target="btn-saibamais" class="btn btn-outline-primary text-white d-block text-center mw-200px font-weight-bold" style="border: 3px solid var(--primary)">
                                                    <article class="text-nowrap">
                                                    Saiba Mais
                                                    </article>
                                                </a>
                                            </div>`;
                                        }

                                        //
                                        else {
                                            //Vacina ou exame sem desconto
                                            botao_servicos += `
                                                <div class="produto-comprar pt-2 px-2" style="width:inherit">
                                                    <a href="/agendamento?produto=${preco_publico.produto_id}" class="btn btn-qtd botaoPadraoAzul text-white d-block text-center mw-200px font-weight-bold mt-1">
                                                        <article class="text-nowrap">
                                                            Agendar
                                                        </article>
                                                    </a>
                                                </div>
                                            `;
                                        }

                                        let valor_servico = preco_publico.valor_ini ? parseFloat(preco_publico.valor_ini).toLocaleFixed(2) : preco_publico.valor_fim ? parseFloat(preco_publico.valor_fim).toLocaleFixed(2) : '';

                                        produto.find('.produto-footer').html(botao_servicos);
                                    }

                                    if(preco_publico && preco_publico.produto_tipo === 'voucher'){
                                        var botao_servicos = ``;
                                        let valor_servico = valor_fim ? valor_fim : valor_ini ? valor_ini : '';
                                        botao_servicos += `
                                            <div class="produto-comprar pt-2" style="width:inherit">
                                                <a href="/vacinas?produto=${preco_publico.produto_id}" class="btn btn-qtd btn-warning text-white d-block text-center mw-200px font-weight-bold mt-1">
                                                    <article class="text-nowrap">
                                                        Reservar
                                                    </article>
                                                </a>
                                            </div>
                                        `;
                                        produto.find('.produto-footer').html(botao_servicos);
                                    }

                                    if (preco_publico && !preco_publico.is_disponivel) {
                                        if (preco_publico.produto_tipo !== 'alto_custo') {
                                            botoes = `
                                                <div class="produto-comprar pt-2  pb-3" style="width:inherit">
                                                    <span class="font-weight-bold  text-danger bg-white text-nowrap small">Produto indisponível</span>
                                                </div>
                                            `;
                                        }
                                        else {

                                            texto_preco = `<span class="font-xl blueText fontOutfitExtraBold">Sob consulta</span>`

                                            botoes = `
                                                <div class="produto-comprar pt-2 pb-3" style="width:inherit">
                                                    <a href="https://api.whatsapp.com/send/?phone=5541988693303&amp;text=Olá! Gostaria de saber mais informações sobre o produto ${preco_publico.produto_id}  https://urlRosario.com.br/${preco_publico.produto_url}" target="_blank" class="btn btn-qtd btn-success text-white d-block text-center font-weight-semibold w-100 d-flex text-nowrap align-items-center small justify-content-center" style="background-color:  #00d45e!important;border-color: #0a9748!important;">
                                                        <img src="/staticfiles/img/icons/icon_whatsapp.svg" width="20">
                                                        Consultar
                                                    </a>
                                                </div>
                                            `;
                                        }
                                        let isRemove = false;
                                        for (let i = 0; i < produto.length; i++) {
                                            if ($(produto[i]).attr('data-target') === "produto_view") {
                                                isRemove = true;
                                                $(produto[i]).find('[data-toggle="number_plus_minus"]').parent().prev().remove();
                                                $(produto[i]).find('[data-toggle="number_plus_minus"]').parent().remove();
                                            }
                                        }
                                        produto.find('.produto-footer').html(botoes);
                                        if (isRemove) {
                                            produto.find('.text-danger.bg-white.text-nowrap').removeClass('pt-5');
                                        }
                                    }

                                    produto.find('.produto-footer [data-target="btn-comprar-levemais"]').on({
                                        mouseenter: function () {
                                            classe_cor_botao_desconto_hover = "#" + classe_cor_botao_desconto_hover;
                                            $(this).css({ backgroundColor: classe_cor_botao_desconto_hover });
                                        },
                                        mouseleave: function () {
                                            classe_cor_botao_desconto = "#" + classe_cor_botao_desconto;
                                            $(this).css({ backgroundColor: classe_cor_botao_desconto });
                                        }
                                    });

                                    

                                    produto.find('[href]').on('click.fbqfunc', function (ev) {
                                        let id_produto = $(ev.target).parents('[data-produto_id]');

                                        let arrayProdutos = [];

                                        id_produto.parents('.owl-stage').find('.owl-item:not(.cloned) .produto').each((chave, valor) => {
                                            arrayProdutos.push($(valor).attr('data-produto_id'));
                                        });

                                        let index_list = arrayProdutos.indexOf(id_produto.attr('data-produto_id')) + 1;
                                        let item_list_name = id_produto.parents('.owl-stage').parent().parent().parent().find('.text-border-bottom-amarelo').text();

                                        filtroParaDadosAnaliticos('ViewContent', {
                                            items: [
                                                {
                                                    id: id_produto.attr('data-produto_id'),
                                                    price: id_produto.find('[data-vlr_desc]').attr('data-vlr_ini') ? id_produto.find('[data-vlr_desc]').attr('data-vlr_ini') : "",
                                                    discount: id_produto.find('[data-vlr_desc]').attr('data-vlr_desc') ? id_produto.find('[data-vlr_desc]').attr('data-vlr_desc') : "",
                                                    item_name: id_produto.find('[data-target="nome_produto"]').text(),
                                                    promotion_name: id_produto.find('[data-vlr_desc]').attr('data-tipo_desc') ? id_produto.find('[data-vlr_desc]').attr('data-tipo_desc') : "",
                                                    currency: 'BRL',
                                                    item_list_name: item_list_name,
                                                    item_list_id: item_list_name.toLowerCase().replace(/\s/g, '_'),
                                                    index: index_list
                                                },
                                            ],
                                        });
                                    });

                                    if(preco_pbm){ 
                                        if(produto.attr('data-target') === 'produto_view'){
                                            produto.find(`[data-target="preco-produto"]`).html(texto_preco_pbm);
                                        }else {
                                            produto.find(`[data-target="preco-produto"]`).html(texto_preco_pbm_home);
                                        }
                                    }else { 
                                        produto.find(`[data-target="preco-produto"]`).html(texto_preco);
                                    }
                                    

                                    /*
                                    produto.find('[data-target="btn-comprar"]').off('click').on('click', function (ev) {
                                        adicionarProdutoCarrinho(preco_publico.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                    });
                                    produto.find('[data-target="btn-comprar-levemais"]').off('click').on('click', function (ev) {
                                        adicionarProdutoCarrinho(preco_publico.is_desc ? preco_publico.hash : preco_clube.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                    });
                                    produto.find('[data-target="btn-comprar-pbm"]').off('click').on('click', function (ev) {

                                        let url_produto = produto.find('[data-target="btn-comprar"]').attr('data-url-ecommerce')
                                        let url_atual = window.location.pathname.replace('/', '', 1).replace(/\s/g, '-').trim()

                                        if(url_atual === url_produto) {
                                            adicionarProdutoCarrinho(preco_pbm.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                        } else {
                                            location.assign(url_produto ? "/" + url_produto : "/" + $(`[data-produto_id=${index}]`).attr('[data-url-ecommerce]'))
                                        }

                                    });
                                    */

                                    produto.find('[data-target="btn-comprar"]').off('click').on('click', function (ev) {

                                        let produto_hash = preco_clube && Object.keys(preco_clube).length > 0 ? preco_clube.hash : preco_publico && Object.keys(preco_publico).length > 0 ? preco_publico.hash : ""
                                        let produto_is_controlado = produto.find('[data-target="btn-comprar"]').attr('data-is-controlado')
                                        let url_produto = produto.find('[data-target="btn-comprar"]').attr('data-url-ecommerce')
                                        let url_atual = window.location.pathname.replace('/', '', 1).replace(/\s/g, '-').trim()

                                        //Fluxo controlado
                                        if(produto_is_controlado != "true"){
                                            if(produto.attr('data-target') != 'produto_view'){
                                                $(this).attr('data-qtd_produto', $(this).prev().find('select').val())
                                            }

                                            adicionarProdutoCarrinho(preco_publico.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                        } else {
                                            /**/

                                            if(produto.attr('data-target') != 'produto_view'){
                                                $(this).attr('data-qtd_produto', $(this).prev().find('select').val())
                                            }
                                            $('#modal_aviso_controlado').modal('show')
                                            // Passar os dados necessários para o botão de confirmação
                                            $('#confirmarCompraControlado').data('hash', preco_publico.hash);
                                            $('#confirmarCompraControlado').data('qtd', parseInt($(this).attr('data-qtd_produto')));
                                            $('#confirmarCompraControlado').data('elemento', this);
                                        }
                                    });
                                    
                                    produto.find('[data-target="btn-comprar-levemais"]').off('click').on('click', function (ev) {
                                        let produto_is_controlado = produto.find('[data-target="btn-comprar-levemais"]').attr('data-is-controlado')
                                        let url_produto = produto.find('[data-target="btn-comprar-levemais"]').attr('data-url-ecommerce')
                                        let url_atual = window.location.pathname.replace('/', '', 1).replace(/\s/g, '-').trim()

                                        //Fluxo controlado
                                        if(produto_is_controlado != "true"){
                                            adicionarProdutoCarrinho(preco_publico.is_desc ? preco_publico.hash : preco_clube.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                        } else {
                                            /**/
                                            
                                            $('#modal_aviso_controlado').modal('show')

                                            // Passar os dados necessários para o botão de confirmação
                                            $('#confirmarCompraControlado').data('hash', preco_publico.is_desc ? preco_publico.hash : preco_clube.hash);
                                            $('#confirmarCompraControlado').data('qtd', parseInt($(this).attr('data-qtd_produto')));
                                            $('#confirmarCompraControlado').data('elemento', this);
                                        }
                                    });

                                    // Função para adicionar o produto ao carrinho ao confirmar no modal
                                    $('#confirmarCompraControlado').off('click').on('click', function() {
                                        let hash = $(this).data('hash');
                                        let qtd = $(this).data('qtd');
                                        let elemento = $(this).data('elemento');
                                        
                                        adicionarProdutoCarrinho(hash, qtd, elemento);

                                        // Fechar o modal após a ação
                                        $('#modal_aviso_controlado').modal('hide');
                                    });

                                    produto.find('[data-target="btn-comprar-pbm"]').off('click').on('click', function (ev) {
                                        let produto_is_controlado = produto.find('[data-target="btn-comprar-pbm"]').attr('data-is-controlado')

                                        let url_produto = produto.find('[data-target="btn-comprar-pbm"]').attr('data-url-ecommerce')
                                        let url_atual = window.location.pathname.replace('/', '', 1).replace(/\s/g, '-').trim()
                                        let index = produto.find('[data-target="btn-comprar-pbm"]').attr('data-cod-produto')
                                        let qtd_produto

                                        //if(url_atual === url_produto) {
                                        //    adicionarProdutoCarrinho(preco_pbm.hash, parseInt($(this).attr('data-qtd_produto')), this);
                                        //} else {
                                        //    location.assign(url_produto ? "/" + url_produto : "/" + $(`[data-produto_id=${index}]`).attr('[data-url-ecommerce]'))
                                        //}
                                        
                                        if(url_atual === url_produto) {
                                            if(produto_is_controlado != "true"){
                                                if(autorizacao_pbm){
                                                    if($('[data-target="combo-qtd-produto"]').val() > qtd_pbm_aprovada){
                                                        toastr.warning('Quantidade aprovada excedida', "Alerta")
                                                        qtd_produto = qtd_pbm_aprovada
                                                        adicionarProdutoCarrinho(preco_pbm.hash, qtd_produto, this);
                                                    }else{
                                                        qtd_produto = $('[data-target="combo-qtd-produto"]').val()
                                                        adicionarProdutoCarrinho(preco_pbm.hash, $('[data-target="combo-qtd-produto"]').val(), this);
                                                    }
                                                }
                                            }else{
                                                $(this).attr('data-hash-produto', preco_publico.is_desc ? preco_publico.hash : preco_clube.hash)
                                                visualizar_receita(this)
                                            }
                                        }else{
                                            if(produto_is_controlado != "true"){
                                                if (autorizacao_pbm) {
                                                    if($('[data-target="combo-qtd-produto"]').val() > qtd_pbm_aprovada){
                                                        toastr.warning('Quantidade aprovada excedida', "Alerta")
                                                        qtd_produto = qtd_pbm_aprovada
                                                        adicionarProdutoCarrinho(preco_pbm.hash, qtd_produto, this);
                                                    }else{
                                                        qtd_produto = $('[data-target="combo-qtd-produto"]').val()
                                                        adicionarProdutoCarrinho(preco_pbm.hash, $('[data-target="combo-qtd-produto"]').val(), this);
                                                    }   
                                                }else{
                                                    $(`[data-target="btn-pbm-${index}"]`).find(`[data-cod-produto="${index}"]`).hide()
                                                    $(`[data-target="btn-pbm-${index}"]`).find('#input-cpf').show()
                                                    $(`[data-target="btn-pbm-${index}"]`).find(`#cpf_home-${index}`).val('')
                                                    $(`[data-target="btn-pbm-${index}"]`).find('#input-cpf').focus()
                                                    $('.form-cpf').mask("000.000.000-00")
                                                    $(`[data-target="btn-pbm-${index}"]`).find('.submit-cpf').off('click').on('click', function() {
                                                        
                                                            $('#modal_aviso').modal('show')
                                                        
                                                    })
                                                }
                                            }else{
                                                location.assign(url_produto ? "/" + url_produto : "/" + $(`[data-produto_id=${index}]`).attr('[data-url-ecommerce]'))   
                                            }
                                        }
                                    });
                                        if (preco_publico && preco_publico.produto_is_funcionario) {
                                            $(`.avisos-produto-funcionario${preco_publico.produto_id}`).removeClass('d-none')
                                            $(".btn-verificar-deconto").addClass('cursor-pointer').off().click(() => {
                                                // Botao de verificar, basicamente é adicionar no carrinho com a validacao no back se vai zerar ou nao
                                                produto.find('[data-target="btn-comprar-levemais"]').click()
                                                onToggleCarrinho("open")
                                            })
                                            if (!preco_publico.is_funcionario) {
                                                $(".btn-verificar-deconto").parent().remove()
                                                produto.find('[data-target="btn-comprar"]').off().addClass('isDisabled')
                                            }
                                        }
            

                                    
                                        $('.produto-footer-pbm').length > 0 ? produto.find('.produto-footer').not('.produto-footer-pbm').find('[data-target="btn-comprar-pbm"]').parent().remove() : null
                                    
                                }); //9328
                            }
                        }

                        $('[data-target="produto_view"]').find('.mw-200px').removeClass('mw-200px').addClass('w-100 font-xl');

                        if (!doSubmitViewItem) {
                            doSubmitViewItem = true;

                            let carrosseisProdutos = $('.produtos.owl-carousel').parent();

                            if (carrosseisProdutos.length === 0 && $('[data-target="produto_view"]').length > 0) {
                                doSubmitViewItem = false;
                            }

                            if ($('.produtos.owl-carousel').length > 0) {

                                carrosseisProdutos.each((chave, element) => {
                                    let itemListName = $(element).find('.text-border-bottom-amarelo').html();
                                    let listaItems = [];

                                    let cont = 1;
                                    $(element).find('.owl-item:not(.cloned) .produto').each((c, e) => {
                                        listaItems.push({
                                            item_id: $(e).attr('data-produto_id'),
                                            price: $(e).find('[data-vlr_desc]').attr('data-vlr_ini') ? $(e).find('[data-vlr_desc]').attr('data-vlr_ini') : "",
                                            discount: $(e).find('[data-vlr_desc]').attr('data-vlr_desc') ? $(e).find('[data-vlr_desc]').attr('data-vlr_desc') : "",
                                            item_name: $(e).find('.text-body.cursor-pointer.text-limit-2').html(),
                                            promotion_name: $(e).find('[data-vlr_desc]').attr('data-tipo_desc') ? $(e).find('[data-vlr_desc]').attr('data-tipo_desc') : "",
                                            item_list_name: itemListName ? itemListName : '',
                                            item_list_id: itemListName ? itemListName.toLowerCase().replace(/\s/g, '_') : '',
                                            currency: 'BRL',
                                            index: cont
                                        });
                                        cont++;
                                    });
                                    let termo = {
                                        item_list_name: itemListName ? itemListName : '',
                                        item_list_id: itemListName ? itemListName.toLowerCase().replace(/\s/g, '_') : '',
                                        items: listaItems
                                    };
                                    filtroParaDadosAnaliticos('ViewItemList', termo);
                                });
                            }

                            let pesquisaProdutos = $('#search-produtos, #destaques_wl').parent();
                            if ($('#search-produtos, #destaques_wl').length > 0) {
                                let itemListName = pesquisaProdutos.find('.font-xs.font-weight-bold.blueText.text-uppercase').last().attr('href');
                                let listaItems = [];
                                let cont = 1;
                                pesquisaProdutos.find('.produto').each((c, e) => {
                                    listaItems.push({
                                        item_id: $(e).attr('data-produto_id'),
                                        price: $(e).find('[data-vlr_desc]').attr('data-vlr_ini') ? $(e).find('[data-vlr_desc]').attr('data-vlr_ini') : "",
                                        discount: $(e).find('[data-vlr_desc]').attr('data-vlr_desc') ? $(e).find('[data-vlr_desc]').attr('data-vlr_desc') : "",
                                        item_name: $(e).find('.text-body.cursor-pointer.text-limit-2').html(),
                                        promotion_name: $(e).find('[data-vlr_desc]').attr('data-tipo_desc') ? $(e).find('[data-vlr_desc]').attr('data-tipo_desc') : "",
                                        item_list_name: itemListName ? itemListName : '',
                                        item_list_id: itemListName ? itemListName.toLowerCase().replace(/\s/g, '_') : '',
                                        currency: 'BRL',
                                        index: cont
                                    })
                                });
                                let termo = {
                                    item_list_name: itemListName ? itemListName : '',
                                    item_list_id: itemListName ? itemListName.toLowerCase().replace(/\s/g, '_') : '',
                                    items: listaItems
                                };
                                filtroParaDadosAnaliticos('ViewItemList', termo);
                            }

                        }

                        if($('.carrossel-especial').length){
                            for(let el of $('.carrossel-especial')){
                                startTimer($(el).attr('data-timer'));
                            }
                        }

                        for(let el of $('.select2-qtd-produtos')){
                            construirComboQtdcarrosselProduto($(el))
                        }


                        // if($('.produto-footer-produto-template').length){
                        //     let cdProduto = $('.produto-footer-produto-template').attr('data-cd-produto')
                        //     let timer = ''
                        //     if(responsePreco[cdProduto]){
                        //         timer = responsePreco[cdProduto].pbm && responsePreco[cdProduto].pbm.dat_fim_timer ? responsePreco[cdProduto].pbm.dat_fim_timer : responsePreco[cdProduto].clube && responsePreco[cdProduto].clube.dat_fim_timer ? responsePreco[cdProduto].clube.dat_fim_timer : responsePreco[cdProduto].publico && responsePreco[cdProduto].publico.dat_fim_timer ? responsePreco[cdProduto].publico.dat_fim_timer : ''
                        //     }
                        //     if(timer){
                        //         startTimer(timer)
                        //         $('[data-target="bloco-promocao-relampago"]').show(300)
                        //     }
                        // }

                        //pegarQtdEstoque(produtosDescontoRelampago)
                    },
                    error: function (data) {
                        load('off', $('body'));

                        for (let i = 0; i < produtos_ids.length; i++) {
                            load('off', $('[data-produto_id="' + produtos_ids[i] + '"]'));
                        }

                        if (data.statusText !== 'error') {
                            toastr.error('Ocorreu um erro inesperado ao atualizar os preços dos produtos.', 'Erro');
                        }
                    }
                });
            }
        }

        pegarPrecosAtribuirDescontos();


        function pegarQtdEstoque(produtos) {

            function removeDups(names) {
                let unique = {};
                names.forEach(function (i) {
                    if (!unique[i]) {
                        unique[i] = true;
                    }
                });
                return Object.keys(unique);
            }

            let produtos_promocao_relampago = removeDups(produtos)

            for (let i = 0; i < produtos_promocao_relampago.length; i++) {
                load('on', $('[data-produto_id="' + produtos_promocao_relampago[i] + '"]:not([data-target="produto_view"])'));
            }

            $.ajax({
                type: "POST",
                url: "/pegar/desconto/quantidade",
                data: {
                    'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                    'desconto_id': produtos_promocao_relampago,
                },
                success: function (data) {
                    for (let i = 0; i < produtos_promocao_relampago.length; i++) {
                        load('off', $('[data-produto_id="' + produtos_promocao_relampago[i] + '"]:not([data-target="produto_view"])'));
                    }
                },
                error: function (data) {
                    for (let i = 0; i < produtos_promocao_relampago.length; i++) {
                        load('off', $('[data-produto_id="' + produtos_promocao_relampago[i] + '"]:not([data-target="produto_view"])'));
                    }
                }
            });
        }

        function scriptInfoProgressivo(info) {
            let lista = ''
            info.dados.progressivos.forEach(objeto => {
                lista += `
                    <div class="d-flex justify-content-between">
                        <strong class="text-muted">${objeto.quantidade} ${objeto.quantidade == '1' ? 'unidade' : 'unidades' }</strong>
                        <span class="text-muted">R$${objeto.vlr_final ? objeto.vlr_final.toLocaleFixed(2) : ''} cada</span>
                    </div>
                `
            });

            $('.desconto-progressivo').html(

                `
                
                    <div class="dropup droptop-progressivo  d-none d-md-block">
                        <span class="btn-desconto-progressivo my-2 cursor-pointer" data-toggle="dropdown" aria-expanded="false">
                            Desconto Progressivo
                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-1 ml-1" height="20" viewBox="0 -960 960 960" width="20"><path d="M453-280h60v-240h-60v240Zm26.982-314q14.018 0 23.518-9.2T513-626q0-14.45-9.482-24.225-9.483-9.775-23.5-9.775-14.018 0-23.518 9.775T447-626q0 13.6 9.482 22.8 9.483 9.2 23.5 9.2Zm.284 514q-82.734 0-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681 80-480.5q0-82.819 31.5-155.659Q143-709 197.5-763t127.341-85.5Q397.681-880 480.5-880q82.819 0 155.659 31.5Q709-817 763-763t85.5 127Q880-563 880-480.266q0 82.734-31.5 155.5T763-197.684q-54 54.316-127 86Q563-80 480.266-80Zm.234-60Q622-140 721-239.5t99-241Q820-622 721.188-721 622.375-820 480-820q-141 0-240.5 98.812Q140-622.375 140-480q0 141 99.5 240.5t241 99.5Zm-.5-340Z"/></svg>
                        </span>

                        <div class="dropdown-menu shadow tooltip-progressivo" x-placement="top-start">
                            <div class="ativo py-1">
                                <p>Desconto Progressivo</p>
                            </div>
                            <div class="p-2">
                                ${lista}
                            </div>
                        </div>
                    </div>
                
                `
            )

            $(".lista-progressivo").html(lista)

            $(".btn-desconto-progressivo").mouseenter(function(){
                $(".tooltip-progressivo").dropdown('toggle');
            });

            $(".btn-desconto-progressivo").mouseleave(function(){
                $(".tooltip-progressivo").dropdown('hide');
            });

            $(".btn-desconto-progressivo").click(function(){
                $("#modal_progressivo").modal('show');
            });
        }
</script>

<!-- Fim do carrinho scripts -->
<script>
    $('#barra-pesquisa').on('focusout', function (e) {
        setTimeout(() => {
            $(".dropdown-search").css({ visibility: 'hidden' });
        }, 200);
    })
    function validaCPF(t) { var e, n = 0; if ("00000000000" === (t = t?.replace(/[^\d]+/g, "")) || "11111111111" === t || "22222222222" === t || "33333333333" === t || "44444444444" === t || "55555555555" === t || "66666666666" === t || "77777777777" === t || "88888888888" === t || "99999999999" === t) return !1; for (i = 1; i <= 9; i++)e = 10 * (n += parseInt(t?.substring(i - 1, i)) * (11 - i)) % 11; if (10 != e && 11 != e || (e = 0), e != parseInt(t?.substring(9, 10))) return !1; for (n = 0, i = 1; i <= 10; i++)e = 10 * (n += parseInt(t?.substring(i - 1, i)) * (12 - i)) % 11; return 10 != e && 11 != e || (e = 0), e == parseInt(t?.substring(10, 11)) } function validaSenha() { return $("#senha_cadastro").val() === $("#confirm-senha_cadastro").val() } function conteudoModal(t) { "login" === t ? ($("#html_login").removeClass("d-none"), $("#html_cadastro").addClass("d-none")) : ($("#html_cadastro").removeClass("d-none"), $("#html_login").addClass("d-none")) } function onoffbody(t) { "on" === t ? $(".body-disabled").css({ visibility: "hidden", opacity: 0 }) : $(".body-disabled").css({ visibility: "visible", opacity: 1 }) } function objectifyForm(t) { let e = {}; for (var i = 0; i < t.length; i++)t[i].value && (e[t[i].name] = t[i].value); return e } $(".cpf").on("blur", function () { validaCPF(this.value) ? this.setCustomValidity("") : this.setCustomValidity("cpf invalido") }), $(".index_letra").on("click", function (t) { return t.preventDefault(), t.stopPropagation(), !1 }), $(".index_letra a").hover(function () { var t = $(this).attr("href"), t = $(t).offset().top - $(".itens_index").offset().top + $(".itens_index").scrollTop(); $(".itens_index").stop().animate({ scrollTop: t }, 200) }), $(".btn_footer-collapse").on("click", function (t) { "false" === t.target.getAttribute("aria-expanded") ? ($(t.target).html($(t.target).html().replace("Mais", "Menos")), $(t.target).children("img").css({ transform: "rotate(180deg)" })) : ($(t.target).html($(t.target).html().replace("Menos", "Mais")), $(t.target).children("img").css({ transform: "rotate(0deg)" })) });
</script>

<script>
    window.onload = function () { load("off", $("body")) };
</script>

<script>

    $("#modal_multiplos_pagamentos").on('shown.bs.modal', function () {
        $('#btn-confirmar-pagamento-dividido').off('click').on('click', function(){ carrinho.instance.pagamento._validarPagamentoDividido(); })
    });

    $("#modal_localizacao_mapa").on("hidden.bs.modal", function (a) { $("[data-target='map-lista_horarios_p']").removeClass("d-none"), $("[data-target='map-lista_horarios_div']").removeClass("d-none"), $("[data-target='map-lista_servicos_div']").removeClass("d-none"), $("[data-target='map-lista_servicos']").removeClass("d-none") });
    function minimizar_e_maximizar(i) { i && ($($(i).attr("data-target")).hasClass("show") ? $(i).find(".indicador").removeClass("icon_horizontal-line").addClass("icon_plus") : $(i).find(".indicador").removeClass("icon_plus").addClass("icon_horizontal-line")) }
    String.prototype.slugify || (String.prototype.slugify = function () { return this.toString().toLowerCase().replace(/[àÀáÁâÂãäÄÅåª]+/g, "a").replace(/[èÈéÉêÊëË]+/g, "e").replace(/[ìÌíÍîÎïÏ]+/g, "i").replace(/[òÒóÓôÔõÕöÖº]+/g, "o").replace(/[ùÙúÚûÛüÜ]+/g, "u").replace(/[ýÝÿŸ]+/g, "y").replace(/[ñÑ]+/g, "n").replace(/[çÇ]+/g, "c").replace(/[ß]+/g, "ss").replace(/[Ææ]+/g, "ae").replace(/[Øøœ]+/g, "oe").replace(/[%]+/g, "pct").replace(/\-\-+/g, "").replace(/\-/g, "").replace(/^-+/, "").replace(/-+$/, "") });
</script>

<script>
    (function (a, b, c, d, e, f, g) {
    a['CsdpObject'] = e; a[e] = a[e] || function () {
    (a[e].q = a[e].q || []).push(arguments)
    }, a[e].l = 1 * Date.now(); f = b.createElement(c),
    g = b.getElementsByTagName(c)[0]; f.async = 1; f.src = d; g.parentNode.insertBefore(f, g)
    })(window, document, 'script', '//device.clearsale.com.br/p/fp.js', 'csdp');
    csdp('app', 'None');
    csdp('sessionid', 'None');
</script>

<script>
    $("[name='sexo']").on("change", function () { $("[name='sexo']").removeClass("is-invalid") }), $("#termo-uso").on("change", function () { this.checked ? $("#btn-cadastrar").removeAttr("disabled") : $("#btn-cadastrar").attr("disabled", "true") }), $(".cpf").mask("000.000.000-00"), $(".telefone").mask("(00) 0 0000-0000"), $(".cep").mask("00.000-000"), $(".rg").mask("00.000.000-0", { placeholder: "" }), $(".dt-nascimento").mask("00/00/0000"), $(".cartao").mask("0000.0000.0000.0000"), $(".validade-num").mask("00/00"), $(".cvv").mask("000"), $(".rg").mask("00.000.000-0"), $(".number").mask("#"), $(".cnpj").mask("00.000.000/0001-00"), $(".input-busca").on("focus", function () { onoffbody("off"), $(".dropdown-search").css({ visibility: "visible" }), $(this).css({ borderRadius: "10px 10px 0px 0px", borderBottom: "none" }) });
    var listasearch = [];
    
</script>

<script>
    $(".input-busca").on("focusout", function () { onoffbody("on"); $(this).css({ borderRadius: "10px", borderBottom: "1px solid #e4e7ea" })});
</script>

<script>
    $('#barra-pesquisa').on('focus', function (e) {
        if($('.dropdown-search').children().length === 0){
            $(".dropdown-search").append(`<div class="col-12 col-md-4" id="search-suggestion"></div>`);

            $.ajax({
                url: "/pesquisa/buscar/mais-buscados",
                type: "POST",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success: (data) => {
                    data.dados.forEach(value => {
                        var texto = document.createElement('p');
                        texto.classList.add('text-search');
                        texto.classList.add('my-1');
                        texto.style.cursor = "pointer";
                        $(texto).on('click', function () {
                            let valor = value;
                            valor = valor.replace(/\s/g, '-').trim();
                            window.location.replace("/pesquisa/" + valor);
                        });
                        texto.innerHTML = value;
                        // for com o texto do resultado da busca //
                        $("#search-suggestion").append(texto);
                    })
                    load("off", $(".dropdown-search"));
                },
                error: function (data) {
                    load("off", $(".dropdown-search"));
                }
            });
        }
    })
</script>

<script>
    function toggleSidebar() {
        $("body").css({ overflow: "auto" }), $(".body-disabled").css({ visibility: "hidden" });
        var t = document.getElementsByClassName("sidebar-mobile")[0];
        "0px" === t.style.left ? (t.style.left = "-100%") : ($("body").css({ overflow: "hidden" }), $(".body-disabled").css({ visibility: "visible" }), (t.style.left = "0"));
        
    }
    $(".input-padrao").each(function (t, e) {
        null == e.value || null == e.value || "" == e.value || e.parentNode.classList.add("active");
    }),
    $(".input-padrao").on("focus", function (t) {
        t.target.parentNode.classList.add("active");
    }),
    $(".input-padrao").on("blur", function (t) {
        0 == this.value.length && t.target.parentNode.classList.remove("active");
    }),
    $(".input-padrao:required ").on("keypress", function (t) {
        "" != t.target.value ? t.target.setCustomValidity("") : t.target.setCustomValidity("preencha o campo");
    }),
    $(".mostra-senha").on("click", function (t) {
        "show" === $(this).attr("data-target")
            ? ($(this).attr("data-target", "close"), t.target.parentNode.querySelector(".senha").setAttribute("type", "text"), (this.style.background = "url(/staticfiles/img/icons/icon-eye-hide.5ebd532e8188.png) no-repeat center"))
            : ($(this).attr("data-target", "show"), t.target.parentNode.querySelector(".senha").setAttribute("type", "password"), (this.style.background = "url(/staticfiles/img/icons/icon-eye-show.4dcd992800a2.png) no-repeat center"));
    }),
    $(".has-children").on("click", function (t) {
        t.target.parentNode.children[1] && t.target.parentNode.children[1].classList.add("active");
    }),
    $(".back_sidebar").on("click", function (t) {
        t.target.parentNode.parentNode && t.target.parentNode.parentNode.classList.remove("active");
    });

    

    $(".is-numeric").mask('00000000000000000000000000');

    function alterarPassoReceita(passo){
        $('.passo:not([data-passo="'+passo+'"])').hide(600);
        $('.passo[data-passo="'+passo+'"]').show(600);
    }

    $(".rg-receita").mask("00.000.000-00")
    $(".qtd-receita").mask("00")

    async function getEstados(form, loader){

        load('on', $(loader));

        return new Promise(function(resolve, reject) {
            $.ajax({
                type: "GET",
                url: "/estados/buscar",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success: function (response) {

                    let estados = response && response.estados && response.estados.length > 0 ? response.estados : []
                    let html = `<option value="" selected disabled>Selecione:</option>`

                    estados.forEach(estado => {
                        if(estado.id){
                            html += `<option value="${estado.id}">${estado.nm_abrev}</option>`
                        }
                    })

                    $(form).find('.combo-estados').html(html);

                    load('off', $(loader));
                    resolve()
                },
                error: function(error) {
                    load('off', $(loader));
                    resolve()
                }
            })
        })
    }

    async function getTiposCr(form, loader){

        load('on', $(loader));

        return new Promise(function(resolve, reject) {
            $.ajax({
                type: "POST",
                url: "/buscar/tipos/cr",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success: function (response) {

                    let crs = response && response.tipos_cr && response.tipos_cr.length > 0 ? response.tipos_cr : []
                    let html = `<option value="" selected disabled>Selecione:</option>`

                    crs.forEach(cr => {
                        if(cr){
                            html += `<option value="${cr}">${cr}</option>`
                        }
                    })

                    $(form).find('.combo-cr').html(html);

                    load('off', $(loader));
                    resolve()
                },
                error: function(error) {
                    load('off', $(loader));
                    resolve()
                }
            })
        })
    }

    async function getFornecedorPrescricao(form){

        return new Promise(function(resolve, reject) {
            $.ajax({
                type: "POST",
                url: "/fornecedor/receita",
                data: {
                    csrfmiddlewaretoken: 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                },
                success: function (response) {

                    let fornecedores = response && response.empresas && response.empresas.length > 0 ? response.empresas : []
                    let html = `<option value="" selected disabled>Selecione:</option>`

                    fornecedores.forEach(forne => {
                        if(forne.codigo){
                            html += `<option value="${forne.codigo}">${forne.informacao}</option>`
                        }
                    })

                    $(form).find('.combo-fornecedor-prescricao').html(html);

                    resolve()
                },
                error: function(error) {
                    resolve()
                }
            })
        })
    }

    let path_receita_carrinho
    function filepond_receita_carrinho(is_required){
        $('#receita_anexo_carrinho').filepond({
            allowFileTypeValidation: true,
            acceptedFileTypes: ["image/jpeg", "application/pdf"],
            allowMultiple: false,
            instantUpload: true,
            allowImagePreview: false,
            maxParallelUploads: 1,
            maxFiles: 1,
            required: is_required ? is_required : false,
            onprocessfilestart: function (file) {
                $('#form_upload_receita_carrinho').find('.submit-receita').addClass('isDisabled')
            },
            onprocessfiles: function () {
                $('#form_upload_receita_carrinho').find('.submit-receita').removeClass('isDisabled')
            },
            onremovefile: function (error, file) {
                $('#form_upload_receita_carrinho').find('.submit-receita').removeClass('isDisabled')
            },
            server: {
                process: (fieldName, file, metadata, load, error, progress, abort, transfer, options) => {

                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onloadend = function () {
                        var base64data = reader.result;
                        var data = new FormData();
                        data.append("csrfmiddlewaretoken", 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw');
                        data.append("nome", file.name);
                        data.append("arquivo", base64data);
                        data.append("diretorio", 'receitas/');
                        const request = new XMLHttpRequest();
                        request.open('POST', "/core/arquivo/salvar")
                        request.upload.onprogress = (e) => {
                            progress(e.lengthComputable, e.loaded, e.total);
                        };
                        request.onload = function () {
                            if (request.status >= 200 && request.status < 300) {
                                load(request.responseText);
                                let retorno = JSON.parse(request.response)
                                path_receita_carrinho = retorno.path
                            } else {
                                error('oh no');
                                toastr.error('Ocorreu um erro ao fazer o upload do arquivo.', 'Erro');
                            }
                        };
                        request.send(data);
                        return {
                            abort: () => {
                                toastr.error('Ocorreu um erro ao fazer o upload do arquivo.', 'Erro');
                                request.abort();
                                abort();
                                path_receita_carrinho = ''
                            }
                        };
                    }
                },
                revert: (uniqueFileId, load, error) => {
                    $.ajax({
                        type: "POST",
                        url: "/core/arquivo/deletar",
                        data: {
                            'csrfmiddlewaretoken': 'ZVU7DEfkPjQp0OzLukeb7va5Jf5eBxkGiq92wMgxcy4MxQ0IGHVV51alSdaIiNWw',
                            'path': JSON.parse(uniqueFileId).path,
                        },
                        success: function (data) {},
                        error: function (data) {}
                    });
                    load()
                    path_receita_carrinho = ''
                },
            },
            labelFileLoading: 'Carregando',
            labelFileProcessing: 'Carregando',
            labelTapToCsancel: 'Clique para cancelar',
            labelFileProcessingComplete: 'Upload completo',
            labelTapToUndo: 'Clique para remover',
            labelButtonRemoveItem: 'Remover',
            labelFileTypeNotAllowed: 'Extensão do arquivo inválida',
            fileValidateTypeLabelExpectedTypes: 'As seguintes esxtensões são esperadas: {allTypes}',
            fileValidateTypeLabelExpectedTypesMap: {'image/jpeg': 'JPG', 'application/pdf': 'PDF'},
            labelIdle: `<img src="/staticfiles/img/icons/icon_upload02.419c83c25873.svg" width="50" alt="" class="mr-2">Arraste o(s) arquivo(s) aqui ou <a  class="btn btn-outline-secondary btn-sm">Selecione do computador</a>`,
        })
    }

    try {

        $('#hora-limite-promocao-relampago, #minuto-limite-promocao-relampago').html(`
            <div class="base-timer">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g class="base-timer__circle" fill="none" stroke="none">
                        <circle stroke-width="10px" stroke="#ffdf98" cx="50" cy="50" r="45"></circle>
                        <path stroke-dasharray="283" class="base-timer-path-remaining base-timer__path-remaining"
                            d="M 50, 50 m -45, 0 a 45,45 0 1,0 90,0 a 45,45 0 1,0 -90,0">
                        </path>
                    </g>
                </svg>
                <span class="base-timer-label base-timer__label text-white label-promocao-relampago d-flex justify-content-center align-items-center font-weight-semibold"></span>
            </div>
        `)

        function startTimer(timer) {

            const FULL_DASH_ARRAY = 283;
            let TIME_LIMIT = 0;
            let time_inicio;
            let time_fim;
            let timePassed = 0;
            let timeLeft = TIME_LIMIT;
            let percent_restante = 100;
            let percent_min_restante = 100;

            let dat_atual = moment(new Date())
            let dat_limite = moment(timer)
            restante = dat_limite.diff(dat_atual, 'seconds')

            let dat_ini_dat_fim_diferenca = moment(timer).diff(moment(dat_limite).subtract(1, 'd'), 'seconds')
            let dat_atual_dat_fim_diferenca = moment(new Date()).diff(moment(dat_limite).subtract(1, 'd'), 'seconds')
            percent_restante = (dat_ini_dat_fim_diferenca - dat_atual_dat_fim_diferenca) / dat_ini_dat_fim_diferenca * 100

            let timerInterval = setInterval(() => {

                timePassed = timePassed + 1;

                timeLeft = restante - timePassed;

                let hrs_restantes, min_restantes, seg_restantes;
                
                if(timeLeft > 0){
                    hrs_restantes = moment.utc(timeLeft * 1000).format("HH")
                    min_restantes = moment.utc(timeLeft * 1000).format("mm")
                    seg_restantes = moment.utc(timeLeft * 1000).format("ss")
                } else {
                    hrs_restantes = 0
                    min_restantes = 0
                    seg_restantes = 0

                    if($('.carrossel-especial').length){
                        $('.carrossel-especial').find('button').addClass('isDisabled')
                    }

                    // if($('.produto-footer-produto-template').length){
                    //     $('.produto-footer-produto-template').find('button').addClass('isDisabled')
                    // }
                }

                percent_min_restante = min_restantes ? (min_restantes / 60) * 100 : 0

                $('#hora-limite-promocao-relampago').find('.base-timer-label').html(hrs_restantes)
                $('#minuto-limite-promocao-relampago').find('.base-timer-label').html(min_restantes)

                const circleDasharrayHours = `${hrs_restantes ? (FULL_DASH_ARRAY / 100) * percent_restante : 0} ${FULL_DASH_ARRAY}`;
                const circleDasharrayMinutes = `${min_restantes ? (FULL_DASH_ARRAY / 100) * percent_min_restante : 0} ${FULL_DASH_ARRAY}`;

                $('#hora-limite-promocao-relampago').find('.base-timer-path-remaining').attr("stroke-dasharray", circleDasharrayHours)
                $('#minuto-limite-promocao-relampago').find('.base-timer-path-remaining').attr("stroke-dasharray", circleDasharrayMinutes)

                if (!timeLeft || timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

    } catch (error) {

    }

</script>
<script>

    function aplicativo_login(usuario, senha, hash) {
        let pagina_anterior = document.referrer;
        $.ajax({
            type: "POST",
            url: "/cliente/login/aplicativo",
            data: {
                'username': usuario,
                'password': senha,
                'hash': hash
            },
            success: async function (data) {
                if (data.status) {
                } else {
                }
            }
        });
    }

</script>

<script>
    $(document).ready(function () {
        
        $(".carousel-topo").nextAll().fadeIn(1000);
    });
</script>


<!-- Js white Label -->


    <script>

        function carregar_carrossel() {
            
                $('.item>a>[width="360"]').parent().parent().remove();
                $('.mobile-banner').parent().remove();
            

            let slider_id = '.carousel-topo';
            let slider_config = {
                "title": "Banner Home",
                "show_title": "0",
                "status": "1",
                "scheduled_ajax": null,
                "nav": "0",
                "dots": "1",
                "center": "0",
                "items": "1",
                "loop": "1",
                "margin": "0",
                "merge": null,
                "URLhashListener": null,
                "stagePadding": "0",
                "lazyLoad": "0",
                "transition": "fadeOut",
                "autoplay": "1",
                "autoplayTimeout": "6000",
                "autoplayHoverPause": "1",
                "autoHeight": "0",
                "nav_brk1": "0",
                "items_brk1": "1",
                "nav_brk2": "0",
                "items_brk2": "1",
                "nav_brk3": "0",
                "items_brk3": "1",
                "nav_brk4": "0",
                "items_brk4": "1"
            };

            let items = ((slider_config.items >= 0 && slider_config.items != null) ? slider_config.items : 1);
            if (slider_config.transition !== 'slide') {
                items = 1;
            }

            let stagePadding = slider_config.stagePadding !== '' ? parseInt(slider_config.stagePadding) : 0;
            let animate_Out = slider_config.transition !== 'fadeOut';


            /** Lazyload bug when fewer items exist in the carousel then the ones displayed */
            $(slider_id).on('initialized.owl.carousel', function (event) {
                let scopeSize = event.page.size;
                for (let i = 0; i < scopeSize; i++) {
                    let imgsrc = $(event.target).find('.owl-item').eq(i).find('img').attr('data-src');
                    $(event.target).find('.owl-item').eq(i).find('img').attr('src', imgsrc);
                    $(event.target).find('.owl-item').eq(i).find('img').attr('style', 'opacity: 1;');
                }
            });

            $(slider_id).owlCarousel({
                dots: parseInt(slider_config.dots) === 1,
                center: (slider_config.center === 1 && animate_Out),
                items: 1,
                loop: parseInt(slider_config.loop) === 1,
                margin: 20,
                stagePadding: parseInt(slider_config.center) === 1 ? 0 : stagePadding,
                lazyLoad: false,
                autoplay: parseInt(slider_config.autoplay) === 1,
                autoplayTimeout: 6000,
                autoplayHoverPause: parseInt(slider_config.autoplayHoverPause) === 1,
                autoHeight: parseInt(slider_config.autoHeight) === 1,
                animateOut: "fadeOut",
                animateIn: "slideron",
                nav: false,
                navClass: ["prev p-2", "next p-2"],
                navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
            });

            $('.produtos').each(function (index, element) {
                var isLoop = true;

                if (window.matchMedia('(min-width):1200px')) {
                    isLoop = $(element).find('.item').length >= 5;
                } else if (window.matchMedia('(min-width):768px')) {
                    isLoop = $(element).find('.item').length >= 4;
                } else if (window.matchMedia('(min-width):600px')) {
                    isLoop = $(element).find('.item').length >= 3;
                } else if (window.matchMedia('(min-width):0px')) {
                    isLoop = $(element).find('.item').length >= 2;
                }

                if(!$(element).hasClass('carrossel-dois-produtos')){
                    $(element).owlCarousel({
                        loop: isLoop,
                        margin: 10,
                        dots: true,
                        stagePaddingRight: 80,
                        stagePaddingLeft: 1,
                        lazyLoad: false,
                        nav: true,
                        navClass: ["prev p-2", "next p-2"],
                        navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
                        responsive: {
                            0: {
                                items: 2,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            600: {
                                items: 3,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },

                            768: {
                                items: 4,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            800: {
                                items: 4,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            1000: {
                                items: 4,
                                margin: 10,
                                stagePaddingLeft: 1,
                            },
                            1200: {
                                items: 5,
                                margin: 10,
                                stagePaddingLeft: 1,
                            },
                        }
                    });
                } else {
                    $(element).owlCarousel({
                        loop: isLoop,
                        margin: 10,
                        dots: true,
                        stagePaddingRight: 80,
                        stagePaddingLeft: 1,
                        lazyLoad: false,
                        nav: true,
                        navClass: ["prev p-2", "next p-2"],
                        navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
                        responsive: {
                            0: {
                                items: 2,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            600: {
                                items: 2,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },

                            768: {
                                items: 2,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            800: {
                                items: 2,
                                margin: 5,
                                stagePaddingLeft: 1,
                                stagePaddingRight: 25,
                            },
                            1000: {
                                items: 2,
                                margin: 10,
                                stagePaddingLeft: 1,
                            },
                            1200: {
                                items: 2,
                                margin: 10,
                                stagePaddingLeft: 1,
                            },
                        }
                    });
                }
            });

            
                $('.categorias').find('.img-carousel-categoria').attr('width', '120').css('max-width', '120px');
                $('.categorias').find('.img-carousel-categoria').attr('height', '160');
            

            
            $('.categorias').owlCarousel({
                loop: true,
                nav: true,
                dots: true,
                stagePaddingRight: 1,
                stagePaddingLeft: 10,
                navClass: ["prev p-2", "next p-2"],
                navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
                responsive: {
                    0: {
                        items: 3,
                        margin: 20,
                    },
                    390: {
                        items: 3,
                        margin: 20,
                    },

                    450: {
                        items: 3,
                        margin: 20,
                    },

                    600: {
                        items: 4,
                        margin: 25,
                    },
                    800: {
                        items: 5,
                        margin: 35,
                    },
                    1000: {
                        items: 6,
                        margin: 50,
                    },
                    1200: {
                        items: 6,
                        margin: 70,
                    },
                }
            });

            $('.marcas-carousel').owlCarousel({
                loop: true,
                nav: true,
                dots: true,
                stagePaddingRight: 1,
                margin:10,
                stagePaddingLeft: 10,
                navClass: ["prev p-2", "next p-2"],
                navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
                responsive: {
                    0: {
                        items: 3,
                        margin: 20,
                    },
                    390: {
                        items: 3,
                        margin: 20,
                    },

                    450: {
                        items: 3,
                        margin: 20,
                    },

                    600: {
                        items: 4,
                        margin: 25,
                    },
                    800: {
                        items: 5,
                        margin: 35,
                    },
                    1000: {
                        items: 6,
                        margin: 50,
                    },
                    1200: {
                        items: 6,
                        margin: 70,
                    },
                }
            });

            $('.owl-carousel-especial').owlCarousel({
                loop: true,
                margin: 10,
                dots: true,
                stagePaddingRight: 80,
                stagePaddingLeft: 1,
                lazyLoad: false,
                nav: true,
                navClass: ["prev p-2", "next p-2"],
                navText:["<p class='font-weight-bold icon_arrow-back01 font-2xl' style='color: #242a46'></p>","<p class='font-weight-bold icon_arrow-next01 font-2xl' style='color: #242a46'></p>"],
                responsive: {
                    0: {
                        items: 1,
                        stagePaddingLeft: 1,
                        stagePaddingRight: 120,
                    },
                    600: {
                        items: 3,
                    },
                }
            });
        }
        $('.preview-carousel-produtos').remove();
        $('.preview-carousel-categorias').remove();
        $('.imagem_preview_banner').remove();
        carregar_carrossel();


    </script>


</body>

</html>
